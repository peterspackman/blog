(()=>{var t={5051:(t,e,s)=>{"use strict";t.exports=s.p+"9fa85ed00b68a123.js"},6206:(t,e,s)=>{"use strict";t.exports=s.p+"e787fb8b01b19848.wasm"}},e={};function s(a){var n=e[a];if(void 0!==n)return n.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,s),i.exports}s.m=t,s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.p="/",s.gca=function(t){return t={}[t]||t,s.p+s.u(t)},s.b=self.location+"/../../../";let a=null,n=!1,i=!1,r=!1;const o="/sim";async function c(){if(!n&&!i){i=!0;try{postMessage({type:"stdout",data:"Loading LAMMPS WebAssembly script..."}),importScripts(new URL(s(5051),s.b).href),postMessage({type:"stdout",data:"LAMMPS script loaded, waiting for runtime initialization..."})}catch(t){i=!1,postMessage({type:"error",data:`Failed to load LAMMPS script: ${t.message}`})}}}function d(t){try{return a.FS.stat(t),!0}catch{return!1}}function l(t){return`${o}/${t}`}function p(){if(!n||!a)throw new Error("LAMMPS worker not initialized")}self.Module={print:t=>postMessage({type:"stdout",data:t}),printErr:t=>postMessage({type:"stderr",data:t}),locateFile:(t,e)=>"lmp.wasm"===t?new URL(s(6206),s.b).href:e+t,onRuntimeInitialized:()=>{postMessage({type:"stdout",data:"LAMMPS runtime initialized"}),a=self.Module,function(){try{(function(t){try{return 16384==(61440&a.FS.stat(t).mode)}catch{return!1}})(o)||a.FS.mkdir(o),n=!0,i=!1,postMessage({type:"stdout",data:`Simulation directory '${o}' ready`}),postMessage({type:"ready",data:"LAMMPS worker ready"})}catch(t){i=!1,postMessage({type:"error",data:`Failed to initialize file system: ${t.message}`})}}()},onAbort:t=>{i=!1,postMessage({type:"error",data:`LAMMPS WebAssembly aborted: ${t}`})},INITIAL_MEMORY:268435456,MAXIMUM_MEMORY:2147483648,ALLOW_MEMORY_GROWTH:!0,NO_EXIT_RUNTIME:!0,FORCE_FILESYSTEM:!0};const f={"upload-file":async function(t,e){p();const{name:s,content:n}=t,i=l(s);try{const t=n instanceof Uint8Array?n:new Uint8Array(n);a.FS.writeFile(i,t),postMessage({type:"file-uploaded",data:{filename:s,size:t.length,path:i},id:e})}catch(r){throw new Error(`Failed to upload ${s}: ${r.message}`)}},"upload-files":async function(t,e){p();const s=[];for(const i of t)try{const{name:t,content:e}=i,n=l(t),r=e instanceof Uint8Array?e:new Uint8Array(e);a.FS.writeFile(n,r),s.push({filename:t,size:r.length,path:n,status:"uploaded"})}catch(n){s.push({filename:i.name,status:"error",error:n.message})}postMessage({type:"files-uploaded",data:s,id:e})},"run-lammps":async function(t,e){if(p(),r)throw new Error("LAMMPS simulation already running. Cancel current run first.");const{inputContent:s,inputFile:n}=t;let i=n;try{if(r=!0,postMessage({type:"stdout",data:"=== Starting LAMMPS Simulation ==="}),s){i=i||"input.lmp";const t=l(i);a.FS.writeFile(t,s),postMessage({type:"stdout",data:`Input script written to ${i}`})}if(!i)throw new Error("No input file specified and no input content provided");if(!d(l(i)))throw new Error(`Input file ${i} not found in simulation directory`);a.FS.chdir(o),postMessage({type:"stdout",data:`> lmp -in ${i}`});const t=["-in",i],n=a.callMain?a.callMain(t):0;r=!1,postMessage({type:"completed",data:{exitCode:n,message:`Simulation completed with exit code: ${n}`,inputFile:i},id:e})}catch(c){throw r=!1,new Error(`LAMMPS execution failed: ${c.message}`)}},"delete-file":async function(t,e){p();const{filename:s}=t,n=l(s);try{d(n)?(a.FS.unlink(n),postMessage({type:"file-deleted",data:{filename:s,path:n},id:e})):postMessage({type:"file-not-found",data:{filename:s,message:`File ${s} not found`},id:e})}catch(i){throw new Error(`Failed to delete ${s}: ${i.message}`)}},"delete-files":async function(t,e){p();const{filenames:s}=t,n=[];for(const r of s)try{const t=l(r);d(t)?(a.FS.unlink(t),n.push({filename:r,status:"deleted"})):n.push({filename:r,status:"not-found"})}catch(i){n.push({filename:r,status:"error",error:i.message})}postMessage({type:"files-deleted",data:n,id:e})},"get-file":async function(t,e){p();const{filename:s}=t,n=l(s);try{if(!d(n))throw new Error(`File ${s} not found`);const t=a.FS.readFile(n);postMessage({type:"file-content",data:{filename:s,content:t,size:t.length},id:e})}catch(i){throw new Error(`Failed to read ${s}: ${i.message}`)}},"list-files":async function(t,e){p();try{const t=a.FS.readdir(o).filter(t=>"."!==t&&".."!==t).map(t=>{const e=l(t),s=a.FS.stat(e),n=16384==(61440&s.mode);return{name:t,size:s.size,isDirectory:n,path:e}});postMessage({type:"file-list",data:t,id:e})}catch(s){throw new Error(`Failed to list files: ${s.message}`)}},"clear-files":async function(t,e){p();try{const t=a.FS.readdir(o).filter(t=>"."!==t&&".."!==t);let n=0;const i=[];for(const e of t)try{const t=l(e);a.FS.unlink(t),n++}catch(s){i.push({filename:e,error:s.message})}postMessage({type:"files-cleared",data:{deletedCount:n,errors:i,message:`Cleared ${n} files from simulation directory`},id:e})}catch(s){throw new Error(`Failed to clear files: ${s.message}`)}},"get-file-info":async function(t,e){p();const{filename:s}=t,n=l(s);try{if(!d(n))throw new Error(`File ${s} not found`);const t=a.FS.stat(n);postMessage({type:"file-info",data:{filename:s,size:t.size,isDirectory:t.isDirectory(),path:n},id:e})}catch(i){throw new Error(`Failed to get info for ${s}: ${i.message}`)}},"poll-trajectory":async function(t,e){p();const s=[/trajectory\.xyz$/i,/\.xyz$/i,/\.dcd$/i,/\.lammpstrj$/i];try{const t=a.FS.readdir(o).filter(t=>"."!==t&&".."!==t),i=[];for(const e of t){if(s.some(t=>t.test(e))){const t=l(e);try{const s=a.FS.stat(t);let n="xyz";/\.dcd$/i.test(e)?n="dcd":/\.lammpstrj$/i.test(e)&&(n="lammpstrj"),i.push({filename:e,size:s.size,path:t,format:n})}catch(n){}}}postMessage({type:"trajectory-files",data:i,id:e})}catch(i){postMessage({type:"trajectory-files",data:[],id:e})}},"get-trajectory":async function(t,e){p();const{filename:s}=t,n=l(s);try{if(!d(n))return void postMessage({type:"trajectory-content",data:{filename:s,content:new Uint8Array(0),size:0},id:e});const t=a.FS.readFile(n);postMessage({type:"trajectory-content",data:{filename:s,content:t,size:t.length},id:e})}catch(i){postMessage({type:"trajectory-content",data:{filename:s,content:new Uint8Array(0),size:0,error:i.message},id:e})}}};self.onmessage=async function(t){const{type:e,data:s,id:a}=t.data;try{if("init"===e)return void await c();const t=f[e];if(!t)throw new Error(`Unknown message type: ${e}`);await t(s,a)}catch(n){postMessage({type:"error",data:n.message,id:a})}},c().catch(t=>{postMessage({type:"error",data:`Worker initialization failed: ${t.message}`})})})();