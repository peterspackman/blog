"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1288],{5066:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Cs});var a=s(6540),n=s(1656);const r="container_Qh_B",l="layout_SyMw",i="sidebar_Cwvp",o="content_ak_G",c="tabs_tRXw",d="tab_F12w",u="tabContent_hF_7",m="collapsibleSection_Nmyk",h="sectionHeader_qShV",p="sectionTitle_aNil",x="chevron_b8vT",v="sectionContent_NPTV",j="chevronExpanded_ry9E",g="status_l6dK",f="statusLoading_AJab",N="statusReady_FVt8",b="moleculeInfo_KKVy",y="button_XSDO",_="stickyButtons_GEQA",S="buttonPrimary_eux_",C="buttonDanger_gLI_",$="tabActive_fzT3",w="propertiesTab_ipsn",k="structureTab_HvbL",F="noStructure_y5fR",E="matricesSection_omrz",M="noMatrices_bajq",O="orbitalsCard_tkcK",z="orbitalGrid_Wtwa",L="moreOrbitals_oRmJ",R="errorModal_HssV",T="errorContent_nEMj",I="optimizationTab_sFuH",H="optimizationSummary_Qbys",D="optimizationHeader_o9LX",V="summaryGrid_miSr",B="summaryItem_TeDs",A="summaryLabel_ItYF",q="summaryValue_eJ3Z",P="converged_TVV4",X="notConverged_zYdK",Y="trajectoryViewerContainer_y8Ak",G="optimizationLayout_h32e",Z="trajectoryViewerSection_ZNX4",U="trajectoryControlsPanel_mPQs",W="trajectoryControlsHeader_NJya",K="trajectoryModeSection_Fa3j",J="modeButton_mefH",Q="active_TuRi",ee="frequenciesControlSection_yYHA",te="frequenciesSectionHeader_PauO",se="frequencySettings_wwcQ",ae="checkboxLabel_yHfy",ne="checkbox_PB7n",re="modesList_XfUU",le="modeItem_NeQD",ie="modeSelected_GfpX",oe="modeSelectedIndicator_koJh",ce="modeInfo_QcHf",de="modeNumber_aQX4",ue="modeValue_Thd_",me="imaginaryBadge_edwd",he="frequencySummary_MO4Z",pe="section_X2kF",xe="exampleSection_iMDs",ve="exampleLabel__wK2",je="exampleSelect_VuLc",ge="inputContainer_aHUj",fe="headerRow_MA_E",Ne="label_1fak",be="controls_Azqc",ye="browseButton_eNgL",_e="combinedInput_AOvI",Se="dragging_F5j2",Ce="valid_peYL",$e="invalid_Yt4V",we="clearButton_KExK",ke="xyzTextarea_Jaou",Fe="errorMessage_OUge";var Ee=s(4848);const Me={formaldehyde:{name:"Formaldehyde (CH\u2082O)",xyz:"4\nFormaldehyde\nH  1.0686 -0.1411  1.0408\nC  0.5979  0.0151  0.0688\nH  1.2687  0.2002 -0.7717\nO -0.5960 -0.0151 -0.0686"},water:{name:"Water (H\u2082O)",xyz:"3\nWater molecule\nO  0.000000  0.000000  0.000000\nH  0.757000  0.586000  0.000000\nH -0.757000  0.586000  0.000000"},urea:{name:"Urea (CH\u2084N\u2082O)",xyz:"8\nUrea molecule\nC  0.000000  0.000000  0.000000\nO  0.000000  1.220000  0.000000\nN  1.150000 -0.610000  0.000000\nN -1.150000 -0.610000  0.000000\nH  1.150000 -1.610000  0.000000\nH  2.050000 -0.110000  0.000000\nH -1.150000 -1.610000  0.000000\nH -2.050000 -0.110000  0.000000"},formamide:{name:"Formamide (CH\u2083NO)",xyz:"6\nFormamide molecule\nC  0.000000  0.000000  0.000000\nO  1.220000  0.000000  0.000000\nN -0.610000  1.150000  0.000000\nH -0.610000 -0.950000  0.000000\nH -1.610000  1.150000  0.000000\nH -0.110000  2.050000  0.000000"},methane:{name:"Methane (CH\u2084)",xyz:"5\nMethane molecule\nC  0.000000  0.000000  0.000000\nH  0.629000  0.629000  0.629000\nH -0.629000 -0.629000  0.629000\nH -0.629000  0.629000 -0.629000\nH  0.629000 -0.629000 -0.629000"},ammonia:{name:"Ammonia (NH\u2083)",xyz:"4\nAmmonia molecule\nN  0.000000  0.000000  0.000000\nH  0.000000  0.950000  0.330000\nH  0.820000 -0.480000  0.330000\nH -0.820000 -0.480000  0.330000"},ethylene:{name:"Ethylene (C\u2082H\u2084)",xyz:"6\nEthylene molecule\nC  0.000000  0.000000  0.668000\nC  0.000000  0.000000 -0.668000\nH  0.000000  0.923000  1.232000\nH  0.000000 -0.923000  1.232000\nH  0.000000  0.923000 -1.232000\nH  0.000000 -0.923000 -1.232000"}},Oe=({onFileLoad:e,onValidationChange:t})=>{const[s,n]=(0,a.useState)(""),[r,l]=(0,a.useState)(""),[i,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)("formaldehyde"),[u,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)(""),x=(0,a.useRef)(null),v=(0,a.useRef)(null),j=e=>{try{const t=e.trim().split("\n").filter((e=>e.trim()));if(t.length<3)return{isValid:!1,error:"XYZ file must have at least 3 lines"};const s=parseInt(t[0]);if(isNaN(s)||s<=0)return{isValid:!1,error:"First line must be a positive integer (number of atoms)"};const a=t.slice(2);if(a.length<s)return{isValid:!1,error:`Expected ${s} atom lines, but found ${a.length}`};const n=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr"];for(let e=0;e<s;e++){const t=a[e].trim().split(/\s+/);if(t.length<4)return{isValid:!1,error:`Line ${e+3}: Expected element symbol and 3 coordinates`};const s=t[0];if(!n.includes(s))return{isValid:!1,error:`Line ${e+3}: Unknown element '${s}'`};for(let a=1;a<=3;a++){const s=parseFloat(t[a]);if(isNaN(s))return{isValid:!1,error:`Line ${e+3}: Invalid coordinate '${t[a]}'`}}}return{isValid:!0}}catch(t){return{isValid:!1,error:"Failed to parse XYZ format: "+t.message}}};(0,a.useEffect)((()=>{const s=Me.formaldehyde;l(s.xyz),n(""),d("formaldehyde"),m(!0),p(""),e(s.xyz),t&&t(!0)}),[]),(0,a.useEffect)((()=>()=>{v.current&&clearTimeout(v.current)}),[]);const g=async s=>{const a=s.name.split(".").pop()?.toLowerCase();if("xyz"===a){n(s.name);try{const a=await s.text();l(a);const n=j(a);m(n.isValid),p(n.error||""),n.isValid&&e(a),t&&t(n.isValid,n.error)}catch(r){console.error("Error reading file:",r),alert("Failed to read file: "+r.message)}}else alert("Please upload an XYZ file.")};return(0,Ee.jsxs)("div",{className:pe,children:[(0,Ee.jsxs)("div",{className:xe,children:[(0,Ee.jsx)("label",{className:ve,children:"Example Molecules"}),(0,Ee.jsxs)("select",{value:c,onChange:s=>{const a=s.target.value;if(a&&Me[a]){const s=Me[a];l(s.xyz),n(""),d(a),m(!0),p(""),e(s.xyz),t&&t(!0),x.current&&(x.current.value="")}},className:je,children:[(0,Ee.jsx)("option",{value:"",children:"Select an example..."}),Object.entries(Me).map((([e,t])=>(0,Ee.jsx)("option",{value:e,children:t.name},e)))]})]}),(0,Ee.jsxs)("div",{className:ge,children:[(0,Ee.jsxs)("div",{className:fe,children:[(0,Ee.jsx)("span",{className:Ne,children:"XYZ Coordinates"}),(0,Ee.jsxs)("div",{className:be,children:[(0,Ee.jsx)("button",{onClick:e=>{e.stopPropagation(),x.current?.click()},className:ye,children:"Browse"}),(s||r)&&(0,Ee.jsx)("button",{onClick:()=>{n(""),l(""),d(""),m(!0),p(""),t&&t(!0),x.current&&(x.current.value="")},className:we,children:"Clear"})]})]}),(0,Ee.jsxs)("div",{className:`${_e} ${i?Se:""} ${u?r.trim()?Ce:"":$e}`,onDrop:e=>{e.preventDefault(),o(!1);const t=e.dataTransfer.files[0];t&&g(t)},onDragOver:e=>{e.preventDefault(),o(!0)},onDragLeave:()=>{o(!1)},children:[(0,Ee.jsx)("textarea",{value:r,onChange:s=>{const a=s.target.value;l(a),n(""),d(""),v.current&&clearTimeout(v.current),v.current=setTimeout((()=>{if(a.trim()){const s=j(a);m(s.isValid),p(s.error||""),s.isValid&&e(a),t&&t(s.isValid,s.error)}else m(!0),p(""),t&&t(!0)}),300)},placeholder:s?`Loaded: ${s}`:"Select an example molecule above or drag & drop XYZ file here",rows:8,className:ke}),(0,Ee.jsx)("input",{ref:x,type:"file",accept:".xyz",onChange:e=>{const t=e.target.files?.[0];t&&g(t)},style:{display:"none"}})]}),!u&&h&&(0,Ee.jsx)("div",{className:Fe,children:h})]})]})},ze="section_H6hy",Le="field_rd2A",Re="checkboxLabel_PBvi",Te="disabled_hTIz",Ie="fieldDescription_BWzj",He=({method:e,setMethod:t,basisSet:s,setBasisSet:a,maxIterations:n,setMaxIterations:r,energyTolerance:l,setEnergyTolerance:i,logLevel:o,setLogLevel:c,optimize:d,setOptimize:u,computeFrequencies:m,setComputeFrequencies:h})=>(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:ze,children:[(0,Ee.jsx)("h3",{children:"Calculation Method"}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("label",{children:"Theory Level"}),(0,Ee.jsxs)("select",{value:e,onChange:e=>t(e.target.value),children:[(0,Ee.jsx)("option",{value:"hf",children:"Hartree-Fock (HF)"}),(0,Ee.jsx)("option",{value:"dft-b3lyp",children:"DFT (B3LYP)"}),(0,Ee.jsx)("option",{value:"dft-pbe",children:"DFT (PBE)"}),(0,Ee.jsx)("option",{value:"dft-pbe0",children:"DFT (PBE0)"}),(0,Ee.jsx)("option",{value:"dft-blyp",children:"DFT (BLYP)"}),(0,Ee.jsx)("option",{value:"dft-wb97x",children:"DFT (\u03c9B97X)"})]})]}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("label",{children:"Basis Set"}),(0,Ee.jsxs)("select",{value:s,onChange:e=>a(e.target.value),children:[(0,Ee.jsx)("option",{value:"sto-3g",children:"STO-3G"}),(0,Ee.jsx)("option",{value:"3-21g",children:"3-21G"}),(0,Ee.jsx)("option",{value:"6-31g",children:"6-31G"}),(0,Ee.jsx)("option",{value:"6-31g(d,p)",children:"6-31G(d,p)"}),(0,Ee.jsx)("option",{value:"6-311g(d,p)",children:"6-311G(d,p)"}),(0,Ee.jsx)("option",{value:"def2-svp",children:"def2-SVP"}),(0,Ee.jsx)("option",{value:"def2-tzvp",children:"def2-TZVP"}),(0,Ee.jsx)("option",{value:"cc-pvdz",children:"cc-pVDZ"}),(0,Ee.jsx)("option",{value:"cc-pvtz",children:"cc-pVTZ"}),(0,Ee.jsx)("option",{value:"cc-pvqz",children:"cc-pVQZ"}),(0,Ee.jsx)("option",{value:"pcseg-0",children:"pc-0"}),(0,Ee.jsx)("option",{value:"pcseg-1",children:"pc-1"}),(0,Ee.jsx)("option",{value:"pcseg-2",children:"pc-2"}),(0,Ee.jsx)("option",{value:"pcseg-3",children:"pc-3"}),(0,Ee.jsx)("option",{value:"aug-pcseg-1",children:"aug-pc-1"}),(0,Ee.jsx)("option",{value:"aug-pcseg-2",children:"aug-pc-2"})]})]})]}),(0,Ee.jsxs)("div",{className:ze,children:[(0,Ee.jsx)("h3",{children:"Calculation Options"}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsxs)("label",{className:Re,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:d,onChange:e=>u(e.target.checked)}),(0,Ee.jsx)("span",{children:"Geometry Optimization"})]}),(0,Ee.jsx)("small",{className:Ie,children:"Optimize molecular geometry to find minimum energy structure"})]}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsxs)("label",{className:`${Re} ${d?"":Te}`,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:m,onChange:e=>h(e.target.checked),disabled:!d}),(0,Ee.jsx)("span",{children:"Vibrational Frequencies"})]}),(0,Ee.jsx)("small",{className:Ie,children:"Calculate vibrational frequencies after optimization (requires optimization)"})]})]}),(0,Ee.jsxs)("div",{className:ze,children:[(0,Ee.jsx)("h3",{children:"SCF Settings"}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("label",{children:"Max Iterations"}),(0,Ee.jsx)("input",{type:"number",min:"10",max:"500",value:n,onChange:e=>r(parseInt(e.target.value))})]}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("label",{children:"Energy Tolerance"}),(0,Ee.jsxs)("select",{value:l.toString(),onChange:e=>i(parseFloat(e.target.value)),children:[(0,Ee.jsx)("option",{value:"1e-6",children:"1e-6"}),(0,Ee.jsx)("option",{value:"1e-7",children:"1e-7"}),(0,Ee.jsx)("option",{value:"1e-8",children:"1e-8"}),(0,Ee.jsx)("option",{value:"1e-9",children:"1e-9"}),(0,Ee.jsx)("option",{value:"1e-10",children:"1e-10"})]})]}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("label",{children:"Log Level"}),(0,Ee.jsxs)("select",{value:o,onChange:e=>c(parseInt(e.target.value)),children:[(0,Ee.jsx)("option",{value:"0",children:"Trace"}),(0,Ee.jsx)("option",{value:"1",children:"Debug"}),(0,Ee.jsx)("option",{value:"2",children:"Info"}),(0,Ee.jsx)("option",{value:"3",children:"Warning"}),(0,Ee.jsx)("option",{value:"4",children:"Error"}),(0,Ee.jsx)("option",{value:"5",children:"Critical"})]})]})]})]}),De="container_R89I",Ve="summaryGrid_ag2i",Be="energyCard_YXOX",Ae="statusCard_RoU8",qe="propertiesCard_AHmH",Pe="primaryEnergy_Xokq",Xe="secondaryEnergy_Gl5x",Ye="propertyItem_grVF",Ge="exportSection_Tufw",Ze="exportButtons_Op6D",Ue="exportButton_Xvg9",We="energyValues_pzt_",Ke="statusInfo_hd1b",Je="convergenceStatus_AYcc",Qe="converged_xwWE",et="notConverged_Y8IO",tt="timing_HvIZ",st="propertyList_aAAD",at="propertyLabel_Acxr",nt="propertyValue_OR5o",rt="exportButtonDisabled_HPmD",lt="noResults_jWfa",it=({results:e})=>{if(!e)return(0,Ee.jsxs)("div",{className:lt,children:[(0,Ee.jsx)("h3",{children:"No Results Yet"}),(0,Ee.jsx)("p",{children:"Run a calculation to see results here."})]});const t=t=>{if(!e.wavefunctionData)return;let s,a,n;switch(t){case"fchk":if(!e.wavefunctionData.fchk)return void alert("FCHK data not available.");s=e.wavefunctionData.fchk,a="wavefunction.fchk",n="text/plain";break;case"json":s=JSON.stringify({energy:e.energy,energyInEV:e.energyInEV,properties:e.properties,numBasisFunctions:e.wavefunctionData.numBasisFunctions,numAtoms:e.wavefunctionData.numAtoms,calculationTime:e.elapsedMs},null,2),a="wavefunction.json",n="application/json"}const r=new Blob([s],{type:n}),l=URL.createObjectURL(r),i=document.createElement("a");i.href=l,i.download=a,i.click(),URL.revokeObjectURL(l)};return(0,Ee.jsxs)("div",{className:De,children:[(0,Ee.jsxs)("div",{className:Ve,children:[(0,Ee.jsxs)("div",{className:Be,children:[(0,Ee.jsx)("h4",{children:"Total Energy"}),(0,Ee.jsxs)("div",{className:We,children:[(0,Ee.jsxs)("div",{className:Pe,children:[e.energy.toFixed(8)," Eh"]}),(0,Ee.jsxs)("div",{className:Xe,children:[e.energyInEV.toFixed(6)," eV"]})]})]}),(0,Ee.jsxs)("div",{className:Ae,children:[(0,Ee.jsx)("h4",{children:"Status"}),(0,Ee.jsxs)("div",{className:Ke,children:[(0,Ee.jsx)("div",{className:`${Je} ${e.converged?Qe:et}`,children:e.converged?"\u2713 Converged":"\u2717 Not Converged"}),(0,Ee.jsx)("div",{className:tt,children:(s=e.elapsedMs,`${Math.floor(s/1e3)}s ${Math.round(s%1e3)}ms`)})]})]}),e.properties&&(0,Ee.jsxs)("div",{className:qe,children:[(0,Ee.jsx)("h4",{children:"Key Properties"}),(0,Ee.jsxs)("div",{className:st,children:[void 0!==e.properties.homo&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:at,children:"HOMO:"}),(0,Ee.jsxs)("span",{className:nt,children:[e.properties.homo.toFixed(6)," Eh"]})]}),void 0!==e.properties.lumo&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:at,children:"LUMO:"}),(0,Ee.jsxs)("span",{className:nt,children:[e.properties.lumo.toFixed(6)," Eh"]})]}),void 0!==e.properties.gap&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:at,children:"Gap:"}),(0,Ee.jsxs)("span",{className:nt,children:[e.properties.gap.toFixed(6)," Eh"]})]})]})]})]}),e.wavefunctionData&&(0,Ee.jsxs)("div",{className:Ge,children:[(0,Ee.jsx)("h4",{children:"Export Wavefunction"}),(0,Ee.jsxs)("div",{className:Ze,children:[(0,Ee.jsx)("button",{className:Ue,onClick:()=>t("json"),children:"\u2193 JSON"}),(0,Ee.jsxs)("button",{className:e.wavefunctionData.fchk?Ue:`${Ue} ${rt}`,onClick:()=>e.wavefunctionData.fchk?t("fchk"):alert("FCHK data not available. Check the calculation logs for details."),disabled:!e.wavefunctionData.fchk,title:e.wavefunctionData.fchk?"Download FCHK file":"FCHK generation failed - see logs",children:["\u2193 FCHK ",!e.wavefunctionData.fchk&&"(unavailable)"]})]})]})]});var s},ot={container:"container_BYXD",header:"header_RGzB",controls:"controls_Rvup",button:"button_YEOU",buttonActive:"buttonActive_nb5D",logOutput:"logOutput_RpAa",noLogs:"noLogs_oYTM",logEntry:"logEntry_Oa3L",timestamp:"timestamp__Tyr",message:"message_A8Nt","log-debug":"log-debug_cHxc","log-info":"log-info_Lwm5","log-warn":"log-warn_SwuY","log-error":"log-error_TdP2"},ct=({logs:e})=>{const[t,s]=(0,a.useState)(!0),n=(0,a.useRef)(null);(0,a.useEffect)((()=>{t&&n.current&&(n.current.scrollTop=n.current.scrollHeight)}),[e,t]);return(0,Ee.jsxs)("div",{className:ot.container,children:[(0,Ee.jsxs)("div",{className:ot.header,children:[(0,Ee.jsx)("h3",{children:"Calculation Output"}),(0,Ee.jsx)("div",{className:ot.controls,children:(0,Ee.jsx)("button",{className:`${ot.button} ${t?ot.buttonActive:""}`,onClick:()=>s(!t),children:t?"Auto-scroll ON":"Auto-scroll OFF"})})]}),(0,Ee.jsx)("div",{ref:n,className:ot.logOutput,children:0===e.length?(0,Ee.jsx)("div",{className:ot.noLogs,children:"No output yet. Run a calculation to see logs."}):e.map(((e,t)=>{return(0,Ee.jsxs)("div",{className:`${ot.logEntry} ${ot[`log-${e.level}`]}`,children:[(0,Ee.jsxs)("span",{className:ot.timestamp,children:["[",(s=e.timestamp,s.toLocaleTimeString()),"]"]}),(0,Ee.jsx)("span",{className:ot.message,children:e.message})]},t);var s}))})]})},dt="matrixContainer__RiK",ut="header_t7QL",mt="controls_sj24",ht="dimensions_G9Ce",pt="toggleButton_ziSy",xt="downloadButton_yZ_5",vt="matrixWrapper_lIP_",jt="matrix_UPd_",gt="matrixElement_jLaA",ft="infoContent_XCc5",Nt="fullMatrix_FIje",bt="zeroElement_VjgC",yt="truncationNotice_Npk0",_t="matrixInfo_AD0u",St="infoToggle_sbWR",Ct=({matrix:e,title:t,precision:s=6,maxDisplaySize:n=8})=>{const[r,l]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);if(!e||!e.data)return(0,Ee.jsxs)("div",{className:dt,children:[(0,Ee.jsx)("h4",{children:t}),(0,Ee.jsx)("p",{children:"Matrix data not available"})]});const{rows:c,cols:d,data:u}=e,m=c>n||d>n,h=i?c:Math.min(c,n),p=i?d:Math.min(d,n),x=e=>Math.abs(e)<1e-10?"\xb7":e.toFixed(s);return(0,Ee.jsxs)("div",{className:dt,children:[(0,Ee.jsxs)("div",{className:ut,children:[(0,Ee.jsx)("h4",{children:t}),(0,Ee.jsxs)("div",{className:mt,children:[(0,Ee.jsxs)("span",{className:ht,children:[c," \xd7 ",d]}),m&&(0,Ee.jsx)("button",{className:pt,onClick:()=>o(!i),children:i?"Show Preview":"Show Full"}),(0,Ee.jsx)("button",{className:xt,onClick:()=>{const e=u.map((e=>e.map((e=>x(e))).join(","))).join("\n"),s=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`${t.toLowerCase().replace(/\s+/g,"_")}_matrix.csv`,n.click(),URL.revokeObjectURL(a)},title:"Download as CSV",children:"\u2193 CSV"})]})]}),(0,Ee.jsxs)("div",{className:vt,children:[(0,Ee.jsx)("div",{className:`${jt} ${i?Nt:""}`,style:{gridTemplateColumns:`repeat(${p}, 1fr)`},children:Array.from({length:h},((e,t)=>Array.from({length:p},((e,s)=>{const a=u[t]?.[s]||0,n=x(a),r=Math.abs(a)<1e-10;return(0,Ee.jsx)("div",{className:`${gt} ${r?bt:""}`,title:`[${t+1},${s+1}] = ${a}`,children:n},`${t}-${s}`)}))))}),m&&!i&&(0,Ee.jsxs)("div",{className:yt,children:["Showing ",h," \xd7 ",p," of ",c," \xd7 ",d," matrix"]})]}),(0,Ee.jsxs)("div",{className:_t,children:[(0,Ee.jsxs)("button",{className:St,onClick:()=>l(!r),children:[r?"\u25bc":"\u25b6"," Matrix Information"]}),r&&(0,Ee.jsxs)("div",{className:ft,children:[(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Dimensions:"})," ",c," rows \xd7 ",d," columns"]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Total elements:"})," ",c*d]}),u.length>0&&u[0]&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Max value:"})," ",Math.max(...u.flat()).toFixed(s)]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Min value:"})," ",Math.min(...u.flat()).toFixed(s)]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Trace (diagonal sum):"})," ",u.reduce(((e,t,s)=>e+(t[s]||0)),0).toFixed(s)]})]})]})]})]})};var $t=s(7851);const wt="container_BTtL",kt="header_Zg_R",Ft="controls_krEJ",Et="controlButton_kE_9",Mt="viewer_MOiN",Ot="representationControls_JFkt",zt="controlGroup_advN",Lt="inlineControlGroup_p0fZ",Rt="controlLabel_p9ac",Tt="controlSelect_wf9l",It="checkboxLabel_O6nm",Ht="checkbox_vb0q",Dt="numberInput_NZEF",Vt="slicePositionControls_XcJh",Bt="collapsibleControl_f2QI",At="controlToggle_IHht",qt="controlContent_BMT8",Pt="colorRangeGrid_zP5d",Xt="computingIndicator_nVPU",Yt="mainContent_hmUM",Gt="viewerContainer_HOsW",Zt="orbitalSidebar_Sjw1",Ut="open_VSem",Wt="orbitalToggleButton_zhVa",Kt="orbitalSidebarHeader_sOPI",Jt="orbitalCloseButton_PBas",Qt="moControls_QuQW",es="collapsibleSection_wCEA",ts="lightSectionHeader_RRMY",ss="chevron_qy2f",as="chevronExpanded_o9bu",ns="sectionContent_L8gO",rs="orbitalList_q8AK",ls="placeholder_XAIu",is="loading_XCE6",os="error_fQgs",cs="orbitalItem_coIp",ds="orbitalOccupied_2McF",us="orbitalVirtual_y4gy",ms="orbitalSelected_kMgf",hs="orbitalContent_ff1A",ps="orbitalEnergy_svnX",xs="orbitalEnergyEV_OrpY",vs="orbitalLabel_q_Pv",js="orbitalIndicators_GNGS",gs="occupationBadge_DFgd",fs="orbitalColorIndicator_WBpC",Ns="orbitalColorPicker_rcrR",bs=({orbital:e,isHOMO:t=!1,isLUMO:s=!1,isSelected:a=!1,colorIndicator:n,onColorChange:r,onClick:l,className:i=""})=>{const o=e.energy/27.2114;return(0,Ee.jsxs)("div",{className:`${cs} ${e.isOccupied?ds:us} ${a?ms:""} ${i}`,onClick:l,title:`MO ${e.index}: ${e.energy.toFixed(3)} eV (occupation: ${e.occupation})`,style:{cursor:l?"pointer":"default"},children:[(0,Ee.jsxs)("div",{className:hs,children:[(0,Ee.jsxs)("div",{className:ps,children:[o.toFixed(6)," Eh"]}),(0,Ee.jsxs)("div",{className:xs,children:[e.energy.toFixed(3)," eV"]}),(t||s)&&(0,Ee.jsx)("div",{className:vs,children:t?"HOMO":"LUMO"})]}),(0,Ee.jsxs)("div",{className:js,children:[e.occupation>0&&(0,Ee.jsx)("div",{className:gs,children:2===e.occupation?"\u2191\u2193":1===e.occupation?"\u2191":""}),n&&(a?(0,Ee.jsx)("input",{type:"color",value:n,onChange:e=>{e.stopPropagation(),r?.(e.target.value)},onClick:e=>e.stopPropagation(),className:Ns,title:`Change color for MO ${e.index}`}):(0,Ee.jsx)("div",{className:fs,style:{backgroundColor:n},title:`Last used color: ${n}`}))]})]})},ys=({xyzData:e,moleculeName:t="Molecule",wavefunctionResults:s,cubeResults:n,cubeGridInfo:r,onRequestCubeComputation:l})=>{const i=(0,a.useRef)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(null),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),[x,v]=(0,a.useState)("ball+stick"),[j,g]=(0,a.useState)(!0),[f,N]=(0,a.useState)("element"),[b,y]=(0,a.useState)(new Set),[_,S]=(0,a.useState)(.01),[C,$]=(0,a.useState)(!1),[w,k]=(0,a.useState)(1),[F,E]=(0,a.useState)(!1),[M,O]=(0,a.useState)((()=>{try{const e=localStorage.getItem("orbitalColors");if(e){const t=JSON.parse(e);return new Map(Object.entries(t).map((([e,t])=>[parseInt(e),t])))}}catch(h){console.warn("Failed to load orbital colors from localStorage:",h)}return new Map})),[z,L]=(0,a.useState)(40),R=(0,a.useRef)(null),T=(0,a.useRef)(null),[I,H]=(0,a.useState)(!0),[D,V]=(0,a.useState)(!1),B=(0,a.useRef)(null),[A,q]=(0,a.useState)(null),[P,X]=(0,a.useState)("surface"),[Y,G]=(0,a.useState)(!1),[Z,U]=(0,a.useState)("z"),[W,K]=(0,a.useState)(0),[J,Q]=(0,a.useState)("rwb"),[ee,te]=(0,a.useState)([0,.05]),[se,ae]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!i.current)return;o.current=new $t.BI(i.current,{backgroundColor:"white",quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10,fogNear:100,fogFar:100});const e=()=>{o.current&&o.current.handleResize()};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),o.current&&o.current.dispose()}}),[]);const ne=()=>{if(!c.current)return;c.current.removeAllRepresentations();const e={colorScheme:f,sele:j?"all":"not hydrogen"};switch(x){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0;break;case"surface":e.opacity=.8,e.surfaceType="vws"}c.current.addRepresentation(x,e),o.current?.autoView()};(0,a.useEffect)((()=>{ne()}),[x,j,f]);const re=async e=>{if(o.current)try{o.current.removeAllComponents();const s=((e,t)=>{const s=e.trim().split("\n"),a=parseInt(s[0]),n=s[1]||t,r=[];for(let m=2;m<2+a;m++){const e=s[m].trim().split(/\s+/);r.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const l={"H-H":.74,"H-C":1.09,"H-N":1.01,"H-O":.96,"H-S":1.34,"C-C":1.54,"C-N":1.47,"C-O":1.43,"C-S":1.82,"N-N":1.45,"N-O":1.4,"N-S":1.68,"O-O":1.48,"O-S":1.66,"S-S":2.05},i=(e,t)=>{const s=e.x-t.x,a=e.y-t.y,n=e.z-t.z;return Math.sqrt(s*s+a*a+n*n)},o=[];for(let m=0;m<r.length;m++)for(let e=m+1;e<r.length;e++){const t=i(r[m],r[e]),s=l[`${c=r[m].element}-${d=r[e].element}`]||l[`${d}-${c}`]||2;if(t<=1.3*s){let a=1;t<.85*s&&(a=2),t<.75*s&&(a=3),o.push({atom1:m+1,atom2:e+1,order:a})}}var c,d;let u=`${n}\n`;return u+="  Generated from XYZ with bond guessing\n",u+="\n",u+=`${a.toString().padStart(3," ")}${o.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`,r.forEach((e=>{const t=e.x.toFixed(4).padStart(10," "),s=e.y.toFixed(4).padStart(10," "),a=e.z.toFixed(4).padStart(10," ");u+=`${t}${s}${a} ${e.element.padEnd(3," ")} 0  0  0  0  0  0  0  0  0  0  0  0\n`})),o.forEach((e=>{u+=`${e.atom1.toString().padStart(3," ")}${e.atom2.toString().padStart(3," ")}${e.order.toString().padStart(3," ")}  0  0  0  0\n`})),u+="M  END\n$$$$\n",u})(e,t),a=new Blob([s],{type:"text/plain"}),n=await o.current.loadFile(a,{ext:"sdf",name:t});c.current=n,ne()}catch(s){throw console.error("Error loading geometry:",s),s}};(0,a.useEffect)((()=>{if(!e||!o.current)return;(async()=>{m(!0),p("");try{await re(e),m(!1)}catch(t){console.error("Error loading molecule:",t),p("Failed to load molecule structure"),m(!1)}})()}),[e,t]);const le=a.useMemo((()=>{if(!s?.orbitalEnergies||!s?.orbitalOccupations)return[];const e=[];for(let t=0;t<s.orbitalEnergies.length;t++){const a=s.orbitalEnergies[t],n=s.orbitalOccupations[t]||0;e.push({index:t,energy:27.2114*a,occupation:n,isOccupied:n>0})}return e}),[s]),ie=le;(0,a.useEffect)((()=>{if(le.length>0&&l&&b.size>0){const e=[];for(const t of b){const s=`molecular_orbital_${t}_${z}`,a=n?.get(s);a||e.push(t)}e.length>0&&(R.current&&clearTimeout(R.current),R.current=setTimeout((()=>{oe(e)}),300))}return()=>{R.current&&clearTimeout(R.current),T.current&&clearTimeout(T.current)}}),[b,le.length,n,z]);const oe=async e=>{if(l&&o.current){E(!0),p("");try{const t=le.length-1;for(const s of e){if(s<0||s>t)throw new Error(`Invalid orbital index ${s}. Valid range: 0-${t}`);l("molecular_orbital",s,z)}}catch(h){console.error("Error requesting MO computation:",h),p("Failed to request molecular orbital computation: "+h.message),E(!1)}}};(0,a.useEffect)((()=>{if(console.log("MO visualization effect triggered:",{selectedOrbitals:b.size,cubeResults:n.size,orbitalRenderStyle:P,sliceDirection:Z,slicePosition:W}),T.current&&(clearTimeout(T.current),T.current=null),!o.current)return;if(0===b.size)return void ce();if(!n)return;Array.from(b).every((e=>{const t=`molecular_orbital_${e}_${z}`;return n.get(t)}))&&(ce(),F&&E(!1))}),[n,b,_,C,w,P,Z,W,J,ee]);const ce=async()=>{var e,t;if(o.current)try{d.current&&(Array.isArray(d.current)?d.current.forEach((e=>{e&&o.current&&o.current.removeComponent(e)})):o.current&&o.current.removeComponent(d.current),d.current=null);const s=[],a=["#4A90E2","#FF8C42","#7B68EE","#32CD32","#FF6B6B","#9B59B6"];if(0===b.size)return d.current=[],void o.current.autoView();for(const[r,l]of Array.from(b).entries()){const i=`molecular_orbital_${l}_${z}`,c=n?.get(i);if(c){const n=new Blob([c],{type:"text/plain"}),i=await o.current.loadFile(n,{ext:"cube",name:`MO_${l}`});if(i){let n=M.get(l);if(n||(n=a[r%a.length],O((e=>{const t=new Map(e);return t.set(l,n),t}))),"surface"===P)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:_,color:n,opacity:w,opaqueBack:!1}),C&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-_,color:"red",opacity:w,opaqueBack:!1});else if("wireframe"===P)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:_,color:n,opacity:w,wireframe:!0,linewidth:2}),C&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-_,color:"red",opacity:w,wireframe:!0,linewidth:2});else if("dot"===P)i.addRepresentation("dot",{visible:!0,color:n,opacity:w,dotType:"square",dotSpacing:2,threshold:.001});else if("slice"===P){const s=(e=Z,t=W,console.log(`Slice position: direction=${e}, position=${t}`),t);console.log(`Adding slice representation: direction=${Z}, normalizedPos=${W}, coordinatePos=${s}`),i.addRepresentation("slice",{visible:!0,opacity:w,dimension:Z,positionType:"coordinate",position:s,thresholdMin:ee[0],thresholdMax:ee[1],thresholdType:"value",colorScheme:J,colorDomain:ee})}s.push(i)}}}d.current=s,o.current.autoView()}catch(h){console.error("Error visualizing molecular orbitals:",h),p("Failed to visualize molecular orbitals: "+h.message)}};return(0,a.useEffect)((()=>{(async()=>{if(!o.current)return;if(B.current&&(o.current.removeComponent(B.current),B.current=null),!D)return;let e=null;if(r){const t=r.origin,s=r.steps,a=r.nx,n=r.ny,l=r.nz,i=r.basis;if(t&&s&&a&&n&&l&&i){const s=[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],r=[t[0],t[1],t[2]],o=[t[0]+(a-1)*s[0][0]+(n-1)*s[1][0]+(l-1)*s[2][0],t[1]+(a-1)*s[0][1]+(n-1)*s[1][1]+(l-1)*s[2][1],t[2]+(a-1)*s[0][2]+(n-1)*s[1][2]+(l-1)*s[2][2]],c=.529177;e={min:[r[0]*c,r[1]*c,r[2]*c],max:[o[0]*c,o[1]*c,o[2]*c]},console.log("Grid bounds (converted to Angstrom):",e)}}if(e)try{const[t,s,a]=e.min,[n,r,l]=e.max,i=[[t,s,a],[n,s,a],[n,r,a],[t,r,a],[t,s,l],[n,s,l],[n,r,l],[t,r,l]],c=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];let d=`Grid Bounds\n  Generated\n  \n${i.length.toString().padStart(3," ")}${c.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`;i.forEach((([e,t,s])=>{d+=`${e.toFixed(4).padStart(10," ")}${t.toFixed(4).padStart(10," ")}${s.toFixed(4).padStart(10," ")} C   0  0  0  0  0  0  0  0  0  0  0  0\n`})),c.forEach((([e,t])=>{d+=`${(e+1).toString().padStart(3," ")}${(t+1).toString().padStart(3," ")}  1  0  0  0  0\n`})),d+="M  END\n$$$$\n";const u=new Blob([d],{type:"text/plain"}),m=await o.current.loadFile(u,{ext:"mol",name:"Grid_Bounds"});m&&(m.addRepresentation("line",{colorScheme:"uniform",colorValue:"#ff6b6b",linewidth:2,opacity:.7}),B.current=m)}catch(h){console.error("Error creating grid bounds visualization:",h),p("Failed to create grid bounds visualization: "+h.message)}else console.log("No cube grid info available - cannot show accurate grid bounds")})()}),[D,r]),(0,a.useEffect)((()=>{try{const e=Object.fromEntries(M);localStorage.setItem("orbitalColors",JSON.stringify(e))}catch(h){console.warn("Failed to save orbital colors to localStorage:",h)}}),[M]),e?(0,Ee.jsxs)("div",{className:wt,children:[(0,Ee.jsxs)("div",{className:kt,children:[(0,Ee.jsx)("h4",{children:"3D Structure & Molecular Orbitals"}),(0,Ee.jsxs)("div",{className:Ft,children:[(0,Ee.jsx)("button",{className:Et,onClick:()=>{o.current&&o.current.autoView()},title:"Reset view",children:"\u2302"}),(0,Ee.jsx)("button",{className:Et,onClick:()=>{o.current&&o.current.toggleFullscreen(i.current)},title:"Toggle fullscreen",children:"\u26f6"})]})]}),(0,Ee.jsxs)("div",{className:Ot,children:[(0,Ee.jsxs)("div",{className:Lt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Style"}),(0,Ee.jsxs)("select",{value:x,onChange:e=>v(e.target.value),className:Tt,children:[(0,Ee.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,Ee.jsx)("option",{value:"line",children:"Line"}),(0,Ee.jsx)("option",{value:"spacefill",children:"Space Fill"}),(0,Ee.jsx)("option",{value:"licorice",children:"Licorice"}),(0,Ee.jsx)("option",{value:"surface",children:"Surface"})]})]}),(0,Ee.jsxs)("div",{className:Lt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Color"}),(0,Ee.jsxs)("select",{value:f,onChange:e=>N(e.target.value),className:Tt,children:[(0,Ee.jsx)("option",{value:"element",children:"By Element"}),(0,Ee.jsx)("option",{value:"uniform",children:"Uniform"}),(0,Ee.jsx)("option",{value:"chainname",children:"By Chain"}),(0,Ee.jsx)("option",{value:"random",children:"Random"})]})]})]}),(0,Ee.jsxs)("div",{className:Yt,children:[(0,Ee.jsxs)("div",{className:Gt,children:[h&&(0,Ee.jsx)("div",{className:os,children:(0,Ee.jsx)("p",{children:h})}),u&&(0,Ee.jsx)("div",{className:is,children:(0,Ee.jsx)("p",{children:"Loading molecule..."})}),(0,Ee.jsx)("div",{ref:i,className:Mt,style:{opacity:u?.5:1}}),s&&le.length>0&&(0,Ee.jsx)("button",{className:Wt,onClick:()=>G(!Y),children:Y?"Hide":"Orbitals"})]}),s&&le.length>0&&(0,Ee.jsxs)("div",{className:`${Zt} ${Y?Ut:""}`,children:[(0,Ee.jsxs)("div",{className:Kt,children:[(0,Ee.jsx)("h5",{children:"Molecular Orbitals"}),(0,Ee.jsx)("button",{className:Jt,onClick:()=>G(!1),title:"Close orbital panel",children:"\xd7"})]}),(0,Ee.jsxs)("div",{className:es,children:[(0,Ee.jsxs)("button",{className:ts,onClick:()=>H(!I),children:[(0,Ee.jsx)("span",{children:"Settings"}),(0,Ee.jsx)("span",{className:`${ss} ${I?as:""}`,children:"\u25bc"})]}),I&&(0,Ee.jsx)("div",{className:ns,children:(0,Ee.jsxs)("div",{className:Qt,children:[(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Style"}),(0,Ee.jsxs)("select",{value:P,onChange:e=>X(e.target.value),className:Tt,children:[(0,Ee.jsx)("option",{value:"surface",children:"Surface"}),(0,Ee.jsx)("option",{value:"wireframe",children:"Wireframe"}),(0,Ee.jsx)("option",{value:"dot",children:"Dot Volume"}),(0,Ee.jsx)("option",{value:"slice",children:"Slice Volume"})]})]}),("surface"===P||"wireframe"===P)&&(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Isovalue"}),(0,Ee.jsx)("input",{type:"number",min:"0.001",max:"0.2",step:"0.001",value:_,onChange:e=>S(parseFloat(e.target.value)||.01),className:Dt})]}),"slice"===P&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Slice Direction"}),(0,Ee.jsxs)("select",{value:Z,onChange:e=>U(e.target.value),className:Tt,children:[(0,Ee.jsx)("option",{value:"x",children:"X-axis"}),(0,Ee.jsx)("option",{value:"y",children:"Y-axis"}),(0,Ee.jsx)("option",{value:"z",children:"Z-axis"})]})]}),(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Slice Position"}),(0,Ee.jsxs)("div",{className:Vt,children:[(0,Ee.jsx)("button",{onClick:()=>K(W-.5),className:Et,title:"Move slice by -0.5",children:"-"}),(0,Ee.jsx)("input",{type:"number",step:"0.1",value:W,onChange:e=>K(parseFloat(e.target.value)||0),className:Dt,title:"Slice position in Angstroms"}),(0,Ee.jsx)("button",{onClick:()=>K(W+.5),className:Et,title:"Move slice by +0.5",children:"+"})]})]}),(0,Ee.jsxs)("div",{className:Bt,children:[(0,Ee.jsxs)("button",{className:At,onClick:()=>ae(!se),children:[(0,Ee.jsx)("span",{className:Rt,children:"Color Range"}),(0,Ee.jsx)("span",{className:`${ss} ${se?as:""}`,children:"\u25bc"})]}),se&&(0,Ee.jsx)("div",{className:qt,children:(0,Ee.jsxs)("div",{className:Pt,children:[(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Minimum"}),(0,Ee.jsx)("input",{type:"number",step:"0.01",value:ee[0],onChange:e=>te([parseFloat(e.target.value)||0,ee[1]]),className:Dt,title:"Minimum value for color scale"})]}),(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Maximum"}),(0,Ee.jsx)("input",{type:"number",step:"0.01",value:ee[1],onChange:e=>te([ee[0],parseFloat(e.target.value)||.05]),className:Dt,title:"Maximum value for color scale"})]})]})})]})]}),(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Opacity"}),(0,Ee.jsx)("input",{type:"number",min:"0",max:"1",step:"0.05",value:w,onChange:e=>k(parseFloat(e.target.value)||1),className:Dt,title:"Orbital surface opacity (0 = transparent, 1 = opaque)"})]}),(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("label",{className:Rt,children:"Grid Steps"}),(0,Ee.jsx)("input",{type:"number",min:"20",max:"60",step:"5",value:z,onChange:e=>L(parseInt(e.target.value)||40),className:Dt,title:"Number of grid points per dimension (higher = more detail, slower)"}),r&&(0,Ee.jsxs)("label",{className:It,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:D,onChange:e=>V(e.target.checked),className:Ht}),"Bounds"]})]}),F&&(0,Ee.jsx)("div",{className:zt,children:(0,Ee.jsx)("span",{className:Xt,children:"Computing MO..."})})]})})]}),(0,Ee.jsx)("div",{className:rs,children:ie.map(((e,t)=>{const s=le.findIndex(((e,t)=>e.isOccupied&&(!le[t+1]||!le[t+1].isOccupied))),a=s>=0?s+1:-1,n=e.index===s,r=e.index===a,l=b.has(e.index),i=M.get(e.index);return(0,Ee.jsx)(bs,{orbital:e,isHOMO:n,isLUMO:r,isSelected:l,colorIndicator:i,onColorChange:t=>((e,t)=>{O((s=>{const a=new Map(s);return a.set(e,t),a})),T.current&&clearTimeout(T.current),b.has(e)&&(T.current=setTimeout((()=>{ce(),T.current=null}),50))})(e.index,t),onClick:()=>{return t=e.index,void y((e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s}));var t}},e.index)}))})]})]})]}):(0,Ee.jsx)("div",{className:wt,children:(0,Ee.jsxs)("div",{className:ls,children:[(0,Ee.jsx)("h4",{children:"Molecule Viewer"}),(0,Ee.jsx)("p",{children:"Load a molecule to see its 3D structure"})]})})};var _s=s(6370);const Ss=()=>{const[e,t]=(0,a.useState)(null),[n,pe]=(0,a.useState)(!1),[xe,ve]=(0,a.useState)(""),[je,ge]=(0,a.useState)(null),[fe,Ne]=(0,a.useState)(!1),[be,ye]=(0,a.useState)(null),[_e,Se]=(0,a.useState)([]),[Ce,$e]=(0,a.useState)("structure"),[we,ke]=(0,a.useState)(""),[Fe,Me]=(0,a.useState)(""),[ze,Le]=(0,a.useState)(new Map),[Re,Te]=(0,a.useState)(null),[Ie,De]=(0,a.useState)(!0),[Ve,Be]=(0,a.useState)(!0),[Ae,qe]=(0,a.useState)(!0),[Pe,Xe]=(0,a.useState)("hf"),[Ye,Ge]=(0,a.useState)("3-21g"),[Ze,Ue]=(0,a.useState)(100),[We,Ke]=(0,a.useState)(1e-8),[Je,Qe]=(0,a.useState)(2),[et,tt]=(0,a.useState)(!1),[st,at]=(0,a.useState)(!1),[nt,rt]=(0,a.useState)("optimization"),[lt,ot]=(0,a.useState)(null),[dt,ut]=(0,a.useState)(!0),[mt,ht]=(0,a.useState)(!0);(0,a.useEffect)((()=>(pt(),()=>{e&&e.terminate()})),[]);const pt=async()=>{try{const e=new Worker(new URL(s.p+s.u(842),s.b),{type:void 0});e.onmessage=xt,e.onerror=e=>{console.error("Worker error:",e),ke("Worker error: "+e.message),pe(!1)},t(e),e.postMessage({type:"init",data:{}})}catch(we){console.error("Failed to initialize worker:",we),ke("Failed to initialize Web Worker: "+we.message)}},xt=e=>{const{type:t,...s}=e.data;switch(t){case"initialized":s.success?(pe(!0),jt("Worker initialized successfully","info")):(pe(!1),ke("Worker initialization failed: "+s.error));break;case"log":jt(s.message,vt(s.level));break;case"progress":jt(s.message,"info"),"complete"===s.stage&&Ne(!1);break;case"result":gt(s);break;case"optimization_progress":jt(s.message,"info");break;case"cubeResult":ft(s);break;case"error":console.error("Worker error:",s.error),ke("Calculation error: "+s.error),Ne(!1)}},vt=e=>{switch(e){case 0:case 1:return"debug";case 2:default:return"info";case 3:return"warn";case 4:case 5:return"error"}},jt=(e,t)=>{Se((s=>[...s,{message:e,level:t,timestamp:new Date}]))},gt=e=>{Ne(!1),e.success?(ye(e.results),$e("results"),jt("Calculation completed successfully!","info")):ke("Calculation failed: "+e.error)},ft=e=>{if(e.success){const t="molecular_orbital"===e.cubeType?`${e.cubeType}_${e.orbitalIndex}_${e.gridSteps||40}`:e.cubeType;Le((s=>new Map(s.set(t,e.cubeData)))),e.gridInfo&&Te(e.gridInfo),jt(`Cube computation completed: ${e.cubeType}${void 0!==e.orbitalIndex?` (orbital ${e.orbitalIndex})`:""} [${e.gridSteps||40} steps]`,"info")}else ke(`Cube computation failed: ${e.error}`),jt(`Cube computation failed: ${e.error}`,"error")},Nt=(e,t,s)=>{const a=e.trim().split("\n"),n=parseInt(a[0]),r=[];for(let l=0;l<5;l++){const e=[n.toString()];e.push(`Mode ${s+1}: ${Math.abs(t).toFixed(2)} cm\u207b\xb9 (normal mode data unavailable)`);for(let t=2;t<a.length;t++)e.push(a[t]);r.push(e.join("\n"))}return r.join("\n")},bt=()=>be?.frequencies?.frequencies?be.frequencies.frequencies.map(((e,t)=>({freq:e,index:t}))).filter((({freq:e})=>!dt||Math.abs(e)>=50)):[];return(0,Ee.jsxs)("div",{className:r,children:[(0,Ee.jsxs)("div",{className:l,children:[(0,Ee.jsxs)("div",{className:i,children:[(0,Ee.jsx)("div",{className:`${g} ${n?N:f}`,children:n?"\u2713 Ready":"\u23f3 Loading..."}),(0,Ee.jsxs)("div",{className:m,children:[(0,Ee.jsxs)("button",{className:h,onClick:()=>Be(!Ve),children:[(0,Ee.jsx)("span",{className:p,children:"Molecule Input"}),(0,Ee.jsx)("span",{className:`${x} ${Ve?j:""}`,children:"\u25bc"})]}),Ve&&(0,Ee.jsxs)("div",{className:v,children:[(0,Ee.jsx)(Oe,{onFileLoad:e=>{ve(e),Le(new Map),ye(null),ke(""),$e("structure"),Me("");try{const t=e.trim().split("\n"),s=parseInt(t[0]),a=t[1]||"Loaded Molecule",n=new Map;for(let e=2;e<2+s;e++){const s=t[e].trim().split(/\s+/)[0];n.set(s,(n.get(s)||0)+1)}const r=Array.from(n.entries()).map((([e,t])=>t>1?`${e}${t}`:e)).join("");ge({name:a,formula:r,numAtoms:s}),jt(`Molecule loaded: ${r} (${s} atoms) - cleared orbital cache`,"info")}catch(we){console.error("Error parsing XYZ:",we)}},onValidationChange:(e,t)=>{De(e),Me(!e&&t?t:"")}}),je&&(0,Ee.jsx)("div",{className:b,children:(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:je.formula})," (",je.numAtoms," atoms)"]})})]})]}),xe&&(0,Ee.jsxs)("div",{className:m,children:[(0,Ee.jsxs)("button",{className:h,onClick:()=>qe(!Ae),children:[(0,Ee.jsx)("span",{className:p,children:"Calculation Settings"}),(0,Ee.jsx)("span",{className:`${x} ${Ae?j:""}`,children:"\u25bc"})]}),Ae&&(0,Ee.jsx)("div",{className:v,children:(0,Ee.jsx)(He,{method:Pe,setMethod:Xe,basisSet:Ye,setBasisSet:Ge,maxIterations:Ze,setMaxIterations:Ue,energyTolerance:We,setEnergyTolerance:Ke,logLevel:Je,setLogLevel:Qe,optimize:et,setOptimize:e=>{tt(e),e||at(!1)},computeFrequencies:st,setComputeFrequencies:at})})]}),xe&&(0,Ee.jsxs)("div",{className:_,children:[(0,Ee.jsx)("button",{className:`${y} ${S}`,onClick:()=>{if(!xe)return void ke("Please load a molecule first.");if(!Ie)return;if(!e||!n)return void ke("Web Worker not ready.");ye(null),Se([]),$e("output"),Ne(!0),e.postMessage({type:"setLogLevel",data:{level:Je}});const t={xyzData:xe,method:Pe,basisSet:Ye,maxIterations:Ze,energyTolerance:We,optimize:et,computeFrequencies:st};jt("Starting calculation...","info"),e.postMessage({type:"calculate",data:t})},disabled:fe||!n||!Ie,children:fe?"Calculating...":"Run Calculation"}),fe&&(0,Ee.jsx)("button",{className:`${y} ${C}`,onClick:()=>{e&&fe&&(e.terminate(),jt("Calculation cancelled. Restarting worker...","warn"),pt(),Ne(!1))},children:"Cancel"})]})]}),(0,Ee.jsxs)("div",{className:o,children:[xe&&(0,Ee.jsxs)("div",{className:c,children:[(0,Ee.jsx)("button",{className:`${d} ${"output"===Ce?$:""}`,onClick:()=>$e("output"),children:"Output"}),(0,Ee.jsx)("button",{className:`${d} ${"results"===Ce?$:""}`,onClick:()=>$e("results"),children:"Results"}),(0,Ee.jsx)("button",{className:`${d} ${"structure"===Ce?$:""}`,onClick:()=>$e("structure"),children:"Structure"}),(0,Ee.jsx)("button",{className:`${d} ${"properties"===Ce?$:""}`,onClick:()=>$e("properties"),children:"Properties"}),be?.optimization&&(0,Ee.jsx)("button",{className:`${d} ${"optimization"===Ce?$:""}`,onClick:()=>$e("optimization"),children:"Optimization"})]}),(0,Ee.jsxs)("div",{className:u,children:["output"===Ce&&(0,Ee.jsx)(ct,{logs:_e}),"results"===Ce&&(0,Ee.jsx)(it,{results:be}),"structure"===Ce&&(0,Ee.jsx)("div",{className:k,children:xe?(0,Ee.jsx)(ys,{xyzData:be?.optimization?.finalXYZ?be.optimization.finalXYZ:xe,moleculeName:`${je?.name||"Molecule"}${be?.optimization?" (Optimized)":""}`,wavefunctionResults:be,cubeResults:ze,cubeGridInfo:Re,onRequestCubeComputation:(t,s,a)=>{e&&n?be&&be.wavefunctionData?(jt(`Requesting ${t} cube computation...`,"info"),e.postMessage({type:"computeCube",data:{cubeType:t,orbitalIndex:s,gridSteps:a||40}})):ke("No wavefunction data available for cube computation."):ke("Web Worker not ready for cube computation.")}}):(0,Ee.jsxs)("div",{className:F,children:[(0,Ee.jsx)("h3",{children:"No Structure Loaded"}),(0,Ee.jsx)("p",{children:"Load a molecule to see its 3D structure visualization."})]})}),"properties"===Ce&&be&&(0,Ee.jsxs)("div",{className:w,children:[be.orbitalEnergies&&be.orbitalEnergies.length>0&&(0,Ee.jsxs)("div",{className:O,children:[(0,Ee.jsx)("h4",{children:"Orbital Energies"}),(0,Ee.jsx)("div",{className:z,children:be.orbitalEnergies.slice(0,20).map(((e,t)=>{const s=be.orbitalOccupations?.[t]??0,a={index:t,energy:27.2114*e,occupation:s,isOccupied:s>0};return(0,Ee.jsx)(bs,{orbital:a},t)}))}),be.orbitalEnergies.length>20&&(0,Ee.jsxs)("div",{className:L,children:["... and ",be.orbitalEnergies.length-20," more orbitals"]})]}),be.matrices&&Object.keys(be.matrices).length>0?(0,Ee.jsx)("div",{className:E,children:Object.entries(be.matrices).map((([e,t])=>t?(0,Ee.jsx)(Ct,{matrix:t,title:`${e.charAt(0).toUpperCase()}${e.slice(1)} Matrix`,precision:6,maxDisplaySize:6},e):null))}):(0,Ee.jsx)("div",{className:M,children:(0,Ee.jsx)("p",{children:"No matrix data available. Matrices are generated during SCF calculations and may depend on the calculation method and settings."})})]}),"optimization"===Ce&&be?.optimization&&(0,Ee.jsxs)("div",{className:I,children:[(0,Ee.jsx)("div",{className:D,children:(0,Ee.jsxs)("div",{className:H,children:[(0,Ee.jsx)("h4",{children:"Optimization Summary"}),(0,Ee.jsxs)("div",{className:V,children:[(0,Ee.jsxs)("div",{className:B,children:[(0,Ee.jsx)("span",{className:A,children:"Converged:"}),(0,Ee.jsx)("span",{className:`${q} ${be.optimization.trajectory.converged?P:X}`,children:be.optimization.trajectory.converged?"Yes":"No"})]}),(0,Ee.jsxs)("div",{className:B,children:[(0,Ee.jsx)("span",{className:A,children:"Steps:"}),(0,Ee.jsx)("span",{className:q,children:be.optimization.steps})]}),(0,Ee.jsxs)("div",{className:B,children:[(0,Ee.jsx)("span",{className:A,children:"Final Energy:"}),(0,Ee.jsxs)("span",{className:q,children:[be.energy.toFixed(8)," Ha"]})]}),(0,Ee.jsxs)("div",{className:B,children:[(0,Ee.jsx)("span",{className:A,children:"Final Energy:"}),(0,Ee.jsxs)("span",{className:q,children:[be.energyInEV.toFixed(4)," eV"]})]})]})]})}),(0,Ee.jsxs)("div",{className:G,children:[(0,Ee.jsx)("div",{className:Z,children:(0,Ee.jsx)("div",{className:Y,children:(0,Ee.jsx)(_s.A,{trajectoryData:"normal_mode"===nt&&null!==lt?(e=>{if(!be?.optimization?.finalXYZ||!be?.frequencies?.normalModes)return console.log("Missing data for normal mode trajectory:",{hasXYZ:!!be?.optimization?.finalXYZ,hasNormalModes:!!be?.frequencies?.normalModes,normalModesLength:be?.frequencies?.normalModes?.length}),"";const t=be.optimization.finalXYZ,s=be.frequencies.normalModes[e],a=be.frequencies.frequencies[e];if(!s||0===s.length)return console.log("Normal mode data not available for mode",e,"normalMode:",s),Nt(t,a,e);const n=t.trim().split("\n"),r=parseInt(n[0]);if(n[1],n.length<r+2)return"";const l=[];for(let o=2;o<2+r;o++){const e=n[o].trim().split(/\s+/);l.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const i=[];for(let o=0;o<20;o++){const t=2*Math.PI*o/20,n=.3*Math.sin(t),c=[r.toString()];c.push(`Mode ${e+1}: ${Math.abs(a).toFixed(2)} cm\u207b\xb9 ${a<0?"(imaginary)":""}`);for(let e=0;e<r;e++){const t=l[e],a=s[3*e]||0,r=s[3*e+1]||0,i=s[3*e+2]||0,o=t.x+n*a,d=t.y+n*r,u=t.z+n*i;c.push(`${t.element}  ${o.toFixed(6)}  ${d.toFixed(6)}  ${u.toFixed(6)}`)}i.push(c.join("\n"))}return i.join("\n")})(lt):"optimization"===nt&&be?.optimization?.trajectory?(e=>{if(!e||!e.geometries||!e.energies)return"";const t=[];return e.geometries.forEach(((s,a)=>{const n=e.energies[a],r=s.trim().split("\n");if(r.length>=2){const e=r[0],s=`Step ${a} Energy=${n.toFixed(9)}`,l=r.slice(2).join("\n");t.push(`${e}\n${s}\n${l}`)}})),t.join("\n")})(be.optimization.trajectory):"",moleculeName:(()=>{if("normal_mode"===nt&&null!==lt&&be?.frequencies?.frequencies){const e=be.frequencies.frequencies[lt];return`Mode ${lt+1}: ${Math.abs(e).toFixed(2)} cm\u207b\xb9`}return"optimization"===nt?`${je?.formula||"Molecule"} Optimization`:"Trajectory"})(),autoPlay:"normal_mode"===nt,initialSpeed:"normal_mode"===nt?60:20})})}),(0,Ee.jsxs)("div",{className:U,children:[(0,Ee.jsx)("div",{className:W,children:(0,Ee.jsx)("h4",{children:"Trajectory Controls"})}),(0,Ee.jsx)("div",{className:K,children:(0,Ee.jsx)("button",{onClick:()=>{rt("optimization"),ot(null)},className:`${J} ${"optimization"===nt?Q:""}`,children:"Optimization Path"})}),be.frequencies&&be.frequencies.frequencies.length>0&&(0,Ee.jsxs)("div",{className:ee,children:[(0,Ee.jsxs)("div",{className:te,children:[(0,Ee.jsx)("h5",{children:"Normal Modes"}),(0,Ee.jsx)("div",{className:se,children:(0,Ee.jsxs)("label",{className:ae,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:dt,onChange:e=>{ut(e.target.checked),e.target.checked&&null!==lt&&be.frequencies.frequencies[lt]&&Math.abs(be.frequencies.frequencies[lt])<50&&(ot(null),rt("optimization"))},className:ne}),"Hide low modes (< 50 cm\u207b\xb9)"]})})]}),(0,Ee.jsx)("div",{className:re,children:bt().map((({freq:e,index:t})=>{const s="normal_mode"===nt&&lt===t;return(0,Ee.jsxs)("div",{className:`${le} ${s?ie:""}`,onClick:()=>{rt("normal_mode"),ot(t)},style:{cursor:"pointer"},title:`Click to visualize mode ${t+1}`,children:[(0,Ee.jsxs)("div",{className:ce,children:[(0,Ee.jsxs)("div",{className:de,children:["Mode ",t+1]}),(0,Ee.jsxs)("div",{className:ue,children:[e<0?`${Math.abs(e).toFixed(1)}i`:e.toFixed(1)," cm\u207b\xb9"]}),e<0&&(0,Ee.jsx)("div",{className:me,children:"imag"})]}),s&&(0,Ee.jsx)("div",{className:oe,children:"\u25b6 Playing"})]},t)}))}),(0,Ee.jsxs)("div",{className:he,children:["Showing ",bt().length," of ",be.frequencies.frequencies.length," modes"]})]})]})]})]})]})]})]}),we&&!Fe&&(0,Ee.jsx)("div",{className:R,children:(0,Ee.jsxs)("div",{className:T,children:[(0,Ee.jsx)("h3",{children:"Error"}),(0,Ee.jsx)("p",{children:we}),(0,Ee.jsx)("button",{onClick:()=>ke(""),children:"Close"})]})})]})};function Cs(){return(0,Ee.jsx)(n.A,{title:"Wavefunction Calculator",description:"Quantum Chemistry Calculations in Your Browser",children:(0,Ee.jsx)("main",{style:{minHeight:"calc(100vh - 60px)"},children:(0,Ee.jsx)(Ss,{})})})}},6370:(e,t,s)=>{s.d(t,{A:()=>L});var a=s(6540),n=s(7851);const r="container_kZ5w",l="header_HEr1",i="controls_ixvO",o="controlButton_GDgO",c="viewer_WviD",d="loadingOverlay_lwCV",u="errorOverlay_rmFC",m="loadingSpinner_PLZ5",h="errorMessage_qkbu",p="frameInfoOverlay_vX3K",x="frameNumber_EMUy",v="frameComment_F9wg",j="frameEnergy_RPyN",g="displayControlsOverlay_fIES",f="overlayControls_EEtd",N="overlayControlGroup_E9WC",b="overlayLabel_tcBl",y="overlaySelect_UZvO",_="overlayCheckbox_jtWY",S="overlaySlider_ifAA",C="overlayValue_f7JJ",$="trajectoryControls_t0nZ",w="compactControls_H6OY",k="frameControls_R8UR",F="playerControls_ukm9",E="playerButton_Mfw8",M="playPauseButton_PlTX",O="frameSlider_B4ss";var z=s(4848);const L=({trajectoryData:e,xyzFrames:t,moleculeName:s="Trajectory",autoPlay:L=!1,initialSpeed:R=100})=>{const T=(0,a.useRef)(null),I=(0,a.useRef)(null),H=(0,a.useRef)(null),D=(0,a.useRef)(null),V=(0,a.useRef)(null),[B,A]=(0,a.useState)(!1),[q,P]=(0,a.useState)(""),[X,Y]=(0,a.useState)(0),[G,Z]=(0,a.useState)(0),[U,W]=(0,a.useState)(!1),[K,J]=(0,a.useState)(30),[Q,ee]=(0,a.useState)("ball+stick"),[te,se]=(0,a.useState)(!0),[ae,ne]=(0,a.useState)("element"),[re,le]=(0,a.useState)([]),[ie,oe]=(0,a.useState)([]),[ce,de]=(0,a.useState)(null),[ue,me]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!T.current)return;I.current=new n.BI(T.current,{backgroundColor:"white",quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10});const e=()=>{I.current&&I.current.handleResize()};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),I.current&&I.current.dispose()}}),[]);const he=e=>{if(e.includes("cm\u207b\xb9")||e.includes("cm-1")||e.toLowerCase().includes("mode"))return null;const t=[/Energy\s*=\s*(-?\d+\.?\d*)/i,/E\s*=\s*(-?\d+\.?\d*)/i,/E\s+(-?\d+\.?\d*)/i,/energy:\s*(-?\d+\.?\d*)/i,/(-?\d+\.\d+)\s*(?:hartree|ha|au)/i];for(const s of t){const t=e.match(s);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null},pe=async e=>{if(I.current){A(!0),P("");try{I.current.removeAllComponents(),D.current=null,V.current=null;const t=(e=>{let t="";return e.forEach(((e,s)=>{t+=`MODEL     ${(s+1).toString().padStart(4," ")}\n`;const a=e.trim().split("\n"),n=parseInt(a[0]);for(let r=0;r<n;r++){const e=a[r+2].trim().split(/\s+/),s=e[0],n=parseFloat(e[1]),l=parseFloat(e[2]),i=parseFloat(e[3]),o=(r+1).toString().padStart(5," "),c=s.padEnd(4," "),d="MOL",u="A",m="1".padStart(4," "),h=n.toFixed(3).padStart(8," "),p=l.toFixed(3).padStart(8," "),x=i.toFixed(3).padStart(8," "),v="1.00".padStart(6," "),j="0.00".padStart(6," "),g=s.padStart(2," ");t+=`ATOM  ${o} ${c} ${d} ${u}${m}    ${h}${p}${x}${v}${j}          ${g}\n`}t+="ENDMDL\n"})),t+="END\n",t})(e),a=new Blob([t],{type:"text/plain"}),n=await I.current.loadFile(a,{ext:"pdb",name:s,asTrajectory:!0});H.current=n,Z(e.length),xe();const r=n.addTrajectory();if(D.current=r,r.trajectory&&r.trajectory.player){const e=r.trajectory.player;V.current=e;const t=Math.round(1e3/K);e.parameters&&(e.parameters.timeout=t,e.parameters.mode="loop",e.parameters.step=1,e.parameters.direction="forward"),e.signals&&(e.signals.startedRunning&&e.signals.startedRunning.add((()=>{W(!0)})),e.signals.haltedRunning&&e.signals.haltedRunning.add((()=>{W(!1)})))}r.trajectory&&r.trajectory.signals&&r.trajectory.signals.frameChanged&&r.trajectory.signals.frameChanged.add((e=>{Y(e)})),I.current.autoView(),L&&V.current&&setTimeout((()=>V.current.play()),500),A(!1)}catch(t){console.error("Error loading trajectory:",t),P(`Failed to load trajectory: ${t.message}`),A(!1)}}},xe=()=>{if(!H.current)return;H.current.removeAllRepresentations();const e={colorScheme:ae,sele:te?"all":"not hydrogen"};switch(Q){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0}H.current.addRepresentation(Q,e),I.current?.autoView()};(0,a.useEffect)((()=>{const s=()=>{if(V.current)if("function"==typeof V.current.pause)try{V.current.pause()}catch(e){}else V.current.intervalId&&clearInterval(V.current.intervalId);W(!1)};if(e){const t=(e=>{const t=e.trim().split("\n"),s=[],a=[],n=[];let r=0;for(;r<t.length;){const e=parseInt(t[r]);if(isNaN(e)){r++;continue}const l=t.slice(r,r+e+2);s.push(l.join("\n"));const i=t[r+1]||"";n.push(i);const o=he(i);console.log(`Comment: "${i}" -> Energy: ${o}`),a.push(o),r+=e+2}console.log("Parsed energies:",a),console.log("Comments:",n),le(a),oe(n);const l=a.filter((e=>null!==e));return console.log("Valid energies:",l),l.length>0?(de(Math.min(...l)),console.log("Set minEnergy to:",Math.min(...l))):(de(null),console.log("Set minEnergy to: null")),s})(e);t.length>0&&(s(),setTimeout((()=>pe(t)),50))}else t&&t.length>0&&(s(),setTimeout((()=>pe(t)),50));return s}),[e,t]),(0,a.useEffect)((()=>{xe()}),[Q,te,ae]);const ve=()=>{if(V.current&&"function"==typeof V.current.play)V.current.play();else if(D.current&&D.current.trajectory&&G>1){W(!0);let e=X;const t=setInterval((()=>{try{D.current&&D.current.trajectory?(e=(e+1)%G,D.current.trajectory.setFrame(e),Y(e)):(clearInterval(t),W(!1))}catch(s){console.warn("Trajectory disposed during playback, stopping:",s.message),clearInterval(t),W(!1)}}),Math.round(1e3/K));V.current={intervalId:t}}},je=()=>{V.current&&("function"==typeof V.current.pause?V.current.pause():V.current.intervalId&&(clearInterval(V.current.intervalId),V.current=null)),W(!1)},ge=e=>{try{D.current&&D.current.trajectory&&D.current.trajectory.setFrame(e)}catch(t){console.warn("Cannot set frame on disposed trajectory:",t.message)}};return(0,a.useEffect)((()=>{const e=e=>{if(!(G<=1||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement))switch(e.code){case"Space":e.preventDefault(),U?je():ve();break;case"ArrowLeft":e.preventDefault(),ge(Math.max(0,X-1));break;case"ArrowRight":e.preventDefault(),ge(Math.min(G-1,X+1));break;case"Home":e.preventDefault(),ge(0);break;case"End":e.preventDefault(),ge(G-1)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[G,X,U]),(0,z.jsxs)("div",{className:r,children:[(0,z.jsxs)("div",{className:l,children:[(0,z.jsx)("h4",{children:s}),(0,z.jsxs)("div",{className:i,children:[(0,z.jsx)("button",{onClick:()=>me(!ue),className:o,title:"Toggle display options",children:"Options"}),(0,z.jsx)("button",{onClick:()=>{I.current&&I.current.autoView(1e3)},className:o,children:"Reset View"}),(0,z.jsx)("button",{onClick:()=>{I.current&&I.current.toggleFullscreen(T.current)},className:o,children:"Fullscreen"})]})]}),(0,z.jsxs)("div",{className:c,ref:T,children:[B&&(0,z.jsx)("div",{className:d,children:(0,z.jsx)("div",{className:m,children:"Loading trajectory..."})}),q&&(0,z.jsx)("div",{className:u,children:(0,z.jsx)("div",{className:h,children:q})}),G>0&&(0,z.jsxs)("div",{className:p,children:[(0,z.jsxs)("div",{className:x,children:["Frame ",X+1,"/",G]}),ie[X]&&(0,z.jsx)("div",{className:v,children:ie[X]}),(console.log("Energy display check:",{currentFrameEnergy:re[X],minEnergy:ce,shouldShow:null!==re[X]&&void 0!==re[X]&&null!==ce}),null!==re[X]&&void 0!==re[X]&&null!==ce&&(0,z.jsx)("div",{className:j,children:(()=>{const e=re[X]-ce;return`${e>=0?"+":""}${(2625.5*e).toFixed(2)} kJ/mol`})()}))]}),ue&&(0,z.jsx)("div",{className:g,children:(0,z.jsxs)("div",{className:f,children:[(0,z.jsxs)("div",{className:N,children:[(0,z.jsx)("label",{className:b,children:"Style:"}),(0,z.jsxs)("select",{value:Q,onChange:e=>ee(e.target.value),className:y,children:[(0,z.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,z.jsx)("option",{value:"line",children:"Line"}),(0,z.jsx)("option",{value:"spacefill",children:"Spacefill"}),(0,z.jsx)("option",{value:"licorice",children:"Licorice"}),(0,z.jsx)("option",{value:"cartoon",children:"Cartoon"})]})]}),(0,z.jsxs)("div",{className:N,children:[(0,z.jsx)("label",{className:b,children:"Color:"}),(0,z.jsxs)("select",{value:ae,onChange:e=>ne(e.target.value),className:y,children:[(0,z.jsx)("option",{value:"element",children:"Element"}),(0,z.jsx)("option",{value:"chainname",children:"Chain"}),(0,z.jsx)("option",{value:"residueindex",children:"Residue"}),(0,z.jsx)("option",{value:"bfactor",children:"B-factor"})]})]}),(0,z.jsxs)("div",{className:N,children:[(0,z.jsx)("input",{type:"checkbox",checked:te,onChange:e=>se(e.target.checked),id:"showH-overlay",className:_}),(0,z.jsx)("label",{htmlFor:"showH-overlay",className:b,children:"Show Hydrogens"})]}),(0,z.jsxs)("div",{className:N,children:[(0,z.jsx)("label",{className:b,children:"FPS:"}),(0,z.jsx)("input",{type:"range",min:"10",max:"60",step:"5",value:K,onChange:e=>(e=>{if(J(e),V.current&&V.current.parameters){const t=Math.round(1e3/e);V.current.parameters.timeout=t,U&&"function"==typeof V.current.pause&&"function"==typeof V.current.play&&(V.current.pause(),V.current.play())}})(parseInt(e.target.value)),className:S}),(0,z.jsx)("span",{className:C,children:K})]})]})})]}),G>1&&(0,z.jsx)("div",{className:$,children:(0,z.jsxs)("div",{className:w,children:[(0,z.jsxs)("div",{className:F,children:[(0,z.jsx)("button",{onClick:()=>ge(Math.max(0,X-1)),className:E,disabled:0===X,title:"Previous frame",children:"\u23ee"}),(0,z.jsx)("button",{onClick:U?je:ve,className:`${E} ${M}`,title:U?"Pause":"Play",children:U?"\u23f8":"\u23f5"}),(0,z.jsx)("button",{onClick:()=>ge(Math.min(G-1,X+1)),className:E,disabled:X===G-1,title:"Next frame",children:"\u23ed"})]}),(0,z.jsx)("div",{className:k,children:(0,z.jsx)("input",{type:"range",min:"0",max:G-1,value:X,onChange:e=>ge(parseInt(e.target.value)),className:O})})]})})]})}}}]);