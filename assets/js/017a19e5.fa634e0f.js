"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[4810],{2302:(e,t,i)=>{i.r(t),i.d(t,{default:()=>G});var r=i(6540),s=i(1656),n=i(5293);class a{constructor(e,t=.95){this.bounds=e,this.damping=t}updateBounds(e){this.bounds=e}setDamping(e){this.damping=e}}class o extends a{apply(e){const{positions:t,velocities:i,count:r}=e,{xMin:s,xMax:n,yMin:a,yMax:o}=this.bounds;for(let l=0;l<r;l++){const e=2*l;t[e]<s?(t[e]=2*s-t[e],i[e]=-i[e]*this.damping):t[e]>n&&(t[e]=2*n-t[e],i[e]=-i[e]*this.damping),t[e+1]<a?(t[e+1]=2*a-t[e+1],i[e+1]=-i[e+1]*this.damping):t[e+1]>o&&(t[e+1]=2*o-t[e+1],i[e+1]=-i[e+1]*this.damping)}}}class l extends a{apply(e){const{positions:t,count:i}=e,{xMin:r,xMax:s,yMin:n,yMax:a}=this.bounds,o=s-r,l=a-n;for(let c=0;c<i;c++){const e=2*c;t[e]<r?t[e]+=o:t[e]>s&&(t[e]-=o),t[e+1]<n?t[e+1]+=l:t[e+1]>a&&(t[e+1]-=l)}}}class c extends a{absorbedParticles=new Set;apply(e){const{positions:t,velocities:i,count:r}=e,{xMin:s,xMax:n,yMin:a,yMax:o}=this.bounds;for(let l=0;l<r;l++){if(this.absorbedParticles.has(l))continue;const e=2*l;(t[e]<s||t[e]>n||t[e+1]<a||t[e+1]>o)&&(i[e]=0,i[e+1]=0,t[e]=Math.max(s,Math.min(n,t[e])),t[e+1]=Math.max(a,Math.min(o,t[e+1])),this.absorbedParticles.add(l))}}reset(){this.absorbedParticles.clear()}getAbsorbedCount(){return this.absorbedParticles.size}}class h extends a{constructor(e,t=.95,i=100){super(e,t),this.stiffness=i}apply(e){const{positions:t,velocities:i,count:r}=e,{xMin:s,xMax:n,yMin:a,yMax:o}=this.bounds;for(let l=0;l<r;l++){const e=2*l,r=2;if(t[e]<s+r){const n=s+r-t[e];i[e]+=this.stiffness*n*.01}else if(t[e]>n-r){const s=t[e]-(n-r);i[e]-=this.stiffness*s*.01}if(t[e+1]<a+r){const s=a+r-t[e+1];i[e+1]+=this.stiffness*s*.01}else if(t[e+1]>o-r){const s=t[e+1]-(o-r);i[e+1]-=this.stiffness*s*.01}t[e]<s?(t[e]=s,i[e]=Math.abs(i[e])*this.damping):t[e]>n&&(t[e]=n,i[e]=-Math.abs(i[e])*this.damping),t[e+1]<a?(t[e+1]=a,i[e+1]=Math.abs(i[e+1])*this.damping):t[e+1]>o&&(t[e+1]=o,i[e+1]=-Math.abs(i[e+1])*this.damping)}}setStiffness(e){this.stiffness=e}}let d=function(e){return e.REFLECTIVE="reflective",e.PERIODIC="periodic",e.ABSORBING="absorbing",e.ELASTIC="elastic",e}({});class u{}class f extends u{constructor(e,t,i=1,r=1,s=10){super(),this.epsilonMatrix=e,this.sigmaMatrix=t,this.epsilonScale=i,this.sigmaScale=r,this.cutoffRadius=s}calculate(e,t,i){if(e>this.cutoffRadius)return{potential:0,force:0};const r=this.epsilonMatrix[t][i]*this.epsilonScale,s=this.sigmaMatrix[t][i]*this.sigmaScale/e,n=Math.pow(s,6),a=Math.pow(n,2);return{potential:4*r*(a-n),force:24*r*(n-2*a)/e}}updateParameters(e,t,i,r){this.epsilonMatrix=e,this.sigmaMatrix=t,void 0!==i&&(this.epsilonScale=i),void 0!==r&&(this.sigmaScale=r)}setCutoff(e){this.cutoffRadius=e}getDescription(){return"Lennard-Jones 12-6 potential with type-dependent parameters"}}class p extends u{constructor(e,t=1,i=14.3996,r=1/0){super(),this.charges=e,this.chargeScale=t,this.coulombConstant=i,this.cutoffRadius=r}calculate(e,t,i){if(e>this.cutoffRadius)return{potential:0,force:0};const r=this.charges[t]*this.chargeScale,s=this.charges[i]*this.chargeScale;return{potential:this.coulombConstant*r*s/e,force:-this.coulombConstant*r*s/(e*e)}}updateCharges(e,t){this.charges=e,void 0!==t&&(this.chargeScale=t)}setCutoff(e){this.cutoffRadius=e}getDescription(){return"Coulomb electrostatic potential"}}class g{constructor(){this.potentials=[],this.weights=[]}addPotential(e,t=1){this.potentials.push(e),this.weights.push(t)}removePotential(e){e>=0&&e<this.potentials.length&&(this.potentials.splice(e,1),this.weights.splice(e,1))}calculateTotal(e,t,i){let r=0,s=0;for(let n=0;n<this.potentials.length;n++){const a=this.potentials[n].calculate(e,t,i);r+=a.potential*this.weights[n],s+=a.force*this.weights[n]}return{potential:r,force:s}}getPotentials(){return[...this.potentials]}getWeights(){return[...this.weights]}setWeight(e,t){e>=0&&e<this.weights.length&&(this.weights[e]=t)}clear(){this.potentials=[],this.weights=[]}}const m=8617333262e-14;class x{constructor(e,t){this.targetTemperature=e,this.timeStep=t}setTargetTemperature(e){this.targetTemperature=e}setTimeStep(e){this.timeStep=e}get kBT(){return m*this.targetTemperature}calculateCurrentTemperature(e){const{velocities:t,masses:i,count:r}=e;let s=0;for(let n=0;n<r;n++){const e=2*n,r=t[e],a=t[e+1],o=r*r+a*a;s+=.5*i[n]*o}return s/(r*m)}getDescription(){return"Base thermostat class"}}class b extends x{constructor(e,t,i=.1){super(e,t),this.couplingStrength=i}apply(e){const t=this.calculateCurrentTemperature(e);if(t>.001){const i=Math.sqrt(this.targetTemperature/t),r=1+this.couplingStrength*(i-1),{velocities:s,count:n}=e;for(let e=0;e<n;e++){const t=2*e;s[t]*=r,s[t+1]*=r}}}setCouplingStrength(e){this.couplingStrength=Math.max(0,Math.min(1,e))}getDescription(){return"Velocity rescaling thermostat with adjustable coupling strength"}}class y extends x{constructor(e,t,i=.01){super(e,t),this.baseFriction=i,this.randomForces=new Float32Array(0)}apply(e){const{velocities:t,masses:i,count:r}=e;this.randomForces.length!==2*r&&(this.randomForces=new Float32Array(2*r));const s=this.calculateCurrentTemperature(e)/Math.max(1,this.targetTemperature),n=s>1.5?this.baseFriction*Math.min(20,s):this.baseFriction;for(let c=0;c<2*r;c+=2){const e=Math.random(),t=Math.random(),i=Math.sqrt(-2*Math.log(Math.max(1e-10,e)));this.randomForces[c]=i*Math.cos(2*Math.PI*t),this.randomForces[c+1]=i*Math.sin(2*Math.PI*t)}const a=this.kBT,o=this.timeStep,l=Math.sqrt(o);for(let c=0;c<r;c++){const e=2*c,r=i[c],s=-n*t[e]*o,h=-n*t[e+1]*o,d=Math.sqrt(2*this.baseFriction*a/r),u=d*l*this.randomForces[e],f=d*l*this.randomForces[e+1];t[e]+=s+u,t[e+1]+=h+f}}setFriction(e){this.baseFriction=Math.max(0,e)}getFriction(){return this.baseFriction}getDescription(){return"Langevin thermostat with adaptive friction"}}class M extends x{constructor(e,t,i=10){super(e,t),this.relaxationTime=i}apply(e){const t=this.calculateCurrentTemperature(e);if(t>.001){const i=this.timeStep,r=this.relaxationTime,s=Math.sqrt(1+i/r*(this.targetTemperature/t-1)),{velocities:n,count:a}=e;for(let e=0;e<a;e++){const t=2*e;n[t]*=s,n[t+1]*=s}}}setRelaxationTime(e){this.relaxationTime=Math.max(.1,e)}getRelaxationTime(){return this.relaxationTime}getDescription(){return"Berendsen thermostat with exponential temperature relaxation"}}class S extends x{constructor(e,t,i=1){super(e,t),this.thermostatMass=i,this.thermostatPosition=0,this.thermostatVelocity=0}apply(e){const{velocities:t,masses:i,count:r}=e,s=this.timeStep,n=this.thermostatMass,a=this.kBT;let o=0;for(let h=0;h<r;h++){const e=2*h,r=t[e],s=t[e+1];o+=.5*i[h]*(r*r+s*s)}const l=(2*o-2*r*a)/n;this.thermostatVelocity+=l*s*.5,this.thermostatPosition+=this.thermostatVelocity*s;const c=Math.exp(-this.thermostatVelocity*s);for(let h=0;h<r;h++){const e=2*h;t[e]*=c,t[e+1]*=c}this.thermostatVelocity+=l*s*.5}setThermostatMass(e){this.thermostatMass=Math.max(.1,e)}reset(){this.thermostatPosition=0,this.thermostatVelocity=0}getDescription(){return"Nos\xe9-Hoover thermostat for canonical ensemble"}}let v=function(e){return e.NONE="none",e.VELOCITY_RESCALING="velocity_rescaling",e.LANGEVIN="langevin",e.BERENDSEN="berendsen",e.NOSE_HOOVER="nose_hoover",e}({});class C{constructor(e=1,t=1e3,i=10,r=100){this.collectiveVariables=new Map,this.systemSnapshots=[],this.samplingInterval=e,this.lastSampleTime=0,this.currentTime=0,this.maxHistoryLength=t,this.particleTypes=new Uint8Array(0);const s=i/r;this.rdf={r:Array.from({length:r},(e,t)=>(t+.5)*s),gr:new Array(r).fill(0),gr_partial:{},binWidth:s,maxRadius:i,sampleCount:0},this.initializeCollectiveVariables()}initializeCollectiveVariables(){[{name:"temperature",unit:"K",description:"Instantaneous temperature"},{name:"pressure",unit:"eV/\xc5\xb2",description:"Instantaneous pressure"},{name:"totalEnergy",unit:"eV",description:"Total energy (kinetic + potential)"},{name:"kineticEnergy",unit:"eV",description:"Total kinetic energy"},{name:"potentialEnergy",unit:"eV",description:"Total potential energy"},{name:"density",unit:"amu/\xc5\xb2",description:"System density (2D)"},{name:"volume",unit:"\xc5\xb2",description:"System area (2D)"},{name:"diffusionCoefficient",unit:"\xc5\xb2/time",description:"Self-diffusion coefficient"},{name:"heatCapacity",unit:"kB",description:"Heat capacity at constant volume"}].forEach(e=>{this.collectiveVariables.set(e.name,{name:e.name,values:[],times:[],unit:e.unit,description:e.description})})}updateTime(e){this.currentTime+=e}shouldSample(){return this.currentTime-this.lastSampleTime>=this.samplingInterval}calculateAndSample(e,t,i,r){if(!this.shouldSample())return;const s=this.calculateSystemProperties(e,t,i,r);this.systemSnapshots.push(s),Object.entries(s).forEach(([e,t])=>{if("time"!==e&&this.collectiveVariables.has(e)){const i=this.collectiveVariables.get(e);i.values.push(t),i.times.push(this.currentTime),i.values.length>this.maxHistoryLength&&(i.values.shift(),i.times.shift())}}),this.calculateDerivedProperties(),this.updateRadialDistributionFunction(e,i),this.lastSampleTime=this.currentTime,this.systemSnapshots.length>this.maxHistoryLength&&this.systemSnapshots.shift()}calculateSystemProperties(e,t,i,r){const{velocities:s,masses:n,count:a}=e;let o=0;for(let u=0;u<a;u++){const e=2*u,t=s[e],i=s[e+1];o+=.5*n[u]*(t*t+i*i)}const l=o/(8617333262e-14*a),c=o+t,h=(o+r)/i,d=n.reduce((e,t)=>e+t,0)/i;return{time:this.currentTime,temperature:l,pressure:h,totalEnergy:c,kineticEnergy:o,potentialEnergy:t,density:d,volume:i}}calculateDerivedProperties(){if(this.systemSnapshots.length<10)return;const e=this.systemSnapshots.slice(-50).map(e=>e.totalEnergy),t=this.systemSnapshots.slice(-50).map(e=>e.temperature);if(e.length>1){const i=e.reduce((e,t)=>e+t,0)/e.length,r=t.reduce((e,t)=>e+t,0)/t.length,s=e.reduce((e,t)=>e+(t-i)**2,0)/(e.length-1)/(r*r),n=this.collectiveVariables.get("heatCapacity");n.values.push(s),n.times.push(this.currentTime),n.values.length>this.maxHistoryLength&&(n.values.shift(),n.times.shift())}const i=this.collectiveVariables.get("diffusionCoefficient");i.values.push(0),i.times.push(this.currentTime),i.values.length>this.maxHistoryLength&&(i.values.shift(),i.times.shift())}updateRadialDistributionFunction(e,t){const{positions:i,count:r}=e,s=this.particleTypes.length===r?this.particleTypes:new Uint8Array(r).fill(0),n=this.rdf.binWidth,a=this.rdf.maxRadius,o=this.rdf.r.length,l=new Array(o).fill(0),c={},h=Array.from(new Set(s));h.forEach(e=>{h.forEach(t=>{if(e<=t){c[`${e}-${t}`]=new Array(o).fill(0)}})});for(let u=0;u<r;u++)for(let e=u+1;e<r;e++){const t=2*u,r=2*e,h=i[r]-i[t],d=i[r+1]-i[t+1],f=Math.sqrt(h*h+d*d);if(f<a&&f>0){const t=Math.floor(f/n);if(t<o){l[t]++;const i=s[u],r=s[e],n=i<=r?`${i}-${r}`:`${r}-${i}`;c[n]&&c[n][t]++}}}const d=r/t;for(let u=0;u<o;u++){const e=this.rdf.r[u],t=d*(2*Math.PI*e*n)*r,i=1/(this.rdf.sampleCount+1);this.rdf.gr[u]=(1-i)*this.rdf.gr[u]+i*(l[u]/t),Object.entries(c).forEach(([e,r])=>{this.rdf.gr_partial[e]||(this.rdf.gr_partial[e]=new Array(o).fill(0)),this.rdf.gr_partial[e][u]=(1-i)*this.rdf.gr_partial[e][u]+i*(r[u]/t)})}this.rdf.sampleCount++}setParticleTypes(e){this.particleTypes=new Uint8Array(e)}getCollectiveVariable(e){return this.collectiveVariables.get(e)}getAllCollectiveVariables(){return new Map(this.collectiveVariables)}getRadialDistributionFunction(){return{...this.rdf}}getSystemSnapshots(){return[...this.systemSnapshots]}getLatestSnapshot(){return this.systemSnapshots[this.systemSnapshots.length-1]}getTimeAverages(e=100){const t={};return this.collectiveVariables.forEach((i,r)=>{if(i.values.length>0){const s=i.values.slice(-e);t[r]=s.reduce((e,t)=>e+t,0)/s.length}}),t}getFluctuations(e=100){const t={};return this.collectiveVariables.forEach((i,r)=>{if(i.values.length>1){const s=i.values.slice(-e),n=s.reduce((e,t)=>e+t,0)/s.length,a=s.reduce((e,t)=>e+(t-n)**2,0)/(s.length-1);t[r]=Math.sqrt(a)}}),t}exportData(){const e={};return this.collectiveVariables.forEach((t,i)=>{e[i]={...t}}),{collectiveVariables:e,rdf:{...this.rdf},snapshots:[...this.systemSnapshots]}}reset(){this.collectiveVariables.forEach(e=>{e.values=[],e.times=[]}),this.systemSnapshots=[],this.rdf.gr.fill(0),this.rdf.gr_partial={},this.rdf.sampleCount=0,this.currentTime=0,this.lastSampleTime=0}setSamplingInterval(e){this.samplingInterval=Math.max(.1,e)}getCurrentTime(){return this.currentTime}}class w{needsRebuild=!0;stepsSinceRebuild=0;totalPairs=0;constructor(e,t){this.boxWidth=e.boxWidth,this.boxHeight=e.boxHeight,this.halfBoxWidth=e.boxWidth/2,this.halfBoxHeight=e.boxHeight/2,this.xMin=e.xMin,this.yMin=e.yMin,this.isPeriodic=e.isPeriodic,this.cutoff=e.cutoff,this.skin=e.skin,this.effectiveCutoff=e.cutoff+e.skin,this.effectiveCutoffSq=this.effectiveCutoff*this.effectiveCutoff,this.cutoffSq=e.cutoff*e.cutoff,this.maxAtoms=t,this.maxNeighborsPerAtom=e.maxNeighborsPerAtom,this.rebuildInterval=e.rebuildInterval;const i=2*this.effectiveCutoff,r=Math.min(this.boxWidth,this.boxHeight),s=Math.max(1,Math.floor(r/i));this.cellSize=r/s,this.nCellsX=Math.max(1,Math.floor(this.boxWidth/this.cellSize)),this.nCellsY=Math.max(1,Math.floor(this.boxHeight/this.cellSize));const n=this.nCellsX*this.nCellsY;this.head=new Int32Array(n),this.next=new Int32Array(t),this.cellVisited=new Uint8Array(n);const a=t*this.maxNeighborsPerAtom;this.neighborIndices=new Int32Array(a),this.neighborCounts=new Int32Array(t),this.neighborDx=new Float32Array(a),this.neighborDy=new Float32Array(a),this.neighborRSq=new Float32Array(a),this.lastBuildPositions=new Float32Array(2*t)}updateBox(e,t,i,r){this.boxWidth=e,this.boxHeight=t,this.halfBoxWidth=e/2,this.halfBoxHeight=t/2,this.xMin=i,this.yMin=r;const s=2*this.effectiveCutoff,n=Math.min(this.boxWidth,this.boxHeight),a=Math.max(1,Math.floor(n/s));this.cellSize=n/a,this.nCellsX=Math.max(1,Math.floor(this.boxWidth/this.cellSize)),this.nCellsY=Math.max(1,Math.floor(this.boxHeight/this.cellSize));const o=this.nCellsX*this.nCellsY;this.head.length<o&&(this.head=new Int32Array(o),this.cellVisited=new Uint8Array(o)),this.needsRebuild=!0}setPeriodicBoundaries(e){this.isPeriodic!==e&&(this.isPeriodic=e,this.needsRebuild=!0)}setCutoff(e){if(this.cutoff!==e){this.cutoff=e,this.effectiveCutoff=e+this.skin,this.effectiveCutoffSq=this.effectiveCutoff*this.effectiveCutoff,this.cutoffSq=e*e;const t=2*this.effectiveCutoff,i=Math.min(this.boxWidth,this.boxHeight),r=Math.max(1,Math.floor(i/t));this.cellSize=i/r,this.nCellsX=Math.max(1,Math.floor(this.boxWidth/this.cellSize)),this.nCellsY=Math.max(1,Math.floor(this.boxHeight/this.cellSize)),this.needsRebuild=!0}}minimumImage(e,t){return this.isPeriodic&&(e>this.halfBoxWidth?e-=this.boxWidth:e<-this.halfBoxWidth&&(e+=this.boxWidth),t>this.halfBoxHeight?t-=this.boxHeight:t<-this.halfBoxHeight&&(t+=this.boxHeight)),[e,t]}checkDisplacement(e,t){const i=this.skin/4*(this.skin/4);for(let r=0;r<t;r++){const t=2*r;let s=e[t]-this.lastBuildPositions[t],n=e[t+1]-this.lastBuildPositions[t+1];if([s,n]=this.minimumImage(s,n),s*s+n*n>i)return!0}return!1}getCellIndex(e,t){let i=e-this.xMin,r=t-this.yMin;this.isPeriodic&&(i=(i%this.boxWidth+this.boxWidth)%this.boxWidth,r=(r%this.boxHeight+this.boxHeight)%this.boxHeight);const s=Math.min(this.nCellsX-1,Math.max(0,Math.floor(i/this.cellSize)));return Math.min(this.nCellsY-1,Math.max(0,Math.floor(r/this.cellSize)))*this.nCellsX+s}buildCellList(e,t){this.head.fill(-1);for(let i=0;i<t;i++){const t=2*i,r=this.getCellIndex(e[t],e[t+1]);this.next[i]=this.head[r],this.head[r]=i}}build(e,t){this.buildCellList(e,t),this.neighborCounts.fill(0),this.totalPairs=0;for(let i=0;i<t;i++){const t=2*i,r=e[t],s=e[t+1];let n=r-this.xMin,a=s-this.yMin;this.isPeriodic&&(n=(n%this.boxWidth+this.boxWidth)%this.boxWidth,a=(a%this.boxHeight+this.boxHeight)%this.boxHeight);const o=Math.min(this.nCellsX-1,Math.max(0,Math.floor(n/this.cellSize))),l=Math.min(this.nCellsY-1,Math.max(0,Math.floor(a/this.cellSize)));for(let c=-1;c<=1;c++)for(let t=-1;t<=1;t++){let n=o+t,a=l+c;if(this.isPeriodic)n=(n%this.nCellsX+this.nCellsX)%this.nCellsX,a=(a%this.nCellsY+this.nCellsY)%this.nCellsY;else if(n<0||n>=this.nCellsX||a<0||a>=this.nCellsY)continue;const h=a*this.nCellsX+n;if(1===this.cellVisited[h])continue;this.cellVisited[h]=1;let d=this.head[h];for(;d>=0;){if(d>i){const t=2*d;let n=e[t]-r,a=e[t+1]-s;[n,a]=this.minimumImage(n,a);const o=n*n+a*a;if(o<this.effectiveCutoffSq){const e=this.neighborCounts[i];if(e<this.maxNeighborsPerAtom){const t=i*this.maxNeighborsPerAtom+e;this.neighborIndices[t]=d,this.neighborDx[t]=n,this.neighborDy[t]=a,this.neighborRSq[t]=o,this.neighborCounts[i]++,this.totalPairs++}}}d=this.next[d]}}this.cellVisited.fill(0)}this.lastBuildPositions.set(e.subarray(0,2*t)),this.needsRebuild=!1,this.stepsSinceRebuild=0}update(e,t){this.stepsSinceRebuild++;return this.needsRebuild||this.stepsSinceRebuild>=this.rebuildInterval||this.checkDisplacement(e,t)?(this.build(e,t),!0):(this.updateDisplacements(e,t),!1)}updateDisplacements(e,t){for(let i=0;i<t;i++){const t=2*i,r=e[t],s=e[t+1],n=this.neighborCounts[i];for(let a=0;a<n;a++){const t=i*this.maxNeighborsPerAtom+a,n=2*this.neighborIndices[t];let o=e[n]-r,l=e[n+1]-s;[o,l]=this.minimumImage(o,l),this.neighborDx[t]=o,this.neighborDy[t]=l,this.neighborRSq[t]=o*o+l*l}}}invalidate(){this.needsRebuild=!0}forEachPair(e,t){for(let i=0;i<t;i++){const t=this.neighborCounts[i];for(let r=0;r<t;r++){const t=i*this.maxNeighborsPerAtom+r,s=this.neighborIndices[t],n=this.neighborDx[t],a=this.neighborDy[t],o=this.neighborRSq[t];o<this.cutoffSq&&e(i,s,n,a,o)}}}getStats(){let e=0,t=0;for(let i=0;i<this.neighborCounts.length;i++)this.neighborCounts[i]>0&&(e+=this.neighborCounts[i],t++);return{totalPairs:this.totalPairs,avgNeighbors:t>0?e/t:0,nCells:[this.nCellsX,this.nCellsY],cellSize:this.cellSize}}getCutoff(){return this.cutoff}getCutoffSquared(){return this.cutoffSq}}function k(e,t,i={}){const{strength:r=50,width:s=15,shape:n="harmonic"}=i,{boxWidth:a,boxHeight:o,xMin:l,yMin:c}=e.config,h=l+a/2,d=c+o/2;switch("draw"!==t&&e.clear(),t){case"vertical-wall":e.addVerticalSeparator(h,r,s,n);break;case"horizontal-wall":e.addHorizontalSeparator(d,r,s,n);break;case"box-walls":e.addVerticalSeparator(l+s/2,r,s,n),e.addVerticalSeparator(l+a-s/2,r,s,n),e.addHorizontalSeparator(c+s/2,r,s,n),e.addHorizontalSeparator(c+o-s/2,r,s,n);break;case"center-repel":e.addPoint(h,d,r,Math.min(a,o)/2,n);break;case"center-attract":e.addPoint(h,d,-r,Math.min(a,o)/2,n);break;case"electrode-walls":const t=.6*s,i=l+.15*a,u=l+.85*a;e.addVerticalSeparator(i,2*r,t,n),e.addVerticalSeparator(u,2*r,t,n)}}const T=.0104,P=3.4,R=39.948,j=.15,F=2.35,I=3.5,E={custom:{name:"Custom",description:"Configure your own simulation",numParticles:250,temperature:1e3,orangeRatio:.5,boundaryType:d.PERIODIC,fieldPreset:"none",eFieldPreset:"none",fieldStrength:50,eFieldStrength:0,initLayout:"random",particleTypes:[{label:"Na\u207a",color:"rgba(255, 165, 0, 0.8)"},{label:"Cl\u207b",color:"rgba(0, 100, 255, 0.8)"}],epsilonMatrix:[[.1,j],[j,.1]],sigmaMatrix:[[F,2.925],[2.925,I]],masses:[22.99,35.45],charges:[1,-1],chargeScale:1},argon:{name:"Argon",description:"Liquid argon - single component LJ fluid",numParticles:100,temperature:90,orangeRatio:1,boundaryType:d.PERIODIC,fieldPreset:"none",eFieldPreset:"none",fieldStrength:50,eFieldStrength:0,initLayout:"random",particleTypes:[{label:"Ar",color:"rgba(128, 128, 255, 0.8)"},{label:"Ar",color:"rgba(128, 128, 255, 0.8)"}],epsilonMatrix:[[T,T],[T,T]],sigmaMatrix:[[P,P],[P,P]],masses:[R,R],charges:[0,0],chargeScale:0},nacl:{name:"NaCl",description:"Molten salt with Coulomb interactions",numParticles:250,temperature:1200,orangeRatio:.5,boundaryType:d.PERIODIC,fieldPreset:"none",eFieldPreset:"none",fieldStrength:50,eFieldStrength:0,initLayout:"random",particleTypes:[{label:"Na\u207a",color:"rgba(255, 165, 0, 0.8)"},{label:"Cl\u207b",color:"rgba(0, 100, 255, 0.8)"}],epsilonMatrix:[[.1,j],[j,.1]],sigmaMatrix:[[F,2.925],[2.925,I]],masses:[22.99,35.45],charges:[1,-1],chargeScale:1},mixing:{name:"Mixing",description:"Two separated fluids diffusing",numParticles:120,temperature:150,orangeRatio:.5,boundaryType:d.PERIODIC,fieldPreset:"none",eFieldPreset:"none",fieldStrength:50,eFieldStrength:0,initLayout:"separated-lr",particleTypes:[{label:"A",color:"rgba(255, 100, 100, 0.8)"},{label:"B",color:"rgba(100, 100, 255, 0.8)"}],epsilonMatrix:[[T,.7*T],[.7*T,T]],sigmaMatrix:[[P,P],[P,P]],masses:[R,R],charges:[0,0],chargeScale:0}};var A=i(8371),D=i(4848);const z=10.1805,W=({numParticles:e,setNumParticles:t,temperature:i,setTemperature:s,timeStep:n,setTimeStep:a,stepsPerFrame:o,setStepsPerFrame:l,orangeRatio:c,setOrangeRatio:h,boundaryType:u,setBoundaryType:f,thermostatType:p,setThermostatType:g,chargeScale:m,setChargeScale:x,visualScale:b,setVisualScale:y,charges:M,setCharges:S,typeLabels:C,setTypeLabels:w,typeColors:k,setTypeColors:T,epsilonMatrix:P,sigmaMatrix:R,updateInteractionParameter:j,numTypes:F,showCells:I,setShowCells:E,showInteractions:W,setShowInteractions:B,showCutoffRadius:V,setShowCutoffRadius:q,cutoffRadius:L,setCutoffRadius:N,isDark:$=!1})=>{const[H,O]=(0,r.useState)(!1),[_,G]=(0,r.useState)(!1),[Y,X]=(0,r.useState)(!0),K={background:$?"#2d2d2d":"#f8f9fa",surface:$?"#3d3d3d":"#ffffff",border:$?"#555":"#e0e0e0",text:$?"#e0e0e0":"#333",textMuted:$?"#999":"#666",accent:$?"#6b9eff":"#2563eb",inputBg:$?"#4a4a4a":"#f3f4f6"},U={width:"100%",padding:"0.35rem 0.5rem",fontSize:"0.8rem",border:`1px solid ${K.border}`,borderRadius:"4px",backgroundColor:K.surface,color:K.text,cursor:"pointer"},J={marginBottom:"1rem",paddingBottom:"1rem",borderBottom:`1px solid ${K.border}`},Q={fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:K.textMuted,marginBottom:"0.5rem"};return(0,D.jsxs)("div",{style:{backgroundColor:K.background,padding:"1rem",borderRadius:"8px",border:`1px solid ${K.border}`,color:K.text,fontSize:"0.85rem"},children:[(0,D.jsxs)("div",{style:J,children:[(0,D.jsx)("div",{style:Q,children:"System"}),(0,D.jsx)(A.GK,{label:"Particles",value:e,onChange:e=>t(Math.round(e)),min:2,max:500,step:1,decimals:0,theme:K}),(0,D.jsx)(A.GK,{label:"Temperature",value:i,onChange:s,min:1,max:3e3,step:10,decimals:0,unit:"K",theme:K}),(0,D.jsx)(A.GK,{label:"Type ratio",value:c,onChange:h,min:0,max:1,step:.1,decimals:1,theme:K}),(0,D.jsx)("div",{style:{marginTop:"0.25rem"},children:(0,D.jsxs)("select",{value:u,onChange:e=>f(e.target.value),style:U,children:[(0,D.jsx)("option",{value:d.PERIODIC,children:"Periodic boundaries"}),(0,D.jsx)("option",{value:d.REFLECTIVE,children:"Reflective walls"}),(0,D.jsx)("option",{value:d.ELASTIC,children:"Elastic walls"})]})})]}),(0,D.jsxs)("div",{style:J,children:[(0,D.jsx)("div",{style:Q,children:"Interactions"}),[0,1].slice(0,F).map(e=>(0,D.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.35rem",marginBottom:"0.25rem"},children:[(0,D.jsx)("div",{style:{width:"10px",height:"10px",backgroundColor:k[e],borderRadius:"2px"}}),(0,D.jsx)("span",{style:{fontSize:"0.75rem",color:K.textMuted},children:"-"}),(0,D.jsx)("div",{style:{width:"10px",height:"10px",backgroundColor:k[e],borderRadius:"2px"}})]}),(0,D.jsx)(A.GK,{label:"\u03b5 (well depth)",value:P[e][e],onChange:t=>((e,t,i)=>{if(j("epsilon",e,t,i),e===t&&Y&&F>1){const t=0===e?i:P[0][0],r=1===e?i:P[1][1],s=Math.sqrt(t*r);j("epsilon",0,1,s),j("epsilon",1,0,s)}})(e,e,t),min:.001,max:2,step:.01,decimals:3,unit:"eV",theme:K}),(0,D.jsx)(A.GK,{label:"\u03c3 (size)",value:R[e][e],onChange:t=>((e,t,i)=>{if(j("sigma",e,t,i),e===t&&Y&&F>1){const t=((0===e?i:R[0][0])+(1===e?i:R[1][1]))/2;j("sigma",0,1,t),j("sigma",1,0,t)}})(e,e,t),min:1,max:8,step:.1,decimals:1,unit:"\xc5",theme:K})]},e)),F>1&&(0,D.jsxs)("div",{style:{marginTop:"0.5rem"},children:[(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.35rem"},children:[(0,D.jsx)("div",{style:{width:"10px",height:"10px",backgroundColor:k[0],borderRadius:"2px"}}),(0,D.jsx)("span",{style:{fontSize:"0.75rem",color:K.textMuted},children:"-"}),(0,D.jsx)("div",{style:{width:"10px",height:"10px",backgroundColor:k[1],borderRadius:"2px"}})]}),(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.7rem",cursor:"pointer",marginLeft:"auto"},children:[(0,D.jsx)("input",{type:"checkbox",checked:Y,onChange:e=>{const t=e.target.checked;if(X(t),t){const e=Math.sqrt(P[0][0]*P[1][1]),t=(R[0][0]+R[1][1])/2;j("epsilon",0,1,e),j("epsilon",1,0,e),j("sigma",0,1,t),j("sigma",1,0,t)}},style:{margin:0}}),(0,D.jsx)("span",{style:{color:K.textMuted},children:"auto"})]})]}),!Y&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(A.GK,{label:"\u03b5 (cross)",value:P[0][1],onChange:e=>{j("epsilon",0,1,e),j("epsilon",1,0,e)},min:.001,max:2,step:.01,decimals:3,unit:"eV",theme:K}),(0,D.jsx)(A.GK,{label:"\u03c3 (cross)",value:R[0][1],onChange:e=>{j("sigma",0,1,e),j("sigma",1,0,e)},min:1,max:8,step:.1,decimals:1,unit:"\xc5",theme:K})]})]}),(0,D.jsx)("div",{style:{marginTop:"0.5rem"},children:(0,D.jsx)(A.GK,{label:"Coulomb strength",value:m,onChange:x,min:0,max:5,step:.1,decimals:1,unit:"\xd7",theme:K})})]}),(0,D.jsx)("div",{style:{marginBottom:"0.75rem"},children:(0,D.jsx)(A.GK,{label:"Circle size",value:b,onChange:y,min:1,max:15,step:.5,decimals:1,theme:K})}),(0,D.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,D.jsxs)("button",{onClick:()=>G(!_),style:{width:"100%",padding:"0.4rem",border:`1px solid ${K.border}`,borderRadius:"4px",backgroundColor:K.surface,color:K.textMuted,fontSize:"0.75rem",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,D.jsx)("span",{children:"Timing"}),(0,D.jsx)("span",{style:{transform:_?"rotate(180deg)":"none",transition:"transform 0.2s"},children:"\u25bc"})]}),_&&(0,D.jsxs)("div",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:K.surface,borderRadius:"4px"},children:[(0,D.jsx)(A.GK,{label:"Time step",value:n*z,onChange:e=>a(e/z),min:.1,max:10,step:.1,decimals:1,unit:"fs",theme:K}),(0,D.jsx)(A.GK,{label:"Steps/frame",value:o,onChange:e=>l(Math.round(e)),min:1,max:100,step:1,decimals:0,theme:K}),(0,D.jsxs)("div",{style:{fontSize:"0.65rem",color:K.textMuted,marginTop:"0.25rem"},children:[(n*z*o).toFixed(0)," fs/frame"]})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("button",{onClick:()=>O(!H),style:{width:"100%",padding:"0.4rem",border:`1px solid ${K.border}`,borderRadius:"4px",backgroundColor:K.surface,color:K.textMuted,fontSize:"0.75rem",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,D.jsx)("span",{children:"Advanced"}),(0,D.jsx)("span",{style:{transform:H?"rotate(180deg)":"none",transition:"transform 0.2s"},children:"\u25bc"})]}),H&&(0,D.jsxs)("div",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:K.surface,borderRadius:"4px"},children:[(0,D.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,D.jsx)("div",{style:{...Q,marginBottom:"0.25rem"},children:"Thermostat"}),(0,D.jsxs)("select",{value:p,onChange:e=>g(e.target.value),style:U,children:[(0,D.jsx)("option",{value:v.NONE,children:"None (NVE)"}),(0,D.jsx)("option",{value:v.LANGEVIN,children:"Langevin"}),(0,D.jsx)("option",{value:v.BERENDSEN,children:"Berendsen"}),(0,D.jsx)("option",{value:v.VELOCITY_RESCALING,children:"Velocity rescaling"}),(0,D.jsx)("option",{value:v.NOSE_HOOVER,children:"Nos\xe9-Hoover"})]})]}),(0,D.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,D.jsx)("div",{style:{...Q,marginBottom:"0.5rem"},children:"Particle Types"}),C.map((e,t)=>(0,D.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"60px 50px 1fr",gap:"0.5rem",alignItems:"center",marginBottom:"0.5rem"},children:[(0,D.jsx)("input",{type:"text",value:e,onChange:e=>{const i=[...C];i[t]=e.target.value,w(i)},style:{padding:"0.2rem 0.3rem",fontSize:"0.75rem",border:`1px solid ${K.border}`,borderRadius:"3px",backgroundColor:K.inputBg,color:K.text},placeholder:"Label"}),(0,D.jsx)("input",{type:"number",step:"0.5",value:M[t],onChange:e=>{const i=[...M];i[t]=parseFloat(e.target.value)||0,S(i)},style:{padding:"0.2rem 0.3rem",fontSize:"0.75rem",border:`1px solid ${K.border}`,borderRadius:"3px",backgroundColor:K.inputBg,color:K.text},title:"Charge (e)"}),(0,D.jsxs)("select",{value:k[t],onChange:e=>{const i=[...k];i[t]=e.target.value,T(i)},style:{...U,fontSize:"0.7rem",padding:"0.25rem"},children:[(0,D.jsx)("option",{value:"rgba(255, 165, 0, 0.8)",children:"Orange"}),(0,D.jsx)("option",{value:"rgba(0, 100, 255, 0.8)",children:"Blue"}),(0,D.jsx)("option",{value:"rgba(255, 50, 50, 0.8)",children:"Red"}),(0,D.jsx)("option",{value:"rgba(50, 180, 50, 0.8)",children:"Green"}),(0,D.jsx)("option",{value:"rgba(160, 50, 200, 0.8)",children:"Purple"}),(0,D.jsx)("option",{value:"rgba(100, 100, 100, 0.8)",children:"Gray"}),(0,D.jsx)("option",{value:"rgba(128, 128, 255, 0.8)",children:"Light Blue"})]})]},t)),(0,D.jsx)("div",{style:{fontSize:"0.65rem",color:K.textMuted,marginTop:"0.25rem"},children:"Label, Charge (e), Color"})]}),E&&B&&q&&N&&(0,D.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,D.jsx)("div",{style:{...Q,marginBottom:"0.5rem"},children:"Debug Visualization"}),(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.4rem"},children:[(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.4rem",cursor:"pointer",fontSize:"0.8rem"},children:[(0,D.jsx)("input",{type:"checkbox",checked:I,onChange:e=>E(e.target.checked)}),"Show cells"]}),(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.4rem",cursor:"pointer",fontSize:"0.8rem"},children:[(0,D.jsx)("input",{type:"checkbox",checked:W,onChange:e=>B(e.target.checked)}),"Show interactions"]}),(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.4rem",cursor:"pointer",fontSize:"0.8rem"},children:[(0,D.jsx)("input",{type:"checkbox",checked:V,onChange:e=>q(e.target.checked)}),"Show cutoff radius"]}),(0,D.jsx)(A.GK,{label:"Cutoff radius",value:L??12,onChange:N,min:6,max:12,step:.5,decimals:1,unit:"\xc5",theme:K})]})]})]})]})]})},B=({running:e,setRunning:t,onReset:i,minimizing:r=!1,onMinimize:s,scenario:n,onScenarioChange:a,time:o,stepCount:l,isDrawMode:c=!1,setIsDrawMode:h,brushRadius:d=20,setBrushRadius:u,fieldStrength:f=100,setFieldStrength:p,showField:g=!0,setShowField:m,fieldChargeMode:x=!1,setFieldChargeMode:b,onClearField:y,isDark:M})=>{const S={bg:M?"#1e1e1e":"#ffffff",surface:M?"#2d2d2d":"#f5f5f5",border:M?"#3d3d3d":"#e0e0e0",text:M?"#e0e0e0":"#333",textMuted:M?"#888":"#666",accent:M?"#60a5fa":"#2563eb",accentHover:M?"#3b82f6":"#1d4ed8"},v={padding:"0.4rem 0.7rem",border:"none",borderRadius:"6px",fontSize:"0.8rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.3rem",transition:"all 0.15s ease"},C=Object.keys(E),w="custom"===n&&h;return(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.5rem 0.75rem",backgroundColor:S.bg,borderRadius:"8px",border:`1px solid ${S.border}`,flexWrap:"wrap"},children:[(0,D.jsxs)("div",{style:{display:"flex",gap:"0.35rem"},children:[(0,D.jsx)("button",{onClick:()=>t(!e),style:{...v,backgroundColor:e?"#f59e0b":"#10b981",color:"#fff",minWidth:"70px"},children:e?"Pause":"Start"}),(0,D.jsx)("button",{onClick:i,title:"Reset simulation",style:{...v,backgroundColor:"#ef4444",color:"#fff"},children:"Reset"}),s&&(0,D.jsx)("button",{onClick:s,disabled:r||e,title:"Energy minimization",style:{...v,backgroundColor:r?"#9ca3af":S.surface,color:r?"#fff":S.text,border:`1px solid ${S.border}`,opacity:e?.5:1,cursor:r||e?"not-allowed":"pointer"},children:r?"...":"Opt."})]}),(0,D.jsx)("div",{style:{width:"1px",height:"24px",backgroundColor:S.border}}),(0,D.jsx)("div",{style:{display:"flex",gap:"0.25rem",flexWrap:"wrap"},children:C.map(e=>{const t=n===e,i=E[e];return(0,D.jsx)("button",{onClick:()=>a(e),title:i.description,style:{padding:"0.3rem 0.6rem",border:"none",borderRadius:"12px",fontSize:"0.75rem",fontWeight:t?600:400,cursor:"pointer",backgroundColor:t?S.accent:S.surface,color:t?"#fff":S.textMuted,transition:"all 0.15s ease"},children:i.name},e)})}),w&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{style:{width:"1px",height:"24px",backgroundColor:S.border}}),(0,D.jsx)("button",{onClick:()=>h(!c),title:"Toggle draw mode (left-click: attract, right-click: repel)",style:{...v,backgroundColor:c?S.accent:S.surface,color:c?"#fff":S.text,border:`1px solid ${S.border}`},children:"Draw"})]}),(0,D.jsx)("div",{style:{flex:1}}),(0,D.jsxs)("div",{style:{display:"flex",gap:"0.75rem",fontSize:"0.75rem",fontFamily:"monospace",color:S.textMuted},children:[(0,D.jsxs)("span",{children:[o.toFixed(2)," ps"]}),(0,D.jsxs)("span",{children:[l.toLocaleString()," steps"]})]})]}),w&&c&&(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"0.4rem 0.75rem",backgroundColor:S.bg,borderRadius:"8px",border:`1px solid ${S.border}`,fontSize:"0.8rem"},children:[(0,D.jsx)("span",{style:{color:S.textMuted,fontSize:"0.75rem"},children:"Left-click: attract | Right-click: repel"}),(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.3rem"},children:[(0,D.jsx)("span",{style:{color:S.textMuted,fontSize:"0.75rem"},children:"Size"}),(0,D.jsx)("input",{type:"range",min:"2",max:"30",step:"1",value:d,onChange:e=>u?.(parseFloat(e.target.value)),style:{width:"60px",accentColor:S.accent}})]}),(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.3rem"},children:[(0,D.jsx)("span",{style:{color:S.textMuted,fontSize:"0.75rem"},children:"Strength"}),(0,D.jsx)("input",{type:"range",min:"10",max:"200",step:"10",value:f,onChange:e=>p?.(parseFloat(e.target.value)),style:{width:"60px",accentColor:S.accent}})]}),(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",cursor:"pointer",color:S.textMuted,fontSize:"0.75rem"},children:[(0,D.jsx)("input",{type:"checkbox",checked:g,onChange:e=>m?.(e.target.checked),style:{margin:0,accentColor:S.accent}}),"Show"]}),(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",cursor:"pointer",color:S.textMuted,fontSize:"0.75rem"},title:"Field affects particles based on their type (+/-)",children:[(0,D.jsx)("input",{type:"checkbox",checked:x,onChange:e=>b?.(e.target.checked),style:{margin:0,accentColor:S.accent}}),"+/-"]}),(0,D.jsx)("button",{onClick:y,title:"Clear all drawn fields",style:{padding:"0.25rem 0.5rem",border:`1px solid ${S.border}`,borderRadius:"4px",fontSize:"0.75rem",cursor:"pointer",backgroundColor:S.surface,color:S.textMuted},children:"Clear"})]})]})},V=({analytics:e,particleData:t,width:i,isDark:s=!1,typeLabels:n=["Type 0","Type 1"],typeColors:a=["rgba(255, 165, 0, 0.8)","rgba(0, 0, 255, 0.8)"]})=>{const o=e=>{const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return t?`rgb(${t[1]}, ${t[2]}, ${t[3]})`:e},l=o(a[0]),c=o(a[1]),h=(0,r.useRef)(null),[d,u]=(0,r.useState)("temperature"),[f,p]=(0,r.useState)(!1),[g,m]=(0,r.useState)({"0-0":!0,"0-1":!0,"1-1":!0,total:!0,kinetic:!0,potential:!0,totalEnergy:!0}),x=e=>{m(t=>({...t,[e]:!t[e]}))},b=(0,r.useRef)([]),y=(0,r.useRef)([]),M={background:s?"#1a1a1a":"#ffffff",surface:s?"#2d2d2d":"#f8f9fa",border:s?"#444":"#e9ecef",text:s?"#e0e0e0":"#374151",textMuted:s?"#888":"#6b7280",axis:s?"#666":"#666666",grid:s?"#333":"#e5e7eb",lineBlue:"#3b82f6",lineOrange:"#f97316",lineBlack:s?"#e0e0e0":"#1f2937",lineRed:"#dc2626"},S=()=>{const t=h.current;if(!t||!e)return;const i=t.getContext("2d");if(!i)return;const r=window.devicePixelRatio||1,a=t.clientWidth,o=t.clientHeight;if(0===a||0===o)return;t.width=a*r,t.height=o*r,i.setTransform(r,0,0,r,0,0);const u=a,p=o,m=45,x=20,S=35,v=50,C=u-v-x,w=p-m-S;i.fillStyle=M.background,i.fillRect(0,0,u,p);const k="gr_combined"===d,T="energy_combined"===d,P=d.startsWith("gr_");if(T){const t=e.getCollectiveVariable("totalEnergy"),r=e.getCollectiveVariable("kineticEnergy"),n=e.getCollectiveVariable("potentialEnergy");if(!t||t.values.length<2)return;const a=1e3,o=t.values.slice(-a),l=r?.values.slice(-a)||[],c=n?.values.slice(-a)||[],h=[...o,...l,...c];let d=Math.min(...h),f=Math.max(...h);const y=f-d||1;i.strokeStyle=M.axis,i.lineWidth=1,i.beginPath(),i.moveTo(v,m),i.lineTo(v,p-S),i.lineTo(u-x,p-S),i.stroke(),i.strokeStyle=M.grid,i.lineWidth=.5;const k=4;for(let e=0;e<=k;e++){const t=m+e/k*w;i.beginPath(),i.moveTo(v,t),i.lineTo(u-x,t),i.stroke()}i.font="10px Arial",i.textAlign="right",i.fillStyle=M.textMuted;for(let e=0;e<=k;e++){const t=f-e/k*y,r=m+e/k*w;i.fillText(t.toFixed(1),v-5,r+3)}const T=[{key:"kinetic",values:l,color:"#ef4444",label:"Kinetic"},{key:"potential",values:c,color:"#3b82f6",label:"Potential"},{key:"totalEnergy",values:o,color:s?"#e0e0e0":"#1f2937",label:"Total"}];T.forEach(({key:e,values:t,color:r,label:s})=>{if(t&&0!==t.length&&g[e]){i.strokeStyle=r,i.lineWidth="Total"===s?2.5:1.5,i.beginPath();for(let e=0;e<t.length;e++){const r=v+e/(t.length-1)*C,s=p-S-(t[e]-d)/y*w;0===e?i.moveTo(r,s):i.lineTo(r,s)}i.stroke()}});const P=u-x-70,R=m+5;i.font="10px Arial",b.current=T.map(({key:e,color:t,label:r},n)=>{const a=R+14*n,o=g[e];return i.strokeStyle=o?t:s?"#555":"#ccc",i.lineWidth="Total"===r?2.5:1.5,i.beginPath(),i.moveTo(P,a),i.lineTo(P+14,a),i.stroke(),i.fillStyle=o?M.text:M.textMuted,i.textAlign="left",i.fillText(r,P+18,a+3),{key:e,x:P,y:a-7,width:60,height:14}}),i.font="13px Arial",i.textAlign="center",i.fillStyle=M.text,i.fillText("Energy",u/2,20),i.font="11px Arial",i.fillStyle=M.textMuted,i.fillText("Time Steps",u/2,p-5)}else if(k){const t=e.getRadialDistributionFunction();if(!t.r||0===t.r.length)return;const r=t.r,a=t.maxRadius,o=[...t.gr_partial["0-0"]||[],...t.gr_partial["0-1"]||[],...t.gr_partial["1-1"]||[],...t.gr||[]];let h=Math.max(...o,1),d=0;const f=h-d||1;i.strokeStyle=M.axis,i.lineWidth=1,i.beginPath(),i.moveTo(v,m),i.lineTo(v,p-S),i.lineTo(u-x,p-S),i.stroke(),i.strokeStyle=M.grid,i.lineWidth=.5;const b=4;for(let e=0;e<=b;e++){const t=m+e/b*w;i.beginPath(),i.moveTo(v,t),i.lineTo(u-x,t),i.stroke()}i.strokeStyle=M.axis,i.lineWidth=1,i.font="10px Arial",i.textAlign="center",i.fillStyle=M.textMuted;const k=a<=5?1:Math.ceil(a/5);for(let e=0;e<=a;e+=k){const t=v+e/a*C;i.beginPath(),i.moveTo(t,p-S),i.lineTo(t,p-S+4),i.stroke(),i.fillText(e.toFixed(0),t,p-S+15)}i.textAlign="right";for(let e=0;e<=b;e++){const t=h-e/b*f,r=m+e/b*w;i.fillText(t.toFixed(1),v-8,r+3)}const T=s?"#a855f7":"#8b5cf6",P=s?"#e0e0e0":"#1f2937",R=n[0]||"Type 0",j=n[1]||"Type 1",F=[{key:"0-0",color:l,label:`${R}-${R}`},{key:"0-1",color:T,label:`${R}-${j}`},{key:"1-1",color:c,label:`${j}-${j}`},{key:"total",color:P,label:"Total",data:t.gr}];F.forEach(e=>{if(!g[e.key])return;const s=e.data||t.gr_partial[e.key];if(s&&0!==s.length){i.strokeStyle=e.color,i.lineWidth="total"===e.key?2.5:1.5,i.beginPath();for(let e=0;e<s.length;e++){const t=v+r[e]/a*C,n=p-S-(s[e]-d)/f*w;0===e?i.moveTo(t,n):i.lineTo(t,n)}i.stroke()}});const I=u-x-70,E=m+5;i.font="10px Arial",y.current=F.map(({key:e,color:t,label:r},n)=>{const a=E+14*n,o=g[e];return i.strokeStyle=o?t:s?"#555":"#ccc",i.lineWidth="Total"===r?2.5:1.5,i.beginPath(),i.moveTo(I,a),i.lineTo(I+14,a),i.stroke(),i.fillStyle=o?M.text:M.textMuted,i.textAlign="left",i.fillText(r,I+18,a+3),{key:e,x:I,y:a-7,width:60,height:14}}),i.font="13px Arial",i.textAlign="center",i.fillStyle=M.text,i.fillText("Radial Distribution Functions g(r)",u/2,20),i.font="11px Arial",i.fillStyle=M.textMuted,i.fillText("Distance r (\xc5)",u/2,p-5)}else if(P){const t=e.getRadialDistributionFunction();let r,s;if("gr_total"===d)r=t.gr,s=t.r;else{const e=d.replace("gr_","");r=t.gr_partial[e]||[],s=t.r}if(0===r.length)return;const n=t.maxRadius;let a=0;const o=Math.max(...r,1)-a||1;i.strokeStyle=M.axis,i.lineWidth=1,i.beginPath(),i.moveTo(v,m),i.lineTo(v,p-S),i.lineTo(u-x,p-S),i.stroke(),i.font="10px Arial",i.textAlign="center",i.fillStyle=M.textMuted;const l=n<=5?1:Math.ceil(n/5);for(let e=0;e<=n;e+=l){const t=v+e/n*C;i.beginPath(),i.moveTo(t,p-S),i.lineTo(t,p-S+4),i.stroke(),i.fillText(e.toFixed(0),t,p-S+15)}i.strokeStyle=M.lineBlue,i.lineWidth=2,i.beginPath();for(let e=0;e<r.length;e++){const t=v+s[e]/n*C,l=p-S-(r[e]-a)/o*w;0===e?i.moveTo(t,l):i.lineTo(t,l)}i.stroke();const c={gr_total:"Total","gr_0-0":"Orange-Orange","gr_0-1":"Orange-Blue","gr_1-1":"Blue-Blue"};i.font="13px Arial",i.textAlign="center",i.fillStyle=M.text,i.fillText(`g(r) - ${c[d]||"Total"}`,u/2,20),i.font="11px Arial",i.fillStyle=M.textMuted,i.fillText("Distance r (\xc5)",u/2,p-5)}else{const t=e.getCollectiveVariable(d);if(!t||t.values.length<2)return;let r=t.values.slice(-1e3);t.times.slice(-1e3);const s=Math.min(10,r.length),n=[];for(let e=0;e<r.length;e++){const t=Math.max(0,e-s+1),i=r.slice(t,e+1),a=i.reduce((e,t)=>e+t,0)/i.length;n.push(a)}let a=Math.min(...r),o=Math.max(...r);f&&a>0&&(r=r.map(e=>Math.log10(Math.max(e,.001))),a=Math.min(...r),o=Math.max(...r));const l=o-a||1;i.strokeStyle=M.axis,i.lineWidth=1,i.beginPath(),i.moveTo(v,m),i.lineTo(v,p-S),i.lineTo(u-x,p-S),i.stroke(),i.strokeStyle=M.grid,i.lineWidth=.5;for(let e=0;e<=4;e++){const t=m+e/4*w;i.beginPath(),i.moveTo(v,t),i.lineTo(u-x,t),i.stroke()}i.font="10px Arial",i.textAlign="right",i.fillStyle=M.textMuted,i.fillText(o.toFixed(2),v-5,m+3),i.fillText(a.toFixed(2),v-5,p-S+3),i.strokeStyle=M.lineBlue,i.lineWidth=1.5,i.beginPath();for(let e=0;e<r.length;e++){const t=v+e/(r.length-1)*C,s=p-S-(r[e]-a)/l*w;0===e?i.moveTo(t,s):i.lineTo(t,s)}if(i.stroke(),!f){i.strokeStyle=M.lineRed,i.lineWidth=2,i.beginPath();for(let e=0;e<n.length;e++){const t=v+e/(n.length-1)*C,r=p-S-(n[e]-a)/l*w;0===e?i.moveTo(t,r):i.lineTo(t,r)}i.stroke()}const c=f?`log\u2081\u2080(${t.name}) (${t.unit})`:`${t.name} (${t.unit})`;i.font="13px Arial",i.textAlign="center",i.fillStyle=M.text,i.fillText(c,u/2,20),i.font="11px Arial",i.fillStyle=M.textMuted,i.fillText("Time Steps",u/2,p-5)}};(0,r.useEffect)(()=>{const e=setInterval(S,100);return()=>clearInterval(e)},[e,d,f,s,i,l,c,g]);const v={padding:"0.25rem 0.5rem",border:`1px solid ${M.border}`,borderRadius:"4px",backgroundColor:s?"#3d3d3d":"rgba(255,255,255,0.95)",color:M.text,fontSize:"0.75rem",cursor:"pointer"},C={padding:"0.25rem 0.5rem",backgroundColor:s?"rgba(45,45,45,0.95)":"rgba(255,255,255,0.95)",borderRadius:"4px",border:`1px solid ${M.border}`,fontSize:"0.75rem",color:M.text};return(0,D.jsxs)("div",{style:{position:"relative",backgroundColor:M.surface,padding:"0.75rem",borderRadius:"8px",border:`1px solid ${M.border}`,height:"280px",width:i?`${i}px`:"100%",maxWidth:i?`${i}px`:"100%",boxSizing:"border-box"},children:[(0,D.jsxs)("div",{style:{position:"absolute",top:"0.75rem",left:"0.75rem",right:"0.75rem",zIndex:10,display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"0.5rem",pointerEvents:"none"},children:[(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",pointerEvents:"auto"},children:[(0,D.jsxs)("select",{value:d,onChange:e=>u(e.target.value),style:v,children:[(0,D.jsx)("option",{value:"temperature",children:"Temperature"}),(0,D.jsx)("option",{value:"pressure",children:"Pressure"}),(0,D.jsx)("option",{value:"energy_combined",children:"Energy"}),(0,D.jsx)("option",{value:"gr_combined",children:"g(r)"})]}),!d.startsWith("gr_")&&(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:M.text},children:[(0,D.jsx)("input",{type:"checkbox",checked:f,onChange:e=>p(e.target.checked)}),"Log"]})]}),(0,D.jsxs)("div",{style:{display:"flex",gap:"0.4rem",pointerEvents:"auto"},children:[(0,D.jsxs)("div",{style:C,children:[(0,D.jsx)("span",{style:{color:M.textMuted},children:"N: "}),(0,D.jsx)("span",{style:{fontWeight:"600",fontFamily:"monospace"},children:t?t.count:0})]}),(0,D.jsxs)("div",{style:C,children:[(0,D.jsx)("span",{style:{color:M.textMuted},children:"T: "}),(0,D.jsx)("span",{style:{fontWeight:"600",fontFamily:"monospace"},children:e?.getLatestSnapshot()?.temperature?.toFixed(2)||"0.00"})]}),(0,D.jsxs)("div",{style:C,children:[(0,D.jsx)("span",{style:{color:M.textMuted},children:"E: "}),(0,D.jsx)("span",{style:{fontWeight:"600",fontFamily:"monospace"},children:e?.getLatestSnapshot()?.totalEnergy?.toFixed(1)||"0.0"})]})]})]}),(0,D.jsx)("canvas",{ref:h,onClick:e=>{const t=h.current;if(!t)return;const i=t.getBoundingClientRect(),r=e.clientX-i.left,s=e.clientY-i.top,n="energy_combined"===d?b.current:"gr_combined"===d?y.current:[];for(const a of n)if(r>=a.x&&r<=a.x+a.width&&s>=a.y&&s<=a.y+a.height)return void x(a.key)},style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"8px",cursor:"energy_combined"===d||"gr_combined"===d?"pointer":"default"}})]})},q=({fieldPreset:e,fieldStrength:t,setFieldStrength:i,eFieldPreset:r,eFieldStrength:s,setEFieldStrength:n,showField:a,setShowField:o,showEField:l,setShowEField:c,onFieldStrengthChange:h,onEFieldStrengthChange:d,isDark:u})=>{const f={bg:u?"rgba(30, 30, 30, 0.95)":"rgba(255, 255, 255, 0.95)",border:u?"#444":"#ddd",text:u?"#e0e0e0":"#333",textMuted:u?"#888":"#666",accent:u?"#60a5fa":"#2563eb"},p="none"!==e,g="none"!==r;return p||g?(0,D.jsxs)("div",{style:{position:"absolute",bottom:"8px",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:"1rem",padding:"0.5rem 0.75rem",backgroundColor:f.bg,borderRadius:"8px",border:`1px solid ${f.border}`,backdropFilter:"blur(8px)",boxShadow:u?"0 4px 12px rgba(0, 0, 0, 0.4)":"0 4px 12px rgba(0, 0, 0, 0.1)",fontSize:"0.8rem",zIndex:10},children:[p&&(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",cursor:"pointer",color:f.textMuted,fontSize:"0.75rem"},children:[(0,D.jsx)("input",{type:"checkbox",checked:a,onChange:e=>o(e.target.checked),style:{margin:0,accentColor:f.accent}}),"Barriers"]}),(0,D.jsx)("input",{type:"range",min:"10",max:"200",step:"10",value:t,onChange:e=>{const t=parseFloat(e.target.value);i(t),h(t)},style:{width:"50px",accentColor:f.accent}})]}),g&&(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[(0,D.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",cursor:"pointer",color:f.textMuted,fontSize:"0.75rem"},children:[(0,D.jsx)("input",{type:"checkbox",checked:l,onChange:e=>c(e.target.checked),style:{margin:0,accentColor:f.accent}}),"E-Field"]}),(0,D.jsx)("input",{type:"range",min:"10",max:"200",step:"10",value:s,onChange:e=>{const t=parseFloat(e.target.value);n(t),d(t)},style:{width:"50px",accentColor:f.accent}})]})]}):null},L=8617333262e-14,N=39.948;function $(e,t,i,r,s,n){const a=e.count,o=function(e){const t=[],i=(e,t)=>{let i=0,r=1/t,s=e;for(;s>0;)i+=r*(s%t),s=Math.floor(s/t),r/=t;return i};for(let r=0;r<e;r++){const e=i(r+1,2),s=i(r+1,3);t.push([e,s])}return t}(a),l=Math.floor(a*t),c=a-l;e.typeCounts[0]=l,e.typeCounts[1]=c;const h=2*s;for(let d=0;d<a;d++){let t,s;const a=d<l?0:1;switch(e.types[d]=a,n){case"separated-lr":0===a?(t=h+o[d][0]*(.12*i-h),s=h+o[d][1]*(r-2*h)):(t=.88*i+o[d][0]*(.12*i-h),s=h+o[d][1]*(r-2*h));break;case"separated-tb":0===a?(t=h+o[d][0]*(i-2*h),s=h+o[d][1]*(.3*r-h)):(t=h+o[d][0]*(i-2*h),s=.7*r+o[d][1]*(.3*r-h));break;case"center-cluster":{const e=i/2,n=r/2,a=.25*Math.min(i,r),l=2*o[d][0]*Math.PI,c=Math.sqrt(o[d][1])*a;t=e+c*Math.cos(l),s=n+c*Math.sin(l);break}default:t=h+o[d][0]*(i-2*h),s=h+o[d][1]*(r-2*h)}const c=2*d;e.positions[c]=t,e.positions[c+1]=s}}function H({numParticles:e,numTypes:t,orangeRatio:i,width:s,height:n,temperature:a,timeStep:o,baseParticleRadius:l,coordinateScale:c,initLayout:h,mass:d=39.948,potentialManager:u,boundaryCondition:f,thermostat:p,neighborListRef:g,vectorFieldRef:m,electricFieldRef:x,fieldPresetRef:b,fieldChargeModeRef:y,eFieldPresetRef:M,analytics:S}){const[v,C]=(0,r.useState)(null),w=(0,r.useRef)(0),[k,T]=(0,r.useState)(0),P=(0,r.useCallback)(()=>{const r=function(e,t){return{positions:new Float32Array(2*e),velocities:new Float32Array(2*e),accelerations:new Float32Array(2*e),oldAccelerations:new Float32Array(2*e),types:new Uint8Array(e),masses:new Float32Array(e),count:e,typeCounts:new Array(t).fill(0)}}(e,t),o=s/5,c=n/5;if($(r,i,o,c,l,h),u&&e>1){const e=10,t=.01,i=1,s=.3,n=144,a=r.positions,h=r.masses,d=r.types,f=r.count,p=new Float32Array(2*f);for(let r=0;r<e;r++){p.fill(0);for(let e=0;e<f;e++){const t=2*e,r=a[t],s=a[t+1];for(let o=e+1;o<f;o++){const l=2*o,c=a[l]-r,f=a[l+1]-s,g=c*c+f*f;if(g>n||g<1e-4)continue;const m=Math.sqrt(g),x=Math.max(i,m),b=u.calculateTotal(x,d[e],d[o]).force;if(!isFinite(b))continue;const y=1/m,M=b*c*y,S=b*f*y;p[t]+=M/h[e],p[t+1]+=S/h[e],p[l]-=M/h[o],p[l+1]-=S/h[o]}}for(let e=0;e<f;e++){const i=2*e;let r=p[i]*t,n=p[i+1]*t;if(!isFinite(r)||!isFinite(n))continue;const h=Math.sqrt(r*r+n*n);if(h>s){const e=s/h;r*=e,n*=e}a[i]+=r,a[i+1]+=n,a[i]=Math.max(l,Math.min(o-l,a[i])),a[i+1]=Math.max(l,Math.min(c-l,a[i+1]))}}}!function(e,t,i=N){const r=e.count,s=Math.sqrt(L*t/i);for(let n=0;n<r;n++){const t=Math.random(),r=Math.random(),a=Math.random(),o=Math.random(),l=s*Math.sqrt(-2*Math.log(Math.max(1e-10,t)))*Math.cos(2*Math.PI*r),c=s*Math.sqrt(-2*Math.log(Math.max(1e-10,a)))*Math.cos(2*Math.PI*o),h=2*n;e.velocities[h]=l,e.velocities[h+1]=c,e.accelerations[h]=0,e.accelerations[h+1]=0,e.oldAccelerations[h]=0,e.oldAccelerations[h+1]=0,e.masses[n]=i}}(r,a,d),S&&(S.reset(),S.setParticleTypes(r.types)),g.current&&g.current.invalidate(),w.current=0,T(0),C(r)},[e,t,i,s,n,a,d,l,h,S,g,u]),R=(0,r.useCallback)(()=>{if(!v||!u||!g.current)return;v.accelerations.fill(0);const e=v.positions,t=v.accelerations,i=v.types,r=v.masses,a=v.count;g.current.update(e,a);let l=0,c=0;if(g.current.forEachPair((e,s,n,a,o)=>{const h=i[e],d=i[s],f=r[e],p=r[s],g=2*e,m=2*s,x=Math.sqrt(o),b=Math.max(1,x),y=u.calculateTotal(b,h,d),M=y.force;l+=y.potential,c+=M*b;const S=x>.001?1/x:0,v=M*n*S,C=M*a*S,w=v/f,k=C/f,T=v/p,P=C/p;t[g]+=w,t[g+1]+=k,t[m]-=T,t[m+1]-=P},a),m.current&&"none"!==b.current){const s=m.current,n=.001,o=y.current;for(let c=0;c<a;c++){const a=2*c,h=e[a],d=e[a+1],{fx:u,fy:f}=s.getForce(h,d,!0),p=o?0===i[c]?1:-1:1;t[a]+=p*u*n/r[c],t[a+1]+=p*f*n/r[c],l+=s.getPotential(h,d,!0)*n}}if(x.current&&"none"!==M.current){const s=x.current,n=.001;for(let o=0;o<a;o++){const a=2*o,l=e[a],c=e[a+1],{ex:h,ey:d}=s.getField(l,c,!0),u=0===i[o]?1:-1;t[a]+=h*u*n/r[o],t[a+1]+=d*u*n/r[o]}}if(S&&v){const e=5,t=s/e*(n/e);S.updateTime(o),S.calculateAndSample(v,l,t,c)}},[v,u,g,m,x,b,y,M,S,s,n,o]),j=(0,r.useCallback)(()=>{if(!v)return;const e=v.positions,t=v.velocities,i=v.accelerations,r=v.oldAccelerations,s=v.count,n=o,a=.5*n*n,l=.5*n;for(let o=0;o<2*s;o++)r[o]=i[o];for(let o=0;o<s;o++){const r=2*o;e[r]+=t[r]*n+i[r]*a,e[r+1]+=t[r+1]*n+i[r+1]*a}f&&f.apply(v),R();for(let o=0;o<s;o++){const e=2*o;t[e]+=(r[e]+i[e])*l,t[e+1]+=(r[e+1]+i[e+1])*l;const s=t[e]*t[e]+t[e+1]*t[e+1];if(s>25){const i=5/Math.sqrt(s);t[e]*=i,t[e+1]*=i}}p&&p.apply(v),w.current++,w.current%50==0&&T(w.current)},[v,o,R,f,p]),F=(0,r.useRef)({dt:.01,alpha:.1,stepsSinceNegative:0,velocities:null}),I=(0,r.useCallback)(()=>{if(!v||!u)return!1;const e=v.positions,t=v.masses,i=v.types,r=v.count;F.current.velocities&&F.current.velocities.length===2*r||(F.current.velocities=new Float32Array(2*r),F.current.dt=.01,F.current.alpha=.1,F.current.stepsSinceNegative=0);const a=F.current.velocities,o=new Float32Array(2*r);for(let s=0;s<r;s++){const n=2*s,a=e[n],l=e[n+1];for(let c=s+1;c<r;c++){const r=2*c,h=e[r]-a,d=e[r+1]-l,f=h*h+d*d;if(f>144||f<1e-4)continue;const p=Math.sqrt(f),g=Math.max(1,p),m=u.calculateTotal(g,i[s],i[c]).force;if(!isFinite(m))continue;const x=1/p,b=m*h*x,y=m*d*x;o[n]+=b/t[s],o[n+1]+=y/t[s],o[r]-=b/t[c],o[r+1]-=y/t[c]}}let c=0,h=0,d=0;for(let s=0;s<2*r;s++)c+=o[s]*a[s],h+=o[s]*o[s],d+=a[s]*a[s];h=Math.sqrt(h),d=Math.sqrt(d);const f=F.current;if(c>0&&h>0){const e=f.alpha,t=d/h;for(let i=0;i<2*r;i++)a[i]=(1-e)*a[i]+e*t*o[i];f.stepsSinceNegative>5&&(f.dt=Math.min(1.1*f.dt,.05),f.alpha*=.99),f.stepsSinceNegative++}else a.fill(0),f.dt=Math.max(.5*f.dt,.001),f.alpha=.1,f.stepsSinceNegative=0;const p=f.dt,g=s/5,m=n/5;let x=0;for(let s=0;s<r;s++){const t=2*s;a[t]+=.5*o[t]*p,a[t+1]+=.5*o[t+1]*p,e[t]+=a[t]*p,e[t+1]+=a[t+1]*p,e[t]=Math.max(l,Math.min(g-l,e[t])),e[t+1]=Math.max(l,Math.min(m-l,e[t+1]));const i=Math.sqrt(o[t]*o[t]+o[t+1]*o[t+1]);i>x&&(x=i)}return v.velocities.fill(0),x<.01},[v,u,s,n,l]);return{particleData:v,setParticleData:C,initializeParticles:P,calculateForces:R,velocityVerlet:j,minimizeStep:I,stepCount:k}}function O({canvasRef:e,particleData:t,width:i,height:s,running:n,isDark:a,theme:o,coordinateScale:l,visualScale:c,baseParticleRadius:h,typeColors:d,vectorFieldRef:u,electricFieldRef:f,neighborListRef:p,showField:g,showEField:m,showCells:x,showInteractions:b,showCutoffRadius:y,fieldPreset:M,eFieldPreset:S,cutoffRadius:v,stepsPerFrame:C,onSimulationStep:w,isPeriodic:k}){const T=(0,r.useRef)(null),P=(0,r.useRef)(null),R=(0,r.useRef)(null),j=(0,r.useRef)(null),F=(0,r.useRef)(null),I="undefined"!=typeof window&&window.devicePixelRatio||1;(0,r.useEffect)(()=>{(()=>{const t=e.current;if(!t)return;const r=t.getContext("2d",{alpha:!1});r&&(t.style.width=`${i}px`,t.style.height=`${s}px`,t.width=i*I,t.height=s*I,r.scale(I,I))})()},[i,s,I]);const E=()=>{if(u.current&&(P.current=u.current.renderToImageData("potential",a),T.current)){const e=T.current.getContext("2d");e&&P.current&&e.putImageData(P.current,0,0)}};return(0,r.useEffect)(()=>{if(u.current){const e=u.current.config.gridWidth,t=u.current.config.gridHeight;T.current||(T.current=document.createElement("canvas")),T.current.width===e&&T.current.height===t||(T.current.width=e,T.current.height=t),E()}},[u.current,a]),(0,r.useEffect)(()=>{E()},[a]),(0,r.useEffect)(()=>{if(!t)return;let r;const u=()=>{const P=e.current;if(!P)return;const E=P.getContext("2d",{alpha:!1});if(!E)return;if(E.setTransform(I,0,0,I,0,0),E.strokeStyle=a?"#444":"#000000",E.fillStyle=o.canvasBg,E.fillRect(0,0,i,s),g&&"none"!==M&&T.current&&(E.imageSmoothingEnabled=!0,E.imageSmoothingQuality="high",E.drawImage(T.current,0,0,i,s)),E.strokeRect(0,0,i,s),m&&f.current&&"none"!==S&&f.current.drawArrows(E,i,s,a),n)for(let e=0;e<C;e++)w();const A=t.positions,D=t.types,z=h*c;if(x&&p.current){const e=p.current.getStats(),[t,r]=e.nCells,n=e.cellSize;E.strokeStyle="rgba(100, 100, 255, 0.3)",E.lineWidth=1,E.setLineDash([4,4]);for(let i=0;i<=t;i++){const e=i*n*l;E.beginPath(),E.moveTo(e,0),E.lineTo(e,s),E.stroke()}for(let s=0;s<=r;s++){const e=s*n*l;E.beginPath(),E.moveTo(0,e),E.lineTo(i,e),E.stroke()}E.setLineDash([])}if(b&&p.current){E.lineWidth=1;const e=i,r=s,n=e/2,a=r/2;p.current.forEachPair((t,i,s,o,c)=>{const h=2*t,d=2*i,u=A[h]*l,f=A[h+1]*l,p=A[d]*l,g=A[d+1]*l,m=Math.sqrt(c),x=Math.max(0,1-m/v);E.strokeStyle=`rgba(255, ${Math.floor(100*(1-x))}, ${Math.floor(100*(1-x))}, ${.3+.5*x})`;const b=p-u,y=g-f,M=k&&Math.abs(b)>n,S=k&&Math.abs(y)>a;if(M||S){const t=s*l,i=o*l;E.beginPath(),E.moveTo(u,f);let n=u+t,a=f+i;n<0&&(n=0),n>e&&(n=e),a<0&&(a=0),a>r&&(a=r),E.lineTo(n,a),E.stroke(),E.beginPath(),E.moveTo(p,g);let c=p-t,h=g-i;c<0&&(c=0),c>e&&(c=e),h<0&&(h=0),h>r&&(h=r),E.lineTo(c,h),E.stroke()}else E.beginPath(),E.moveTo(u,f),E.lineTo(p,g),E.stroke()},t.count)}if(y&&t.count>0){const e=A[0]*l,t=A[1]*l,i=v*l;E.strokeStyle="rgba(0, 200, 100, 0.5)",E.lineWidth=2,E.setLineDash([6,3]),E.beginPath(),E.arc(e,t,i,0,2*Math.PI),E.stroke(),E.setLineDash([])}E.strokeStyle=a?"#555":"#000000",E.lineWidth=.5,(!j.current||j.current.length<t.count)&&(j.current=new Float32Array(t.count)),(!F.current||F.current.length<2*t.count)&&(F.current=new Float32Array(2*t.count)),(!R.current||R.current.length<2*t.count)&&(R.current=new Float32Array(2*t.count),R.current.set(A.subarray(0,2*t.count)));const W=i/l/2,B=s/l/2;for(let e=0;e<t.count;e++){const t=2*e,i=D[e],r=A[t]*l,s=A[t+1]*l;if(k&&n){const i=A[t]-R.current[t],r=A[t+1]-R.current[t+1];if(Math.abs(i)>W||Math.abs(r)>B){j.current[e]=30;const s=i>W?1:i<-W?-1:0,n=r>B?1:r<-B?-1:0;F.current[t]=s,F.current[t+1]=n}}if(j.current[e]>0&&j.current[e]--,R.current[t]=A[t],R.current[t+1]=A[t+1],E.beginPath(),E.arc(r,s,z,0,2*Math.PI),E.fillStyle=d[i],E.fill(),E.stroke(),j.current[e]>0&&F.current){const i=j.current[e]/30,n=F.current[t],o=F.current[t+1];if(E.beginPath(),E.arc(r,s,z+3+3*i,0,2*Math.PI),E.strokeStyle=`rgba(50, 220, 100, ${.9*i})`,E.lineWidth=3,E.stroke(),0!==n||0!==o){const e=20+8*i,t=8,a=z+6,l=r+n*a,c=s+o*a,h=r+n*(a+e),d=s+o*(a+e);E.strokeStyle=`rgba(50, 220, 100, ${.95*i})`,E.fillStyle=`rgba(50, 220, 100, ${.95*i})`,E.lineWidth=3,E.beginPath(),E.moveTo(l,c),E.lineTo(h,d),E.stroke();const u=Math.atan2(o,n);E.beginPath(),E.moveTo(h,d),E.lineTo(h-t*Math.cos(u-Math.PI/6),d-t*Math.sin(u-Math.PI/6)),E.lineTo(h-t*Math.cos(u+Math.PI/6),d-t*Math.sin(u+Math.PI/6)),E.closePath(),E.fill()}E.lineWidth=.5,E.strokeStyle=a?"#555":"#000000"}}r=window.requestAnimationFrame(u)};return u(),()=>{window.cancelAnimationFrame(r)}},[t,n,h,i,s,C,c,d,x,b,y,v,a,o,I,g,M,m,S,w,k,l]),{updateFieldVisualization:E,fieldCanvasRef:T,fieldImageRef:P}}const _=()=>{const{colorMode:e}=(0,n.G)(),t="dark"===e,i={background:t?"#1e1e1e":"#ffffff",surface:t?"#2d2d2d":"#f8f9fa",border:t?"#444":"#ccc",text:t?"#e0e0e0":"#333",textMuted:t?"#888":"#666",canvasBg:t?"#1a1a1a":"#ffffff"},[s,a]=(0,r.useState)(800),[u,m]=(0,r.useState)(600),x=(0,r.useRef)(null),T=(0,r.useRef)(null),[P,R]=((0,r.useRef)(0),(0,r.useState)(800)),[j,F]=(0,r.useState)(600);(0,r.useEffect)(()=>{if(T.current){const e=T.current.getBoundingClientRect(),t=Math.max(400,e.width-10),i=Math.max(300,Math.min(600,.6*t));a(t),m(i)}},[]),(0,r.useEffect)(()=>{R(s),F(u)},[s,u]);const[I,A]=(0,r.useState)(1e3),[z,L]=(0,r.useState)("custom"),[N,$]=(0,r.useState)("random"),[_,G]=(0,r.useState)(250),[Y,X]=(0,r.useState)(.098),[K,U]=(0,r.useState)(!1),[J,Q]=(0,r.useState)(!1),[Z,ee]=(0,r.useState)(null),[te,ie]=(0,r.useState)(20),[re,se]=(0,r.useState)(5),[ne,ae]=(0,r.useState)(1.7),[oe]=(0,r.useState)(2),[le,ce]=(0,r.useState)(["Na\u207a","Cl\u207b"]),[he,de]=(0,r.useState)(["rgba(255, 165, 0, 0.8)","rgba(0, 100, 255, 0.8)"]),[ue,fe]=(0,r.useState)([[.1,.15],[.15,.1]]),[pe,ge]=(0,r.useState)([[2.35,2.93],[2.93,3.5]]),[me,xe]=(0,r.useState)([1,-1]),[be,ye]=(0,r.useState)(1),[Me,Se]=(0,r.useState)(null),[ve,Ce]=(0,r.useState)(null),[we,ke]=(0,r.useState)(null),[Te,Pe]=(0,r.useState)(null),Re=(0,r.useRef)(null),[je,Fe]=(0,r.useState)(12),Ie=(0,r.useRef)(null),[Ee,Ae]=(0,r.useState)("none"),[De,ze]=(0,r.useState)(100),[We,Be]=(0,r.useState)("harmonic"),[Ve,qe]=(0,r.useState)(!0),[Le,Ne]=(0,r.useState)(20),[$e,He]=(0,r.useState)(!1),[Oe,_e]=(0,r.useState)(!1),[Ge,Ye]=(0,r.useState)("potential"),Xe=(0,r.useRef)(null),Ke=(0,r.useRef)(null),Ue=(0,r.useRef)(null),[Je,Qe]=(0,r.useState)("none"),[Ze,et]=(0,r.useState)(50),[tt,it]=(0,r.useState)(!0),rt=(0,r.useRef)(Ee);rt.current=Ee;(0,r.useRef)(De).current=De;const st=(0,r.useRef)($e);st.current=$e;const nt=(0,r.useRef)(Je);nt.current=Je;const[at,ot]=(0,r.useState)(!1),[lt,ct]=(0,r.useState)(!1),[ht,dt]=(0,r.useState)(!1),[ut,ft]=(0,r.useState)(!1),[pt,gt]=(0,r.useState)(!0);(0,r.useEffect)(()=>{const e=()=>{const e=window.innerWidth<768;ft(e),e&&gt(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[mt,xt]=(0,r.useState)(d.PERIODIC),[bt,yt]=(0,r.useState)(v.LANGEVIN),[Mt,St]=(0,r.useState)(.5),[vt,Ct]=(0,r.useState)(!1),wt=(0,r.useRef)({x:0,y:0}),kt=(0,r.useRef)({width:0,height:0}),Tt=e=>{if(!vt)return;const t=e.clientX-wt.current.x,i=e.clientY-wt.current.y,r=Math.max(400,Math.min(1200,kt.current.width+t)),s=Math.max(300,Math.min(800,kt.current.height+i));a(r),m(s)},Pt=()=>{Ct(!1)};(0,r.useEffect)(()=>{if(vt)return document.addEventListener("mousemove",Tt),document.addEventListener("mouseup",Pt),()=>{document.removeEventListener("mousemove",Tt),document.removeEventListener("mouseup",Pt)}},[vt]),(0,r.useEffect)(()=>{const e=function(e,t,i){const r=new g,s=new f(e,t),n=new p(i);return r.addPotential(s,1),r.addPotential(n,1),r}(ue,pe,me),t=e.getPotentials()[0],i=e.getPotentials()[1];t.updateParameters(ue,pe,1,1),t.setCutoff(je),i.updateCharges(me,be),i.setCutoff(je),Se(e)},[ue,pe,me,be,je]),(0,r.useEffect)(()=>{if(P&&j){const e=5,t=function(e,t,i){const r=i?.damping??.95;switch(e){case d.REFLECTIVE:return new o(t,r);case d.PERIODIC:return new l(t,r);case d.ABSORBING:return new c(t,r);case d.ELASTIC:return new h(t,r,i?.stiffness??100);default:return new o(t,r)}}(mt,{xMin:ne,xMax:P/e-ne,yMin:ne,yMax:j/e-ne});Ce(t)}},[mt,P,j,ne]),(0,r.useEffect)(()=>{const e=function(e,t,i,r){switch(e){case v.NONE:return null;case v.VELOCITY_RESCALING:return new b(t,i,r?.couplingStrength??.1);case v.LANGEVIN:return new y(t,i,r?.friction??.01);case v.BERENDSEN:return new M(t,i,r?.relaxationTime??10);case v.NOSE_HOOVER:return new S(t,i,r?.thermostatMass??1);default:return new b(t,i)}}(bt,I,Y);ke(e)},[bt,Y]),(0,r.useEffect)(()=>{we&&we.setTargetTemperature(I)},[I,we]);const Rt=(0,r.useCallback)(e=>{const t=E[e];L(e),G(t.numParticles),A(t.temperature),St(t.orangeRatio),xt(t.boundaryType),Ae(t.fieldPreset),ze(t.fieldStrength),Qe(t.eFieldPreset),et(t.eFieldStrength),$(t.initLayout),ce(t.particleTypes.map(e=>e.label)),de(t.particleTypes.map(e=>e.color)),fe(t.epsilonMatrix),ge(t.sigmaMatrix),xe(t.charges),ye(t.chargeScale),Ie.current&&(k(Ie.current,t.fieldPreset,{strength:t.fieldStrength,width:15,shape:We}),Wt()),Ue.current&&Ue.current.applyPreset(t.eFieldPreset,t.eFieldStrength)},[We]);(0,r.useEffect)(()=>{const e=new C(1,2e3,10,100);Pe(e)},[]),(0,r.useEffect)(()=>{if(P&&j){const e=5,t=ne,i=ne,r=P/e-2*ne,s=j/e-2*ne,n=mt===d.PERIODIC;Re.current?(Re.current.updateBox(r,s,t,i),Re.current.setPeriodicBoundaries(n),Re.current.setCutoff(je)):Re.current=function(e,t,i,r,s,n){return new w({boxWidth:e,boxHeight:t,xMin:i,yMin:r,cutoff:n?.cutoff??12,skin:n?.skin??2,isPeriodic:n?.isPeriodic??!1,maxNeighborsPerAtom:n?.maxNeighborsPerAtom??64,rebuildInterval:n?.rebuildInterval??20},s)}(r,s,t,i,1500,{cutoff:je,skin:2,isPeriodic:n,maxNeighborsPerAtom:64,rebuildInterval:20})}},[P,j,mt,je,ne]),(0,r.useEffect)(()=>{if(P&&j){const e=5,i=P/e,r=j/e,s=Math.max(16,Math.floor(i/2)),n=Math.max(16,Math.floor(r/2));Ie.current=function(e){const{gridWidth:t,gridHeight:i,boxWidth:r,boxHeight:s,xMin:n,yMin:a}=e,o=r/t,l=s/i,c=new Float32Array(t*i*3);let h=null,d=null,u=!0;const f=(e,i)=>3*(i*t+e),p=(e,r)=>{const s=(e-n)/o,c=(r-a)/l,h=Math.max(0,Math.min(t-1,Math.floor(s))),d=Math.max(0,Math.min(i-1,Math.floor(c)));return{ix:h,iy:d,fx:s-h,fy:c-d}},g=(e,t)=>({x:n+(e+.5)*o,y:a+(t+.5)*l}),m=(e,t,i)=>{if(e>=t)return 0;const r=e/t;switch(i){case"exponential":return Math.exp(-3*r)*(1-r);case"harmonic":return(1-r)*(1-r);case"constant":return 1;default:return 1-r}},x=()=>{h||(h=document.createElement("canvas"),h.width=t,h.height=i,d=h.getContext("2d"))},b=(e,r=!1)=>{if(x(),!d)throw new Error("Failed to get canvas context");const s=d.createImageData(t,i),n=s.data;let a=0,o=0;for(let d=0;d<t*i;d++){const e=3*d,t=Math.abs(c[e+2]),i=Math.sqrt(c[e]*c[e]+c[e+1]*c[e+1]);t>a&&(a=t),i>o&&(o=i)}const l=r?26:255,h=r?26:255,f=r?26:255;for(let d=0;d<i;d++)for(let e=0;e<t;e++){const i=3*(d*t+e),r=4*(d*t+e),s=c[i+2],o=c[i],u=c[i+1],p=(Math.sqrt(o*o+u*u),a>0?Math.min(1,Math.abs(s)/a):0);p<.01?(n[r]=l,n[r+1]=h,n[r+2]=f,n[r+3]=255):(s>0?(n[r]=Math.floor(l*(1-p)+100*p),n[r+1]=Math.floor(h*(1-p)+180*p),n[r+2]=Math.floor(f*(1-p)+255*p)):(n[r]=Math.floor(l*(1-p)+255*p),n[r+1]=Math.floor(h*(1-p)+100*p),n[r+2]=Math.floor(f*(1-p)+100*p)),n[r+3]=255)}return u=!1,s};return{getForce:(e,r,s=!1)=>{const{ix:n,iy:a,fx:o,fy:l}=p(e,r);if(!s){const e=f(n,a);return{fx:c[e],fy:c[e+1]}}const h=Math.min(n+1,t-1),d=Math.min(a+1,i-1),u=f(n,a),g=f(h,a),m=f(n,d),x=f(h,d),b=(1-o)*(1-l),y=o*(1-l),M=(1-o)*l,S=o*l;return{fx:c[u]*b+c[g]*y+c[m]*M+c[x]*S,fy:c[u+1]*b+c[g+1]*y+c[m+1]*M+c[x+1]*S}},getPotential:(e,r,s=!1)=>{const{ix:n,iy:a,fx:o,fy:l}=p(e,r);if(!s){const e=f(n,a);return c[e+2]}const h=Math.min(n+1,t-1),d=Math.min(a+1,i-1),u=f(n,a),g=f(h,a),m=f(n,d),x=f(h,d),b=(1-o)*(1-l),y=o*(1-l),M=(1-o)*l,S=o*l;return c[u+2]*b+c[g+2]*y+c[m+2]*M+c[x+2]*S},setCell:(e,r,s,n,a)=>{if(e<0||e>=t||r<0||r>=i)return;const o=f(e,r);c[o]=s,c[o+1]=n,c[o+2]=a,u=!0},clear:()=>{c.fill(0),u=!0},paintAt:(e,r,s,n,a)=>{const h=Math.ceil(s/o),d=Math.ceil(s/l),{ix:x,iy:b}=p(e,r);for(let o=-d;o<=d;o++)for(let l=-h;l<=h;l++){const h=x+l,d=b+o;if(h<0||h>=t||d<0||d>=i)continue;const{x:u,y:p}=g(h,d),y=u-e,M=p-r,S=Math.sqrt(y*y+M*M);if(S<s&&S>.001){const e=m(S,s,a),t=n*e/S,i=f(h,d);c[i]+=y*t,c[i+1]+=M*t,c[i+2]+=n*e}}u=!0},eraseAt:(e,r,s)=>{const n=Math.ceil(s/o),a=Math.ceil(s/l),{ix:h,iy:d}=p(e,r);for(let o=-a;o<=a;o++)for(let a=-n;a<=n;a++){const n=h+a,l=d+o;if(n<0||n>=t||l<0||l>=i)continue;const{x:u,y:p}=g(n,l),m=u-e,x=p-r,b=Math.sqrt(m*m+x*x);if(b<s){const e=f(n,l),t=b/s;c[e]*=t,c[e+1]*=t,c[e+2]*=t}}u=!0},addBarrier:(e,r,s,n,a,o,l)=>{const h=s-e,d=n-r,p=Math.sqrt(h*h+d*d);if(0!==p){for(let s=0;s<i;s++)for(let i=0;i<t;i++){const{x:t,y:n}=g(i,s),u=Math.max(0,Math.min(1,((t-e)*h+(n-r)*d)/(p*p))),x=t-(e+u*h),b=n-(r+u*d),y=Math.sqrt(x*x+b*b);if(y<o&&y>.001){const e=m(y,o,l),t=a*e/y,r=f(i,s);c[r]+=x*t,c[r+1]+=b*t,c[r+2]+=a*e}}u=!0}},addVerticalSeparator:(e,r,s,n)=>{for(let a=0;a<i;a++)for(let i=0;i<t;i++){const{x:t}=g(i,a),o=Math.abs(t-e);if(o<s){const l=m(o,s,n),h=t<e?-1:1,d=f(i,a);c[d]+=r*l*h,c[d+2]+=r*l}}u=!0},addHorizontalSeparator:(e,r,s,n)=>{for(let a=0;a<i;a++)for(let i=0;i<t;i++){const{y:t}=g(i,a),o=Math.abs(t-e);if(o<s){const l=m(o,s,n),h=t<e?-1:1,d=f(i,a);c[d+1]+=r*l*h,c[d+2]+=r*l}}u=!0},addRadialField:(e,r,s,n)=>{for(let a=0;a<i;a++)for(let i=0;i<t;i++){const{x:t,y:o}=g(i,a),l=t-e,h=o-r,d=Math.sqrt(l*l+h*h);if(d>.001){const e=s*Math.exp(-d/n),t=f(i,a);c[t]+=l/d*e,c[t+1]+=h/d*e,c[t+2]+=Math.abs(e)}}u=!0},addUniformField:(e,r)=>{const s=Math.sqrt(e*e+r*r);for(let n=0;n<i;n++)for(let i=0;i<t;i++){const t=f(i,n);c[t]+=e,c[t+1]+=r,c[t+2]+=s}u=!0},addPoint:(e,r,s,n,a)=>{for(let o=0;o<i;o++)for(let i=0;i<t;i++){const{x:t,y:l}=g(i,o),h=t-e,d=l-r,u=Math.sqrt(h*h+d*d);if(u>.001&&u<n){const e=m(u,n,a),t=s*e/u,r=f(i,o);c[r]+=h*t,c[r+1]+=d*t,c[r+2]+=s*e}}u=!0},renderToImageData:b,getVisualizationCanvas:()=>{if(x(),u&&d){const e=b();d.putImageData(e,0,0)}return h},markDirty:()=>{u=!0},config:e,data:c,worldToGrid:(e,t)=>{const i=p(e,t);return{ix:i.ix,iy:i.iy}},gridToWorld:g}}({gridWidth:s,gridHeight:n,boxWidth:i,boxHeight:r,xMin:0,yMin:0}),k(Ie.current,Ee,{strength:De,width:15}),Ke.current||(Ke.current=document.createElement("canvas")),Ke.current.width=s,Ke.current.height=n,Xe.current=Ie.current.renderToImageData("potential",t);const a=Ke.current.getContext("2d");a&&Xe.current&&a.putImageData(Xe.current,0,0)}},[P,j,t]),(0,r.useEffect)(()=>{if(P&&j){const e=5,t=P/e,i=j/e,r=Math.max(6,Math.min(12,Math.floor(t/10))),s=Math.max(6,Math.min(12,Math.floor(i/10)));Ue.current=function(e){const{gridWidth:t,gridHeight:i,boxWidth:r,boxHeight:s,xMin:n,yMin:a}=e,o=r/t,l=s/i,c=new Float32Array(t*i*2),h=(e,i)=>2*(i*t+e),d=(e,r)=>{const s=(e-n)/o,c=(r-a)/l;return{ix:Math.max(0,Math.min(t-1,Math.floor(s))),iy:Math.max(0,Math.min(i-1,Math.floor(c)))}},u=(e,t)=>({x:n+(e+.5)*o,y:a+(t+.5)*l}),f=(e,r,s,n)=>{if(e<0||e>=t||r<0||r>=i)return;const a=h(e,r);c[a]=s,c[a+1]=n},p=()=>{c.fill(0)};return{getField:(e,r,s=!1)=>{const d=(e-n)/o,u=(r-a)/l,f=Math.max(0,Math.min(t-1,Math.floor(d))),p=Math.max(0,Math.min(i-1,Math.floor(u)));if(!s){const e=h(f,p);return{ex:c[e],ey:c[e+1]}}const g=d-f,m=u-p,x=Math.min(f+1,t-1),b=Math.min(p+1,i-1),y=h(f,p),M=h(x,p),S=h(f,b),v=h(x,b),C=(1-g)*(1-m),w=g*(1-m),k=(1-g)*m,T=g*m;return{ex:c[y]*C+c[M]*w+c[S]*k+c[v]*T,ey:c[y+1]*C+c[M+1]*w+c[S+1]*k+c[v+1]*T}},setCell:f,addToCell:(e,r,s,n)=>{if(e<0||e>=t||r<0||r>=i)return;const a=h(e,r);c[a]+=s,c[a+1]+=n},clear:p,paintAt:(e,r,s,n,a)=>{const f=Math.ceil(a/o),p=Math.ceil(a/l),{ix:g,iy:m}=d(e,r);for(let o=-p;o<=p;o++)for(let l=-f;l<=f;l++){const d=g+l,f=m+o;if(d<0||d>=t||f<0||f>=i)continue;const{x:p,y:x}=u(d,f),b=(p-e)**2+(x-r)**2;if(b<=a*a){const e=1-Math.sqrt(b)/a,t=h(d,f);c[t]=c[t]*(1-e)+s*e,c[t+1]=c[t+1]*(1-e)+n*e}}},perturbAt:(e,r,s,n,a)=>{const f=Math.ceil(a/o),p=Math.ceil(a/l),{ix:g,iy:m}=d(e,r);for(let o=-p;o<=p;o++)for(let l=-f;l<=f;l++){const d=g+l,f=m+o;if(d<0||d>=t||f<0||f>=i)continue;const{x:p,y:x}=u(d,f),b=(p-e)**2+(x-r)**2;if(b<=a*a){const e=1-Math.sqrt(b)/a,t=h(d,f);c[t]+=s*e,c[t+1]+=n*e}}},applyPreset:(e,o)=>{p();const l=n+r/2,c=a+s/2;switch(e){case"uniform-right":for(let r=0;r<i;r++)for(let e=0;e<t;e++)f(e,r,o,0);break;case"uniform-left":for(let r=0;r<i;r++)for(let e=0;e<t;e++)f(e,r,-o,0);break;case"uniform-down":for(let r=0;r<i;r++)for(let e=0;e<t;e++)f(e,r,0,o);break;case"uniform-up":for(let r=0;r<i;r++)for(let e=0;e<t;e++)f(e,r,0,-o);break;case"radial-out":for(let r=0;r<i;r++)for(let e=0;e<t;e++){const{x:t,y:i}=u(e,r),s=t-l,n=i-c,a=Math.sqrt(s*s+n*n);a>.001&&f(e,r,s/a*o,n/a*o)}break;case"radial-in":for(let r=0;r<i;r++)for(let e=0;e<t;e++){const{x:t,y:i}=u(e,r),s=t-l,n=i-c,a=Math.sqrt(s*s+n*n);a>.001&&f(e,r,-s/a*o,-n/a*o)}break;case"dipole-horizontal":for(let s=0;s<i;s++)for(let e=0;e<t;e++){const{x:t,y:i}=u(e,s),n=t-(l-.25*r),a=i-c,h=Math.sqrt(n*n+a*a),d=t-(l+.25*r),p=i-c,g=Math.sqrt(d*d+p*p);let m=0,x=0;h>.001&&(m+=n/h*o/(1+.1*h),x+=a/h*o/(1+.1*h)),g>.001&&(m-=d/g*o/(1+.1*g),x-=p/g*o/(1+.1*g)),f(e,s,m,x)}break;case"dipole-vertical":for(let r=0;r<i;r++)for(let e=0;e<t;e++){const{x:t,y:i}=u(e,r),n=t-l,a=i-(c-.25*s),h=Math.sqrt(n*n+a*a),d=t-l,p=i-(c+.25*s),g=Math.sqrt(d*d+p*p);let m=0,x=0;h>.001&&(m+=n/h*o/(1+.1*h),x+=a/h*o/(1+.1*h)),g>.001&&(m-=d/g*o/(1+.1*g),x-=p/g*o/(1+.1*g)),f(e,r,m,x)}break;case"quadrupole":const e=[{x:l-.2*r,y:c-.2*s,q:1},{x:l+.2*r,y:c-.2*s,q:-1},{x:l-.2*r,y:c+.2*s,q:-1},{x:l+.2*r,y:c+.2*s,q:1}];for(let r=0;r<i;r++)for(let i=0;i<t;i++){const{x:t,y:s}=u(i,r);let n=0,a=0;for(const i of e){const e=t-i.x,r=s-i.y,l=Math.sqrt(e*e+r*r);l>.001&&(n+=i.q*(e/l)*o/(1+.1*l),a+=i.q*(r/l)*o/(1+.1*l))}f(i,r,n,a)}break;case"battery-lr":for(let s=0;s<i;s++)for(let e=0;e<t;e++){const{x:t}=u(e,s),i=Math.min(t-n,n+r-t),a=Math.min(1,i/(.15*r));f(e,s,o*a,0)}break;case"battery-rl":for(let s=0;s<i;s++)for(let e=0;e<t;e++){const{x:t}=u(e,s),i=Math.min(t-n,n+r-t),a=Math.min(1,i/(.15*r));f(e,s,-o*a,0)}}},worldToGrid:d,gridToWorld:u,drawArrows:(e,r,s,n)=>{const a=r/t,o=s/i,l=.4*Math.min(a,o);let d=0;for(let h=0;h<t*i;h++){const e=2*h,t=Math.sqrt(c[e]**2+c[e+1]**2);t>d&&(d=t)}if(0!==d){e.save(),e.strokeStyle=n?"#ffcc00":"#cc8800",e.fillStyle=n?"#ffcc00":"#cc8800",e.lineWidth=1.5;for(let r=0;r<i;r++)for(let i=0;i<t;i++){const t=h(i,r),s=c[t],n=c[t+1],u=Math.sqrt(s*s+n*n);if(u<.01*d)continue;const f=(i+.5)*a,p=(r+.5)*o,g=u/d*l,m=s/u,x=n/u,b=f-m*g/2,y=p-x*g/2,M=f+m*g/2,S=p+x*g/2;e.beginPath(),e.moveTo(b,y),e.lineTo(M,S),e.stroke();const v=Math.min(6,.4*g),C=Math.atan2(x,m),w=Math.PI/5;e.beginPath(),e.moveTo(M,S),e.lineTo(M-v*Math.cos(C-w),S-v*Math.sin(C-w)),e.lineTo(M-v*Math.cos(C+w),S-v*Math.sin(C+w)),e.closePath(),e.fill()}e.restore()}},config:e,data:c}}({gridWidth:r,gridHeight:s,boxWidth:t,boxHeight:i,xMin:0,yMin:0}),Ue.current.applyPreset(Je,Ze)}},[P,j]),(0,r.useEffect)(()=>{Ue.current&&Ue.current.applyPreset(Je,Ze),"battery-lr"!==Je&&"battery-rl"!==Je||"electrode-walls"!==Ee&&"draw"!==Ee&&Ae("electrode-walls")},[Je,Ze]),(0,r.useEffect)(()=>{Ie.current&&(k(Ie.current,Ee,{strength:De,width:15,shape:We}),Wt())},[Ee,De,We]);const{particleData:jt,setParticleData:Ft,initializeParticles:It,velocityVerlet:Et,minimizeStep:At,stepCount:Dt}=H({numParticles:_,numTypes:oe,orangeRatio:Mt,width:P,height:j,temperature:I,timeStep:Y,baseParticleRadius:ne,coordinateScale:5,initLayout:N,potentialManager:Me,boundaryCondition:ve,thermostat:we,neighborListRef:Re,vectorFieldRef:Ie,electricFieldRef:Ue,fieldPresetRef:rt,fieldChargeModeRef:st,eFieldPresetRef:nt,analytics:Te}),zt=(0,r.useCallback)(()=>{if(J||K)return;Q(!0),U(!1);let e=0;const t=()=>{const i=At();e++,i||e>=100?Q(!1):requestAnimationFrame(t)};requestAnimationFrame(t)},[J,K,At]);(0,r.useEffect)(()=>{It()},[_,oe,Mt,P,j,mt,bt,N]);const{updateFieldVisualization:Wt}=O({canvasRef:x,particleData:jt,width:P,height:j,running:K,isDark:t,theme:i,coordinateScale:5,visualScale:re,baseParticleRadius:ne,typeColors:he,vectorFieldRef:Ie,electricFieldRef:Ue,neighborListRef:Re,showField:Ve,showEField:tt,showCells:at,showInteractions:lt,showCutoffRadius:ht,fieldPreset:Ee,eFieldPreset:Je,cutoffRadius:je,stepsPerFrame:te,onSimulationStep:Et,isPeriodic:mt===d.PERIODIC}),{handlePointerDown:Bt,handlePointerMove:Vt,handlePointerUp:qt,handleContextMenu:Lt}=function({canvasRef:e,particleData:t,vectorFieldRef:i,electricFieldRef:s,fieldPreset:n,eFieldPreset:a,fieldStrength:o,eFieldStrength:l,fieldShape:c,brushRadius:h,coordinateScale:d,visualScale:u,baseParticleRadius:f,onVectorFieldUpdate:p}){const g=(0,r.useRef)(0),m=(0,r.useRef)(null),x=(0,r.useRef)(null),b=(0,r.useRef)(!1),y=(0,r.useRef)("potential"),M=(0,r.useCallback)((e,t)=>{if(!i.current||"draw"!==n)return;const r=e/d,s=t/d,a=g.current;0===a?i.current.paintAt(r,s,h,-o,c):2===a?i.current.paintAt(r,s,h,o,c):i.current.eraseAt(r,s,h),p()},[i,n,d,h,o,c,p]),S=(0,r.useCallback)((e,t,i,r)=>{if(!s.current||"draw"!==a)return;const n=e/d,o=t/d,c=Math.sqrt(i*i+r*r);if(c>5){const e=i/c*l,t=r/c*l;s.current.paintAt(n,o,e,t,2*h)}},[s,a,d,l,h]);return{handlePointerDown:(0,r.useCallback)(i=>{if(!e.current||!t)return;i.preventDefault(),i.target.setPointerCapture(i.pointerId);const r=i.nativeEvent.offsetX,s=i.nativeEvent.offsetY;if("draw"===n)return g.current=i.button,b.current=!0,y.current="potential",void M(r,s);if("draw"===a)return b.current=!0,y.current="electric",void(m.current={x:r,y:s});const o=t.positions;for(let e=0;e<t.count;e++){const t=2*e,n=o[t]*d,a=o[t+1]*d,l=Math.abs(n-r),c=Math.abs(a-s),h=f*u*("touch"===i.pointerType?2:1.2);if(l<=h&&c<=h){x.current=e;break}}},[e,t,n,a,d,u,f,M]),handlePointerMove:(0,r.useCallback)(i=>{if(!e.current)return;const r=i.nativeEvent.offsetX,s=i.nativeEvent.offsetY;if(b.current&&"potential"===y.current&&"draw"===n)return void M(r,s);if(b.current&&"electric"===y.current&&"draw"===a&&m.current){const e=r-m.current.x,t=s-m.current.y;return S(m.current.x,m.current.y,e,t),void(m.current={x:r,y:s})}if(null===x.current||!t)return;const o=r/d,l=s/d,c=2*x.current;t.positions[c]=o,t.positions[c+1]=l,t.velocities[c]=0,t.velocities[c+1]=0,t.accelerations[c]=0,t.accelerations[c+1]=0},[e,t,n,a,d,M,S]),handlePointerUp:(0,r.useCallback)(e=>{e.target.releasePointerCapture(e.pointerId),x.current=null,b.current=!1,m.current=null},[]),handleContextMenu:(0,r.useCallback)(e=>{"draw"!==n&&"draw"!==a||e.preventDefault()},[n,a]),draggingParticle:x.current}}({canvasRef:x,particleData:jt,vectorFieldRef:Ie,electricFieldRef:Ue,fieldPreset:Ee,eFieldPreset:Je,fieldStrength:De,eFieldStrength:Ze,fieldShape:We,brushRadius:Le,coordinateScale:5,visualScale:re,baseParticleRadius:ne,onVectorFieldUpdate:Wt});return(0,D.jsxs)("div",{style:{width:"100%",maxWidth:"1400px",margin:"0 auto",minHeight:"100vh",display:"grid",gridTemplateColumns:ut?"1fr":"1fr 300px",gap:"1rem",padding:"1rem",boxSizing:"border-box"},children:[(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",alignItems:"center"},children:[(0,D.jsxs)("div",{style:{width:"100%",maxWidth:`${s+20}px`},children:[(0,D.jsx)(B,{running:K,setRunning:U,onReset:It,minimizing:J,onMinimize:zt,scenario:z,onScenarioChange:Rt,time:Te?.01018*Te.getCurrentTime():0,stepCount:Dt,isDrawMode:"draw"===Ee,setIsDrawMode:e=>Ae(e?"draw":"none"),brushRadius:Le,setBrushRadius:Ne,fieldStrength:De,setFieldStrength:ze,showField:Ve,setShowField:qe,fieldChargeMode:$e,setFieldChargeMode:He,onClearField:()=>{Ie.current&&(Ie.current.clear(),Wt())},isDark:t}),(0,D.jsxs)("div",{ref:T,style:{width:`${s+10}px`,height:`${u+10}px`,backgroundColor:i.canvasBg,position:"relative",padding:"5px",margin:"0.5rem auto 0",borderRadius:"8px",border:`1px solid ${i.border}`},children:[(0,D.jsx)("canvas",{ref:x,style:{display:"block",width:`${P}px`,height:`${j}px`,backgroundColor:i.canvasBg,borderRadius:"4px",touchAction:"none"},onPointerDown:Bt,onPointerMove:Vt,onPointerUp:qt,onPointerCancel:qt,onContextMenu:Lt}),"custom"!==z&&(0,D.jsx)(q,{fieldPreset:Ee,fieldStrength:De,setFieldStrength:ze,eFieldPreset:Je,eFieldStrength:Ze,setEFieldStrength:et,showField:Ve,setShowField:qe,showEField:tt,setShowEField:it,onFieldStrengthChange:e=>{Ie.current&&(k(Ie.current,Ee,{strength:e,width:15,shape:We}),Wt())},onEFieldStrengthChange:e=>{Ue.current&&Ue.current.applyPreset(Je,e)},isDark:t}),(0,D.jsx)("div",{onMouseDown:e=>{Ct(!0),wt.current={x:e.clientX,y:e.clientY},kt.current={width:s,height:u},e.preventDefault()},style:{position:"absolute",bottom:"2px",right:"2px",width:"12px",height:"12px",cursor:"se-resize",opacity:.3,pointerEvents:"auto",backgroundImage:`linear-gradient(135deg, transparent 50%, ${t?"#888":"#999"} 50%)`},title:"Drag to resize"})]})]}),(0,D.jsx)(V,{analytics:Te,particleData:jt,width:s+10,isDark:t,typeLabels:le,typeColors:he})]}),ut&&(0,D.jsx)("button",{onClick:()=>gt(!pt),style:{position:"fixed",bottom:"1rem",right:"1rem",zIndex:1e3,padding:"0.75rem 1rem",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",fontSize:"0.9rem"},children:pt?"Close":"Controls"}),(pt||!ut)&&(0,D.jsx)("div",{style:{...ut?{position:"fixed",top:0,right:0,bottom:0,width:"300px",maxWidth:"85vw",zIndex:999,backgroundColor:i.background,boxShadow:t?"-4px 0 16px rgba(0,0,0,0.4)":"-4px 0 16px rgba(0,0,0,0.15)",overflowY:"auto"}:{}},children:(0,D.jsx)(W,{numParticles:_,setNumParticles:G,temperature:I,setTemperature:A,timeStep:Y,setTimeStep:X,stepsPerFrame:te,setStepsPerFrame:ie,orangeRatio:Mt,setOrangeRatio:St,boundaryType:mt,setBoundaryType:xt,thermostatType:bt,setThermostatType:yt,chargeScale:be,setChargeScale:ye,visualScale:re,setVisualScale:se,charges:me,setCharges:xe,typeLabels:le,setTypeLabels:ce,typeColors:he,setTypeColors:de,epsilonMatrix:ue,sigmaMatrix:pe,updateInteractionParameter:(e,t,i,r)=>{if("epsilon"===e){const e=[...ue];e[t][i]=r,e[i][t]=r,fe(e)}else if("sigma"===e){const e=[...pe];e[t][i]=r,e[i][t]=r,ge(e)}},numTypes:oe,showCells:at,setShowCells:ot,showInteractions:lt,setShowInteractions:ct,showCutoffRadius:ht,setShowCutoffRadius:dt,cutoffRadius:je,setCutoffRadius:Fe,isDark:t})})]})};function G(){const[e,t]=(0,r.useState)("1D");return(0,D.jsx)(s.A,{title:"Molecular Dynamics",description:"Interactive visualizations of molecular dynamics for",children:(0,D.jsx)("main",{style:{width:"100%",maxWidth:"none",padding:0},children:(0,D.jsx)(_,{})})})}},8371:(e,t,i)=>{i.d(t,{iV:()=>a,GK:()=>n,jF:()=>o});var r=i(6540),s=i(4848);const n=({label:e,value:t,onChange:i,min:n,max:a,step:o,unit:l="",decimals:c=2,theme:h,disabled:d=!1})=>{const[u,f]=(0,r.useState)(t.toFixed(c)),[p,g]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{p||f(t.toFixed(c))},[t,c,p]),(0,s.jsxs)("div",{style:{marginBottom:"0.6rem",opacity:d?.5:1},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.25rem"},children:[(0,s.jsx)("span",{style:{fontSize:"0.8rem",color:h.text},children:e}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,s.jsx)("input",{type:"text",value:p?u:t.toFixed(c),onChange:e=>{f(e.target.value)},onFocus:()=>g(!0),onBlur:()=>{g(!1);const e=parseFloat(u);if(isNaN(e))f(t.toFixed(c));else{const t=Math.max(n,Math.min(a,e));i(t),f(t.toFixed(c))}},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},disabled:d,style:{width:"4rem",padding:"0.15rem 0.3rem",fontSize:"0.75rem",fontFamily:"monospace",textAlign:"right",border:`1px solid ${h.border}`,borderRadius:"3px",backgroundColor:h.inputBg,color:h.text}}),l&&(0,s.jsx)("span",{style:{fontSize:"0.7rem",color:h.textMuted,minWidth:"1.5rem"},children:l})]})]}),(0,s.jsx)("input",{type:"range",min:n,max:a,step:o,value:t,onChange:e=>{const t=parseFloat(e.target.value);i(t),f(t.toFixed(c))},disabled:d,style:{width:"100%",height:"4px",borderRadius:"2px",cursor:d?"not-allowed":"pointer"}})]})},a=({title:e,children:t,defaultExpanded:i=!1,theme:n})=>{const[a,o]=(0,r.useState)(i);return(0,s.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,s.jsxs)("button",{onClick:()=>o(!a),style:{width:"100%",padding:"0.5rem 0.6rem",border:`1px solid ${n.border}`,borderRadius:"4px",backgroundColor:n.surface||n.inputBg,color:n.text,fontSize:"0.8rem",fontWeight:500,cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"left"},children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("span",{style:{transform:a?"rotate(180deg)":"none",transition:"transform 0.2s ease",fontSize:"0.7rem"},children:"\u25bc"})]}),(0,s.jsx)("div",{style:{maxHeight:a?"500px":"0",overflow:"hidden",transition:"max-height 0.2s ease-out"},children:(0,s.jsx)("div",{style:{marginTop:"0.5rem",padding:"0.6rem",backgroundColor:n.surface||n.inputBg,borderRadius:"4px",border:`1px solid ${n.border}`},children:t})})]})},o=({label:e,checked:t,onChange:i,theme:r,disabled:n=!1})=>(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:n?"not-allowed":"pointer",fontSize:"0.8rem",color:r.text,marginBottom:"0.4rem",opacity:n?.5:1},children:[(0,s.jsxs)("div",{style:{position:"relative",width:"36px",height:"20px",backgroundColor:t?r.accent||"#2563eb":r.border,borderRadius:"10px",transition:"background-color 0.2s ease"},children:[(0,s.jsx)("div",{style:{position:"absolute",top:"2px",left:t?"18px":"2px",width:"16px",height:"16px",backgroundColor:"#fff",borderRadius:"50%",transition:"left 0.2s ease",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}}),(0,s.jsx)("input",{type:"checkbox",checked:t,onChange:e=>i(e.target.checked),disabled:n,style:{position:"absolute",opacity:0,width:"100%",height:"100%",cursor:n?"not-allowed":"pointer",margin:0}})]}),(0,s.jsx)("span",{children:e})]})}}]);