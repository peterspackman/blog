"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1288],{5066:(e,s,a)=>{a.r(s),a.d(s,{default:()=>$s});var t=a(6540),n=a(1656);const r="container_Qh_B",l="layout_SyMw",i="sidebar_Cwvp",c="content_ak_G",o="tabs_tRXw",d="tab_F12w",u="tabContent_hF_7",m="collapsibleSection_Nmyk",h="sectionHeader_qShV",p="sectionTitle_aNil",x="chevron_b8vT",v="sectionContent_NPTV",j="chevronExpanded_ry9E",g="status_l6dK",b="statusLoading_AJab",f="statusReady_FVt8",N="moleculeInfo_KKVy",_="button_XSDO",y="stickyButtons_GEQA",C="buttonPrimary_eux_",S="buttonDanger_gLI_",w="tabActive_fzT3",$="propertiesTab_ipsn",k="structureTab_HvbL",F="noStructure_y5fR",E="matricesSection_omrz",O="noMatrices_bajq",M="orbitalsCard_tkcK",L="orbitalGrid_Wtwa",H="moreOrbitals_oRmJ",D="errorModal_HssV",T="errorContent_nEMj",R="section_X2kF",B="exampleSection_iMDs",z="exampleLabel__wK2",I="exampleSelect_VuLc",A="inputContainer_aHUj",V="headerRow_MA_E",W="label_1fak",P="controls_Azqc",U="browseButton_eNgL",X="combinedInput_AOvI",G="dragging_F5j2",q="clearButton_KExK",Y="xyzTextarea_Jaou";var K=a(4848);const Z={water:{name:"Water (H\u2082O)",xyz:"3\nWater molecule\nO  0.000000  0.000000  0.000000\nH  0.757000  0.586000  0.000000\nH -0.757000  0.586000  0.000000"},urea:{name:"Urea (CH\u2084N\u2082O)",xyz:"8\nUrea molecule\nC  0.000000  0.000000  0.000000\nO  0.000000  1.220000  0.000000\nN  1.150000 -0.610000  0.000000\nN -1.150000 -0.610000  0.000000\nH  1.150000 -1.610000  0.000000\nH  2.050000 -0.110000  0.000000\nH -1.150000 -1.610000  0.000000\nH -2.050000 -0.110000  0.000000"},formamide:{name:"Formamide (CH\u2083NO)",xyz:"6\nFormamide molecule\nC  0.000000  0.000000  0.000000\nO  1.220000  0.000000  0.000000\nN -0.610000  1.150000  0.000000\nH -0.610000 -0.950000  0.000000\nH -1.610000  1.150000  0.000000\nH -0.110000  2.050000  0.000000"},methane:{name:"Methane (CH\u2084)",xyz:"5\nMethane molecule\nC  0.000000  0.000000  0.000000\nH  0.629000  0.629000  0.629000\nH -0.629000 -0.629000  0.629000\nH -0.629000  0.629000 -0.629000\nH  0.629000 -0.629000 -0.629000"},ammonia:{name:"Ammonia (NH\u2083)",xyz:"4\nAmmonia molecule\nN  0.000000  0.000000  0.000000\nH  0.000000  0.950000  0.330000\nH  0.820000 -0.480000  0.330000\nH -0.820000 -0.480000  0.330000"},ethylene:{name:"Ethylene (C\u2082H\u2084)",xyz:"6\nEthylene molecule\nC  0.000000  0.000000  0.668000\nC  0.000000  0.000000 -0.668000\nH  0.000000  0.923000  1.232000\nH  0.000000 -0.923000  1.232000\nH  0.000000  0.923000 -1.232000\nH  0.000000 -0.923000 -1.232000"}},Q=({onFileLoad:e})=>{const[s,a]=(0,t.useState)(""),[n,r]=(0,t.useState)(""),[l,i]=(0,t.useState)(!1),[c,o]=(0,t.useState)("water"),d=(0,t.useRef)(null);(0,t.useEffect)((()=>{const s=Z.water;r(s.xyz),a(""),o("water"),e(s.xyz)}),[]);const u=async s=>{const t=s.name.split(".").pop()?.toLowerCase();if("xyz"===t){a(s.name);try{const a=await s.text();r(a),e(a)}catch(n){console.error("Error reading file:",n),alert("Failed to read file: "+n.message)}}else alert("Please upload an XYZ file.")};return(0,K.jsxs)("div",{className:R,children:[(0,K.jsxs)("div",{className:B,children:[(0,K.jsx)("label",{className:z,children:"Example Molecules"}),(0,K.jsxs)("select",{value:c,onChange:s=>{const t=s.target.value;if(t&&Z[t]){const s=Z[t];r(s.xyz),a(""),o(t),e(s.xyz),d.current&&(d.current.value="")}},className:I,children:[(0,K.jsx)("option",{value:"",children:"Select an example..."}),Object.entries(Z).map((([e,s])=>(0,K.jsx)("option",{value:e,children:s.name},e)))]})]}),(0,K.jsxs)("div",{className:A,children:[(0,K.jsxs)("div",{className:V,children:[(0,K.jsx)("span",{className:W,children:"XYZ Coordinates"}),(0,K.jsxs)("div",{className:P,children:[(0,K.jsx)("button",{onClick:e=>{e.stopPropagation(),d.current?.click()},className:U,children:"Browse"}),(s||n)&&(0,K.jsx)("button",{onClick:()=>{a(""),r(""),o(""),d.current&&(d.current.value="")},className:q,children:"Clear"})]})]}),(0,K.jsxs)("div",{className:`${X} ${l?G:""}`,onDrop:e=>{e.preventDefault(),i(!1);const s=e.dataTransfer.files[0];s&&u(s)},onDragOver:e=>{e.preventDefault(),i(!0)},onDragLeave:()=>{i(!1)},children:[(0,K.jsx)("textarea",{value:n,onChange:s=>{const t=s.target.value;r(t),t.trim()&&(a(""),o(""),e(t))},placeholder:s?`Loaded: ${s}`:"Select an example molecule above or drag & drop XYZ file here",rows:8,className:Y}),(0,K.jsx)("input",{ref:d,type:"file",accept:".xyz",onChange:e=>{const s=e.target.files?.[0];s&&u(s)},style:{display:"none"}})]})]})]})},J="section_H6hy",ee="field_rd2A",se=({method:e,setMethod:s,basisSet:a,setBasisSet:t,maxIterations:n,setMaxIterations:r,energyTolerance:l,setEnergyTolerance:i,logLevel:c,setLogLevel:o})=>(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)("div",{className:J,children:[(0,K.jsx)("h3",{children:"Calculation Method"}),(0,K.jsxs)("div",{className:ee,children:[(0,K.jsx)("label",{children:"Theory Level"}),(0,K.jsxs)("select",{value:e,onChange:e=>s(e.target.value),children:[(0,K.jsx)("option",{value:"hf",children:"Hartree-Fock (HF)"}),(0,K.jsx)("option",{value:"dft-b3lyp",children:"DFT (B3LYP)"}),(0,K.jsx)("option",{value:"dft-pbe",children:"DFT (PBE)"}),(0,K.jsx)("option",{value:"dft-pbe0",children:"DFT (PBE0)"}),(0,K.jsx)("option",{value:"dft-blyp",children:"DFT (BLYP)"}),(0,K.jsx)("option",{value:"dft-wb97x",children:"DFT (\u03c9B97X)"}),(0,K.jsx)("option",{value:"dft-wb97m",children:"DFT (\u03c9B97M)"}),(0,K.jsx)("option",{value:"dft-m062x",children:"DFT (M06-2X)"}),(0,K.jsx)("option",{value:"dft-r2scan",children:"DFT (r\xb2SCAN)"}),(0,K.jsx)("option",{value:"dft-tpss",children:"DFT (TPSS)"})]})]}),(0,K.jsxs)("div",{className:ee,children:[(0,K.jsx)("label",{children:"Basis Set"}),(0,K.jsxs)("select",{value:a,onChange:e=>t(e.target.value),children:[(0,K.jsx)("option",{value:"sto-3g",children:"STO-3G"}),(0,K.jsx)("option",{value:"3-21g",children:"3-21G"}),(0,K.jsx)("option",{value:"6-31g",children:"6-31G"}),(0,K.jsx)("option",{value:"6-31g(d,p)",children:"6-31G(d,p)"}),(0,K.jsx)("option",{value:"6-311g(d,p)",children:"6-311G(d,p)"}),(0,K.jsx)("option",{value:"def2-svp",children:"def2-SVP"}),(0,K.jsx)("option",{value:"def2-tzvp",children:"def2-TZVP"}),(0,K.jsx)("option",{value:"cc-pvdz",children:"cc-pVDZ"}),(0,K.jsx)("option",{value:"cc-pvtz",children:"cc-pVTZ"}),(0,K.jsx)("option",{value:"cc-pvqz",children:"cc-pVQZ"}),(0,K.jsx)("option",{value:"pcseg-0",children:"pc-0"}),(0,K.jsx)("option",{value:"pcseg-1",children:"pc-1"}),(0,K.jsx)("option",{value:"pcseg-2",children:"pc-2"}),(0,K.jsx)("option",{value:"pcseg-3",children:"pc-3"}),(0,K.jsx)("option",{value:"aug-pcseg-1",children:"aug-pc-1"}),(0,K.jsx)("option",{value:"aug-pcseg-2",children:"aug-pc-2"})]})]})]}),(0,K.jsxs)("div",{className:J,children:[(0,K.jsx)("h3",{children:"SCF Settings"}),(0,K.jsxs)("div",{className:ee,children:[(0,K.jsx)("label",{children:"Max Iterations"}),(0,K.jsx)("input",{type:"number",min:"10",max:"500",value:n,onChange:e=>r(parseInt(e.target.value))})]}),(0,K.jsxs)("div",{className:ee,children:[(0,K.jsx)("label",{children:"Energy Tolerance"}),(0,K.jsxs)("select",{value:l.toString(),onChange:e=>i(parseFloat(e.target.value)),children:[(0,K.jsx)("option",{value:"1e-6",children:"1e-6"}),(0,K.jsx)("option",{value:"1e-7",children:"1e-7"}),(0,K.jsx)("option",{value:"1e-8",children:"1e-8"}),(0,K.jsx)("option",{value:"1e-9",children:"1e-9"}),(0,K.jsx)("option",{value:"1e-10",children:"1e-10"})]})]}),(0,K.jsxs)("div",{className:ee,children:[(0,K.jsx)("label",{children:"Log Level"}),(0,K.jsxs)("select",{value:c,onChange:e=>o(parseInt(e.target.value)),children:[(0,K.jsx)("option",{value:"0",children:"Trace"}),(0,K.jsx)("option",{value:"1",children:"Debug"}),(0,K.jsx)("option",{value:"2",children:"Info"}),(0,K.jsx)("option",{value:"3",children:"Warning"}),(0,K.jsx)("option",{value:"4",children:"Error"}),(0,K.jsx)("option",{value:"5",children:"Critical"})]})]})]})]}),ae="container_R89I",te="summaryGrid_ag2i",ne="energyCard_YXOX",re="statusCard_RoU8",le="propertiesCard_AHmH",ie="primaryEnergy_Xokq",ce="secondaryEnergy_Gl5x",oe="propertyItem_grVF",de="exportSection_Tufw",ue="exportButtons_Op6D",me="exportButton_Xvg9",he="energyValues_pzt_",pe="statusInfo_hd1b",xe="convergenceStatus_AYcc",ve="converged_xwWE",je="notConverged_Y8IO",ge="timing_HvIZ",be="propertyList_aAAD",fe="propertyLabel_Acxr",Ne="propertyValue_OR5o",_e="exportButtonDisabled_HPmD",ye="noResults_jWfa",Ce=({results:e})=>{if(!e)return(0,K.jsxs)("div",{className:ye,children:[(0,K.jsx)("h3",{children:"No Results Yet"}),(0,K.jsx)("p",{children:"Run a calculation to see results here."})]});const s=s=>{if(!e.wavefunctionData)return;let a,t,n;switch(s){case"fchk":if(!e.wavefunctionData.fchk)return void alert("FCHK data not available.");a=e.wavefunctionData.fchk,t="wavefunction.fchk",n="text/plain";break;case"json":a=JSON.stringify({energy:e.energy,energyInEV:e.energyInEV,properties:e.properties,numBasisFunctions:e.wavefunctionData.numBasisFunctions,numAtoms:e.wavefunctionData.numAtoms,calculationTime:e.elapsedMs},null,2),t="wavefunction.json",n="application/json"}const r=new Blob([a],{type:n}),l=URL.createObjectURL(r),i=document.createElement("a");i.href=l,i.download=t,i.click(),URL.revokeObjectURL(l)};return(0,K.jsxs)("div",{className:ae,children:[(0,K.jsxs)("div",{className:te,children:[(0,K.jsxs)("div",{className:ne,children:[(0,K.jsx)("h4",{children:"Total Energy"}),(0,K.jsxs)("div",{className:he,children:[(0,K.jsxs)("div",{className:ie,children:[e.energy.toFixed(8)," Eh"]}),(0,K.jsxs)("div",{className:ce,children:[e.energyInEV.toFixed(6)," eV"]})]})]}),(0,K.jsxs)("div",{className:re,children:[(0,K.jsx)("h4",{children:"Status"}),(0,K.jsxs)("div",{className:pe,children:[(0,K.jsx)("div",{className:`${xe} ${e.converged?ve:je}`,children:e.converged?"\u2713 Converged":"\u2717 Not Converged"}),(0,K.jsx)("div",{className:ge,children:(a=e.elapsedMs,`${Math.floor(a/1e3)}s ${Math.round(a%1e3)}ms`)})]})]}),e.properties&&(0,K.jsxs)("div",{className:le,children:[(0,K.jsx)("h4",{children:"Key Properties"}),(0,K.jsxs)("div",{className:be,children:[void 0!==e.properties.homo&&(0,K.jsxs)("div",{className:oe,children:[(0,K.jsx)("span",{className:fe,children:"HOMO:"}),(0,K.jsxs)("span",{className:Ne,children:[e.properties.homo.toFixed(6)," Eh"]})]}),void 0!==e.properties.lumo&&(0,K.jsxs)("div",{className:oe,children:[(0,K.jsx)("span",{className:fe,children:"LUMO:"}),(0,K.jsxs)("span",{className:Ne,children:[e.properties.lumo.toFixed(6)," Eh"]})]}),void 0!==e.properties.gap&&(0,K.jsxs)("div",{className:oe,children:[(0,K.jsx)("span",{className:fe,children:"Gap:"}),(0,K.jsxs)("span",{className:Ne,children:[e.properties.gap.toFixed(6)," Eh"]})]})]})]})]}),e.wavefunctionData&&(0,K.jsxs)("div",{className:de,children:[(0,K.jsx)("h4",{children:"Export Wavefunction"}),(0,K.jsxs)("div",{className:ue,children:[(0,K.jsx)("button",{className:me,onClick:()=>s("json"),children:"\u2193 JSON"}),(0,K.jsxs)("button",{className:e.wavefunctionData.fchk?me:`${me} ${_e}`,onClick:()=>e.wavefunctionData.fchk?s("fchk"):alert("FCHK data not available. Check the calculation logs for details."),disabled:!e.wavefunctionData.fchk,title:e.wavefunctionData.fchk?"Download FCHK file":"FCHK generation failed - see logs",children:["\u2193 FCHK ",!e.wavefunctionData.fchk&&"(unavailable)"]})]})]})]});var a},Se={container:"container_BYXD",header:"header_RGzB",controls:"controls_Rvup",button:"button_YEOU",buttonActive:"buttonActive_nb5D",logOutput:"logOutput_RpAa",noLogs:"noLogs_oYTM",logEntry:"logEntry_Oa3L",timestamp:"timestamp__Tyr",message:"message_A8Nt","log-debug":"log-debug_cHxc","log-info":"log-info_Lwm5","log-warn":"log-warn_SwuY","log-error":"log-error_TdP2"},we=({logs:e})=>{const[s,a]=(0,t.useState)(!0),n=(0,t.useRef)(null);(0,t.useEffect)((()=>{s&&n.current&&(n.current.scrollTop=n.current.scrollHeight)}),[e,s]);return(0,K.jsxs)("div",{className:Se.container,children:[(0,K.jsxs)("div",{className:Se.header,children:[(0,K.jsx)("h3",{children:"Calculation Output"}),(0,K.jsx)("div",{className:Se.controls,children:(0,K.jsx)("button",{className:`${Se.button} ${s?Se.buttonActive:""}`,onClick:()=>a(!s),children:s?"Auto-scroll ON":"Auto-scroll OFF"})})]}),(0,K.jsx)("div",{ref:n,className:Se.logOutput,children:0===e.length?(0,K.jsx)("div",{className:Se.noLogs,children:"No output yet. Run a calculation to see logs."}):e.map(((e,s)=>{return(0,K.jsxs)("div",{className:`${Se.logEntry} ${Se[`log-${e.level}`]}`,children:[(0,K.jsxs)("span",{className:Se.timestamp,children:["[",(a=e.timestamp,a.toLocaleTimeString()),"]"]}),(0,K.jsx)("span",{className:Se.message,children:e.message})]},s);var a}))})]})},$e="matrixContainer__RiK",ke="header_t7QL",Fe="controls_sj24",Ee="dimensions_G9Ce",Oe="toggleButton_ziSy",Me="downloadButton_yZ_5",Le="matrixWrapper_lIP_",He="matrix_UPd_",De="matrixElement_jLaA",Te="infoContent_XCc5",Re="fullMatrix_FIje",Be="zeroElement_VjgC",ze="truncationNotice_Npk0",Ie="matrixInfo_AD0u",Ae="infoToggle_sbWR",Ve=({matrix:e,title:s,precision:a=6,maxDisplaySize:n=8})=>{const[r,l]=(0,t.useState)(!1),[i,c]=(0,t.useState)(!1);if(!e||!e.data)return(0,K.jsxs)("div",{className:$e,children:[(0,K.jsx)("h4",{children:s}),(0,K.jsx)("p",{children:"Matrix data not available"})]});const{rows:o,cols:d,data:u}=e,m=o>n||d>n,h=i?o:Math.min(o,n),p=i?d:Math.min(d,n),x=e=>Math.abs(e)<1e-10?"\xb7":e.toFixed(a);return(0,K.jsxs)("div",{className:$e,children:[(0,K.jsxs)("div",{className:ke,children:[(0,K.jsx)("h4",{children:s}),(0,K.jsxs)("div",{className:Fe,children:[(0,K.jsxs)("span",{className:Ee,children:[o," \xd7 ",d]}),m&&(0,K.jsx)("button",{className:Oe,onClick:()=>c(!i),children:i?"Show Preview":"Show Full"}),(0,K.jsx)("button",{className:Me,onClick:()=>{const e=u.map((e=>e.map((e=>x(e))).join(","))).join("\n"),a=new Blob([e],{type:"text/csv"}),t=URL.createObjectURL(a),n=document.createElement("a");n.href=t,n.download=`${s.toLowerCase().replace(/\s+/g,"_")}_matrix.csv`,n.click(),URL.revokeObjectURL(t)},title:"Download as CSV",children:"\u2193 CSV"})]})]}),(0,K.jsxs)("div",{className:Le,children:[(0,K.jsx)("div",{className:`${He} ${i?Re:""}`,style:{gridTemplateColumns:`repeat(${p}, 1fr)`},children:Array.from({length:h},((e,s)=>Array.from({length:p},((e,a)=>{const t=u[s]?.[a]||0,n=x(t),r=Math.abs(t)<1e-10;return(0,K.jsx)("div",{className:`${De} ${r?Be:""}`,title:`[${s+1},${a+1}] = ${t}`,children:n},`${s}-${a}`)}))))}),m&&!i&&(0,K.jsxs)("div",{className:ze,children:["Showing ",h," \xd7 ",p," of ",o," \xd7 ",d," matrix"]})]}),(0,K.jsxs)("div",{className:Ie,children:[(0,K.jsxs)("button",{className:Ae,onClick:()=>l(!r),children:[r?"\u25bc":"\u25b6"," Matrix Information"]}),r&&(0,K.jsxs)("div",{className:Te,children:[(0,K.jsxs)("div",{children:[(0,K.jsx)("strong",{children:"Dimensions:"})," ",o," rows \xd7 ",d," columns"]}),(0,K.jsxs)("div",{children:[(0,K.jsx)("strong",{children:"Total elements:"})," ",o*d]}),u.length>0&&u[0]&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)("div",{children:[(0,K.jsx)("strong",{children:"Max value:"})," ",Math.max(...u.flat()).toFixed(a)]}),(0,K.jsxs)("div",{children:[(0,K.jsx)("strong",{children:"Min value:"})," ",Math.min(...u.flat()).toFixed(a)]}),(0,K.jsxs)("div",{children:[(0,K.jsx)("strong",{children:"Trace (diagonal sum):"})," ",u.reduce(((e,s,a)=>e+(s[a]||0)),0).toFixed(a)]})]})]})]})]})};var We=a(7851);const Pe="container_BTtL",Ue="header_Zg_R",Xe="controls_krEJ",Ge="controlButton_kE_9",qe="viewer_MOiN",Ye="representationControls_JFkt",Ke="controlGroup_advN",Ze="controlLabel_p9ac",Qe="controlSelect_wf9l",Je="checkboxLabel_O6nm",es="checkbox_vb0q",ss="numberInput_NZEF",as="computingIndicator_nVPU",ts="mainContent_hmUM",ns="viewerContainer_HOsW",rs="orbitalSidebar_Sjw1",ls="orbitalSidebarHeader_sOPI",is="orbitalHint_l4jM",cs="moControls_QuQW",os="orbitalList_q8AK",ds="placeholder_XAIu",us="loading_XCE6",ms="error_fQgs",hs="orbitalItem_coIp",ps="orbitalOccupied_2McF",xs="orbitalVirtual_y4gy",vs="orbitalSelected_kMgf",js="orbitalContent_ff1A",gs="orbitalEnergy_svnX",bs="orbitalEnergyEV_OrpY",fs="orbitalLabel_q_Pv",Ns="orbitalIndicators_GNGS",_s="occupationBadge_DFgd",ys="orbitalColorIndicator_WBpC",Cs=({orbital:e,isHOMO:s=!1,isLUMO:a=!1,isSelected:t=!1,colorIndicator:n,onClick:r,className:l=""})=>{const i=e.energy/27.2114;return(0,K.jsxs)("div",{className:`${hs} ${e.isOccupied?ps:xs} ${t?vs:""} ${l}`,onClick:r,title:`MO ${e.index}: ${e.energy.toFixed(3)} eV (occupation: ${e.occupation})`,style:{cursor:r?"pointer":"default"},children:[(0,K.jsxs)("div",{className:js,children:[(0,K.jsxs)("div",{className:gs,children:[i.toFixed(6)," Eh"]}),(0,K.jsxs)("div",{className:bs,children:[e.energy.toFixed(3)," eV"]}),(s||a)&&(0,K.jsx)("div",{className:fs,children:s?"HOMO":"LUMO"})]}),(0,K.jsxs)("div",{className:Ns,children:[e.occupation>0&&(0,K.jsx)("div",{className:_s,children:2===e.occupation?"\u2191\u2193":1===e.occupation?"\u2191":""}),n&&(0,K.jsx)("div",{className:ys,style:{backgroundColor:n},title:`Plotted in ${n}`})]})]})},Ss=({xyzData:e,moleculeName:s="Molecule",wavefunctionResults:a,cubeResults:n,onRequestCubeComputation:r})=>{const l=(0,t.useRef)(null),i=(0,t.useRef)(null),c=(0,t.useRef)(null),o=(0,t.useRef)(null),[d,u]=(0,t.useState)(!1),[m,h]=(0,t.useState)(""),[p,x]=(0,t.useState)("ball+stick"),[v,j]=(0,t.useState)(!0),[g,b]=(0,t.useState)("element"),[f,N]=(0,t.useState)(new Set),[_,y]=(0,t.useState)(.01),[C,S]=(0,t.useState)(!1),[w,$]=(0,t.useState)(1),[k,F]=(0,t.useState)(!1),[E,O]=(0,t.useState)(new Map),[M,L]=(0,t.useState)(40),[H,D]=(0,t.useState)(5),T=(0,t.useRef)(null);(0,t.useEffect)((()=>{if(!l.current)return;i.current=new We.BI(l.current,{backgroundColor:"white",quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10,fogNear:100,fogFar:100});const e=()=>{i.current&&i.current.handleResize()};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),i.current&&i.current.dispose()}}),[]);const R=()=>{if(!c.current)return;c.current.removeAllRepresentations();const e={colorScheme:g,sele:v?"all":"not hydrogen"};switch(p){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0;break;case"surface":e.opacity=.8,e.surfaceType="vws"}c.current.addRepresentation(p,e),i.current?.autoView()};(0,t.useEffect)((()=>{R()}),[p,v,g]),(0,t.useEffect)((()=>{if(!e||!i.current)return;(async()=>{u(!0),h("");try{i.current.removeAllComponents();const a=((e,s)=>{const a=e.trim().split("\n"),t=parseInt(a[0]),n=a[1]||s,r=[];for(let m=2;m<2+t;m++){const e=a[m].trim().split(/\s+/);r.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const l={"H-H":.74,"H-C":1.09,"H-N":1.01,"H-O":.96,"H-S":1.34,"C-C":1.54,"C-N":1.47,"C-O":1.43,"C-S":1.82,"N-N":1.45,"N-O":1.4,"N-S":1.68,"O-O":1.48,"O-S":1.66,"S-S":2.05},i=(e,s)=>{const a=e.x-s.x,t=e.y-s.y,n=e.z-s.z;return Math.sqrt(a*a+t*t+n*n)},c=[];for(let m=0;m<r.length;m++)for(let e=m+1;e<r.length;e++){const s=i(r[m],r[e]),a=l[`${o=r[m].element}-${d=r[e].element}`]||l[`${d}-${o}`]||2;if(s<=1.3*a){let t=1;s<.85*a&&(t=2),s<.75*a&&(t=3),c.push({atom1:m+1,atom2:e+1,order:t})}}var o,d;let u=`${n}\n`;return u+="  Generated from XYZ with bond guessing\n",u+="\n",u+=`${t.toString().padStart(3," ")}${c.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`,r.forEach((e=>{const s=e.x.toFixed(4).padStart(10," "),a=e.y.toFixed(4).padStart(10," "),t=e.z.toFixed(4).padStart(10," ");u+=`${s}${a}${t} ${e.element.padEnd(3," ")} 0  0  0  0  0  0  0  0  0  0  0  0\n`})),c.forEach((e=>{u+=`${e.atom1.toString().padStart(3," ")}${e.atom2.toString().padStart(3," ")}${e.order.toString().padStart(3," ")}  0  0  0  0\n`})),u+="M  END\n$$$$\n",u})(e,s),t=new Blob([a],{type:"text/plain"}),n=await i.current.loadFile(t,{ext:"sdf",name:s});c.current=n,R(),u(!1)}catch(a){console.error("Error loading molecule:",a),h("Failed to load molecule structure"),u(!1)}})()}),[e,s]);const B=t.useMemo((()=>{if(!a?.orbitalEnergies||!a?.orbitalOccupations)return[];const e=[];for(let s=0;s<a.orbitalEnergies.length;s++){const t=a.orbitalEnergies[s],n=a.orbitalOccupations[s]||0;e.push({index:s,energy:27.2114*t,occupation:n,isOccupied:n>0})}return e}),[a]),z=B;(0,t.useEffect)((()=>{if(B.length>0&&r&&f.size>0){const e=[];for(const s of f){const a=`molecular_orbital_${s}_${M}_${H}`,t=n?.get(a);t||e.push(s)}e.length>0&&(T.current&&clearTimeout(T.current),T.current=setTimeout((()=>{I(e)}),300))}return()=>{T.current&&clearTimeout(T.current)}}),[f,B.length,n,M,H]);const I=async e=>{if(r&&i.current){F(!0),h("");try{for(const s of e)r("molecular_orbital",s,M,H)}catch(m){console.error("Error requesting MO computation:",m),h("Failed to request molecular orbital computation: "+m.message),F(!1)}}};(0,t.useEffect)((()=>{if(!i.current)return;if(0===f.size)return void A();if(!n)return;Array.from(f).every((e=>{const s=`molecular_orbital_${e}_${M}_${H}`;return n.get(s)}))&&(A(),k&&F(!1))}),[n,f,_,C,w]);const A=async()=>{if(i.current)try{o.current&&(Array.isArray(o.current)?o.current.forEach((e=>{e&&i.current&&i.current.removeComponent(e)})):i.current&&i.current.removeComponent(o.current),o.current=null);const e=[],s=["#4A90E2","#FF8C42","#7B68EE","#32CD32","#FF6B6B","#9B59B6"],a=new Map;if(0===f.size)return o.current=[],O(a),void i.current.autoView();for(const[t,r]of Array.from(f).entries()){const l=`molecular_orbital_${r}_${M}_${H}`,c=n?.get(l);if(c){const n=new Blob([c],{type:"text/plain"}),l=await i.current.loadFile(n,{ext:"cube",name:`MO_${r}`});if(l){const n=s[t%s.length];a.set(r,n),l.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:_,color:n,opacity:w,opaqueBack:!1}),C&&l.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-_,color:"red",opacity:w,opaqueBack:!1}),e.push(l)}}}o.current=e,O(a),i.current.autoView()}catch(m){console.error("Error visualizing molecular orbitals:",m),h("Failed to visualize molecular orbitals: "+m.message)}};return e?(0,K.jsxs)("div",{className:Pe,children:[(0,K.jsxs)("div",{className:Ue,children:[(0,K.jsx)("h4",{children:"3D Structure & Molecular Orbitals"}),(0,K.jsxs)("div",{className:Xe,children:[(0,K.jsx)("button",{className:Ge,onClick:()=>{i.current&&i.current.autoView()},title:"Reset view",children:"\u2302"}),(0,K.jsx)("button",{className:Ge,onClick:()=>{i.current&&i.current.toggleFullscreen(l.current)},title:"Toggle fullscreen",children:"\u26f6"})]})]}),(0,K.jsxs)("div",{className:Ye,children:[(0,K.jsxs)("div",{className:Ke,children:[(0,K.jsx)("label",{className:Ze,children:"Style"}),(0,K.jsxs)("select",{value:p,onChange:e=>x(e.target.value),className:Qe,children:[(0,K.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,K.jsx)("option",{value:"line",children:"Line"}),(0,K.jsx)("option",{value:"spacefill",children:"Space Fill"}),(0,K.jsx)("option",{value:"licorice",children:"Licorice"}),(0,K.jsx)("option",{value:"surface",children:"Surface"})]})]}),(0,K.jsxs)("div",{className:Ke,children:[(0,K.jsx)("label",{className:Ze,children:"Color"}),(0,K.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:Qe,children:[(0,K.jsx)("option",{value:"element",children:"By Element"}),(0,K.jsx)("option",{value:"uniform",children:"Uniform"}),(0,K.jsx)("option",{value:"chainname",children:"By Chain"}),(0,K.jsx)("option",{value:"random",children:"Random"})]})]}),(0,K.jsx)("div",{className:Ke,children:(0,K.jsxs)("label",{className:Je,children:[(0,K.jsx)("input",{type:"checkbox",checked:v,onChange:e=>j(e.target.checked),className:es}),"Show Hydrogens"]})})]}),(0,K.jsxs)("div",{className:ts,children:[(0,K.jsxs)("div",{className:ns,children:[m&&(0,K.jsx)("div",{className:ms,children:(0,K.jsx)("p",{children:m})}),d&&(0,K.jsx)("div",{className:us,children:(0,K.jsx)("p",{children:"Loading molecule..."})}),(0,K.jsx)("div",{ref:l,className:qe,style:{opacity:d?.5:1}})]}),a&&B.length>0&&(0,K.jsxs)("div",{className:rs,children:[(0,K.jsxs)("div",{className:ls,children:[(0,K.jsx)("h5",{children:"Molecular Orbitals"}),(0,K.jsx)("span",{className:is,children:"Click orbitals to visualize"})]}),(0,K.jsxs)("div",{className:cs,children:[(0,K.jsxs)("div",{className:Ke,children:[(0,K.jsx)("label",{className:Ze,children:"Isovalue"}),(0,K.jsx)("input",{type:"number",min:"0.001",max:"0.2",step:"0.001",value:_,onChange:e=>y(parseFloat(e.target.value)||.01),className:ss})]}),(0,K.jsxs)("div",{className:Ke,children:[(0,K.jsx)("label",{className:Ze,children:"Opacity"}),(0,K.jsx)("input",{type:"number",min:"0.1",max:"1.0",step:"0.05",value:w,onChange:e=>$(parseFloat(e.target.value)||1),className:ss,title:"Orbital surface opacity (0.1 = very transparent, 1.0 = opaque)"})]}),(0,K.jsxs)("div",{className:Ke,children:[(0,K.jsx)("label",{className:Ze,children:"Grid Steps"}),(0,K.jsx)("input",{type:"number",min:"20",max:"100",step:"5",value:M,onChange:e=>L(parseInt(e.target.value)||40),className:ss,title:"Number of grid points per dimension (higher = more detail, slower)"})]}),(0,K.jsxs)("div",{className:Ke,children:[(0,K.jsx)("label",{className:Ze,children:"Grid Buffer (\xc5)"}),(0,K.jsx)("input",{type:"number",min:"2.0",max:"10.0",step:"0.5",value:H,onChange:e=>D(parseFloat(e.target.value)||5),className:ss,title:"Buffer region around molecule in Angstroms"})]}),k&&(0,K.jsx)("div",{className:Ke,children:(0,K.jsx)("span",{className:as,children:"Computing MO..."})})]}),(0,K.jsx)("div",{className:os,children:z.map(((e,s)=>{const a=B.findIndex(((e,s)=>e.isOccupied&&(!B[s+1]||!B[s+1].isOccupied))),t=a>=0?a+1:-1,n=e.index===a,r=e.index===t,l=f.has(e.index),i=E.get(e.index);return(0,K.jsx)(Cs,{orbital:e,isHOMO:n,isLUMO:r,isSelected:l,colorIndicator:l?i:void 0,onClick:()=>{return s=e.index,void N((e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a}));var s}},e.index)}))})]})]})]}):(0,K.jsx)("div",{className:Pe,children:(0,K.jsxs)("div",{className:ds,children:[(0,K.jsx)("h4",{children:"Molecule Viewer"}),(0,K.jsx)("p",{children:"Load a molecule to see its 3D structure"})]})})},ws=()=>{const[e,s]=(0,t.useState)(null),[n,R]=(0,t.useState)(!1),[B,z]=(0,t.useState)(""),[I,A]=(0,t.useState)(null),[V,W]=(0,t.useState)(!1),[P,U]=(0,t.useState)(null),[X,G]=(0,t.useState)([]),[q,Y]=(0,t.useState)("structure"),[Z,J]=(0,t.useState)(""),[ee,ae]=(0,t.useState)(new Map),[te,ne]=(0,t.useState)(!0),[re,le]=(0,t.useState)(!0),[ie,ce]=(0,t.useState)("dft-wb97x"),[oe,de]=(0,t.useState)("6-31g(d,p)"),[ue,me]=(0,t.useState)(100),[he,pe]=(0,t.useState)(1e-8),[xe,ve]=(0,t.useState)(2);(0,t.useEffect)((()=>(je(),()=>{e&&e.terminate()})),[]);const je=async()=>{try{const e=new Worker(new URL(a.p+a.u(842),a.b),{type:void 0});e.onmessage=ge,e.onerror=e=>{console.error("Worker error:",e),J("Worker error: "+e.message),R(!1)},s(e),e.postMessage({type:"init",data:{}})}catch(Z){console.error("Failed to initialize worker:",Z),J("Failed to initialize Web Worker: "+Z.message)}},ge=e=>{const{type:s,...a}=e.data;switch(s){case"initialized":a.success?(R(!0),fe("Worker initialized successfully","info")):(R(!1),J("Worker initialization failed: "+a.error));break;case"log":fe(a.message,be(a.level));break;case"progress":fe(a.message,"info"),"complete"===a.stage&&W(!1);break;case"result":Ne(a);break;case"cubeResult":_e(a);break;case"error":console.error("Worker error:",a.error),J("Calculation error: "+a.error),W(!1)}},be=e=>{switch(e){case 0:case 1:return"debug";case 2:default:return"info";case 3:return"warn";case 4:case 5:return"error"}},fe=(e,s)=>{G((a=>[...a,{message:e,level:s,timestamp:new Date}]))},Ne=e=>{W(!1),e.success?(U(e.results),Y("results"),fe("Calculation completed successfully!","info")):J("Calculation failed: "+e.error)},_e=e=>{if(e.success){const s="molecular_orbital"===e.cubeType?`${e.cubeType}_${e.orbitalIndex}_${e.gridSteps||40}_${e.gridBuffer||5}`:e.cubeType;ae((a=>new Map(a.set(s,e.cubeData)))),fe(`Cube computation completed: ${e.cubeType}${void 0!==e.orbitalIndex?` (orbital ${e.orbitalIndex})`:""} [${e.gridSteps||40} steps, ${e.gridBuffer||5}\xc5 buffer]`,"info")}else J(`Cube computation failed: ${e.error}`),fe(`Cube computation failed: ${e.error}`,"error")};return(0,K.jsxs)("div",{className:r,children:[(0,K.jsxs)("div",{className:l,children:[(0,K.jsxs)("div",{className:i,children:[(0,K.jsx)("div",{className:`${g} ${n?f:b}`,children:n?"\u2713 Ready":"\u23f3 Loading..."}),(0,K.jsxs)("div",{className:m,children:[(0,K.jsxs)("button",{className:h,onClick:()=>ne(!te),children:[(0,K.jsx)("span",{className:p,children:"Molecule Input"}),(0,K.jsx)("span",{className:`${x} ${te?j:""}`,children:"\u25bc"})]}),te&&(0,K.jsxs)("div",{className:v,children:[(0,K.jsx)(Q,{onFileLoad:e=>{z(e),ae(new Map),U(null);try{const s=e.trim().split("\n"),a=parseInt(s[0]),t=s[1]||"Loaded Molecule",n=new Map;for(let e=2;e<2+a;e++){const a=s[e].trim().split(/\s+/)[0];n.set(a,(n.get(a)||0)+1)}const r=Array.from(n.entries()).map((([e,s])=>s>1?`${e}${s}`:e)).join("");A({name:t,formula:r,numAtoms:a}),fe(`Molecule loaded: ${r} (${a} atoms) - cleared orbital cache`,"info")}catch(Z){console.error("Error parsing XYZ:",Z),J("Failed to parse XYZ data: "+Z.message)}}}),I&&(0,K.jsx)("div",{className:N,children:(0,K.jsxs)("div",{children:[(0,K.jsx)("strong",{children:I.formula})," (",I.numAtoms," atoms)"]})})]})]}),B&&(0,K.jsxs)("div",{className:m,children:[(0,K.jsxs)("button",{className:h,onClick:()=>le(!re),children:[(0,K.jsx)("span",{className:p,children:"Calculation Settings"}),(0,K.jsx)("span",{className:`${x} ${re?j:""}`,children:"\u25bc"})]}),re&&(0,K.jsx)("div",{className:v,children:(0,K.jsx)(se,{method:ie,setMethod:ce,basisSet:oe,setBasisSet:de,maxIterations:ue,setMaxIterations:me,energyTolerance:he,setEnergyTolerance:pe,logLevel:xe,setLogLevel:ve})})]}),B&&(0,K.jsxs)("div",{className:y,children:[(0,K.jsx)("button",{className:`${_} ${C}`,onClick:()=>{if(!B)return void J("Please load a molecule first.");if(!e||!n)return void J("Web Worker not ready.");U(null),G([]),Y("output"),W(!0),e.postMessage({type:"setLogLevel",data:{level:xe}});const s={xyzData:B,method:ie,basisSet:oe,maxIterations:ue,energyTolerance:he};fe("Starting calculation...","info"),e.postMessage({type:"calculate",data:s})},disabled:V||!n,children:V?"Calculating...":"Run Calculation"}),V&&(0,K.jsx)("button",{className:`${_} ${S}`,onClick:()=>{e&&V&&(e.terminate(),fe("Calculation cancelled. Restarting worker...","warn"),je(),W(!1))},children:"Cancel"})]})]}),(0,K.jsxs)("div",{className:c,children:[B&&(0,K.jsxs)("div",{className:o,children:[(0,K.jsx)("button",{className:`${d} ${"output"===q?w:""}`,onClick:()=>Y("output"),children:"Output"}),(0,K.jsx)("button",{className:`${d} ${"results"===q?w:""}`,onClick:()=>Y("results"),children:"Results"}),(0,K.jsx)("button",{className:`${d} ${"structure"===q?w:""}`,onClick:()=>Y("structure"),children:"Structure"}),(0,K.jsx)("button",{className:`${d} ${"properties"===q?w:""}`,onClick:()=>Y("properties"),children:"Properties"})]}),(0,K.jsxs)("div",{className:u,children:["output"===q&&(0,K.jsx)(we,{logs:X}),"results"===q&&(0,K.jsx)(Ce,{results:P}),"structure"===q&&(0,K.jsx)("div",{className:k,children:B?(0,K.jsx)(Ss,{xyzData:B,moleculeName:I?.name||"Molecule",wavefunctionResults:P,cubeResults:ee,onRequestCubeComputation:(s,a,t,r)=>{e&&n?P&&P.wavefunctionData?(fe(`Requesting ${s} cube computation...`,"info"),e.postMessage({type:"computeCube",data:{cubeType:s,orbitalIndex:a,gridSteps:t||40,gridBuffer:r||5}})):J("No wavefunction data available for cube computation."):J("Web Worker not ready for cube computation.")}}):(0,K.jsxs)("div",{className:F,children:[(0,K.jsx)("h3",{children:"No Structure Loaded"}),(0,K.jsx)("p",{children:"Load a molecule to see its 3D structure visualization."})]})}),"properties"===q&&P&&(0,K.jsxs)("div",{className:$,children:[P.orbitalEnergies&&P.orbitalEnergies.length>0&&(0,K.jsxs)("div",{className:M,children:[(0,K.jsx)("h4",{children:"Orbital Energies"}),(0,K.jsx)("div",{className:L,children:P.orbitalEnergies.slice(0,20).map(((e,s)=>{const a=P.orbitalOccupations?.[s]??0,t={index:s,energy:27.2114*e,occupation:a,isOccupied:a>0};return(0,K.jsx)(Cs,{orbital:t},s)}))}),P.orbitalEnergies.length>20&&(0,K.jsxs)("div",{className:H,children:["... and ",P.orbitalEnergies.length-20," more orbitals"]})]}),P.matrices&&Object.keys(P.matrices).length>0?(0,K.jsx)("div",{className:E,children:Object.entries(P.matrices).map((([e,s])=>s?(0,K.jsx)(Ve,{matrix:s,title:`${e.charAt(0).toUpperCase()}${e.slice(1)} Matrix`,precision:6,maxDisplaySize:6},e):null))}):(0,K.jsx)("div",{className:O,children:(0,K.jsx)("p",{children:"No matrix data available. Matrices are generated during SCF calculations and may depend on the calculation method and settings."})})]})]})]})]}),Z&&(0,K.jsx)("div",{className:D,children:(0,K.jsxs)("div",{className:T,children:[(0,K.jsx)("h3",{children:"Error"}),(0,K.jsx)("p",{children:Z}),(0,K.jsx)("button",{onClick:()=>J(""),children:"Close"})]})})]})};function $s(){return(0,K.jsx)(n.A,{title:"Wavefunction Calculator",description:"Quantum Chemistry Calculations in Your Browser",children:(0,K.jsx)("main",{style:{minHeight:"calc(100vh - 60px)"},children:(0,K.jsx)(ws,{})})})}}}]);