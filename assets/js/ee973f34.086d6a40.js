"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[979],{643:(e,t,a)=>{a.d(t,{A:()=>r});const r={utilitiesMain:"utilitiesMain_siLQ",heroSection:"heroSection_fp5l",heroTitle:"heroTitle_IiF1",heroSubtitle:"heroSubtitle_G8I3",utilitiesSection:"utilitiesSection_F0eJ",utilityCard:"utilityCard_gd2u",cardHeader:"cardHeader_kmu1",cardTitle:"cardTitle_zVg2",cardBody:"cardBody_mvNT",cardDescription:"cardDescription_O5cA",cardFooter:"cardFooter_iFIC",infoSection:"infoSection_a90X",lead:"lead_kUWS",utilityPage:"utilityPage_jfjb",container:"container_W1LS",mainLayout:"mainLayout_Vq2n",leftColumn:"leftColumn_RKh5",rightColumn:"rightColumn_SRw5",inputSection:"inputSection_vYbF",dragOver:"dragOver_FKFh",trajectoryInput:"trajectoryInput_BWnR",fileControls:"fileControls_RnoX",dragHint:"dragHint_oLc8",inputControls:"inputControls_do9o",errorMessage:"errorMessage_xmAz",formatHelp:"formatHelp_SSdV",formatExample:"formatExample_XLQ0",formatNote:"formatNote_LyvY",placeholderViewer:"placeholderViewer_pXBD",placeholderContent:"placeholderContent_LY28",tabNavigation:"tabNavigation_vKN7",tabButton:"tabButton_S3Zy",activeTab:"activeTab_cPgI",fileInputGroup:"fileInputGroup_Mjx2",fileLabel:"fileLabel_kJ2V",fileDescription:"fileDescription_eg5F",fileName:"fileName_xbPq",formatInfo:"formatInfo_GvT5"}},5998:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var r=a(6540),n=a(1656),s=a(643),l=a(6370),c=a(4848);const i=function(){const[e,t]=(0,r.useState)("xyz"),[a,i]=(0,r.useState)(""),[o,u]=(0,r.useState)(""),[d,m]=(0,r.useState)(!1),p=(0,r.useRef)(null),[h,f]=(0,r.useState)(null),[j,y]=(0,r.useState)(null),[g,x]=(0,r.useState)(""),[v,N]=(0,r.useState)(!1),[b,C]=(0,r.useState)(!1),S=(0,r.useRef)(null),F=(0,r.useRef)(null),A="3\nStep 0 Energy=-75.576566960\nO     0.000000     0.000000     0.000000\nH     0.900000     0.000000     0.000000\nH    -0.300000     0.850000     0.000000\n3\nStep 1 Energy=-75.584772914\nO    -0.007706    -0.010230     0.000000\nH     0.934579    -0.016478     0.000000\nH    -0.326873     0.876708     0.000000\n3\nStep 2 Energy=-75.585838726\nO    -0.014077    -0.019071     0.000000\nH     0.946513    -0.018211     0.000000\nH    -0.332435     0.887282     0.000000\n3\nStep 3 Energy=-75.585944869\nO    -0.017729    -0.024187     0.000000\nH     0.948447    -0.015719     0.000000\nH    -0.330718     0.889906     0.000000\n3\nStep 4 Energy=-75.585957726\nO    -0.019253    -0.026339     0.000000\nH     0.947775    -0.013628     0.000000\nH    -0.328522     0.889966     0.000000\n3\nStep 5 Energy=-75.585959662\nO    -0.019726    -0.027015     0.000000\nH     0.947039    -0.012603     0.000000\nH    -0.327313     0.889618     0.000000\n3\nStep 6 Energy=-75.585959757\nO    -0.019728    -0.027022     0.000000\nH     0.946851    -0.012467     0.000000\nH    -0.327123     0.889489     0.000000",_=e=>{const t=new FileReader;t.onload=e=>{const t=e.target?.result;i(t)},t.onerror=()=>{u("Failed to read file")},t.readAsText(e)};return(0,c.jsx)(n.A,{title:"Trajectory Viewer",description:"Visualize molecular trajectories",children:(0,c.jsx)("main",{className:s.A.utilityPage,children:(0,c.jsxs)("div",{className:s.A.container,children:[(0,c.jsx)("h1",{children:"Trajectory Viewer"}),(0,c.jsx)("p",{children:"Visualize molecular trajectories and dynamics from XYZ data or structure/trajectory file pairs using NGL's capabilities."}),(0,c.jsxs)("div",{className:s.A.tabNavigation,children:[(0,c.jsx)("button",{className:`${s.A.tabButton} ${"xyz"===e?s.A.activeTab:""}`,onClick:()=>t("xyz"),children:"XYZ Text/File"}),(0,c.jsx)("button",{className:`${s.A.tabButton} ${"files"===e?s.A.activeTab:""}`,onClick:()=>t("files"),children:"Structure + Trajectory Files"})]}),(0,c.jsxs)("div",{className:s.A.mainLayout,children:[(0,c.jsxs)("div",{className:s.A.leftColumn,children:["xyz"===e&&(0,c.jsxs)("div",{className:`${s.A.inputSection} ${d?s.A.dragOver:""}`,onDragOver:e=>{e.preventDefault(),m(!0)},onDragLeave:e=>{e.preventDefault(),m(!1)},onDrop:e=>{e.preventDefault(),m(!1);const t=e.dataTransfer.files;if(t.length>0){const e=t[0];_(e)}},children:[(0,c.jsx)("h3",{children:"XYZ Trajectory Input"}),(0,c.jsx)("input",{ref:p,type:"file",accept:".xyz,.txt",onChange:e=>{const t=e.target.files?.[0];t&&_(t)},style:{display:"none"}}),(0,c.jsxs)("div",{className:s.A.fileControls,children:[(0,c.jsx)("button",{onClick:()=>{p.current?.click()},className:"button button--primary button--sm",children:"Open File"}),(0,c.jsx)("span",{className:s.A.dragHint,children:"or drag & drop XYZ file here"})]}),(0,c.jsx)("textarea",{value:a,onChange:e=>i(e.target.value),placeholder:"Paste multi-frame XYZ data here or drag & drop a file...",className:s.A.trajectoryInput}),(0,c.jsxs)("div",{className:s.A.inputControls,children:[(0,c.jsx)("button",{onClick:()=>i(A),className:"button button--primary button--sm",children:"Load Example"}),(0,c.jsx)("button",{onClick:()=>i(""),className:"button button--outline button--sm",children:"Clear"})]}),o&&(0,c.jsx)("div",{className:s.A.errorMessage,children:o}),(0,c.jsxs)("div",{className:s.A.formatHelp,children:[(0,c.jsx)("h4",{children:"Format Guide"}),(0,c.jsx)("pre",{className:s.A.formatExample,children:"3\nFrame 1\nO  0.000  0.000  0.000\nH  0.757  0.586  0.000\nH -0.757  0.586  0.000\n3\nFrame 2\nO  0.000  0.000  0.010\n..."}),(0,c.jsx)("p",{className:s.A.formatNote,children:"Each frame: atom count \u2192 comment \u2192 coordinates"})]})]}),"files"===e&&(0,c.jsxs)("div",{className:s.A.inputSection,children:[(0,c.jsx)("h3",{children:"Structure + Trajectory Files"}),(0,c.jsxs)("div",{className:s.A.fileInputGroup,children:[(0,c.jsx)("label",{className:s.A.fileLabel,children:"Structure File (Required)"}),(0,c.jsx)("p",{className:s.A.fileDescription,children:"PDB, GRO, mmCIF, or other structure formats"}),(0,c.jsx)("input",{ref:S,type:"file",accept:".pdb,.ent,.pqr,.gro,.mmcif,.cif,.mcif,.sdf,.mol2,.mmtf",onChange:e=>{const t=e.target.files?.[0];t&&(f(t),x(""))},style:{display:"none"}}),(0,c.jsxs)("div",{className:`${s.A.fileControls} ${v?s.A.dragOver:""}`,onDragOver:e=>{e.preventDefault(),N(!0)},onDragLeave:e=>{e.preventDefault(),N(!1)},onDrop:e=>{e.preventDefault(),N(!1);const t=e.dataTransfer.files;if(t.length>0){const e=t[0];f(e),x("")}},children:[(0,c.jsx)("button",{onClick:()=>S.current?.click(),className:"button button--primary button--sm",children:"Choose Structure File"}),(0,c.jsx)("span",{className:s.A.dragHint,children:"or drag & drop file here"}),h&&(0,c.jsx)("span",{className:s.A.fileName,children:h.name})]})]}),(0,c.jsxs)("div",{className:s.A.fileInputGroup,children:[(0,c.jsx)("label",{className:s.A.fileLabel,children:"Trajectory File (Optional)"}),(0,c.jsx)("p",{className:s.A.fileDescription,children:"DCD, TRR, XTC, or NCTRAJ files. Leave empty for multi-model structures."}),(0,c.jsx)("input",{ref:F,type:"file",accept:".dcd,.trr,.xtc,.nctraj",onChange:e=>{const t=e.target.files?.[0];t&&(y(t),x(""))},style:{display:"none"}}),(0,c.jsxs)("div",{className:`${s.A.fileControls} ${b?s.A.dragOver:""}`,onDragOver:e=>{e.preventDefault(),C(!0)},onDragLeave:e=>{e.preventDefault(),C(!1)},onDrop:e=>{e.preventDefault(),C(!1);const t=e.dataTransfer.files;if(t.length>0){const e=t[0];y(e),x("")}},children:[(0,c.jsx)("button",{onClick:()=>F.current?.click(),className:"button button--outline button--sm",children:"Choose Trajectory File"}),(0,c.jsx)("span",{className:s.A.dragHint,children:"or drag & drop file here"}),j&&(0,c.jsx)("span",{className:s.A.fileName,children:j.name})]})]}),(0,c.jsx)("div",{className:s.A.inputControls,children:(0,c.jsx)("button",{onClick:()=>{f(null),y(null),x("")},className:"button button--outline button--sm",children:"Clear Files"})}),g&&(0,c.jsx)("div",{className:s.A.errorMessage,children:g}),(0,c.jsxs)("div",{className:s.A.formatHelp,children:[(0,c.jsx)("h4",{children:"Supported Formats"}),(0,c.jsxs)("div",{className:s.A.formatExample,children:[(0,c.jsx)("strong",{children:"Structure:"})," PDB, GRO, mmCIF, SDF, MOL2, MMTF",(0,c.jsx)("br",{}),(0,c.jsx)("strong",{children:"Trajectory:"})," DCD, TRR, XTC, NCTRAJ"]}),(0,c.jsx)("p",{className:s.A.formatNote,children:"Load a structure file first, then optionally add a trajectory file for dynamics."})]})]})]}),(0,c.jsxs)("div",{className:s.A.rightColumn,children:["xyz"===e&&(a.trim()&&!o?(0,c.jsx)(l.A,{trajectoryData:a,moleculeName:"XYZ Trajectory",autoPlay:!1}):(0,c.jsx)("div",{className:s.A.placeholderViewer,children:(0,c.jsxs)("div",{className:s.A.placeholderContent,children:[(0,c.jsx)("h3",{children:"Trajectory Viewer"}),(0,c.jsx)("p",{children:"Load XYZ trajectory data to visualize molecular dynamics"}),(0,c.jsx)("button",{onClick:()=>i(A),className:"button button--primary",children:"Try Example"})]})})),"files"===e&&(h&&!g?(0,c.jsx)(l.A,{structureFile:h,trajectoryFile:j||void 0,moleculeName:h.name.split(".")[0],autoPlay:!1}):(0,c.jsx)("div",{className:s.A.placeholderViewer,children:(0,c.jsxs)("div",{className:s.A.placeholderContent,children:[(0,c.jsx)("h3",{children:"Trajectory Viewer"}),(0,c.jsx)("p",{children:"Select structure and trajectory files to visualize molecular dynamics"}),(0,c.jsxs)("div",{className:s.A.formatInfo,children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Structure:"})," PDB, GRO, mmCIF, etc."]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Trajectory:"})," DCD, TRR, XTC (optional)"]})]})]})}))]})]})]})})})}},6370:(e,t,a)=>{a.d(t,{A:()=>H});var r=a(6540),n=a(7851);const s="container_kZ5w",l="header_HEr1",c="controls_ixvO",i="controlButton_GDgO",o="viewer_WviD",u="loadingOverlay_lwCV",d="errorOverlay_rmFC",m="loadingSpinner_PLZ5",p="errorMessage_qkbu",h="frameInfoOverlay_vX3K",f="frameNumber_EMUy",j="frameComment_F9wg",y="frameEnergy_RPyN",g="frameVolume_c0K5",x="displayControlsOverlay_fIES",v="overlayControls_EEtd",N="overlayControlGroup_E9WC",b="overlayLabel_tcBl",C="overlaySelect_UZvO",S="overlayCheckbox_jtWY",F="overlaySlider_ifAA",A="overlayValue_f7JJ",_="overlayNumberInput_nqMv",M="trajectoryControls_t0nZ",T="compactControls_H6OY",L="frameControls_R8UR",w="playerControls_ukm9",I="playerButton_Mfw8",R="playPauseButton_PlTX",k="frameSlider_B4ss";var D=a(4848);class E{shapeComponent=null;frameUnitcells=[];constructor(e,t){this.component=e,this.stage=t}setFrameUnitcells(e){this.frameUnitcells=e.map((e=>{if(!e.includes("Lattice="))return null;const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const a=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==a.length)return null;return{a:[a[0],a[1],a[2]],b:[a[3],a[4],a[5]],c:[a[6],a[7],a[8]]}}))}updateFrame(e){if(e<0||e>=this.frameUnitcells.length)return;const t=this.frameUnitcells[e];t&&(this.remove(),this.createUnitCellShape(t))}createUnitCellShape(e){const{a:t,b:a,c:r}=e,s=this.component.structure.center,l=[[0,0,0],[1,0,0],[0,1,0],[0,0,1],[1,1,0],[1,0,1],[0,1,1],[1,1,1]].map((([e,n,l])=>[s.x+e*t[0]+n*a[0]+l*r[0],s.y+e*t[1]+n*a[1]+l*r[1],s.z+e*t[2]+n*a[2]+l*r[2]])),c=new n.yp("unitcell");[[0,1],[0,2],[0,3],[1,4],[1,5],[2,4],[2,6],[3,5],[3,6],[4,7],[5,7],[6,7]].forEach((([e,t])=>{c.addWideline(l[e],l[t],[1,.5,0])})),this.shapeComponent=this.stage.addComponentFromObject(c),this.shapeComponent.addRepresentation("buffer",{linewidth:5,opacity:.8})}remove(){this.shapeComponent&&(this.stage.removeComponent(this.shapeComponent),this.shapeComponent=null)}setVisible(e){this.shapeComponent&&this.shapeComponent.setVisibility(e)}}const O=e=>e.toLowerCase().split(".").pop()||"",P=e=>["pdb","ent","pqr","mmcif","cif","mcif","gro","sdf","mol2","mmtf"].includes(e);class ${static convertXYZTrajToPDB(e,t="MOL"){const a=this.parseXYZTrajectory(e);return this.convertFramesToPDB(a,t)}static calculateVolume(e,t,a,r,n,s){const l=r*Math.PI/180,c=n*Math.PI/180,i=s*Math.PI/180,o=Math.cos(l),u=Math.cos(c),d=Math.cos(i);return e*t*a*Math.sqrt(1+2*o*u*d-o*o-u*u-d*d)}static parseLatticeInfo(e){const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const a=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==a.length)return null;const r=a[0],n=a[1],s=a[2],l=a[3],c=a[4],i=a[5],o=a[6],u=a[7],d=a[8],m=Math.sqrt(r*r+n*n+s*s),p=Math.sqrt(l*l+c*c+i*i),h=Math.sqrt(o*o+u*u+d*d),f=180*Math.acos((l*o+c*u+i*d)/(p*h))/Math.PI,j=180*Math.acos((r*o+n*u+s*d)/(m*h))/Math.PI,y=180*Math.acos((r*l+n*c+s*i)/(m*p))/Math.PI;return{a:m,b:p,c:h,alpha:f,beta:j,gamma:y,volume:this.calculateVolume(m,p,h,f,j,y)}}static convertFramesToPDB(e,t="MOL"){let a="";return e.forEach(((e,r)=>{a+=`MODEL     ${(r+1).toString().padStart(4," ")}\n`;const n=e.trim().split("\n"),s=parseInt(n[0]),l=n[1]||"",c=this.parseLatticeInfo(l);if(c){const e=c.a.toFixed(3).padStart(9," "),t=c.b.toFixed(3).padStart(9," "),r=c.c.toFixed(3).padStart(9," "),n=c.alpha.toFixed(2).padStart(7," "),s=c.beta.toFixed(2).padStart(7," "),l=c.gamma.toFixed(2).padStart(7," ");a+=`CRYST1${e}${t}${r}${n}${s}${l} P 1           1\n`}for(let i=0;i<s;i++){const e=n[i+2].trim().split(/\s+/),r=e[0],s=parseFloat(e[1]),l=parseFloat(e[2]),c=parseFloat(e[3]),o=(i+1).toString().padStart(5," "),u=r.padEnd(4," "),d=t.substring(0,3).padEnd(3," "),m="A",p="1".padStart(4," "),h=s.toFixed(3).padStart(8," "),f=l.toFixed(3).padStart(8," "),j=c.toFixed(3).padStart(8," ");a+=`ATOM  ${o} ${u} ${d} ${m}${p}    ${h}${f}${j}  1.00  0.00           ${r.padEnd(2," ")}\n`}a+="ENDMDL\n"})),a+="END\n",a}static parseXYZTrajectory(e){const t=[],a=e.trim().split("\n");let r=0;for(;r<a.length;){if(!a[r]||""===a[r].trim()){r++;continue}const e=parseInt(a[r]);if(isNaN(e)||e<=0){r++;continue}if(r+e+1>=a.length)break;const n=a.slice(r,r+e+2);t.push(n.join("\n")),r+=e+2}return t}}const H=({trajectoryData:e,xyzFrames:t,structureFile:a,trajectoryFile:H,structureUrl:V,trajectoryUrl:B,moleculeName:U="Trajectory",autoPlay:z=!1,initialSpeed:X=100})=>{const Y=(0,r.useRef)(null),q=(0,r.useRef)(null),Z=(0,r.useRef)(null),G=(0,r.useRef)(null),J=(0,r.useRef)(null),[W,K]=(0,r.useState)(!1),[Q,ee]=(0,r.useState)(""),[te,ae]=(0,r.useState)(0),[re,ne]=(0,r.useState)(0),[se,le]=(0,r.useState)(!1),[ce,ie]=(0,r.useState)(30),[oe,ue]=(0,r.useState)("ball+stick"),[de,me]=(0,r.useState)(!0),[pe,he]=(0,r.useState)("element"),[fe,je]=(0,r.useState)([]),[ye,ge]=(0,r.useState)([]),[xe,ve]=(0,r.useState)(null),[Ne,be]=(0,r.useState)(!1),[Ce,Se]=(0,r.useState)(!1),[Fe,Ae]=(0,r.useState)(!1),[_e,Me]=(0,r.useState)(1),[Te,Le]=(0,r.useState)(1),[we,Ie]=(0,r.useState)(1),[Re,ke]=(0,r.useState)([]),[De,Ee]=(0,r.useState)(null),Oe=()=>"dark"===document.documentElement.getAttribute("data-theme")?"#1b1b1d":"#ffffff";(0,r.useEffect)((()=>{if(!Y.current)return;q.current=new n.BI(Y.current,{backgroundColor:Oe(),quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10});const e=()=>{q.current&&q.current.handleResize()};window.addEventListener("resize",e);const t=new MutationObserver((()=>{q.current&&q.current.setParameters({backgroundColor:Oe()})}));return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{window.removeEventListener("resize",e),t.disconnect(),q.current&&q.current.dispose()}}),[]);const Pe=e=>{const t=[/Energy\s*=\s*(-?\d+\.?\d*)/i,/E\s*=\s*(-?\d+\.?\d*)/i,/energy:\s*(-?\d+\.?\d*)/i];for(const a of t){const t=e.match(a);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null},$e=e=>e.includes("cm\u207b\xb9")||e.includes("cm-1")||e.toLowerCase().includes("mode")||e.includes("Frame=")?null:e.toUpperCase().includes("ORCA")?(e=>{if(e.toUpperCase().includes("ORCA")){const t=e.match(/E\s+(-?\d+\.?\d*)/i);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null})(e):e.includes("Energy=")||e.includes("E=")||e.includes("energy:")||e.includes("Lattice=")?Pe(e):null,He=e=>{const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const a=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==a.length)return null;const r=a[0],n=a[1],s=a[2],l=a[3],c=a[4],i=a[5],o=a[6],u=a[7],d=a[8],m=Math.sqrt(r*r+n*n+s*s),p=Math.sqrt(l*l+c*c+i*i),h=Math.sqrt(o*o+u*u+d*d),f=180*Math.acos((l*o+c*u+i*d)/(p*h))/Math.PI,j=180*Math.acos((r*o+n*u+s*d)/(m*h))/Math.PI,y=180*Math.acos((r*l+n*c+s*i)/(m*p))/Math.PI,g=f*Math.PI/180,x=j*Math.PI/180,v=y*Math.PI/180,N=Math.cos(g),b=Math.cos(x),C=Math.cos(v);return m*p*h*Math.sqrt(1+2*N*b*C-N*N-b*b-C*C)},Ve=e=>{const t=e.trim().split("\n"),a=[],r=[],n=[],s=[];let l=!1,c=0;for(;c<t.length;){const e=parseInt(t[c]);if(isNaN(e)){c++;continue}const i=t.slice(c,c+e+2);a.push(i.join("\n"));const o=t[c+1]||"";n.push(o);const u=$e(o);r.push(u);const d=He(o);s.push(d),o.includes("Lattice=")&&(l=!0),c+=e+2}je(r),ge(n),ke(s),Se(l);const i=r.filter((e=>null!==e));return i.length>0?ve(Math.min(...i)):ve(null),{frames:a,comments:n,hasLattice:l}},Be=async(e,t=[],a=!1)=>{if(q.current){K(!0),ee("");try{q.current.removeAllComponents(),G.current=null,J.current=null;const r=$.convertFramesToPDB(e,U),n=new Blob([r],{type:"text/plain"}),s=await q.current.loadFile(n,{ext:"pdb",name:U,asTrajectory:!0});Z.current=s,ne(e.length),Ue();const l=s.addTrajectory();if(G.current=l,l.trajectory&&l.trajectory.player){const e=l.trajectory.player;J.current=e;const t=Math.round(1e3/ce);e.parameters&&(e.parameters.timeout=t,e.parameters.mode="loop",e.parameters.step=1,e.parameters.direction="forward"),e.signals&&(e.signals.startedRunning&&e.signals.startedRunning.add((()=>{le(!0)})),e.signals.haltedRunning&&e.signals.haltedRunning.add((()=>{le(!1)})))}if(l.trajectory&&l.trajectory.signals&&l.trajectory.signals.frameChanged&&l.trajectory.signals.frameChanged.add((e=>{ae(e)})),q.current.autoView(),console.log("Trajectory loaded. latticeDetected:",a,"comments.length:",t.length),a&&t.length>0){console.log("Creating CustomUnitCellRepresentation...");const e=new E(s,q.current);e.setFrameUnitcells(t),Ee(e),Se(!0),console.log("CustomUnitCellRepresentation created:",e)}else console.log("Not creating unit cell: latticeDetected =",a,"comments =",t.length),Se(!1);z&&J.current&&setTimeout((()=>J.current.play()),500),K(!1)}catch(r){console.error("Error loading trajectory:",r),ee(`Failed to load trajectory: ${r.message}`),K(!1)}}},Ue=()=>{if(!Z.current)return;Z.current.removeAllRepresentations();const e={colorScheme:pe,sele:de?"all":"not hydrogen"};switch(oe){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0}Z.current.addRepresentation(oe,e),q.current?.autoView()},ze=e=>1===_e&&1===Te&&1===we?e:e.map((e=>{const t=e.trim().split("\n"),a=parseInt(t[0]),r=t[1]||"",n=r.match(/Lattice="([^"]+)"/);if(!n)return e;const s=n[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==s.length)return e;const l=[s[0],s[1],s[2]],c=[s[3],s[4],s[5]],i=[s[6],s[7],s[8]],o=[];for(let p=0;p<a;p++){const e=t[p+2].trim().split(/\s+/);o.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const u=[];for(let p=0;p<_e;p++)for(let e=0;e<Te;e++)for(let t=0;t<we;t++){const a=[p*l[0]+e*c[0]+t*i[0],p*l[1]+e*c[1]+t*i[1],p*l[2]+e*c[2]+t*i[2]];o.forEach((e=>{u.push({element:e.element,x:e.x+a[0],y:e.y+a[1],z:e.z+a[2]})}))}const d=[u.length.toString()],m=r.replace(/Lattice="([^"]+)"/,((e,t)=>`Lattice="${[l[0]*_e,l[1]*_e,l[2]*_e,c[0]*Te,c[1]*Te,c[2]*Te,i[0]*we,i[1]*we,i[2]*we].join(" ")}"`));return d.push(m),u.forEach((e=>{d.push(`${e.element}  ${e.x.toFixed(6)}  ${e.y.toFixed(6)}  ${e.z.toFixed(6)}`)})),d.join("\n")})),Xe=()=>{De&&Ce&&(Fe?(De.updateFrame(te),De.setVisible(!0)):De.setVisible(!1))};(0,r.useEffect)((()=>{const r=()=>{if(J.current)if("function"==typeof J.current.pause)try{J.current.pause()}catch(e){}else J.current.intervalId&&clearInterval(J.current.intervalId);le(!1)};if((a||V)&&(H||B||P(a?O(a.name):V?O(V):""))){r();const e=a||V,t=H||B;setTimeout((()=>(async(e,t)=>{if(q.current){K(!0),ee("");try{let a;if(q.current.removeAllComponents(),G.current=null,J.current=null,"string"==typeof e)a=await q.current.loadFile(e,{name:U});else{const t=O(e.name);a=await q.current.loadFile(e,{ext:t,name:U})}if(Z.current=a,Ue(),t){let e;if("string"==typeof t)e=await n.un(t);else{const a=URL.createObjectURL(t);try{e=await n.un(a,{ext:O(t.name)})}finally{URL.revokeObjectURL(a)}}const r=a.addTrajectory(e);if(G.current=r,r.trajectory&&r.trajectory.player){const e=r.trajectory.player;J.current=e;const t=Math.round(1e3/ce);e.parameters&&(e.parameters.timeout=t,e.parameters.mode="loop",e.parameters.step=1,e.parameters.direction="forward"),e.signals&&(e.signals.startedRunning&&e.signals.startedRunning.add((()=>{le(!0)})),e.signals.haltedRunning&&e.signals.haltedRunning.add((()=>{le(!1)})))}r.trajectory&&r.trajectory.signals&&r.trajectory.signals.frameChanged&&r.trajectory.signals.frameChanged.add((e=>{ae(e)})),e&&void 0!==e.frameCount?ne(e.frameCount):r.trajectory&&void 0!==r.trajectory.frameCount&&ne(r.trajectory.frameCount)}else if(P(O("string"==typeof e?e:e.name))){const e=a.addTrajectory();if(G.current=e,e.trajectory&&e.trajectory.player){const t=e.trajectory.player;J.current=t;const a=Math.round(1e3/ce);t.parameters&&(t.parameters.timeout=a,t.parameters.mode="loop",t.parameters.step=1,t.parameters.direction="forward"),t.signals&&(t.signals.startedRunning&&t.signals.startedRunning.add((()=>{le(!0)})),t.signals.haltedRunning&&t.signals.haltedRunning.add((()=>{le(!1)})))}e.trajectory&&e.trajectory.signals&&e.trajectory.signals.frameChanged&&e.trajectory.signals.frameChanged.add((e=>{ae(e)})),a.structure&&a.structure.modelStore&&void 0!==a.structure.modelStore.count&&ne(a.structure.modelStore.count)}q.current.autoView(),z&&J.current&&re>1&&setTimeout((()=>{J.current&&"function"==typeof J.current.play&&J.current.play()}),500),K(!1)}catch(a){console.error("Error loading trajectory:",a),ee(`Failed to load trajectory: ${a.message}`),K(!1)}}})(e,t)),50)}else if(e){const t=Ve(e);if(t.frames.length>0){r();const e=ze(t.frames);setTimeout((()=>Be(e,t.comments,t.hasLattice)),50)}}else if(t&&t.length>0){r();const e=t.join("\n\n"),a=Ve(e),n=ze(a.frames);setTimeout((()=>Be(n,a.comments,a.hasLattice)),50)}return r}),[e,t,a,H,V,B,_e,Te,we]),(0,r.useEffect)((()=>{Ue()}),[oe,de,pe]),(0,r.useEffect)((()=>{Fe?Xe():De&&De.remove()}),[Fe,_e,Te,we,Ce,De]),(0,r.useEffect)((()=>{Fe&&Ce&&Xe()}),[te,Fe,Ce,De]);const Ye=()=>{if(J.current&&"function"==typeof J.current.play)J.current.play();else if(G.current&&G.current.trajectory&&re>1){le(!0);let e=te;const t=setInterval((()=>{try{G.current&&G.current.trajectory?(e=(e+1)%re,G.current.trajectory.setFrame(e),ae(e)):(clearInterval(t),le(!1))}catch(a){console.warn("Trajectory disposed during playback, stopping:",a.message),clearInterval(t),le(!1)}}),Math.round(1e3/ce));J.current={intervalId:t}}},qe=()=>{J.current&&("function"==typeof J.current.pause?J.current.pause():J.current.intervalId&&(clearInterval(J.current.intervalId),J.current=null)),le(!1)},Ze=e=>{try{G.current&&G.current.trajectory&&G.current.trajectory.setFrame(e)}catch(t){console.warn("Cannot set frame on disposed trajectory:",t.message)}};return(0,r.useEffect)((()=>{const e=e=>{if(!(re<=1||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement))switch(e.code){case"Space":e.preventDefault(),se?qe():Ye();break;case"ArrowLeft":e.preventDefault(),Ze(Math.max(0,te-1));break;case"ArrowRight":e.preventDefault(),Ze(Math.min(re-1,te+1));break;case"Home":e.preventDefault(),Ze(0);break;case"End":e.preventDefault(),Ze(re-1)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[re,te,se]),(0,D.jsxs)("div",{className:s,children:[(0,D.jsxs)("div",{className:l,children:[(0,D.jsx)("h4",{children:U}),(0,D.jsxs)("div",{className:c,children:[(0,D.jsx)("button",{onClick:()=>be(!Ne),className:i,title:"Toggle display options",children:"Options"}),(0,D.jsx)("button",{onClick:()=>{q.current&&q.current.autoView(1e3)},className:i,children:"Reset View"}),(0,D.jsx)("button",{onClick:()=>{q.current&&q.current.toggleFullscreen(Y.current)},className:i,children:"Fullscreen"})]})]}),(0,D.jsxs)("div",{className:o,ref:Y,children:[W&&(0,D.jsx)("div",{className:u,children:(0,D.jsx)("div",{className:m,children:"Loading trajectory..."})}),Q&&(0,D.jsx)("div",{className:d,children:(0,D.jsx)("div",{className:p,children:Q})}),re>0&&(0,D.jsxs)("div",{className:h,children:[(0,D.jsxs)("div",{className:f,children:["Frame ",te+1,"/",re]}),ye[te]&&(0,D.jsx)("div",{className:j,children:ye[te]}),null!==fe[te]&&void 0!==fe[te]&&null!==xe&&(0,D.jsx)("div",{className:y,children:(()=>{const e=fe[te]-xe;return`${e>=0?"+":""}${(2625.5*e).toFixed(2)} kJ/mol`})()}),null!==Re[te]&&void 0!==Re[te]&&(0,D.jsxs)("div",{className:g,children:["Volume: ",Re[te].toFixed(2)," \xc5\xb3"]})]}),Ne&&(0,D.jsx)("div",{className:x,children:(0,D.jsxs)("div",{className:v,children:[(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("label",{className:b,children:"Style:"}),(0,D.jsxs)("select",{value:oe,onChange:e=>ue(e.target.value),className:C,children:[(0,D.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,D.jsx)("option",{value:"line",children:"Line"}),(0,D.jsx)("option",{value:"spacefill",children:"Spacefill"}),(0,D.jsx)("option",{value:"licorice",children:"Licorice"}),(0,D.jsx)("option",{value:"cartoon",children:"Cartoon"})]})]}),(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("label",{className:b,children:"Color:"}),(0,D.jsxs)("select",{value:pe,onChange:e=>he(e.target.value),className:C,children:[(0,D.jsx)("option",{value:"element",children:"Element"}),(0,D.jsx)("option",{value:"chainname",children:"Chain"}),(0,D.jsx)("option",{value:"residueindex",children:"Residue"}),(0,D.jsx)("option",{value:"bfactor",children:"B-factor"})]})]}),(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("input",{type:"checkbox",checked:de,onChange:e=>me(e.target.checked),id:"showH-overlay",className:S}),(0,D.jsx)("label",{htmlFor:"showH-overlay",className:b,children:"Show Hydrogens"})]}),(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("label",{className:b,children:"FPS:"}),(0,D.jsx)("input",{type:"range",min:"10",max:"60",step:"5",value:ce,onChange:e=>(e=>{if(ie(e),J.current&&J.current.parameters){const t=Math.round(1e3/e);J.current.parameters.timeout=t,se&&"function"==typeof J.current.pause&&"function"==typeof J.current.play&&(J.current.pause(),J.current.play())}})(parseInt(e.target.value)),className:F}),(0,D.jsx)("span",{className:A,children:ce})]}),Ce&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("input",{type:"checkbox",checked:Fe,onChange:e=>Ae(e.target.checked),id:"showUnitCell-overlay",className:S}),(0,D.jsx)("label",{htmlFor:"showUnitCell-overlay",className:b,children:"Show Unit Cell"})]}),Fe&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("label",{className:b,children:"Supercell X:"}),(0,D.jsx)("input",{type:"number",min:"1",max:"5",value:_e,onChange:e=>Me(parseInt(e.target.value)||1),className:_})]}),(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("label",{className:b,children:"Supercell Y:"}),(0,D.jsx)("input",{type:"number",min:"1",max:"5",value:Te,onChange:e=>Le(parseInt(e.target.value)||1),className:_})]}),(0,D.jsxs)("div",{className:N,children:[(0,D.jsx)("label",{className:b,children:"Supercell Z:"}),(0,D.jsx)("input",{type:"number",min:"1",max:"5",value:we,onChange:e=>Ie(parseInt(e.target.value)||1),className:_})]})]})]})]})})]}),re>1&&(0,D.jsx)("div",{className:M,children:(0,D.jsxs)("div",{className:T,children:[(0,D.jsxs)("div",{className:w,children:[(0,D.jsx)("button",{onClick:()=>Ze(Math.max(0,te-1)),className:I,disabled:0===te,title:"Previous frame",children:"\u23ee"}),(0,D.jsx)("button",{onClick:se?qe:Ye,className:`${I} ${R}`,title:se?"Pause":"Play",children:se?"\u23f8":"\u23f5"}),(0,D.jsx)("button",{onClick:()=>Ze(Math.min(re-1,te+1)),className:I,disabled:te===re-1,title:"Next frame",children:"\u23ed"})]}),(0,D.jsx)("div",{className:L,children:(0,D.jsx)("input",{type:"range",min:"0",max:re-1,value:te,onChange:e=>Ze(parseInt(e.target.value)),className:k})})]})})]})}}}]);