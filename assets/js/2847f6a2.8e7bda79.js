"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[3519],{3578:(e,t,s)=>{s.r(t),s.d(t,{default:()=>L});var n=s(6540),a=s(1656);const i="leftColumn_UGQQ",l="rightColumn_y3rk",r="panel_XDw_",o="filesPanel_CmGz",c="scriptPanel_Dt6j",d="outputPanel_mcU0",u="outputFilesPanel_R2M7",m="outputFilesList_RxhV",p="outputFileItem_ebxE",f="outputFileName_m1fX",h="fileUpload_ogCW",g="dragover_scMl",y="fileBadges_ZPwX",b="fileBadge_lKcj",x="selected_ZSOO",j="fileBadgeText_MmMs",k="deleteBtn_Bbnv",v="inputFileHint_oI2_",M="inputScript_YGG3",w="buttonGroup_XO6g",S="status_obbO",N="output_WrLT",C="error_UmX2";var $=s(4848);const _=()=>{const[e,t]=(0,n.useState)(null),[a,_]=(0,n.useState)(!1),[L,E]=(0,n.useState)(!1),[A,F]=(0,n.useState)("Loading LAMMPS..."),[W,P]=(0,n.useState)([]),R="# LAMMPS input script\nunits lj\ndimension 3\natom_style atomic\nlattice fcc 0.8442\nregion box block 0 4 0 4 0 4\ncreate_box 1 box\ncreate_atoms 1 box\nmass 1 1.0\nvelocity all create 1.44 87287 loop geom\npair_style lj/cut 2.5\npair_coeff 1 1 1.0 1.0 2.5\nneighbor 0.3 bin\nneigh_modify delay 0 every 20 check no\nfix 1 all nve\nthermo 100\ndump 1 all xyz 50 trajectory.xyz\nrun 1000\nundump 1",[D,z]=(0,n.useState)(R),[U,O]=(0,n.useState)(new Map),[T,B]=(0,n.useState)(""),[G,X]=(0,n.useState)(!1),[V,I]=(0,n.useState)([]),[H,K]=(0,n.useState)(!1),Q=(0,n.useRef)(null),Z=(0,n.useRef)(null);(0,n.useEffect)((()=>(q(),()=>{e&&e.terminate()})),[]),(0,n.useEffect)((()=>()=>{e&&e.terminate()}),[e]),(0,n.useEffect)((()=>{Z.current&&(Z.current.scrollTop=Z.current.scrollHeight)}),[W]),(0,n.useEffect)((()=>{if(!H)if(T&&U.has(T)){const e=U.get(T);if(e){const t=(new TextDecoder).decode(e);z(t)}}else z(R)}),[T,U,R,H]);const q=async()=>{try{J("Creating LAMMPS Web Worker...");const e=new Worker(new URL(s.p+s.u(6685),s.b),{type:void 0});e.onmessage=Y,e.onerror=e=>{J(`Worker error: ${e.message}`,!0),F("Error")},t(e),J("Web Worker created, initializing LAMMPS..."),e.postMessage({type:"init"})}catch(e){J(`Failed to create worker: ${e.message}`,!0),F("Error")}},Y=t=>{const{type:s,data:n}=t.data,a=t.target;switch(console.log("Worker message:",s,n),s){case"ready":if(J(n),U.size>0){J(`Re-uploading ${U.size} file(s) to new worker...`);for(let[t,s]of U){let n=s;if(t===T&&H){n=(new TextEncoder).encode(D).buffer}e?.postMessage({type:"upload-file",data:{name:t,content:n}})}}F("Ready"),_(!0);break;case"stdout":J(n);break;case"stderr":J(n,!0);break;case"completed":J(n.message),J("Checking for output files..."),F("Complete"),E(!1),console.log("Sending list-files request after completion"),setTimeout((()=>{console.log("Actually sending list-files message"),a.postMessage({type:"list-files",data:{}})}),500);break;case"cancelled":J(n),F("Cancelled"),E(!1);break;case"error":J(n,!0),F("Error"),E(!1);break;case"file-uploaded":J("string"==typeof n?n:`Uploaded: ${n.filename} (${n.size} bytes)`);break;case"file-deleted":J("string"==typeof n?n:`Deleted: ${n.filename}`);break;case"file-not-found":J(n.message,!0);break;case"file-list":I(n),0===n.length?J("VFS is empty - no files found"):(J(`VFS contains ${n.length} file(s):`),n.forEach((e=>{e.isDirectory||J(`  \u2192 ${e.name} (${e.size>1024?`${(e.size/1024).toFixed(1)} KB`:`${e.size} B`})`)})),J("Files available in Output Files panel below"));break;case"file-content":const t=new Blob([n.content],{type:"application/octet-stream"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=n.filename,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),J(`Downloaded: ${n.filename} (${n.size} bytes)`)}},J=(e,t=!1)=>{P((s=>[...s,{text:e,isError:t}]))},ee=t=>{const s=new Map(U);let n=0;const i=t.length;J(`Starting upload of ${i} file(s)...`),Array.from(t).forEach((l=>{const r=new FileReader;r.onload=r=>{const o=r.target?.result;s.set(l.name,o),n++,J(`Read file: ${l.name} (${o.byteLength} bytes)`),n===i&&(O(new Map(s)),e&&a?(J(`Sending ${i} file(s) to LAMMPS worker...`),Array.from(t).forEach((t=>{let n=s.get(t.name);if(t.name===T&&H&&n){n=(new TextEncoder).encode(D).buffer}n&&e.postMessage({type:"upload-file",data:{name:t.name,content:n}})}))):J("Worker not ready, files will be uploaded when ready",!0))},r.onerror=()=>{J(`Failed to read file: ${l.name}`,!0),n++},r.readAsArrayBuffer(l)}))},te=Array.from(U.keys()).filter((e=>e.endsWith(".lmp")||e.endsWith(".in")||e.endsWith(".inp")||e.includes("input")));return(0,$.jsx)("div",{className:"container",style:{maxWidth:"none",padding:"1rem"},children:(0,$.jsxs)("div",{className:"row",style:{margin:0},children:[(0,$.jsx)("div",{className:"col col--6",style:{padding:"0 0.5rem 0 0"},children:(0,$.jsxs)("div",{className:i,children:[(0,$.jsxs)("div",{className:`${r} ${o}`,children:[(0,$.jsx)("h3",{children:"Files"}),(0,$.jsxs)("div",{className:`${h} ${G?g:""}`,onDrop:e=>{e.preventDefault(),X(!1),ee(e.dataTransfer.files)},onDragOver:e=>{e.preventDefault(),X(!0)},onDragLeave:()=>{X(!1)},onClick:()=>Q.current?.click(),children:[(0,$.jsx)("div",{children:"Click or drag files here"}),(0,$.jsx)("small",{children:"Upload LAMMPS input files, data files, etc."})]}),(0,$.jsx)("input",{ref:Q,type:"file",multiple:!0,onChange:e=>e.target.files&&ee(e.target.files),style:{display:"none"}}),U.size>0&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{className:y,children:Array.from(U.keys()).map((t=>{const s=t.endsWith(".lmp")||t.endsWith(".in")||t.endsWith(".inp")||t.includes("input"),n=T===t;return(0,$.jsxs)("div",{className:`${b} ${n?x:""}`,onClick:()=>{if(s){B(n?"":t),K(!1)}},style:{cursor:s?"pointer":"default"},title:s?"Click to select as main input file":t,children:[(0,$.jsx)("span",{className:j,children:t}),(0,$.jsx)("button",{className:k,onClick:s=>{s.stopPropagation(),(t=>{const s=new Map(U);s.delete(t),O(s),T===t&&B(""),e&&a&&e.postMessage({type:"delete-file",data:{filename:t}})})(t)},title:"Delete file",children:"\xd7"})]},t)}))}),te.length>0&&(0,$.jsx)("div",{className:v,children:"Click input files above to specify main input file"})]})]}),(0,$.jsxs)("div",{className:`${r} ${c}`,children:[(0,$.jsx)("h3",{children:"LAMMPS Script"}),(0,$.jsx)("textarea",{className:M,value:D,onChange:e=>(e=>{if(z(e),K(!0),T){const t=new Map(U),s=(new TextEncoder).encode(e);t.set(T,s.buffer),O(t)}})(e.target.value),placeholder:"Enter LAMMPS commands here or select an input file above..."}),(0,$.jsxs)("div",{className:w,children:[L?(0,$.jsx)("button",{onClick:()=>{L&&e&&(J("Cancelling simulation and restarting worker...",!0),e.terminate(),t(null),_(!1),E(!1),F("Cancelled - Restarting..."),setTimeout((()=>{q()}),500))},className:"button button--danger",children:"Cancel Run"}):(0,$.jsx)("button",{onClick:()=>{if(a&&e){F("Running..."),E(!0);try{const t=D.trim();if(T){if(H){J(`Uploading edited version of ${T}...`);const t=(new TextEncoder).encode(D);e.postMessage({type:"upload-file",data:{name:T,content:t.buffer}})}e.postMessage({type:"run-lammps",data:{inputFile:T}})}else{if(!t)throw new Error("No input provided! Either select a main input file or enter commands in the textarea.");e.postMessage({type:"run-lammps",data:{inputContent:t,inputFile:"input.lmp"}})}}catch(t){J(`Error: ${t.message}`,!0),F("Error"),E(!1)}}else J("LAMMPS worker not ready yet!",!0)},disabled:!a,className:"button button--primary",children:"Run LAMMPS"}),(0,$.jsx)("button",{onClick:()=>{P([])},className:"button button--secondary",children:"Clear Output"}),(0,$.jsx)("button",{onClick:()=>{a&&e?e.postMessage({type:"list-files",data:{}}):J("Worker not ready yet!",!0)},disabled:!a,className:"button button--secondary",children:"List VFS Files"})]}),(0,$.jsxs)("div",{className:S,children:["Status: ",A]})]})]})}),(0,$.jsx)("div",{className:"col col--6",style:{padding:"0 0 0 0.5rem"},children:(0,$.jsxs)("div",{className:l,children:[(0,$.jsxs)("div",{className:`${r} ${d}`,children:[(0,$.jsx)("h3",{children:"Output"}),(0,$.jsx)("div",{ref:Z,className:N,children:0===W.length?"Waiting for LAMMPS to initialize...":W.map(((e,t)=>(0,$.jsx)("div",{className:e.isError?C:"",children:e.text},t)))})]}),V.length>0&&(0,$.jsxs)("div",{className:u,children:[(0,$.jsx)("h3",{children:"Output Files"}),(0,$.jsx)("div",{className:m,children:V.filter((e=>!e.isDirectory)).map((t=>(0,$.jsxs)("div",{className:p,children:[(0,$.jsx)("span",{className:f,children:t.name}),(0,$.jsx)("button",{className:"button button--primary button--sm",onClick:()=>{return s=t.name,void(a&&e?(J(`Downloading ${s}...`),e.postMessage({type:"get-file",data:{filename:s}})):J("Worker not ready yet!",!0));var s},disabled:!a,children:"Download"})]},t.name)))})]})]})})]})})};function L(){return(0,$.jsx)(a.A,{title:"LAMMPS Interface",description:"Run LAMMPS molecular dynamics simulations in your browser",wrapperClassName:"layout-wrapper--full-height",children:(0,$.jsx)("div",{className:"container-fluid",style:{height:"100%",padding:"1rem"},children:(0,$.jsx)(_,{})})})}}}]);