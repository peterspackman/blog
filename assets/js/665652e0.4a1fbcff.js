"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1288],{1230:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ma});var s=a(6540),r=a(1656);const n="container_Qh_B",l="layout_SyMw",i="sidebar_Cwvp",o="content_ak_G",c="tabs_tRXw",d="tab_F12w",u="tabContent_hF_7",m="collapsibleSection_Nmyk",h="sectionHeader_qShV",p="sectionTitle_aNil",x="chevron_b8vT",j="sectionContent_NPTV",v="chevronExpanded_ry9E",g="status_l6dK",f="statusLoading_AJab",y="statusReady_FVt8",b="moleculeInfo_KKVy",N="button_XSDO",C="scrollableContent_ikhb",_="stickyButtons_GEQA",S="buttonPrimary_eux_",$="buttonDanger_gLI_",F="tabActive_fzT3",w="propertiesTab_ipsn",M="structureTab_HvbL",k="noStructure_y5fR",E="matricesSection_omrz",z="noMatrices_bajq",L="orbitalsCard_tkcK",O="orbitalGrid_Wtwa",T="moreOrbitals_oRmJ",I="errorModal_HssV",R="errorContent_nEMj",D="optimizationTab_sFuH",q="optimizationSummary_Qbys",H="optimizationHeader_o9LX",V="summaryGrid_miSr",A="summaryItem_TeDs",P="summaryLabel_ItYF",B="summaryValue_eJ3Z",U="converged_TVV4",X="notConverged_zYdK",Y="trajectoryViewerContainer_y8Ak",Z="optimizationLayout_h32e",G="trajectoryViewerSection_ZNX4",W="trajectoryControlsPanel_mPQs",K="trajectoryControlsHeader_NJya",J="trajectoryModeSection_Fa3j",Q="modeButton_mefH",ee="active_TuRi",te="frequenciesControlSection_yYHA",ae="frequenciesSectionHeader_PauO",se="frequencySettings_wwcQ",re="checkboxLabel_yHfy",ne="checkbox_PB7n",le="modesList_XfUU",ie="modeItem_NeQD",oe="modeSelected_GfpX",ce="modeSelectedIndicator_koJh",de="modeInfo_QcHf",ue="modeNumber_aQX4",me="modeValue_Thd_",he="imaginaryBadge_edwd",pe="frequencySummary_MO4Z",xe="section_X2kF",je="exampleSection_iMDs",ve="exampleLabel__wK2",ge="exampleSelect_VuLc",fe="inputContainer_aHUj",ye="headerRow_MA_E",be="label_1fak",Ne="controls_Azqc",Ce="browseButton_eNgL",_e="combinedInput_AOvI",Se="dragging_F5j2",$e="valid_peYL",Fe="invalid_Yt4V",we="clearButton_KExK",Me="xyzTextarea_Jaou",ke="errorMessage_OUge";var Ee=a(4848);const ze={formaldehyde:{name:"Formaldehyde (CH\u2082O)",xyz:"4\nFormaldehyde\nH  1.0686 -0.1411  1.0408\nC  0.5979  0.0151  0.0688\nH  1.2687  0.2002 -0.7717\nO -0.5960 -0.0151 -0.0686"},water:{name:"Water (H\u2082O)",xyz:"3\nWater molecule\nO  0.000000  0.000000  0.000000\nH  0.757000  0.586000  0.000000\nH -0.757000  0.586000  0.000000"},urea:{name:"Urea (CH\u2084N\u2082O)",xyz:"8\nUrea molecule\nC  0.000000  0.000000  0.000000\nO  0.000000  1.220000  0.000000\nN  1.150000 -0.610000  0.000000\nN -1.150000 -0.610000  0.000000\nH  1.150000 -1.610000  0.000000\nH  2.050000 -0.110000  0.000000\nH -1.150000 -1.610000  0.000000\nH -2.050000 -0.110000  0.000000"},formamide:{name:"Formamide (CH\u2083NO)",xyz:"6\nFormamide molecule\nC  0.000000  0.000000  0.000000\nO  1.220000  0.000000  0.000000\nN -0.610000  1.150000  0.000000\nH -0.610000 -0.950000  0.000000\nH -1.610000  1.150000  0.000000\nH -0.110000  2.050000  0.000000"},methane:{name:"Methane (CH\u2084)",xyz:"5\nMethane molecule\nC  0.000000  0.000000  0.000000\nH  0.629000  0.629000  0.629000\nH -0.629000 -0.629000  0.629000\nH -0.629000  0.629000 -0.629000\nH  0.629000 -0.629000 -0.629000"},ammonia:{name:"Ammonia (NH\u2083)",xyz:"4\nAmmonia molecule\nN  0.000000  0.000000  0.000000\nH  0.000000  0.950000  0.330000\nH  0.820000 -0.480000  0.330000\nH -0.820000 -0.480000  0.330000"},ethylene:{name:"Ethylene (C\u2082H\u2084)",xyz:"6\nEthylene molecule\nC  0.000000  0.000000  0.668000\nC  0.000000  0.000000 -0.668000\nH  0.000000  0.923000  1.232000\nH  0.000000 -0.923000  1.232000\nH  0.000000  0.923000 -1.232000\nH  0.000000 -0.923000 -1.232000"}},Le=({onFileLoad:e,onValidationChange:t})=>{const[a,r]=(0,s.useState)(""),[n,l]=(0,s.useState)(""),[i,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)("formaldehyde"),[u,m]=(0,s.useState)(!0),[h,p]=(0,s.useState)(""),x=(0,s.useRef)(null),j=(0,s.useRef)(null),v=e=>{try{const t=e.trim().split("\n");if(t.length<3)return{isValid:!1,error:"XYZ file must have at least 3 lines"};const a=parseInt(t[0]);if(isNaN(a)||a<=0)return{isValid:!1,error:"First line must be a positive integer (number of atoms)"};const s=t.slice(2);if(s.length<a)return{isValid:!1,error:`Expected ${a} atom lines, but found ${s.length}`};for(let e=0;e<a;e++){const t=s[e];if(!t||!t.trim())return{isValid:!1,error:`Line ${e+3}: Empty atom line`};const a=t.trim().split(/\s+/);if(a.length<4)return{isValid:!1,error:`Line ${e+3}: Expected element symbol and 3 coordinates`};const r=a[0];if(!/^[A-Z][a-z]?$/.test(r))return{isValid:!1,error:`Line ${e+3}: Invalid element symbol format '${r}'`};for(let s=1;s<=3;s++){const t=parseFloat(a[s]);if(isNaN(t))return{isValid:!1,error:`Line ${e+3}: Invalid coordinate '${a[s]}'`}}}return{isValid:!0}}catch(t){return{isValid:!1,error:"Failed to parse XYZ format: "+t.message}}};(0,s.useEffect)((()=>{const a=ze.formaldehyde;l(a.xyz),r(""),d("formaldehyde"),m(!0),p(""),e(a.xyz),t&&t(!0)}),[]),(0,s.useEffect)((()=>()=>{j.current&&clearTimeout(j.current)}),[]);const g=async a=>{const s=a.name.split(".").pop()?.toLowerCase();if("xyz"===s){r(a.name);try{const s=await a.text();l(s);const r=v(s);m(r.isValid),p(r.error||""),r.isValid&&e(s),t&&t(r.isValid,r.error)}catch(n){console.error("Error reading file:",n),alert("Failed to read file: "+n.message)}}else alert("Please upload an XYZ file.")};return(0,Ee.jsxs)("div",{className:xe,children:[(0,Ee.jsxs)("div",{className:je,children:[(0,Ee.jsx)("label",{className:ve,children:"Example Molecules"}),(0,Ee.jsxs)("select",{value:c,onChange:a=>{const s=a.target.value;if(s&&ze[s]){const a=ze[s];l(a.xyz),r(""),d(s),m(!0),p(""),e(a.xyz),t&&t(!0),x.current&&(x.current.value="")}},className:ge,children:[(0,Ee.jsx)("option",{value:"",children:"Select an example..."}),Object.entries(ze).map((([e,t])=>(0,Ee.jsx)("option",{value:e,children:t.name},e)))]})]}),(0,Ee.jsxs)("div",{className:fe,children:[(0,Ee.jsxs)("div",{className:ye,children:[(0,Ee.jsx)("span",{className:be,children:"XYZ Coordinates"}),(0,Ee.jsxs)("div",{className:Ne,children:[(0,Ee.jsx)("button",{onClick:e=>{e.stopPropagation(),x.current?.click()},className:Ce,children:"Browse"}),(a||n)&&(0,Ee.jsx)("button",{onClick:()=>{r(""),l(""),d(""),m(!0),p(""),t&&t(!0),x.current&&(x.current.value="")},className:we,children:"Clear"})]})]}),(0,Ee.jsxs)("div",{className:`${_e} ${i?Se:""} ${u?n.trim()?$e:"":Fe}`,onDrop:e=>{e.preventDefault(),o(!1);const t=e.dataTransfer.files[0];t&&g(t)},onDragOver:e=>{e.preventDefault(),o(!0)},onDragLeave:()=>{o(!1)},children:[(0,Ee.jsx)("textarea",{value:n,onChange:a=>{const s=a.target.value;l(s),r(""),d(""),j.current&&clearTimeout(j.current),j.current=setTimeout((()=>{if(s.trim()){const a=v(s);m(a.isValid),p(a.error||""),a.isValid&&e(s),t&&t(a.isValid,a.error)}else m(!0),p(""),t&&t(!0)}),300)},placeholder:a?`Loaded: ${a}`:"Select an example molecule above or drag & drop XYZ file here",rows:8,className:Me}),(0,Ee.jsx)("input",{ref:x,type:"file",accept:".xyz",onChange:e=>{const t=e.target.files?.[0];t&&g(t)},style:{display:"none"}})]}),!u&&h&&(0,Ee.jsx)("div",{className:ke,children:h})]})]})},Oe="section_H6hy",Te="field_rd2A",Ie="checkboxLabel_PBvi",Re="disabled_hTIz",De="fieldDescription_BWzj",qe=({method:e,setMethod:t,basisSet:a,setBasisSet:s,maxIterations:r,setMaxIterations:n,energyTolerance:l,setEnergyTolerance:i,logLevel:o,setLogLevel:c,optimize:d,setOptimize:u,computeFrequencies:m,setComputeFrequencies:h,charge:p,setCharge:x,threads:j,setThreads:v})=>(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:Oe,children:[(0,Ee.jsx)("h3",{children:"Calculation Method"}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsx)("label",{children:"Theory Level"}),(0,Ee.jsxs)("select",{value:e,onChange:e=>t(e.target.value),children:[(0,Ee.jsx)("option",{value:"hf",children:"Hartree-Fock (HF)"}),(0,Ee.jsx)("option",{value:"dft-b3lyp",children:"DFT (B3LYP)"}),(0,Ee.jsx)("option",{value:"dft-pbe",children:"DFT (PBE)"}),(0,Ee.jsx)("option",{value:"dft-pbe0",children:"DFT (PBE0)"}),(0,Ee.jsx)("option",{value:"dft-blyp",children:"DFT (BLYP)"}),(0,Ee.jsx)("option",{value:"dft-wb97x",children:"DFT (\u03c9B97X)"})]})]}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsx)("label",{children:"Basis Set"}),(0,Ee.jsxs)("select",{value:a,onChange:e=>s(e.target.value),children:[(0,Ee.jsx)("option",{value:"sto-3g",children:"STO-3G"}),(0,Ee.jsx)("option",{value:"3-21g",children:"3-21G"}),(0,Ee.jsx)("option",{value:"6-31g",children:"6-31G"}),(0,Ee.jsx)("option",{value:"6-31g(d,p)",children:"6-31G(d,p)"}),(0,Ee.jsx)("option",{value:"6-311g(d,p)",children:"6-311G(d,p)"}),(0,Ee.jsx)("option",{value:"def2-svp",children:"def2-SVP"}),(0,Ee.jsx)("option",{value:"def2-tzvp",children:"def2-TZVP"}),(0,Ee.jsx)("option",{value:"cc-pvdz",children:"cc-pVDZ"}),(0,Ee.jsx)("option",{value:"cc-pvtz",children:"cc-pVTZ"}),(0,Ee.jsx)("option",{value:"cc-pvqz",children:"cc-pVQZ"}),(0,Ee.jsx)("option",{value:"pcseg-0",children:"pc-0"}),(0,Ee.jsx)("option",{value:"pcseg-1",children:"pc-1"}),(0,Ee.jsx)("option",{value:"pcseg-2",children:"pc-2"}),(0,Ee.jsx)("option",{value:"pcseg-3",children:"pc-3"}),(0,Ee.jsx)("option",{value:"aug-pcseg-1",children:"aug-pc-1"}),(0,Ee.jsx)("option",{value:"aug-pcseg-2",children:"aug-pc-2"})]})]}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsx)("label",{children:"Molecular Charge"}),(0,Ee.jsx)("input",{type:"number",min:"-5",max:"5",step:"1",value:p,onChange:e=>x(parseInt(e.target.value)||0)}),(0,Ee.jsx)("small",{className:De,children:"Net charge on the molecule (restricted to even electron counts)"})]})]}),(0,Ee.jsxs)("div",{className:Oe,children:[(0,Ee.jsx)("h3",{children:"Calculation Options"}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsxs)("label",{className:Ie,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:d,onChange:e=>u(e.target.checked)}),(0,Ee.jsx)("span",{children:"Geometry Optimization"})]}),(0,Ee.jsx)("small",{className:De,children:"Optimize molecular geometry to find minimum energy structure"})]}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsxs)("label",{className:`${Ie} ${d?"":Re}`,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:m,onChange:e=>h(e.target.checked),disabled:!d}),(0,Ee.jsx)("span",{children:"Vibrational Frequencies"})]}),(0,Ee.jsx)("small",{className:De,children:"Calculate vibrational frequencies after optimization (requires optimization)"})]})]}),(0,Ee.jsxs)("div",{className:Oe,children:[(0,Ee.jsx)("h3",{children:"SCF Settings"}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsx)("label",{children:"Max Iterations"}),(0,Ee.jsx)("input",{type:"number",min:"10",max:"500",value:r,onChange:e=>n(parseInt(e.target.value))})]}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsx)("label",{children:"Energy Tolerance"}),(0,Ee.jsxs)("select",{value:l.toString(),onChange:e=>i(parseFloat(e.target.value)),children:[(0,Ee.jsx)("option",{value:"1e-6",children:"1e-6"}),(0,Ee.jsx)("option",{value:"1e-7",children:"1e-7"}),(0,Ee.jsx)("option",{value:"1e-8",children:"1e-8"}),(0,Ee.jsx)("option",{value:"1e-9",children:"1e-9"}),(0,Ee.jsx)("option",{value:"1e-10",children:"1e-10"})]})]}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsx)("label",{children:"Log Level"}),(0,Ee.jsxs)("select",{value:o,onChange:e=>c(parseInt(e.target.value)),children:[(0,Ee.jsx)("option",{value:"0",children:"Trace"}),(0,Ee.jsx)("option",{value:"1",children:"Debug"}),(0,Ee.jsx)("option",{value:"2",children:"Info"}),(0,Ee.jsx)("option",{value:"3",children:"Warning"}),(0,Ee.jsx)("option",{value:"4",children:"Error"}),(0,Ee.jsx)("option",{value:"5",children:"Critical"})]})]}),(0,Ee.jsxs)("div",{className:Te,children:[(0,Ee.jsx)("label",{children:"Number of Threads"}),(0,Ee.jsx)("input",{type:"number",min:"1",max:"16",value:j,onChange:e=>v(parseInt(e.target.value)||1)}),(0,Ee.jsx)("small",{className:De,children:"Number of parallel threads to use for calculations"})]})]})]}),He="container_R89I",Ve="summaryGrid_ag2i",Ae="energyCard_YXOX",Pe="statusCard_RoU8",Be="propertiesCard_AHmH",Ue="primaryEnergy_Xokq",Xe="secondaryEnergy_Gl5x",Ye="propertyItem_grVF",Ze="exportSection_Tufw",Ge="exportButtons_Op6D",We="exportButton_Xvg9",Ke="energyValues_pzt_",Je="statusInfo_hd1b",Qe="convergenceStatus_AYcc",et="converged_xwWE",tt="notConverged_Y8IO",at="timing_HvIZ",st="propertyList_aAAD",rt="propertyLabel_Acxr",nt="propertyValue_OR5o",lt="exportButtonDisabled_HPmD",it="noResults_jWfa",ot="optimizationInfo_faKG",ct="infoItem_rXyy",dt=({results:e})=>{if(!e)return(0,Ee.jsxs)("div",{className:it,children:[(0,Ee.jsx)("h3",{children:"No Results Yet"}),(0,Ee.jsx)("p",{children:"Run a calculation to see results here."})]});const t=t=>{if(!e.wavefunctionData)return;let a,s,r;switch(t){case"fchk":if(!e.wavefunctionData.fchk)return void alert("FCHK data not available.");a=e.wavefunctionData.fchk,s="wavefunction.fchk",r="text/plain";break;case"json":a=JSON.stringify({energy:e.energy,energyInEV:e.energyInEV,properties:e.properties,numBasisFunctions:e.wavefunctionData.numBasisFunctions,numAtoms:e.wavefunctionData.numAtoms,calculationTime:e.elapsedMs},null,2),s="wavefunction.json",r="application/json"}const n=new Blob([a],{type:r}),l=URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.download=s,i.click(),URL.revokeObjectURL(l)};return(0,Ee.jsxs)("div",{className:He,children:[(0,Ee.jsxs)("div",{className:Ve,children:[(0,Ee.jsxs)("div",{className:Ae,children:[(0,Ee.jsx)("h4",{children:"Total Energy"}),(0,Ee.jsxs)("div",{className:Ke,children:[(0,Ee.jsxs)("div",{className:Ue,children:[e.energy.toFixed(8)," Eh"]}),(0,Ee.jsxs)("div",{className:Xe,children:[e.energyInEV.toFixed(6)," eV"]})]})]}),(0,Ee.jsxs)("div",{className:Pe,children:[(0,Ee.jsx)("h4",{children:"Status"}),(0,Ee.jsxs)("div",{className:Je,children:[(0,Ee.jsx)("div",{className:`${Qe} ${e.converged?et:tt}`,children:e.converged?"\u2713 Converged":"\u2717 Not Converged"}),(0,Ee.jsx)("div",{className:at,children:(a=e.elapsedMs,`${Math.floor(a/1e3)}s ${Math.round(a%1e3)}ms`)})]})]}),e.properties&&(0,Ee.jsxs)("div",{className:Be,children:[(0,Ee.jsx)("h4",{children:"Key Properties"}),(0,Ee.jsxs)("div",{className:st,children:[void 0!==e.properties.homo&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:rt,children:"HOMO:"}),(0,Ee.jsxs)("span",{className:nt,children:[e.properties.homo.toFixed(6)," Eh"]})]}),void 0!==e.properties.lumo&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:rt,children:"LUMO:"}),(0,Ee.jsxs)("span",{className:nt,children:[e.properties.lumo.toFixed(6)," Eh"]})]}),void 0!==e.properties.gap&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:rt,children:"Gap:"}),(0,Ee.jsxs)("span",{className:nt,children:[e.properties.gap.toFixed(6)," Eh"]})]})]})]})]}),e.wavefunctionData&&(0,Ee.jsxs)("div",{className:Ze,children:[(0,Ee.jsx)("h4",{children:"Export Wavefunction"}),(0,Ee.jsxs)("div",{className:Ge,children:[(0,Ee.jsx)("button",{className:We,onClick:()=>t("json"),children:"\u2193 JSON"}),(0,Ee.jsxs)("button",{className:e.wavefunctionData.fchk?We:`${We} ${lt}`,onClick:()=>e.wavefunctionData.fchk?t("fchk"):alert("FCHK data not available. Check the calculation logs for details."),disabled:!e.wavefunctionData.fchk,title:e.wavefunctionData.fchk?"Download FCHK file":"FCHK generation failed - see logs",children:["\u2193 FCHK ",!e.wavefunctionData.fchk&&"(unavailable)"]})]})]}),e.optimization&&(0,Ee.jsxs)("div",{className:Ze,children:[(0,Ee.jsx)("h4",{children:"Export Optimized Geometry"}),(0,Ee.jsx)("div",{className:Ge,children:(0,Ee.jsx)("button",{className:We,onClick:()=>{if(!e.optimization?.finalXYZ)return;const t=e.optimization.finalXYZ,a=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download="optimized_geometry.xyz",r.click(),URL.revokeObjectURL(s)},title:"Download optimized geometry in XYZ format",children:"\u2193 Optimized XYZ"})}),(0,Ee.jsxs)("div",{className:ot,children:[(0,Ee.jsxs)("div",{className:ct,children:[(0,Ee.jsx)("span",{children:"Status:"}),(0,Ee.jsx)("span",{className:`${Qe} ${e.optimization.trajectory.converged?et:tt}`,children:e.optimization.trajectory.converged?"\u2713 Converged":"\u2717 Not Converged"})]}),(0,Ee.jsxs)("div",{className:ct,children:[(0,Ee.jsx)("span",{children:"Steps:"}),(0,Ee.jsx)("span",{children:e.optimization.steps})]}),(0,Ee.jsxs)("div",{className:ct,children:[(0,Ee.jsx)("span",{children:"Final Energy:"}),(0,Ee.jsxs)("span",{children:[e.energy.toFixed(8)," Eh"]})]})]})]})]});var a},ut={container:"container_BYXD",header:"header_RGzB",controls:"controls_Rvup",button:"button_YEOU",buttonActive:"buttonActive_nb5D",logOutput:"logOutput_RpAa",noLogs:"noLogs_oYTM",logEntry:"logEntry_Oa3L",timestamp:"timestamp__Tyr",message:"message_A8Nt","log-debug":"log-debug_cHxc","log-info":"log-info_Lwm5","log-warn":"log-warn_SwuY","log-error":"log-error_TdP2"},mt=({logs:e})=>{const[t,a]=(0,s.useState)(!0),r=(0,s.useRef)(null);(0,s.useEffect)((()=>{t&&r.current&&(r.current.scrollTop=r.current.scrollHeight)}),[e,t]);return(0,Ee.jsxs)("div",{className:ut.container,children:[(0,Ee.jsxs)("div",{className:ut.header,children:[(0,Ee.jsx)("h3",{children:"Calculation Output"}),(0,Ee.jsx)("div",{className:ut.controls,children:(0,Ee.jsx)("button",{className:`${ut.button} ${t?ut.buttonActive:""}`,onClick:()=>a(!t),children:t?"Auto-scroll ON":"Auto-scroll OFF"})})]}),(0,Ee.jsx)("div",{ref:r,className:ut.logOutput,children:0===e.length?(0,Ee.jsx)("div",{className:ut.noLogs,children:"No output yet. Run a calculation to see logs."}):e.map(((e,t)=>{return(0,Ee.jsxs)("div",{className:`${ut.logEntry} ${ut[`log-${e.level}`]}`,children:[(0,Ee.jsxs)("span",{className:ut.timestamp,children:["[",(a=e.timestamp,a.toLocaleTimeString()),"]"]}),(0,Ee.jsx)("span",{className:ut.message,children:e.message})]},t);var a}))})]})},ht="matrixContainer__RiK",pt="header_t7QL",xt="controls_sj24",jt="dimensions_G9Ce",vt="toggleButton_ziSy",gt="downloadButton_yZ_5",ft="matrixWrapper_lIP_",yt="matrix_UPd_",bt="matrixElement_jLaA",Nt="infoContent_XCc5",Ct="fullMatrix_FIje",_t="zeroElement_VjgC",St="truncationNotice_Npk0",$t="matrixInfo_AD0u",Ft="infoToggle_sbWR",wt=({matrix:e,title:t,precision:a=6,maxDisplaySize:r=8})=>{const[n,l]=(0,s.useState)(!1),[i,o]=(0,s.useState)(!1);if(!e||!e.data)return(0,Ee.jsxs)("div",{className:ht,children:[(0,Ee.jsx)("h4",{children:t}),(0,Ee.jsx)("p",{children:"Matrix data not available"})]});const{rows:c,cols:d,data:u}=e,m=c>r||d>r,h=i?c:Math.min(c,r),p=i?d:Math.min(d,r),x=e=>Math.abs(e)<1e-10?"\xb7":e.toFixed(a);return(0,Ee.jsxs)("div",{className:ht,children:[(0,Ee.jsxs)("div",{className:pt,children:[(0,Ee.jsx)("h4",{children:t}),(0,Ee.jsxs)("div",{className:xt,children:[(0,Ee.jsxs)("span",{className:jt,children:[c," \xd7 ",d]}),m&&(0,Ee.jsx)("button",{className:vt,onClick:()=>o(!i),children:i?"Show Preview":"Show Full"}),(0,Ee.jsx)("button",{className:gt,onClick:()=>{const e=u.map((e=>e.map((e=>x(e))).join(","))).join("\n"),a=new Blob([e],{type:"text/csv"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`${t.toLowerCase().replace(/\s+/g,"_")}_matrix.csv`,r.click(),URL.revokeObjectURL(s)},title:"Download as CSV",children:"\u2193 CSV"})]})]}),(0,Ee.jsxs)("div",{className:ft,children:[(0,Ee.jsx)("div",{className:`${yt} ${i?Ct:""}`,style:{gridTemplateColumns:`repeat(${p}, 1fr)`},children:Array.from({length:h},((e,t)=>Array.from({length:p},((e,a)=>{const s=u[t]?.[a]||0,r=x(s),n=Math.abs(s)<1e-10;return(0,Ee.jsx)("div",{className:`${bt} ${n?_t:""}`,title:`[${t+1},${a+1}] = ${s}`,children:r},`${t}-${a}`)}))))}),m&&!i&&(0,Ee.jsxs)("div",{className:St,children:["Showing ",h," \xd7 ",p," of ",c," \xd7 ",d," matrix"]})]}),(0,Ee.jsxs)("div",{className:$t,children:[(0,Ee.jsxs)("button",{className:Ft,onClick:()=>l(!n),children:[n?"\u25bc":"\u25b6"," Matrix Information"]}),n&&(0,Ee.jsxs)("div",{className:Nt,children:[(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Dimensions:"})," ",c," rows \xd7 ",d," columns"]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Total elements:"})," ",c*d]}),u.length>0&&u[0]&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Max value:"})," ",Math.max(...u.flat()).toFixed(a)]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Min value:"})," ",Math.min(...u.flat()).toFixed(a)]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Trace (diagonal sum):"})," ",u.reduce(((e,t,a)=>e+(t[a]||0)),0).toFixed(a)]})]})]})]})]})};var Mt=a(7851);const kt="container_BTtL",Et="header_Zg_R",zt="controls_krEJ",Lt="controlButton_kE_9",Ot="viewer_MOiN",Tt="representationControls_JFkt",It="controlGroup_advN",Rt="inlineControlGroup_p0fZ",Dt="controlLabel_p9ac",qt="controlSelect_wf9l",Ht="checkboxLabel_O6nm",Vt="checkbox_vb0q",At="numberInput_NZEF",Pt="slicePositionControls_XcJh",Bt="collapsibleControl_f2QI",Ut="controlToggle_IHht",Xt="controlContent_BMT8",Yt="colorRangeGrid_zP5d",Zt="computingIndicator_nVPU",Gt="mainContent_hmUM",Wt="viewerContainer_HOsW",Kt="orbitalSidebar_Sjw1",Jt="open_VSem",Qt="orbitalToggleButton_zhVa",ea="orbitalSidebarHeader_sOPI",ta="orbitalCloseButton_PBas",aa="moControls_QuQW",sa="collapsibleSection_wCEA",ra="lightSectionHeader_RRMY",na="chevron_qy2f",la="chevronExpanded_o9bu",ia="sectionContent_L8gO",oa="orbitalList_q8AK",ca="placeholder_XAIu",da="loading_XCE6",ua="error_fQgs",ma="orbitalItem_coIp",ha="orbitalOccupied_2McF",pa="orbitalVirtual_y4gy",xa="orbitalSelected_kMgf",ja="orbitalContent_ff1A",va="orbitalEnergy_svnX",ga="orbitalEnergyEV_OrpY",fa="orbitalLabel_q_Pv",ya="orbitalIndicators_GNGS",ba="occupationBadge_DFgd",Na="orbitalColorIndicator_WBpC",Ca="orbitalColorPicker_rcrR",_a=({orbital:e,isHOMO:t=!1,isLUMO:a=!1,isSelected:s=!1,colorIndicator:r,onColorChange:n,onClick:l,className:i=""})=>{const o=e.energy/27.2114;return(0,Ee.jsxs)("div",{className:`${ma} ${e.isOccupied?ha:pa} ${s?xa:""} ${i}`,onClick:l,title:`MO ${e.index}: ${e.energy.toFixed(3)} eV (occupation: ${e.occupation})`,style:{cursor:l?"pointer":"default"},children:[(0,Ee.jsxs)("div",{className:ja,children:[(0,Ee.jsxs)("div",{className:va,children:[o.toFixed(6)," Eh"]}),(0,Ee.jsxs)("div",{className:ga,children:[e.energy.toFixed(3)," eV"]}),(t||a)&&(0,Ee.jsx)("div",{className:fa,children:t?"HOMO":"LUMO"})]}),(0,Ee.jsxs)("div",{className:ya,children:[e.occupation>0&&(0,Ee.jsx)("div",{className:ba,children:2===e.occupation?"\u2191\u2193":1===e.occupation?"\u2191":""}),r&&(s?(0,Ee.jsx)("input",{type:"color",value:r,onChange:e=>{e.stopPropagation(),n?.(e.target.value)},onClick:e=>e.stopPropagation(),className:Ca,title:`Change color for MO ${e.index}`}):(0,Ee.jsx)("div",{className:Na,style:{backgroundColor:r},title:`Last used color: ${r}`}))]})]})},Sa=({xyzData:e,moleculeName:t="Molecule",wavefunctionResults:a,cubeResults:r,cubeGridInfo:n,onRequestCubeComputation:l})=>{const i=(0,s.useRef)(null),o=(0,s.useRef)(null),c=(0,s.useRef)(null),d=(0,s.useRef)(null),[u,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(""),[x,j]=(0,s.useState)("ball+stick"),[v,g]=(0,s.useState)(!0),[f,y]=(0,s.useState)("element"),[b,N]=(0,s.useState)(new Set),[C,_]=(0,s.useState)(.01),[S,$]=(0,s.useState)(!1),[F,w]=(0,s.useState)(1),[M,k]=(0,s.useState)(!1),[E,z]=(0,s.useState)((()=>{try{const e=localStorage.getItem("orbitalColors");if(e){const t=JSON.parse(e);return new Map(Object.entries(t).map((([e,t])=>[parseInt(e),t])))}}catch(h){console.warn("Failed to load orbital colors from localStorage:",h)}return new Map})),[L,O]=(0,s.useState)(40),T=(0,s.useRef)(null),I=(0,s.useRef)(null),[R,D]=(0,s.useState)(!0),[q,H]=(0,s.useState)(!1),V=(0,s.useRef)(null),[A,P]=(0,s.useState)(null),[B,U]=(0,s.useState)("surface"),[X,Y]=(0,s.useState)(!1),[Z,G]=(0,s.useState)("z"),[W,K]=(0,s.useState)(0),[J,Q]=(0,s.useState)("rwb"),[ee,te]=(0,s.useState)([0,.05]),[ae,se]=(0,s.useState)(!1),re=()=>"dark"===document.documentElement.getAttribute("data-theme")?"#1b1b1d":"#ffffff";(0,s.useEffect)((()=>{if(!i.current)return;o.current=new Mt.BI(i.current,{backgroundColor:re(),quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10,fogNear:100,fogFar:100});const e=()=>{o.current&&o.current.handleResize()};window.addEventListener("resize",e);const t=new MutationObserver((()=>{o.current&&o.current.setParameters({backgroundColor:re()})}));return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{window.removeEventListener("resize",e),t.disconnect(),o.current&&o.current.dispose()}}),[]);const ne=()=>{if(!c.current)return;c.current.removeAllRepresentations();const e={colorScheme:f,sele:v?"all":"not hydrogen"};switch(x){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0;break;case"surface":e.opacity=.8,e.surfaceType="vws"}c.current.addRepresentation(x,e),o.current?.autoView()};(0,s.useEffect)((()=>{ne()}),[x,v,f]);const le=async e=>{if(o.current)try{o.current.removeAllComponents();const a=((e,t)=>{const a=e.trim().split("\n"),s=parseInt(a[0]),r=a[1]||t,n=[];for(let m=2;m<2+s;m++){const e=a[m].trim().split(/\s+/);n.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const l={"H-H":.74,"H-C":1.09,"H-N":1.01,"H-O":.96,"H-S":1.34,"C-C":1.54,"C-N":1.47,"C-O":1.43,"C-S":1.82,"N-N":1.45,"N-O":1.4,"N-S":1.68,"O-O":1.48,"O-S":1.66,"S-S":2.05},i=(e,t)=>{const a=e.x-t.x,s=e.y-t.y,r=e.z-t.z;return Math.sqrt(a*a+s*s+r*r)},o=[];for(let m=0;m<n.length;m++)for(let e=m+1;e<n.length;e++){const t=i(n[m],n[e]),a=l[`${c=n[m].element}-${d=n[e].element}`]||l[`${d}-${c}`]||2;if(t<=1.3*a){let s=1;t<.85*a&&(s=2),t<.75*a&&(s=3),o.push({atom1:m+1,atom2:e+1,order:s})}}var c,d;let u=`${r}\n`;return u+="  Generated from XYZ with bond guessing\n",u+="\n",u+=`${s.toString().padStart(3," ")}${o.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`,n.forEach((e=>{const t=e.x.toFixed(4).padStart(10," "),a=e.y.toFixed(4).padStart(10," "),s=e.z.toFixed(4).padStart(10," ");u+=`${t}${a}${s} ${e.element.padEnd(3," ")} 0  0  0  0  0  0  0  0  0  0  0  0\n`})),o.forEach((e=>{u+=`${e.atom1.toString().padStart(3," ")}${e.atom2.toString().padStart(3," ")}${e.order.toString().padStart(3," ")}  0  0  0  0\n`})),u+="M  END\n$$$$\n",u})(e,t),s=new Blob([a],{type:"text/plain"}),r=await o.current.loadFile(s,{ext:"sdf",name:t});c.current=r,ne()}catch(a){throw console.error("Error loading geometry:",a),a}};(0,s.useEffect)((()=>{if(!e||!o.current)return;(async()=>{m(!0),p("");try{await le(e),m(!1)}catch(t){console.error("Error loading molecule:",t),p("Failed to load molecule structure"),m(!1)}})()}),[e,t]);const ie=s.useMemo((()=>{if(!a?.orbitalEnergies||!a?.orbitalOccupations)return[];const e=[];for(let t=0;t<a.orbitalEnergies.length;t++){const s=a.orbitalEnergies[t],r=a.orbitalOccupations[t]||0;e.push({index:t,energy:27.2114*s,occupation:r,isOccupied:r>0})}return e}),[a]),oe=ie;(0,s.useEffect)((()=>{if(ie.length>0&&l&&b.size>0){const e=[];for(const t of b){const a=`molecular_orbital_${t}_${L}`,s=r?.get(a);s||e.push(t)}e.length>0&&(T.current&&clearTimeout(T.current),T.current=setTimeout((()=>{ce(e)}),300))}return()=>{T.current&&clearTimeout(T.current),I.current&&clearTimeout(I.current)}}),[b,ie.length,r,L]);const ce=async e=>{if(l&&o.current){k(!0),p("");try{const t=ie.length-1;for(const a of e){if(a<0||a>t)throw new Error(`Invalid orbital index ${a}. Valid range: 0-${t}`);l("molecular_orbital",a,L)}}catch(h){console.error("Error requesting MO computation:",h),p("Failed to request molecular orbital computation: "+h.message),k(!1)}}};(0,s.useEffect)((()=>{if(console.log("MO visualization effect triggered:",{selectedOrbitals:b.size,cubeResults:r.size,orbitalRenderStyle:B,sliceDirection:Z,slicePosition:W}),I.current&&(clearTimeout(I.current),I.current=null),!o.current)return;if(0===b.size)return void de();if(!r)return;Array.from(b).every((e=>{const t=`molecular_orbital_${e}_${L}`;return r.get(t)}))&&(de(),M&&k(!1))}),[r,b,C,S,F,B,Z,W,J,ee]);const de=async()=>{var e,t;if(o.current)try{d.current&&(Array.isArray(d.current)?d.current.forEach((e=>{e&&o.current&&o.current.removeComponent(e)})):o.current&&o.current.removeComponent(d.current),d.current=null);const a=[],s=["#4A90E2","#FF8C42","#7B68EE","#32CD32","#FF6B6B","#9B59B6"];if(0===b.size)return d.current=[],void o.current.autoView();for(const[n,l]of Array.from(b).entries()){const i=`molecular_orbital_${l}_${L}`,c=r?.get(i);if(c){const r=new Blob([c],{type:"text/plain"}),i=await o.current.loadFile(r,{ext:"cube",name:`MO_${l}`});if(i){let r=E.get(l);if(r||(r=s[n%s.length],z((e=>{const t=new Map(e);return t.set(l,r),t}))),"surface"===B)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:C,color:r,opacity:F,opaqueBack:!1}),S&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-C,color:"red",opacity:F,opaqueBack:!1});else if("wireframe"===B)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:C,color:r,opacity:F,wireframe:!0,linewidth:2}),S&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-C,color:"red",opacity:F,wireframe:!0,linewidth:2});else if("dot"===B)i.addRepresentation("dot",{visible:!0,color:r,opacity:F,dotType:"square",dotSpacing:2,threshold:.001});else if("slice"===B){const a=(e=Z,t=W,console.log(`Slice position: direction=${e}, position=${t}`),t);console.log(`Adding slice representation: direction=${Z}, normalizedPos=${W}, coordinatePos=${a}`),i.addRepresentation("slice",{visible:!0,opacity:F,dimension:Z,positionType:"coordinate",position:a,thresholdMin:ee[0],thresholdMax:ee[1],thresholdType:"value",colorScheme:J,colorDomain:ee})}a.push(i)}}}d.current=a,o.current.autoView()}catch(h){console.error("Error visualizing molecular orbitals:",h),p("Failed to visualize molecular orbitals: "+h.message)}};return(0,s.useEffect)((()=>{(async()=>{if(!o.current)return;if(V.current&&(o.current.removeComponent(V.current),V.current=null),!q)return;let e=null;if(n){const t=n.origin,a=n.steps,s=n.nx,r=n.ny,l=n.nz,i=n.basis;if(t&&a&&s&&r&&l&&i){const a=[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],n=[t[0],t[1],t[2]],o=[t[0]+(s-1)*a[0][0]+(r-1)*a[1][0]+(l-1)*a[2][0],t[1]+(s-1)*a[0][1]+(r-1)*a[1][1]+(l-1)*a[2][1],t[2]+(s-1)*a[0][2]+(r-1)*a[1][2]+(l-1)*a[2][2]],c=.529177;e={min:[n[0]*c,n[1]*c,n[2]*c],max:[o[0]*c,o[1]*c,o[2]*c]},console.log("Grid bounds (converted to Angstrom):",e)}}if(e)try{const[t,a,s]=e.min,[r,n,l]=e.max,i=[[t,a,s],[r,a,s],[r,n,s],[t,n,s],[t,a,l],[r,a,l],[r,n,l],[t,n,l]],c=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];let d=`Grid Bounds\n  Generated\n  \n${i.length.toString().padStart(3," ")}${c.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`;i.forEach((([e,t,a])=>{d+=`${e.toFixed(4).padStart(10," ")}${t.toFixed(4).padStart(10," ")}${a.toFixed(4).padStart(10," ")} C   0  0  0  0  0  0  0  0  0  0  0  0\n`})),c.forEach((([e,t])=>{d+=`${(e+1).toString().padStart(3," ")}${(t+1).toString().padStart(3," ")}  1  0  0  0  0\n`})),d+="M  END\n$$$$\n";const u=new Blob([d],{type:"text/plain"}),m=await o.current.loadFile(u,{ext:"mol",name:"Grid_Bounds"});m&&(m.addRepresentation("line",{colorScheme:"uniform",colorValue:"#ff6b6b",linewidth:2,opacity:.7}),V.current=m)}catch(h){console.error("Error creating grid bounds visualization:",h),p("Failed to create grid bounds visualization: "+h.message)}else console.log("No cube grid info available - cannot show accurate grid bounds")})()}),[q,n]),(0,s.useEffect)((()=>{try{const e=Object.fromEntries(E);localStorage.setItem("orbitalColors",JSON.stringify(e))}catch(h){console.warn("Failed to save orbital colors to localStorage:",h)}}),[E]),e?(0,Ee.jsxs)("div",{className:kt,children:[(0,Ee.jsxs)("div",{className:Et,children:[(0,Ee.jsx)("h4",{children:"3D Structure & Molecular Orbitals"}),(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("button",{className:Lt,onClick:()=>{o.current&&o.current.autoView()},title:"Reset view",children:"\u2302"}),(0,Ee.jsx)("button",{className:Lt,onClick:()=>{o.current&&o.current.toggleFullscreen(i.current)},title:"Toggle fullscreen",children:"\u26f6"})]})]}),(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsxs)("div",{className:Rt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Style"}),(0,Ee.jsxs)("select",{value:x,onChange:e=>j(e.target.value),className:qt,children:[(0,Ee.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,Ee.jsx)("option",{value:"line",children:"Line"}),(0,Ee.jsx)("option",{value:"spacefill",children:"Space Fill"}),(0,Ee.jsx)("option",{value:"licorice",children:"Licorice"}),(0,Ee.jsx)("option",{value:"surface",children:"Surface"})]})]}),(0,Ee.jsxs)("div",{className:Rt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Color"}),(0,Ee.jsxs)("select",{value:f,onChange:e=>y(e.target.value),className:qt,children:[(0,Ee.jsx)("option",{value:"element",children:"By Element"}),(0,Ee.jsx)("option",{value:"uniform",children:"Uniform"}),(0,Ee.jsx)("option",{value:"chainname",children:"By Chain"}),(0,Ee.jsx)("option",{value:"random",children:"Random"})]})]})]}),(0,Ee.jsxs)("div",{className:Gt,children:[(0,Ee.jsxs)("div",{className:Wt,children:[h&&(0,Ee.jsx)("div",{className:ua,children:(0,Ee.jsx)("p",{children:h})}),u&&(0,Ee.jsx)("div",{className:da,children:(0,Ee.jsx)("p",{children:"Loading molecule..."})}),(0,Ee.jsx)("div",{ref:i,className:Ot,style:{opacity:u?.5:1}}),a&&ie.length>0&&(0,Ee.jsx)("button",{className:Qt,onClick:()=>Y(!X),children:X?"Hide":"Orbitals"})]}),a&&ie.length>0&&(0,Ee.jsxs)("div",{className:`${Kt} ${X?Jt:""}`,children:[(0,Ee.jsxs)("div",{className:ea,children:[(0,Ee.jsx)("h5",{children:"Molecular Orbitals"}),(0,Ee.jsx)("button",{className:ta,onClick:()=>Y(!1),title:"Close orbital panel",children:"\xd7"})]}),(0,Ee.jsxs)("div",{className:sa,children:[(0,Ee.jsxs)("button",{className:ra,onClick:()=>D(!R),children:[(0,Ee.jsx)("span",{children:"Settings"}),(0,Ee.jsx)("span",{className:`${na} ${R?la:""}`,children:"\u25bc"})]}),R&&(0,Ee.jsx)("div",{className:ia,children:(0,Ee.jsxs)("div",{className:aa,children:[(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Style"}),(0,Ee.jsxs)("select",{value:B,onChange:e=>U(e.target.value),className:qt,children:[(0,Ee.jsx)("option",{value:"surface",children:"Surface"}),(0,Ee.jsx)("option",{value:"wireframe",children:"Wireframe"}),(0,Ee.jsx)("option",{value:"dot",children:"Dot Volume"}),(0,Ee.jsx)("option",{value:"slice",children:"Slice Volume"})]})]}),("surface"===B||"wireframe"===B)&&(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Isovalue"}),(0,Ee.jsx)("input",{type:"number",min:"0.001",max:"0.2",step:"0.001",value:C,onChange:e=>_(parseFloat(e.target.value)||.01),className:At})]}),"slice"===B&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Slice Direction"}),(0,Ee.jsxs)("select",{value:Z,onChange:e=>G(e.target.value),className:qt,children:[(0,Ee.jsx)("option",{value:"x",children:"X-axis"}),(0,Ee.jsx)("option",{value:"y",children:"Y-axis"}),(0,Ee.jsx)("option",{value:"z",children:"Z-axis"})]})]}),(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Slice Position"}),(0,Ee.jsxs)("div",{className:Pt,children:[(0,Ee.jsx)("button",{onClick:()=>K(W-.5),className:Lt,title:"Move slice by -0.5",children:"-"}),(0,Ee.jsx)("input",{type:"number",step:"0.1",value:W,onChange:e=>K(parseFloat(e.target.value)||0),className:At,title:"Slice position in Angstroms"}),(0,Ee.jsx)("button",{onClick:()=>K(W+.5),className:Lt,title:"Move slice by +0.5",children:"+"})]})]}),(0,Ee.jsxs)("div",{className:Bt,children:[(0,Ee.jsxs)("button",{className:Ut,onClick:()=>se(!ae),children:[(0,Ee.jsx)("span",{className:Dt,children:"Color Range"}),(0,Ee.jsx)("span",{className:`${na} ${ae?la:""}`,children:"\u25bc"})]}),ae&&(0,Ee.jsx)("div",{className:Xt,children:(0,Ee.jsxs)("div",{className:Yt,children:[(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Minimum"}),(0,Ee.jsx)("input",{type:"number",step:"0.01",value:ee[0],onChange:e=>te([parseFloat(e.target.value)||0,ee[1]]),className:At,title:"Minimum value for color scale"})]}),(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Maximum"}),(0,Ee.jsx)("input",{type:"number",step:"0.01",value:ee[1],onChange:e=>te([ee[0],parseFloat(e.target.value)||.05]),className:At,title:"Maximum value for color scale"})]})]})})]})]}),(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Opacity"}),(0,Ee.jsx)("input",{type:"number",min:"0",max:"1",step:"0.05",value:F,onChange:e=>w(parseFloat(e.target.value)||1),className:At,title:"Orbital surface opacity (0 = transparent, 1 = opaque)"})]}),(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsx)("label",{className:Dt,children:"Grid Steps"}),(0,Ee.jsx)("input",{type:"number",min:"20",max:"60",step:"5",value:L,onChange:e=>O(parseInt(e.target.value)||40),className:At,title:"Number of grid points per dimension (higher = more detail, slower)"}),n&&(0,Ee.jsxs)("label",{className:Ht,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:q,onChange:e=>H(e.target.checked),className:Vt}),"Bounds"]})]}),M&&(0,Ee.jsx)("div",{className:It,children:(0,Ee.jsx)("span",{className:Zt,children:"Computing MO..."})})]})})]}),(0,Ee.jsx)("div",{className:oa,children:oe.map(((e,t)=>{const a=ie.findIndex(((e,t)=>e.isOccupied&&(!ie[t+1]||!ie[t+1].isOccupied))),s=a>=0?a+1:-1,r=e.index===a,n=e.index===s,l=b.has(e.index),i=E.get(e.index);return(0,Ee.jsx)(_a,{orbital:e,isHOMO:r,isLUMO:n,isSelected:l,colorIndicator:i,onColorChange:t=>((e,t)=>{z((a=>{const s=new Map(a);return s.set(e,t),s})),I.current&&clearTimeout(I.current),b.has(e)&&(I.current=setTimeout((()=>{de(),I.current=null}),50))})(e.index,t),onClick:()=>{return t=e.index,void N((e=>{const a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a}));var t}},e.index)}))})]})]})]}):(0,Ee.jsx)("div",{className:kt,children:(0,Ee.jsxs)("div",{className:ca,children:[(0,Ee.jsx)("h4",{children:"Molecule Viewer"}),(0,Ee.jsx)("p",{children:"Load a molecule to see its 3D structure"})]})})};var $a=a(6370);class Fa{static DEFAULT_FRAMES=20;static DEFAULT_AMPLITUDE=.3;static precomputeAllTrajectories(e,t,a,s){const r=new Map;return t.forEach(((t,n)=>{const l=a[n],i=l&&l.length>0?this.generateTrajectory(e,l,t,n,s):this.createPlaceholderTrajectory(e,t,n);r.set(n,i)})),r}static generateTrajectory(e,t,a,s,r){const n=r?.frames??this.DEFAULT_FRAMES,l=r?.amplitude??this.DEFAULT_AMPLITUDE,{numAtoms:i,atoms:o}=this.parseGeometry(e);if(!o.length)return"";const c=[];for(let d=0;d<n;d++){const e=2*Math.PI*d/n,r=l*Math.sin(e),i=this.createFrame(o,t,r,a,s);c.push(i)}return c.join("\n")}static createPlaceholderTrajectory(e,t,a){const s=e.trim().split("\n"),r=parseInt(s[0]),n=[];for(let l=0;l<5;l++){const e=[r.toString()];e.push(`Mode ${a+1}: ${Math.abs(t).toFixed(2)} cm\u207b\xb9 (normal mode data unavailable)`);for(let t=2;t<s.length;t++)e.push(s[t]);n.push(e.join("\n"))}return n.join("\n")}static parseGeometry(e){const t=e.trim().split("\n"),a=parseInt(t[0]);if(t.length<a+2)return{numAtoms:0,atoms:[]};const s=[];for(let r=2;r<2+a;r++){const e=t[r].trim().split(/\s+/);s.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}return{numAtoms:a,atoms:s}}static createFrame(e,t,a,s,r){const n=[e.length.toString()];n.push(`Mode ${r+1}: ${Math.abs(s).toFixed(2)} cm\u207b\xb9 ${s<0?"(imaginary)":""}`);for(let l=0;l<e.length;l++){const s=e[l],r=t[3*l]||0,i=t[3*l+1]||0,o=t[3*l+2]||0,c=s.x+a*r,d=s.y+a*i,u=s.z+a*o;n.push(`${s.element}  ${c.toFixed(6)}  ${d.toFixed(6)}  ${u.toFixed(6)}`)}return n.join("\n")}}const wa=()=>{const[e,t]=(0,s.useState)(null),[r,xe]=(0,s.useState)(!1),[je,ve]=(0,s.useState)(""),[ge,fe]=(0,s.useState)(null),[ye,be]=(0,s.useState)(!1),[Ne,Ce]=(0,s.useState)(null),[_e,Se]=(0,s.useState)([]),[$e,Fe]=(0,s.useState)("structure"),[we,Me]=(0,s.useState)(""),[ke,ze]=(0,s.useState)(""),[Oe,Te]=(0,s.useState)(new Map),[Ie,Re]=(0,s.useState)(null),[De,He]=(0,s.useState)(!0),[Ve,Ae]=(0,s.useState)(!0),[Pe,Be]=(0,s.useState)(!0),[Ue,Xe]=(0,s.useState)("hf"),[Ye,Ze]=(0,s.useState)("3-21g"),[Ge,We]=(0,s.useState)(100),[Ke,Je]=(0,s.useState)(1e-8),[Qe,et]=(0,s.useState)(2),[tt,at]=(0,s.useState)(!1),[st,rt]=(0,s.useState)(!1),[nt,lt]=(0,s.useState)(0),[it,ot]=(0,s.useState)(4),[ct,ut]=(0,s.useState)("optimization"),[ht,pt]=(0,s.useState)(null),[xt,jt]=(0,s.useState)(!0),[vt,gt]=(0,s.useState)(!0),[ft,yt]=(0,s.useState)(new Map);(0,s.useEffect)((()=>(bt(),()=>{e&&e.terminate()})),[]);const bt=async()=>{try{const e=new Worker(new URL(a.p+a.u(842),a.b),{type:void 0});e.onmessage=Nt,e.onerror=e=>{console.error("Worker error:",e),Me("Worker error: "+e.message),xe(!1)},t(e),e.postMessage({type:"init",data:{}}),setTimeout((()=>{e&&e.postMessage({type:"warmup",data:{}})}),100)}catch(we){console.error("Failed to initialize worker:",we),Me("Failed to initialize Web Worker: "+we.message)}},Nt=e=>{const{type:t,...a}=e.data;switch(t){case"initialized":a.success?(xe(!0),_t("Worker initialized successfully","info")):(xe(!1),Me("Worker initialization failed: "+a.error));break;case"log":_t(a.message,Ct(a.level));break;case"progress":_t(a.message,"info"),"complete"===a.stage&&be(!1);break;case"result":St(a);break;case"optimization_progress":_t(a.message,"info");break;case"cubeResult":$t(a);break;case"error":console.error("Worker error:",a.error),Me("Calculation error: "+a.error),be(!1)}},Ct=e=>{switch(e){case 0:case 1:return"debug";case 2:default:return"info";case 3:return"warn";case 4:case 5:return"error"}},_t=(e,t)=>{Se((a=>[...a,{message:e,level:t,timestamp:new Date}]))},St=e=>{be(!1),e.success?(Ce(e.results),Fe("results"),_t("Calculation completed successfully!","info"),e.results.frequencies?.frequencies&&e.results.optimization?.finalXYZ?(_t(`Found frequency data: ${e.results.frequencies.frequencies.length} frequencies, normalModes: ${e.results.frequencies.normalModes?"available":"missing"}`,"info"),Ft(e.results)):_t("No frequency data or optimized geometry available for trajectory pre-computation","info")):Me("Calculation failed: "+e.error)},$t=e=>{if(e.success){const t="molecular_orbital"===e.cubeType?`${e.cubeType}_${e.orbitalIndex}_${e.gridSteps||40}`:e.cubeType;Te((a=>new Map(a.set(t,e.cubeData)))),e.gridInfo&&Re(e.gridInfo),_t(`Cube computation completed: ${e.cubeType}${void 0!==e.orbitalIndex?` (orbital ${e.orbitalIndex})`:""} [${e.gridSteps||40} steps]`,"info")}else Me(`Cube computation failed: ${e.error}`),_t(`Cube computation failed: ${e.error}`,"error")},Ft=e=>{if(!e.frequencies?.frequencies||!e.optimization?.finalXYZ)return;_t("Pre-computing normal mode trajectories...","info");const t=Fa.precomputeAllTrajectories(e.optimization.finalXYZ,e.frequencies.frequencies,e.frequencies.normalModes||[]);yt(t),_t(`Pre-computed ${t.size} normal mode trajectories`,"info")},Mt=()=>Ne?.frequencies?.frequencies?Ne.frequencies.frequencies.map(((e,t)=>({freq:e,index:t}))).filter((({freq:e})=>!xt||Math.abs(e)>=50)):[];return(0,Ee.jsxs)("div",{className:n,children:[(0,Ee.jsxs)("div",{className:l,children:[(0,Ee.jsxs)("div",{className:i,children:[(0,Ee.jsx)("div",{className:`${g} ${r?y:f}`,children:r?"\u2713 Ready":"\u23f3 Loading..."}),(0,Ee.jsxs)("div",{className:C,children:[(0,Ee.jsxs)("div",{className:m,children:[(0,Ee.jsxs)("button",{className:h,onClick:()=>Ae(!Ve),children:[(0,Ee.jsx)("span",{className:p,children:"Molecule Input"}),(0,Ee.jsx)("span",{className:`${x} ${Ve?v:""}`,children:"\u25bc"})]}),Ve&&(0,Ee.jsxs)("div",{className:j,children:[(0,Ee.jsx)(Le,{onFileLoad:e=>{ve(e),Te(new Map),Ce(null),Me(""),Fe("structure"),ze("");try{const t=e.trim().split("\n"),a=parseInt(t[0]),s=t[1]||"Loaded Molecule",r=new Map;for(let e=2;e<2+a;e++){const a=t[e].trim().split(/\s+/)[0];r.set(a,(r.get(a)||0)+1)}const n=Array.from(r.entries()).map((([e,t])=>t>1?`${e}${t}`:e)).join("");fe({name:s,formula:n,numAtoms:a}),_t(`Molecule loaded: ${n} (${a} atoms) - cleared orbital cache`,"info")}catch(we){console.error("Error parsing XYZ:",we)}},onValidationChange:(e,t)=>{He(e),ze(!e&&t?t:"")}}),ge&&(0,Ee.jsx)("div",{className:b,children:(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:ge.formula})," (",ge.numAtoms," atoms)"]})})]})]}),je&&(0,Ee.jsxs)("div",{className:m,children:[(0,Ee.jsxs)("button",{className:h,onClick:()=>Be(!Pe),children:[(0,Ee.jsx)("span",{className:p,children:"Calculation Settings"}),(0,Ee.jsx)("span",{className:`${x} ${Pe?v:""}`,children:"\u25bc"})]}),Pe&&(0,Ee.jsx)("div",{className:j,children:(0,Ee.jsx)(qe,{method:Ue,setMethod:Xe,basisSet:Ye,setBasisSet:Ze,maxIterations:Ge,setMaxIterations:We,energyTolerance:Ke,setEnergyTolerance:Je,logLevel:Qe,setLogLevel:et,optimize:tt,setOptimize:e=>{at(e),e||rt(!1)},computeFrequencies:st,setComputeFrequencies:rt,charge:nt,setCharge:lt,threads:it,setThreads:ot})})]})]}),je&&(0,Ee.jsxs)("div",{className:_,children:[(0,Ee.jsx)("button",{className:`${N} ${S}`,onClick:()=>{if(!je)return void Me("Please load a molecule first.");if(!De)return;if(!e||!r)return void Me("Web Worker not ready.");Ce(null),Se([]),Fe("output"),be(!0),yt(new Map),e.postMessage({type:"setLogLevel",data:{level:Qe}});const t={xyzData:je,method:Ue,basisSet:Ye,maxIterations:Ge,energyTolerance:Ke,optimize:tt,computeFrequencies:st,charge:nt,threads:it};_t("Starting calculation...","info"),e.postMessage({type:"calculate",data:t})},disabled:ye||!r||!De,children:ye?"Calculating...":"Run Calculation"}),ye&&(0,Ee.jsx)("button",{className:`${N} ${$}`,onClick:()=>{e&&ye&&(e.terminate(),_t("Calculation cancelled. Restarting worker...","warn"),bt(),be(!1))},children:"Cancel"})]})]}),(0,Ee.jsxs)("div",{className:o,children:[je&&(0,Ee.jsxs)("div",{className:c,children:[(0,Ee.jsx)("button",{className:`${d} ${"output"===$e?F:""}`,onClick:()=>Fe("output"),children:"Output"}),(0,Ee.jsx)("button",{className:`${d} ${"results"===$e?F:""}`,onClick:()=>Fe("results"),children:"Results"}),(0,Ee.jsx)("button",{className:`${d} ${"structure"===$e?F:""}`,onClick:()=>Fe("structure"),children:"Structure"}),(0,Ee.jsx)("button",{className:`${d} ${"properties"===$e?F:""}`,onClick:()=>Fe("properties"),children:"Properties"}),Ne?.optimization&&(0,Ee.jsx)("button",{className:`${d} ${"optimization"===$e?F:""}`,onClick:()=>Fe("optimization"),children:"Optimization"})]}),(0,Ee.jsxs)("div",{className:u,children:["output"===$e&&(0,Ee.jsx)(mt,{logs:_e}),"results"===$e&&(0,Ee.jsx)(dt,{results:Ne}),"structure"===$e&&(0,Ee.jsx)("div",{className:M,children:je?(0,Ee.jsx)(Sa,{xyzData:Ne?.optimization?.finalXYZ?Ne.optimization.finalXYZ:je,moleculeName:`${ge?.name||"Molecule"}${Ne?.optimization?" (Optimized)":""}`,wavefunctionResults:Ne,cubeResults:Oe,cubeGridInfo:Ie,onRequestCubeComputation:(t,a,s)=>{e&&r?Ne&&Ne.wavefunctionData?(_t(`Requesting ${t} cube computation...`,"info"),e.postMessage({type:"computeCube",data:{cubeType:t,orbitalIndex:a,gridSteps:s||40}})):Me("No wavefunction data available for cube computation."):Me("Web Worker not ready for cube computation.")}}):(0,Ee.jsxs)("div",{className:k,children:[(0,Ee.jsx)("h3",{children:"No Structure Loaded"}),(0,Ee.jsx)("p",{children:"Load a molecule to see its 3D structure visualization."})]})}),"properties"===$e&&Ne&&(0,Ee.jsxs)("div",{className:w,children:[Ne.orbitalEnergies&&Ne.orbitalEnergies.length>0&&(0,Ee.jsxs)("div",{className:L,children:[(0,Ee.jsx)("h4",{children:"Orbital Energies"}),(0,Ee.jsx)("div",{className:O,children:Ne.orbitalEnergies.slice(0,20).map(((e,t)=>{const a=Ne.orbitalOccupations?.[t]??0,s={index:t,energy:27.2114*e,occupation:a,isOccupied:a>0};return(0,Ee.jsx)(_a,{orbital:s},t)}))}),Ne.orbitalEnergies.length>20&&(0,Ee.jsxs)("div",{className:T,children:["... and ",Ne.orbitalEnergies.length-20," more orbitals"]})]}),Ne.matrices&&Object.keys(Ne.matrices).length>0?(0,Ee.jsx)("div",{className:E,children:Object.entries(Ne.matrices).map((([e,t])=>t?(0,Ee.jsx)(wt,{matrix:t,title:`${e.charAt(0).toUpperCase()}${e.slice(1)} Matrix`,precision:6,maxDisplaySize:6},e):null))}):(0,Ee.jsx)("div",{className:z,children:(0,Ee.jsx)("p",{children:"No matrix data available. Matrices are generated during SCF calculations and may depend on the calculation method and settings."})})]}),"optimization"===$e&&Ne?.optimization&&(0,Ee.jsxs)("div",{className:D,children:[(0,Ee.jsx)("div",{className:H,children:(0,Ee.jsxs)("div",{className:q,children:[(0,Ee.jsx)("h4",{children:"Optimization Summary"}),(0,Ee.jsxs)("div",{className:V,children:[(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Converged:"}),(0,Ee.jsx)("span",{className:`${B} ${Ne.optimization.trajectory.converged?U:X}`,children:Ne.optimization.trajectory.converged?"Yes":"No"})]}),(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Steps:"}),(0,Ee.jsx)("span",{className:B,children:Ne.optimization.steps})]}),(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Final Energy:"}),(0,Ee.jsxs)("span",{className:B,children:[Ne.energy.toFixed(8)," Ha"]})]}),(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Final Energy:"}),(0,Ee.jsxs)("span",{className:B,children:[Ne.energyInEV.toFixed(4)," eV"]})]})]})]})}),(0,Ee.jsxs)("div",{className:Z,children:[(0,Ee.jsx)("div",{className:G,children:(0,Ee.jsx)("div",{className:Y,children:(0,Ee.jsx)($a.A,{trajectoryData:"normal_mode"===ct&&null!==ht?(e=>{const t=ft.get(e);if(t)return t;if(!Ne?.optimization?.finalXYZ||!Ne?.frequencies?.frequencies)return"";const a=Ne.frequencies.normalModes?.[e],s=Ne.frequencies.frequencies[e];return a&&0!==a.length?Fa.generateTrajectory(Ne.optimization.finalXYZ,a,s,e):Fa.createPlaceholderTrajectory(Ne.optimization.finalXYZ,s,e)})(ht):"optimization"===ct&&Ne?.optimization?.trajectory?(e=>{if(!e||!e.geometries||!e.energies)return"";const t=[];return e.geometries.forEach(((a,s)=>{const r=e.energies[s],n=a.trim().split("\n");if(n.length>=2){const e=n[0],a=`Step ${s} Energy=${r.toFixed(9)}`,l=n.slice(2).join("\n");t.push(`${e}\n${a}\n${l}`)}})),t.join("\n")})(Ne.optimization.trajectory):"",moleculeName:(()=>{if("normal_mode"===ct&&null!==ht&&Ne?.frequencies?.frequencies){const e=Ne.frequencies.frequencies[ht];return`Mode ${ht+1}: ${Math.abs(e).toFixed(2)} cm\u207b\xb9`}return"optimization"===ct?`${ge?.formula||"Molecule"} Optimization`:"Trajectory"})(),autoPlay:"normal_mode"===ct,initialSpeed:"normal_mode"===ct?60:20})})}),(0,Ee.jsxs)("div",{className:W,children:[(0,Ee.jsx)("div",{className:K,children:(0,Ee.jsx)("h4",{children:"Trajectory Controls"})}),(0,Ee.jsx)("div",{className:J,children:(0,Ee.jsx)("button",{onClick:()=>{ut("optimization"),pt(null)},className:`${Q} ${"optimization"===ct?ee:""}`,children:"Optimization Path"})}),Ne.frequencies&&Ne.frequencies.frequencies.length>0&&(0,Ee.jsxs)("div",{className:te,children:[(0,Ee.jsxs)("div",{className:ae,children:[(0,Ee.jsx)("h5",{children:"Normal Modes"}),(0,Ee.jsx)("div",{className:se,children:(0,Ee.jsxs)("label",{className:re,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:xt,onChange:e=>{jt(e.target.checked),e.target.checked&&null!==ht&&Ne.frequencies.frequencies[ht]&&Math.abs(Ne.frequencies.frequencies[ht])<50&&(pt(null),ut("optimization"))},className:ne}),"Hide low modes (< 50 cm\u207b\xb9)"]})})]}),(0,Ee.jsx)("div",{className:le,children:Mt().map((({freq:e,index:t})=>{const a="normal_mode"===ct&&ht===t;return(0,Ee.jsxs)("div",{className:`${ie} ${a?oe:""}`,onClick:()=>{ut("normal_mode"),pt(t)},style:{cursor:"pointer"},title:`Click to visualize mode ${t+1}`,children:[(0,Ee.jsxs)("div",{className:de,children:[(0,Ee.jsxs)("div",{className:ue,children:["Mode ",t+1]}),(0,Ee.jsxs)("div",{className:me,children:[e<0?`${Math.abs(e).toFixed(1)}i`:e.toFixed(1)," cm\u207b\xb9"]}),e<0&&(0,Ee.jsx)("div",{className:he,children:"imag"})]}),a&&(0,Ee.jsx)("div",{className:ce,children:"\u25b6 Playing"})]},t)}))}),(0,Ee.jsxs)("div",{className:pe,children:["Showing ",Mt().length," of ",Ne.frequencies.frequencies.length," modes"]})]})]})]})]})]})]})]}),we&&!ke&&(0,Ee.jsx)("div",{className:I,children:(0,Ee.jsxs)("div",{className:R,children:[(0,Ee.jsx)("h3",{children:"Error"}),(0,Ee.jsx)("p",{children:we}),(0,Ee.jsx)("button",{onClick:()=>Me(""),children:"Close"})]})})]})};function Ma(){return(0,s.useEffect)((()=>{const e=document.createElement("script");return e.src="/coi-serviceworker.js",e.async=!0,document.head.appendChild(e),()=>{e.parentNode&&e.parentNode.removeChild(e)}}),[]),(0,Ee.jsx)(r.A,{title:"Wavefunction Calculator",description:"Quantum Chemistry Calculations in Your Browser",children:(0,Ee.jsx)("main",{style:{minHeight:"calc(100vh - 60px)"},children:(0,Ee.jsx)(wa,{})})})}},6370:(e,t,a)=>{a.d(t,{A:()=>H});var s=a(6540),r=a(7851);const n="container_kZ5w",l="header_HEr1",i="controls_ixvO",o="controlButton_GDgO",c="viewer_WviD",d="loadingOverlay_lwCV",u="errorOverlay_rmFC",m="loadingSpinner_PLZ5",h="errorMessage_qkbu",p="frameInfoOverlay_vX3K",x="frameNumber_EMUy",j="frameComment_F9wg",v="frameEnergy_RPyN",g="frameVolume_c0K5",f="displayControlsOverlay_fIES",y="overlayControls_EEtd",b="overlayControlGroup_E9WC",N="overlayLabel_tcBl",C="overlaySelect_UZvO",_="overlayCheckbox_jtWY",S="overlaySlider_ifAA",$="overlayValue_f7JJ",F="overlayNumberInput_nqMv",w="trajectoryControls_t0nZ",M="compactControls_H6OY",k="frameControls_R8UR",E="playerControls_ukm9",z="playerButton_Mfw8",L="playPauseButton_PlTX",O="frameSlider_B4ss";var T=a(4848);class I{shapeComponent=null;frameUnitcells=[];constructor(e,t){this.component=e,this.stage=t}setFrameUnitcells(e){this.frameUnitcells=e.map((e=>{if(!e.includes("Lattice="))return null;const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const a=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==a.length)return null;return{a:[a[0],a[1],a[2]],b:[a[3],a[4],a[5]],c:[a[6],a[7],a[8]]}}))}updateFrame(e){if(e<0||e>=this.frameUnitcells.length)return;const t=this.frameUnitcells[e];t&&(this.remove(),this.createUnitCellShape(t))}createUnitCellShape(e){const{a:t,b:a,c:s}=e,n=this.component.structure.center,l=[[0,0,0],[1,0,0],[0,1,0],[0,0,1],[1,1,0],[1,0,1],[0,1,1],[1,1,1]].map((([e,r,l])=>[n.x+e*t[0]+r*a[0]+l*s[0],n.y+e*t[1]+r*a[1]+l*s[1],n.z+e*t[2]+r*a[2]+l*s[2]])),i=new r.yp("unitcell");[[0,1],[0,2],[0,3],[1,4],[1,5],[2,4],[2,6],[3,5],[3,6],[4,7],[5,7],[6,7]].forEach((([e,t])=>{i.addWideline(l[e],l[t],[1,.5,0])})),this.shapeComponent=this.stage.addComponentFromObject(i),this.shapeComponent.addRepresentation("buffer",{linewidth:5,opacity:.8})}remove(){this.shapeComponent&&(this.stage.removeComponent(this.shapeComponent),this.shapeComponent=null)}setVisible(e){this.shapeComponent&&this.shapeComponent.setVisibility(e)}}const R=e=>e.toLowerCase().split(".").pop()||"",D=e=>["pdb","ent","pqr","mmcif","cif","mcif","gro","sdf","mol2","mmtf"].includes(e);class q{static convertXYZTrajToPDB(e,t="MOL"){const a=this.parseXYZTrajectory(e);return this.convertFramesToPDB(a,t)}static calculateVolume(e,t,a,s,r,n){const l=s*Math.PI/180,i=r*Math.PI/180,o=n*Math.PI/180,c=Math.cos(l),d=Math.cos(i),u=Math.cos(o);return e*t*a*Math.sqrt(1+2*c*d*u-c*c-d*d-u*u)}static parseLatticeInfo(e){const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const a=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==a.length)return null;const s=a[0],r=a[1],n=a[2],l=a[3],i=a[4],o=a[5],c=a[6],d=a[7],u=a[8],m=Math.sqrt(s*s+r*r+n*n),h=Math.sqrt(l*l+i*i+o*o),p=Math.sqrt(c*c+d*d+u*u),x=180*Math.acos((l*c+i*d+o*u)/(h*p))/Math.PI,j=180*Math.acos((s*c+r*d+n*u)/(m*p))/Math.PI,v=180*Math.acos((s*l+r*i+n*o)/(m*h))/Math.PI;return{a:m,b:h,c:p,alpha:x,beta:j,gamma:v,volume:this.calculateVolume(m,h,p,x,j,v)}}static convertFramesToPDB(e,t="MOL"){let a="";return e.forEach(((e,s)=>{a+=`MODEL     ${(s+1).toString().padStart(4," ")}\n`;const r=e.trim().split("\n"),n=parseInt(r[0]),l=r[1]||"",i=this.parseLatticeInfo(l);if(i){const e=i.a.toFixed(3).padStart(9," "),t=i.b.toFixed(3).padStart(9," "),s=i.c.toFixed(3).padStart(9," "),r=i.alpha.toFixed(2).padStart(7," "),n=i.beta.toFixed(2).padStart(7," "),l=i.gamma.toFixed(2).padStart(7," ");a+=`CRYST1${e}${t}${s}${r}${n}${l} P 1           1\n`}for(let o=0;o<n;o++){const e=r[o+2].trim().split(/\s+/),s=e[0],n=parseFloat(e[1]),l=parseFloat(e[2]),i=parseFloat(e[3]),c=(o+1).toString().padStart(5," "),d=s.padEnd(4," "),u=t.substring(0,3).padEnd(3," "),m="A",h="1".padStart(4," "),p=n.toFixed(3).padStart(8," "),x=l.toFixed(3).padStart(8," "),j=i.toFixed(3).padStart(8," ");a+=`ATOM  ${c} ${d} ${u} ${m}${h}    ${p}${x}${j}  1.00  0.00           ${s.padEnd(2," ")}\n`}a+="ENDMDL\n"})),a+="END\n",a}static parseXYZTrajectory(e){const t=[],a=e.trim().split("\n");let s=0;for(;s<a.length;){if(!a[s]||""===a[s].trim()){s++;continue}const e=parseInt(a[s]);if(isNaN(e)||e<=0){s++;continue}if(s+e+1>=a.length)break;const r=a.slice(s,s+e+2);t.push(r.join("\n")),s+=e+2}return t}}const H=({trajectoryData:e,xyzFrames:t,structureFile:a,trajectoryFile:H,structureUrl:V,trajectoryUrl:A,moleculeName:P="Trajectory",autoPlay:B=!1,initialSpeed:U=100})=>{const X=(0,s.useRef)(null),Y=(0,s.useRef)(null),Z=(0,s.useRef)(null),G=(0,s.useRef)(null),W=(0,s.useRef)(null),[K,J]=(0,s.useState)(!1),[Q,ee]=(0,s.useState)(""),[te,ae]=(0,s.useState)(0),[se,re]=(0,s.useState)(0),[ne,le]=(0,s.useState)(!1),[ie,oe]=(0,s.useState)(30),[ce,de]=(0,s.useState)("ball+stick"),[ue,me]=(0,s.useState)(!0),[he,pe]=(0,s.useState)("element"),[xe,je]=(0,s.useState)([]),[ve,ge]=(0,s.useState)([]),[fe,ye]=(0,s.useState)(null),[be,Ne]=(0,s.useState)(!1),[Ce,_e]=(0,s.useState)(!1),[Se,$e]=(0,s.useState)(!1),[Fe,we]=(0,s.useState)(1),[Me,ke]=(0,s.useState)(1),[Ee,ze]=(0,s.useState)(1),[Le,Oe]=(0,s.useState)([]),[Te,Ie]=(0,s.useState)(null),Re=()=>"dark"===document.documentElement.getAttribute("data-theme")?"#1b1b1d":"#ffffff";(0,s.useEffect)((()=>{if(!X.current)return;Y.current=new r.BI(X.current,{backgroundColor:Re(),quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10});const e=()=>{Y.current&&Y.current.handleResize()};window.addEventListener("resize",e);const t=new MutationObserver((()=>{Y.current&&Y.current.setParameters({backgroundColor:Re()})}));return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{window.removeEventListener("resize",e),t.disconnect(),Y.current&&Y.current.dispose()}}),[]);const De=e=>{const t=[/Energy\s*=\s*(-?\d+\.?\d*)/i,/E\s*=\s*(-?\d+\.?\d*)/i,/energy:\s*(-?\d+\.?\d*)/i];for(const a of t){const t=e.match(a);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null},qe=e=>e.includes("cm\u207b\xb9")||e.includes("cm-1")||e.toLowerCase().includes("mode")||e.includes("Frame=")?null:e.toUpperCase().includes("ORCA")?(e=>{if(e.toUpperCase().includes("ORCA")){const t=e.match(/E\s+(-?\d+\.?\d*)/i);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null})(e):e.includes("Energy=")||e.includes("E=")||e.includes("energy:")||e.includes("Lattice=")?De(e):null,He=e=>{const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const a=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==a.length)return null;const s=a[0],r=a[1],n=a[2],l=a[3],i=a[4],o=a[5],c=a[6],d=a[7],u=a[8],m=Math.sqrt(s*s+r*r+n*n),h=Math.sqrt(l*l+i*i+o*o),p=Math.sqrt(c*c+d*d+u*u),x=180*Math.acos((l*c+i*d+o*u)/(h*p))/Math.PI,j=180*Math.acos((s*c+r*d+n*u)/(m*p))/Math.PI,v=180*Math.acos((s*l+r*i+n*o)/(m*h))/Math.PI,g=x*Math.PI/180,f=j*Math.PI/180,y=v*Math.PI/180,b=Math.cos(g),N=Math.cos(f),C=Math.cos(y);return m*h*p*Math.sqrt(1+2*b*N*C-b*b-N*N-C*C)},Ve=e=>{const t=e.trim().split("\n"),a=[],s=[],r=[],n=[];let l=!1,i=0;for(;i<t.length;){const e=parseInt(t[i]);if(isNaN(e)){i++;continue}const o=t.slice(i,i+e+2);a.push(o.join("\n"));const c=t[i+1]||"";r.push(c);const d=qe(c);s.push(d);const u=He(c);n.push(u),c.includes("Lattice=")&&(l=!0),i+=e+2}je(s),ge(r),Oe(n),_e(l);const o=s.filter((e=>null!==e));return o.length>0?ye(Math.min(...o)):ye(null),{frames:a,comments:r,hasLattice:l}},Ae=async(e,t=[],a=!1)=>{if(Y.current){J(!0),ee("");try{Y.current.removeAllComponents(),G.current=null,W.current=null;const s=q.convertFramesToPDB(e,P),r=new Blob([s],{type:"text/plain"}),n=await Y.current.loadFile(r,{ext:"pdb",name:P,asTrajectory:!0});Z.current=n,re(e.length),Pe();const l=n.addTrajectory();if(G.current=l,l.trajectory&&l.trajectory.player){const e=l.trajectory.player;W.current=e;const t=Math.round(1e3/ie);e.parameters&&(e.parameters.timeout=t,e.parameters.mode="loop",e.parameters.step=1,e.parameters.direction="forward"),e.signals&&(e.signals.startedRunning&&e.signals.startedRunning.add((()=>{le(!0)})),e.signals.haltedRunning&&e.signals.haltedRunning.add((()=>{le(!1)})))}if(l.trajectory&&l.trajectory.signals&&l.trajectory.signals.frameChanged&&l.trajectory.signals.frameChanged.add((e=>{ae(e)})),Y.current.autoView(),console.log("Trajectory loaded. latticeDetected:",a,"comments.length:",t.length),a&&t.length>0){console.log("Creating CustomUnitCellRepresentation...");const e=new I(n,Y.current);e.setFrameUnitcells(t),Ie(e),_e(!0),console.log("CustomUnitCellRepresentation created:",e)}else console.log("Not creating unit cell: latticeDetected =",a,"comments =",t.length),_e(!1);B&&W.current&&setTimeout((()=>W.current.play()),500),J(!1)}catch(s){console.error("Error loading trajectory:",s),ee(`Failed to load trajectory: ${s.message}`),J(!1)}}},Pe=()=>{if(!Z.current)return;Z.current.removeAllRepresentations();const e={colorScheme:he,sele:ue?"all":"not hydrogen"};switch(ce){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0}Z.current.addRepresentation(ce,e),Y.current?.autoView()},Be=e=>1===Fe&&1===Me&&1===Ee?e:e.map((e=>{const t=e.trim().split("\n"),a=parseInt(t[0]),s=t[1]||"",r=s.match(/Lattice="([^"]+)"/);if(!r)return e;const n=r[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==n.length)return e;const l=[n[0],n[1],n[2]],i=[n[3],n[4],n[5]],o=[n[6],n[7],n[8]],c=[];for(let h=0;h<a;h++){const e=t[h+2].trim().split(/\s+/);c.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const d=[];for(let h=0;h<Fe;h++)for(let e=0;e<Me;e++)for(let t=0;t<Ee;t++){const a=[h*l[0]+e*i[0]+t*o[0],h*l[1]+e*i[1]+t*o[1],h*l[2]+e*i[2]+t*o[2]];c.forEach((e=>{d.push({element:e.element,x:e.x+a[0],y:e.y+a[1],z:e.z+a[2]})}))}const u=[d.length.toString()],m=s.replace(/Lattice="([^"]+)"/,((e,t)=>`Lattice="${[l[0]*Fe,l[1]*Fe,l[2]*Fe,i[0]*Me,i[1]*Me,i[2]*Me,o[0]*Ee,o[1]*Ee,o[2]*Ee].join(" ")}"`));return u.push(m),d.forEach((e=>{u.push(`${e.element}  ${e.x.toFixed(6)}  ${e.y.toFixed(6)}  ${e.z.toFixed(6)}`)})),u.join("\n")})),Ue=()=>{Te&&Ce&&(Se?(Te.updateFrame(te),Te.setVisible(!0)):Te.setVisible(!1))};(0,s.useEffect)((()=>{const s=()=>{if(W.current)if("function"==typeof W.current.pause)try{W.current.pause()}catch(e){}else W.current.intervalId&&clearInterval(W.current.intervalId);le(!1)};if((a||V)&&(H||A||D(a?R(a.name):V?R(V):""))){s();const e=a||V,t=H||A;setTimeout((()=>(async(e,t)=>{if(Y.current){J(!0),ee("");try{let a;if(Y.current.removeAllComponents(),G.current=null,W.current=null,"string"==typeof e)a=await Y.current.loadFile(e,{name:P});else{const t=R(e.name);a=await Y.current.loadFile(e,{ext:t,name:P})}if(Z.current=a,Pe(),t){let e;if("string"==typeof t)e=await r.un(t);else{const a=URL.createObjectURL(t);try{e=await r.un(a,{ext:R(t.name)})}finally{URL.revokeObjectURL(a)}}const s=a.addTrajectory(e);if(G.current=s,s.trajectory&&s.trajectory.player){const e=s.trajectory.player;W.current=e;const t=Math.round(1e3/ie);e.parameters&&(e.parameters.timeout=t,e.parameters.mode="loop",e.parameters.step=1,e.parameters.direction="forward"),e.signals&&(e.signals.startedRunning&&e.signals.startedRunning.add((()=>{le(!0)})),e.signals.haltedRunning&&e.signals.haltedRunning.add((()=>{le(!1)})))}s.trajectory&&s.trajectory.signals&&s.trajectory.signals.frameChanged&&s.trajectory.signals.frameChanged.add((e=>{ae(e)})),e&&void 0!==e.frameCount?re(e.frameCount):s.trajectory&&void 0!==s.trajectory.frameCount&&re(s.trajectory.frameCount)}else if(D(R("string"==typeof e?e:e.name))){const e=a.addTrajectory();if(G.current=e,e.trajectory&&e.trajectory.player){const t=e.trajectory.player;W.current=t;const a=Math.round(1e3/ie);t.parameters&&(t.parameters.timeout=a,t.parameters.mode="loop",t.parameters.step=1,t.parameters.direction="forward"),t.signals&&(t.signals.startedRunning&&t.signals.startedRunning.add((()=>{le(!0)})),t.signals.haltedRunning&&t.signals.haltedRunning.add((()=>{le(!1)})))}e.trajectory&&e.trajectory.signals&&e.trajectory.signals.frameChanged&&e.trajectory.signals.frameChanged.add((e=>{ae(e)})),a.structure&&a.structure.modelStore&&void 0!==a.structure.modelStore.count&&re(a.structure.modelStore.count)}Y.current.autoView(),B&&W.current&&se>1&&setTimeout((()=>{W.current&&"function"==typeof W.current.play&&W.current.play()}),500),J(!1)}catch(a){console.error("Error loading trajectory:",a),ee(`Failed to load trajectory: ${a.message}`),J(!1)}}})(e,t)),50)}else if(e){const t=Ve(e);if(t.frames.length>0){s();const e=Be(t.frames);setTimeout((()=>Ae(e,t.comments,t.hasLattice)),50)}}else if(t&&t.length>0){s();const e=t.join("\n\n"),a=Ve(e),r=Be(a.frames);setTimeout((()=>Ae(r,a.comments,a.hasLattice)),50)}return s}),[e,t,a,H,V,A,Fe,Me,Ee]),(0,s.useEffect)((()=>{Pe()}),[ce,ue,he]),(0,s.useEffect)((()=>{Se?Ue():Te&&Te.remove()}),[Se,Fe,Me,Ee,Ce,Te]),(0,s.useEffect)((()=>{Se&&Ce&&Ue()}),[te,Se,Ce,Te]);const Xe=()=>{if(W.current&&"function"==typeof W.current.play)W.current.play();else if(G.current&&G.current.trajectory&&se>1){le(!0);let e=te;const t=setInterval((()=>{try{G.current&&G.current.trajectory?(e=(e+1)%se,G.current.trajectory.setFrame(e),ae(e)):(clearInterval(t),le(!1))}catch(a){console.warn("Trajectory disposed during playback, stopping:",a.message),clearInterval(t),le(!1)}}),Math.round(1e3/ie));W.current={intervalId:t}}},Ye=()=>{W.current&&("function"==typeof W.current.pause?W.current.pause():W.current.intervalId&&(clearInterval(W.current.intervalId),W.current=null)),le(!1)},Ze=e=>{try{G.current&&G.current.trajectory&&G.current.trajectory.setFrame(e)}catch(t){console.warn("Cannot set frame on disposed trajectory:",t.message)}};return(0,s.useEffect)((()=>{const e=e=>{if(!(se<=1||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement))switch(e.code){case"Space":e.preventDefault(),ne?Ye():Xe();break;case"ArrowLeft":e.preventDefault(),Ze(Math.max(0,te-1));break;case"ArrowRight":e.preventDefault(),Ze(Math.min(se-1,te+1));break;case"Home":e.preventDefault(),Ze(0);break;case"End":e.preventDefault(),Ze(se-1)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[se,te,ne]),(0,T.jsxs)("div",{className:n,children:[(0,T.jsxs)("div",{className:l,children:[(0,T.jsx)("h4",{children:P}),(0,T.jsxs)("div",{className:i,children:[(0,T.jsx)("button",{onClick:()=>Ne(!be),className:o,title:"Toggle display options",children:"Options"}),(0,T.jsx)("button",{onClick:()=>{Y.current&&Y.current.autoView(1e3)},className:o,children:"Reset View"}),(0,T.jsx)("button",{onClick:()=>{Y.current&&Y.current.toggleFullscreen(X.current)},className:o,children:"Fullscreen"})]})]}),(0,T.jsxs)("div",{className:c,ref:X,children:[K&&(0,T.jsx)("div",{className:d,children:(0,T.jsx)("div",{className:m,children:"Loading trajectory..."})}),Q&&(0,T.jsx)("div",{className:u,children:(0,T.jsx)("div",{className:h,children:Q})}),se>0&&(0,T.jsxs)("div",{className:p,children:[(0,T.jsxs)("div",{className:x,children:["Frame ",te+1,"/",se]}),ve[te]&&(0,T.jsx)("div",{className:j,children:ve[te]}),null!==xe[te]&&void 0!==xe[te]&&null!==fe&&(0,T.jsx)("div",{className:v,children:(()=>{const e=xe[te]-fe;return`${e>=0?"+":""}${(2625.5*e).toFixed(2)} kJ/mol`})()}),null!==Le[te]&&void 0!==Le[te]&&(0,T.jsxs)("div",{className:g,children:["Volume: ",Le[te].toFixed(2)," \xc5\xb3"]})]}),be&&(0,T.jsx)("div",{className:f,children:(0,T.jsxs)("div",{className:y,children:[(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("label",{className:N,children:"Style:"}),(0,T.jsxs)("select",{value:ce,onChange:e=>de(e.target.value),className:C,children:[(0,T.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,T.jsx)("option",{value:"line",children:"Line"}),(0,T.jsx)("option",{value:"spacefill",children:"Spacefill"}),(0,T.jsx)("option",{value:"licorice",children:"Licorice"}),(0,T.jsx)("option",{value:"cartoon",children:"Cartoon"})]})]}),(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("label",{className:N,children:"Color:"}),(0,T.jsxs)("select",{value:he,onChange:e=>pe(e.target.value),className:C,children:[(0,T.jsx)("option",{value:"element",children:"Element"}),(0,T.jsx)("option",{value:"chainname",children:"Chain"}),(0,T.jsx)("option",{value:"residueindex",children:"Residue"}),(0,T.jsx)("option",{value:"bfactor",children:"B-factor"})]})]}),(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("input",{type:"checkbox",checked:ue,onChange:e=>me(e.target.checked),id:"showH-overlay",className:_}),(0,T.jsx)("label",{htmlFor:"showH-overlay",className:N,children:"Show Hydrogens"})]}),(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("label",{className:N,children:"FPS:"}),(0,T.jsx)("input",{type:"range",min:"10",max:"60",step:"5",value:ie,onChange:e=>(e=>{if(oe(e),W.current&&W.current.parameters){const t=Math.round(1e3/e);W.current.parameters.timeout=t,ne&&"function"==typeof W.current.pause&&"function"==typeof W.current.play&&(W.current.pause(),W.current.play())}})(parseInt(e.target.value)),className:S}),(0,T.jsx)("span",{className:$,children:ie})]}),Ce&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("input",{type:"checkbox",checked:Se,onChange:e=>$e(e.target.checked),id:"showUnitCell-overlay",className:_}),(0,T.jsx)("label",{htmlFor:"showUnitCell-overlay",className:N,children:"Show Unit Cell"})]}),Se&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("label",{className:N,children:"Supercell X:"}),(0,T.jsx)("input",{type:"number",min:"1",max:"5",value:Fe,onChange:e=>we(parseInt(e.target.value)||1),className:F})]}),(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("label",{className:N,children:"Supercell Y:"}),(0,T.jsx)("input",{type:"number",min:"1",max:"5",value:Me,onChange:e=>ke(parseInt(e.target.value)||1),className:F})]}),(0,T.jsxs)("div",{className:b,children:[(0,T.jsx)("label",{className:N,children:"Supercell Z:"}),(0,T.jsx)("input",{type:"number",min:"1",max:"5",value:Ee,onChange:e=>ze(parseInt(e.target.value)||1),className:F})]})]})]})]})})]}),se>1&&(0,T.jsx)("div",{className:w,children:(0,T.jsxs)("div",{className:M,children:[(0,T.jsxs)("div",{className:E,children:[(0,T.jsx)("button",{onClick:()=>Ze(Math.max(0,te-1)),className:z,disabled:0===te,title:"Previous frame",children:"\u23ee"}),(0,T.jsx)("button",{onClick:ne?Ye:Xe,className:`${z} ${L}`,title:ne?"Pause":"Play",children:ne?"\u23f8":"\u23f5"}),(0,T.jsx)("button",{onClick:()=>Ze(Math.min(se-1,te+1)),className:z,disabled:te===se-1,title:"Next frame",children:"\u23ed"})]}),(0,T.jsx)("div",{className:k,children:(0,T.jsx)("input",{type:"range",min:"0",max:se-1,value:te,onChange:e=>Ze(parseInt(e.target.value)),className:O})})]})})]})}}}]);