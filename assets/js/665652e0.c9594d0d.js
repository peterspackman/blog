"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1288],{1230:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Ms});var a=s(6540),n=s(1656);const r="container_Qh_B",l="layout_SyMw",i="sidebar_Cwvp",o="content_ak_G",c="tabs_tRXw",d="tab_F12w",u="tabContent_hF_7",m="collapsibleSection_Nmyk",h="sectionHeader_qShV",p="sectionTitle_aNil",x="chevron_b8vT",v="sectionContent_NPTV",j="chevronExpanded_ry9E",f="status_l6dK",g="statusLoading_AJab",b="statusReady_FVt8",N="moleculeInfo_KKVy",y="button_XSDO",_="scrollableContent_ikhb",S="stickyButtons_GEQA",C="buttonPrimary_eux_",$="buttonDanger_gLI_",F="tabActive_fzT3",w="propertiesTab_ipsn",M="structureTab_HvbL",k="noStructure_y5fR",E="matricesSection_omrz",z="noMatrices_bajq",O="orbitalsCard_tkcK",L="orbitalGrid_Wtwa",I="moreOrbitals_oRmJ",T="errorModal_HssV",R="errorContent_nEMj",D="optimizationTab_sFuH",H="optimizationSummary_Qbys",q="optimizationHeader_o9LX",V="summaryGrid_miSr",A="summaryItem_TeDs",P="summaryLabel_ItYF",B="summaryValue_eJ3Z",U="converged_TVV4",X="notConverged_zYdK",Y="trajectoryViewerContainer_y8Ak",Z="optimizationLayout_h32e",G="trajectoryViewerSection_ZNX4",W="trajectoryControlsPanel_mPQs",K="trajectoryControlsHeader_NJya",J="trajectoryModeSection_Fa3j",Q="modeButton_mefH",ee="active_TuRi",te="frequenciesControlSection_yYHA",se="frequenciesSectionHeader_PauO",ae="frequencySettings_wwcQ",ne="checkboxLabel_yHfy",re="checkbox_PB7n",le="modesList_XfUU",ie="modeItem_NeQD",oe="modeSelected_GfpX",ce="modeSelectedIndicator_koJh",de="modeInfo_QcHf",ue="modeNumber_aQX4",me="modeValue_Thd_",he="imaginaryBadge_edwd",pe="frequencySummary_MO4Z",xe="section_X2kF",ve="exampleSection_iMDs",je="exampleLabel__wK2",fe="exampleSelect_VuLc",ge="inputContainer_aHUj",be="headerRow_MA_E",Ne="label_1fak",ye="controls_Azqc",_e="browseButton_eNgL",Se="combinedInput_AOvI",Ce="dragging_F5j2",$e="valid_peYL",Fe="invalid_Yt4V",we="clearButton_KExK",Me="xyzTextarea_Jaou",ke="errorMessage_OUge";var Ee=s(4848);const ze={formaldehyde:{name:"Formaldehyde (CH\u2082O)",xyz:"4\nFormaldehyde\nH  1.0686 -0.1411  1.0408\nC  0.5979  0.0151  0.0688\nH  1.2687  0.2002 -0.7717\nO -0.5960 -0.0151 -0.0686"},water:{name:"Water (H\u2082O)",xyz:"3\nWater molecule\nO  0.000000  0.000000  0.000000\nH  0.757000  0.586000  0.000000\nH -0.757000  0.586000  0.000000"},urea:{name:"Urea (CH\u2084N\u2082O)",xyz:"8\nUrea molecule\nC  0.000000  0.000000  0.000000\nO  0.000000  1.220000  0.000000\nN  1.150000 -0.610000  0.000000\nN -1.150000 -0.610000  0.000000\nH  1.150000 -1.610000  0.000000\nH  2.050000 -0.110000  0.000000\nH -1.150000 -1.610000  0.000000\nH -2.050000 -0.110000  0.000000"},formamide:{name:"Formamide (CH\u2083NO)",xyz:"6\nFormamide molecule\nC  0.000000  0.000000  0.000000\nO  1.220000  0.000000  0.000000\nN -0.610000  1.150000  0.000000\nH -0.610000 -0.950000  0.000000\nH -1.610000  1.150000  0.000000\nH -0.110000  2.050000  0.000000"},methane:{name:"Methane (CH\u2084)",xyz:"5\nMethane molecule\nC  0.000000  0.000000  0.000000\nH  0.629000  0.629000  0.629000\nH -0.629000 -0.629000  0.629000\nH -0.629000  0.629000 -0.629000\nH  0.629000 -0.629000 -0.629000"},ammonia:{name:"Ammonia (NH\u2083)",xyz:"4\nAmmonia molecule\nN  0.000000  0.000000  0.000000\nH  0.000000  0.950000  0.330000\nH  0.820000 -0.480000  0.330000\nH -0.820000 -0.480000  0.330000"},ethylene:{name:"Ethylene (C\u2082H\u2084)",xyz:"6\nEthylene molecule\nC  0.000000  0.000000  0.668000\nC  0.000000  0.000000 -0.668000\nH  0.000000  0.923000  1.232000\nH  0.000000 -0.923000  1.232000\nH  0.000000  0.923000 -1.232000\nH  0.000000 -0.923000 -1.232000"}},Oe=({onFileLoad:e,onValidationChange:t})=>{const[s,n]=(0,a.useState)(""),[r,l]=(0,a.useState)(""),[i,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)("formaldehyde"),[u,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)(""),x=(0,a.useRef)(null),v=(0,a.useRef)(null),j=e=>{try{const t=e.trim().split("\n").filter((e=>e.trim()));if(t.length<3)return{isValid:!1,error:"XYZ file must have at least 3 lines"};const s=parseInt(t[0]);if(isNaN(s)||s<=0)return{isValid:!1,error:"First line must be a positive integer (number of atoms)"};const a=t.slice(2);if(a.length<s)return{isValid:!1,error:`Expected ${s} atom lines, but found ${a.length}`};for(let e=0;e<s;e++){const t=a[e].trim().split(/\s+/);if(t.length<4)return{isValid:!1,error:`Line ${e+3}: Expected element symbol and 3 coordinates`};const s=t[0];if(!/^[A-Z][a-z]?$/.test(s))return{isValid:!1,error:`Line ${e+3}: Invalid element symbol format '${s}'`};for(let a=1;a<=3;a++){const s=parseFloat(t[a]);if(isNaN(s))return{isValid:!1,error:`Line ${e+3}: Invalid coordinate '${t[a]}'`}}}return{isValid:!0}}catch(t){return{isValid:!1,error:"Failed to parse XYZ format: "+t.message}}};(0,a.useEffect)((()=>{const s=ze.formaldehyde;l(s.xyz),n(""),d("formaldehyde"),m(!0),p(""),e(s.xyz),t&&t(!0)}),[]),(0,a.useEffect)((()=>()=>{v.current&&clearTimeout(v.current)}),[]);const f=async s=>{const a=s.name.split(".").pop()?.toLowerCase();if("xyz"===a){n(s.name);try{const a=await s.text();l(a);const n=j(a);m(n.isValid),p(n.error||""),n.isValid&&e(a),t&&t(n.isValid,n.error)}catch(r){console.error("Error reading file:",r),alert("Failed to read file: "+r.message)}}else alert("Please upload an XYZ file.")};return(0,Ee.jsxs)("div",{className:xe,children:[(0,Ee.jsxs)("div",{className:ve,children:[(0,Ee.jsx)("label",{className:je,children:"Example Molecules"}),(0,Ee.jsxs)("select",{value:c,onChange:s=>{const a=s.target.value;if(a&&ze[a]){const s=ze[a];l(s.xyz),n(""),d(a),m(!0),p(""),e(s.xyz),t&&t(!0),x.current&&(x.current.value="")}},className:fe,children:[(0,Ee.jsx)("option",{value:"",children:"Select an example..."}),Object.entries(ze).map((([e,t])=>(0,Ee.jsx)("option",{value:e,children:t.name},e)))]})]}),(0,Ee.jsxs)("div",{className:ge,children:[(0,Ee.jsxs)("div",{className:be,children:[(0,Ee.jsx)("span",{className:Ne,children:"XYZ Coordinates"}),(0,Ee.jsxs)("div",{className:ye,children:[(0,Ee.jsx)("button",{onClick:e=>{e.stopPropagation(),x.current?.click()},className:_e,children:"Browse"}),(s||r)&&(0,Ee.jsx)("button",{onClick:()=>{n(""),l(""),d(""),m(!0),p(""),t&&t(!0),x.current&&(x.current.value="")},className:we,children:"Clear"})]})]}),(0,Ee.jsxs)("div",{className:`${Se} ${i?Ce:""} ${u?r.trim()?$e:"":Fe}`,onDrop:e=>{e.preventDefault(),o(!1);const t=e.dataTransfer.files[0];t&&f(t)},onDragOver:e=>{e.preventDefault(),o(!0)},onDragLeave:()=>{o(!1)},children:[(0,Ee.jsx)("textarea",{value:r,onChange:s=>{const a=s.target.value;l(a),n(""),d(""),v.current&&clearTimeout(v.current),v.current=setTimeout((()=>{if(a.trim()){const s=j(a);m(s.isValid),p(s.error||""),s.isValid&&e(a),t&&t(s.isValid,s.error)}else m(!0),p(""),t&&t(!0)}),300)},placeholder:s?`Loaded: ${s}`:"Select an example molecule above or drag & drop XYZ file here",rows:8,className:Me}),(0,Ee.jsx)("input",{ref:x,type:"file",accept:".xyz",onChange:e=>{const t=e.target.files?.[0];t&&f(t)},style:{display:"none"}})]}),!u&&h&&(0,Ee.jsx)("div",{className:ke,children:h})]})]})},Le="section_H6hy",Ie="field_rd2A",Te="checkboxLabel_PBvi",Re="disabled_hTIz",De="fieldDescription_BWzj",He=({method:e,setMethod:t,basisSet:s,setBasisSet:a,maxIterations:n,setMaxIterations:r,energyTolerance:l,setEnergyTolerance:i,logLevel:o,setLogLevel:c,optimize:d,setOptimize:u,computeFrequencies:m,setComputeFrequencies:h,charge:p,setCharge:x})=>(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("h3",{children:"Calculation Method"}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsx)("label",{children:"Theory Level"}),(0,Ee.jsxs)("select",{value:e,onChange:e=>t(e.target.value),children:[(0,Ee.jsx)("option",{value:"hf",children:"Hartree-Fock (HF)"}),(0,Ee.jsx)("option",{value:"dft-b3lyp",children:"DFT (B3LYP)"}),(0,Ee.jsx)("option",{value:"dft-pbe",children:"DFT (PBE)"}),(0,Ee.jsx)("option",{value:"dft-pbe0",children:"DFT (PBE0)"}),(0,Ee.jsx)("option",{value:"dft-blyp",children:"DFT (BLYP)"}),(0,Ee.jsx)("option",{value:"dft-wb97x",children:"DFT (\u03c9B97X)"})]})]}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsx)("label",{children:"Basis Set"}),(0,Ee.jsxs)("select",{value:s,onChange:e=>a(e.target.value),children:[(0,Ee.jsx)("option",{value:"sto-3g",children:"STO-3G"}),(0,Ee.jsx)("option",{value:"3-21g",children:"3-21G"}),(0,Ee.jsx)("option",{value:"6-31g",children:"6-31G"}),(0,Ee.jsx)("option",{value:"6-31g(d,p)",children:"6-31G(d,p)"}),(0,Ee.jsx)("option",{value:"6-311g(d,p)",children:"6-311G(d,p)"}),(0,Ee.jsx)("option",{value:"def2-svp",children:"def2-SVP"}),(0,Ee.jsx)("option",{value:"def2-tzvp",children:"def2-TZVP"}),(0,Ee.jsx)("option",{value:"cc-pvdz",children:"cc-pVDZ"}),(0,Ee.jsx)("option",{value:"cc-pvtz",children:"cc-pVTZ"}),(0,Ee.jsx)("option",{value:"cc-pvqz",children:"cc-pVQZ"}),(0,Ee.jsx)("option",{value:"pcseg-0",children:"pc-0"}),(0,Ee.jsx)("option",{value:"pcseg-1",children:"pc-1"}),(0,Ee.jsx)("option",{value:"pcseg-2",children:"pc-2"}),(0,Ee.jsx)("option",{value:"pcseg-3",children:"pc-3"}),(0,Ee.jsx)("option",{value:"aug-pcseg-1",children:"aug-pc-1"}),(0,Ee.jsx)("option",{value:"aug-pcseg-2",children:"aug-pc-2"})]})]}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsx)("label",{children:"Molecular Charge"}),(0,Ee.jsx)("input",{type:"number",min:"-5",max:"5",step:"1",value:p,onChange:e=>x(parseInt(e.target.value)||0)}),(0,Ee.jsx)("small",{className:De,children:"Net charge on the molecule (restricted to even electron counts)"})]})]}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("h3",{children:"Calculation Options"}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsxs)("label",{className:Te,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:d,onChange:e=>u(e.target.checked)}),(0,Ee.jsx)("span",{children:"Geometry Optimization"})]}),(0,Ee.jsx)("small",{className:De,children:"Optimize molecular geometry to find minimum energy structure"})]}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsxs)("label",{className:`${Te} ${d?"":Re}`,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:m,onChange:e=>h(e.target.checked),disabled:!d}),(0,Ee.jsx)("span",{children:"Vibrational Frequencies"})]}),(0,Ee.jsx)("small",{className:De,children:"Calculate vibrational frequencies after optimization (requires optimization)"})]})]}),(0,Ee.jsxs)("div",{className:Le,children:[(0,Ee.jsx)("h3",{children:"SCF Settings"}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsx)("label",{children:"Max Iterations"}),(0,Ee.jsx)("input",{type:"number",min:"10",max:"500",value:n,onChange:e=>r(parseInt(e.target.value))})]}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsx)("label",{children:"Energy Tolerance"}),(0,Ee.jsxs)("select",{value:l.toString(),onChange:e=>i(parseFloat(e.target.value)),children:[(0,Ee.jsx)("option",{value:"1e-6",children:"1e-6"}),(0,Ee.jsx)("option",{value:"1e-7",children:"1e-7"}),(0,Ee.jsx)("option",{value:"1e-8",children:"1e-8"}),(0,Ee.jsx)("option",{value:"1e-9",children:"1e-9"}),(0,Ee.jsx)("option",{value:"1e-10",children:"1e-10"})]})]}),(0,Ee.jsxs)("div",{className:Ie,children:[(0,Ee.jsx)("label",{children:"Log Level"}),(0,Ee.jsxs)("select",{value:o,onChange:e=>c(parseInt(e.target.value)),children:[(0,Ee.jsx)("option",{value:"0",children:"Trace"}),(0,Ee.jsx)("option",{value:"1",children:"Debug"}),(0,Ee.jsx)("option",{value:"2",children:"Info"}),(0,Ee.jsx)("option",{value:"3",children:"Warning"}),(0,Ee.jsx)("option",{value:"4",children:"Error"}),(0,Ee.jsx)("option",{value:"5",children:"Critical"})]})]})]})]}),qe="container_R89I",Ve="summaryGrid_ag2i",Ae="energyCard_YXOX",Pe="statusCard_RoU8",Be="propertiesCard_AHmH",Ue="primaryEnergy_Xokq",Xe="secondaryEnergy_Gl5x",Ye="propertyItem_grVF",Ze="exportSection_Tufw",Ge="exportButtons_Op6D",We="exportButton_Xvg9",Ke="energyValues_pzt_",Je="statusInfo_hd1b",Qe="convergenceStatus_AYcc",et="converged_xwWE",tt="notConverged_Y8IO",st="timing_HvIZ",at="propertyList_aAAD",nt="propertyLabel_Acxr",rt="propertyValue_OR5o",lt="exportButtonDisabled_HPmD",it="noResults_jWfa",ot="optimizationInfo_faKG",ct="infoItem_rXyy",dt=({results:e})=>{if(!e)return(0,Ee.jsxs)("div",{className:it,children:[(0,Ee.jsx)("h3",{children:"No Results Yet"}),(0,Ee.jsx)("p",{children:"Run a calculation to see results here."})]});const t=t=>{if(!e.wavefunctionData)return;let s,a,n;switch(t){case"fchk":if(!e.wavefunctionData.fchk)return void alert("FCHK data not available.");s=e.wavefunctionData.fchk,a="wavefunction.fchk",n="text/plain";break;case"json":s=JSON.stringify({energy:e.energy,energyInEV:e.energyInEV,properties:e.properties,numBasisFunctions:e.wavefunctionData.numBasisFunctions,numAtoms:e.wavefunctionData.numAtoms,calculationTime:e.elapsedMs},null,2),a="wavefunction.json",n="application/json"}const r=new Blob([s],{type:n}),l=URL.createObjectURL(r),i=document.createElement("a");i.href=l,i.download=a,i.click(),URL.revokeObjectURL(l)};return(0,Ee.jsxs)("div",{className:qe,children:[(0,Ee.jsxs)("div",{className:Ve,children:[(0,Ee.jsxs)("div",{className:Ae,children:[(0,Ee.jsx)("h4",{children:"Total Energy"}),(0,Ee.jsxs)("div",{className:Ke,children:[(0,Ee.jsxs)("div",{className:Ue,children:[e.energy.toFixed(8)," Eh"]}),(0,Ee.jsxs)("div",{className:Xe,children:[e.energyInEV.toFixed(6)," eV"]})]})]}),(0,Ee.jsxs)("div",{className:Pe,children:[(0,Ee.jsx)("h4",{children:"Status"}),(0,Ee.jsxs)("div",{className:Je,children:[(0,Ee.jsx)("div",{className:`${Qe} ${e.converged?et:tt}`,children:e.converged?"\u2713 Converged":"\u2717 Not Converged"}),(0,Ee.jsx)("div",{className:st,children:(s=e.elapsedMs,`${Math.floor(s/1e3)}s ${Math.round(s%1e3)}ms`)})]})]}),e.properties&&(0,Ee.jsxs)("div",{className:Be,children:[(0,Ee.jsx)("h4",{children:"Key Properties"}),(0,Ee.jsxs)("div",{className:at,children:[void 0!==e.properties.homo&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:nt,children:"HOMO:"}),(0,Ee.jsxs)("span",{className:rt,children:[e.properties.homo.toFixed(6)," Eh"]})]}),void 0!==e.properties.lumo&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:nt,children:"LUMO:"}),(0,Ee.jsxs)("span",{className:rt,children:[e.properties.lumo.toFixed(6)," Eh"]})]}),void 0!==e.properties.gap&&(0,Ee.jsxs)("div",{className:Ye,children:[(0,Ee.jsx)("span",{className:nt,children:"Gap:"}),(0,Ee.jsxs)("span",{className:rt,children:[e.properties.gap.toFixed(6)," Eh"]})]})]})]})]}),e.wavefunctionData&&(0,Ee.jsxs)("div",{className:Ze,children:[(0,Ee.jsx)("h4",{children:"Export Wavefunction"}),(0,Ee.jsxs)("div",{className:Ge,children:[(0,Ee.jsx)("button",{className:We,onClick:()=>t("json"),children:"\u2193 JSON"}),(0,Ee.jsxs)("button",{className:e.wavefunctionData.fchk?We:`${We} ${lt}`,onClick:()=>e.wavefunctionData.fchk?t("fchk"):alert("FCHK data not available. Check the calculation logs for details."),disabled:!e.wavefunctionData.fchk,title:e.wavefunctionData.fchk?"Download FCHK file":"FCHK generation failed - see logs",children:["\u2193 FCHK ",!e.wavefunctionData.fchk&&"(unavailable)"]})]})]}),e.optimization&&(0,Ee.jsxs)("div",{className:Ze,children:[(0,Ee.jsx)("h4",{children:"Export Optimized Geometry"}),(0,Ee.jsx)("div",{className:Ge,children:(0,Ee.jsx)("button",{className:We,onClick:()=>{if(!e.optimization?.finalXYZ)return;const t=e.optimization.finalXYZ,s=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download="optimized_geometry.xyz",n.click(),URL.revokeObjectURL(a)},title:"Download optimized geometry in XYZ format",children:"\u2193 Optimized XYZ"})}),(0,Ee.jsxs)("div",{className:ot,children:[(0,Ee.jsxs)("div",{className:ct,children:[(0,Ee.jsx)("span",{children:"Status:"}),(0,Ee.jsx)("span",{className:`${Qe} ${e.optimization.trajectory.converged?et:tt}`,children:e.optimization.trajectory.converged?"\u2713 Converged":"\u2717 Not Converged"})]}),(0,Ee.jsxs)("div",{className:ct,children:[(0,Ee.jsx)("span",{children:"Steps:"}),(0,Ee.jsx)("span",{children:e.optimization.steps})]}),(0,Ee.jsxs)("div",{className:ct,children:[(0,Ee.jsx)("span",{children:"Final Energy:"}),(0,Ee.jsxs)("span",{children:[e.energy.toFixed(8)," Eh"]})]})]})]})]});var s},ut={container:"container_BYXD",header:"header_RGzB",controls:"controls_Rvup",button:"button_YEOU",buttonActive:"buttonActive_nb5D",logOutput:"logOutput_RpAa",noLogs:"noLogs_oYTM",logEntry:"logEntry_Oa3L",timestamp:"timestamp__Tyr",message:"message_A8Nt","log-debug":"log-debug_cHxc","log-info":"log-info_Lwm5","log-warn":"log-warn_SwuY","log-error":"log-error_TdP2"},mt=({logs:e})=>{const[t,s]=(0,a.useState)(!0),n=(0,a.useRef)(null);(0,a.useEffect)((()=>{t&&n.current&&(n.current.scrollTop=n.current.scrollHeight)}),[e,t]);return(0,Ee.jsxs)("div",{className:ut.container,children:[(0,Ee.jsxs)("div",{className:ut.header,children:[(0,Ee.jsx)("h3",{children:"Calculation Output"}),(0,Ee.jsx)("div",{className:ut.controls,children:(0,Ee.jsx)("button",{className:`${ut.button} ${t?ut.buttonActive:""}`,onClick:()=>s(!t),children:t?"Auto-scroll ON":"Auto-scroll OFF"})})]}),(0,Ee.jsx)("div",{ref:n,className:ut.logOutput,children:0===e.length?(0,Ee.jsx)("div",{className:ut.noLogs,children:"No output yet. Run a calculation to see logs."}):e.map(((e,t)=>{return(0,Ee.jsxs)("div",{className:`${ut.logEntry} ${ut[`log-${e.level}`]}`,children:[(0,Ee.jsxs)("span",{className:ut.timestamp,children:["[",(s=e.timestamp,s.toLocaleTimeString()),"]"]}),(0,Ee.jsx)("span",{className:ut.message,children:e.message})]},t);var s}))})]})},ht="matrixContainer__RiK",pt="header_t7QL",xt="controls_sj24",vt="dimensions_G9Ce",jt="toggleButton_ziSy",ft="downloadButton_yZ_5",gt="matrixWrapper_lIP_",bt="matrix_UPd_",Nt="matrixElement_jLaA",yt="infoContent_XCc5",_t="fullMatrix_FIje",St="zeroElement_VjgC",Ct="truncationNotice_Npk0",$t="matrixInfo_AD0u",Ft="infoToggle_sbWR",wt=({matrix:e,title:t,precision:s=6,maxDisplaySize:n=8})=>{const[r,l]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);if(!e||!e.data)return(0,Ee.jsxs)("div",{className:ht,children:[(0,Ee.jsx)("h4",{children:t}),(0,Ee.jsx)("p",{children:"Matrix data not available"})]});const{rows:c,cols:d,data:u}=e,m=c>n||d>n,h=i?c:Math.min(c,n),p=i?d:Math.min(d,n),x=e=>Math.abs(e)<1e-10?"\xb7":e.toFixed(s);return(0,Ee.jsxs)("div",{className:ht,children:[(0,Ee.jsxs)("div",{className:pt,children:[(0,Ee.jsx)("h4",{children:t}),(0,Ee.jsxs)("div",{className:xt,children:[(0,Ee.jsxs)("span",{className:vt,children:[c," \xd7 ",d]}),m&&(0,Ee.jsx)("button",{className:jt,onClick:()=>o(!i),children:i?"Show Preview":"Show Full"}),(0,Ee.jsx)("button",{className:ft,onClick:()=>{const e=u.map((e=>e.map((e=>x(e))).join(","))).join("\n"),s=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`${t.toLowerCase().replace(/\s+/g,"_")}_matrix.csv`,n.click(),URL.revokeObjectURL(a)},title:"Download as CSV",children:"\u2193 CSV"})]})]}),(0,Ee.jsxs)("div",{className:gt,children:[(0,Ee.jsx)("div",{className:`${bt} ${i?_t:""}`,style:{gridTemplateColumns:`repeat(${p}, 1fr)`},children:Array.from({length:h},((e,t)=>Array.from({length:p},((e,s)=>{const a=u[t]?.[s]||0,n=x(a),r=Math.abs(a)<1e-10;return(0,Ee.jsx)("div",{className:`${Nt} ${r?St:""}`,title:`[${t+1},${s+1}] = ${a}`,children:n},`${t}-${s}`)}))))}),m&&!i&&(0,Ee.jsxs)("div",{className:Ct,children:["Showing ",h," \xd7 ",p," of ",c," \xd7 ",d," matrix"]})]}),(0,Ee.jsxs)("div",{className:$t,children:[(0,Ee.jsxs)("button",{className:Ft,onClick:()=>l(!r),children:[r?"\u25bc":"\u25b6"," Matrix Information"]}),r&&(0,Ee.jsxs)("div",{className:yt,children:[(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Dimensions:"})," ",c," rows \xd7 ",d," columns"]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Total elements:"})," ",c*d]}),u.length>0&&u[0]&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Max value:"})," ",Math.max(...u.flat()).toFixed(s)]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Min value:"})," ",Math.min(...u.flat()).toFixed(s)]}),(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:"Trace (diagonal sum):"})," ",u.reduce(((e,t,s)=>e+(t[s]||0)),0).toFixed(s)]})]})]})]})]})};var Mt=s(7851);const kt="container_BTtL",Et="header_Zg_R",zt="controls_krEJ",Ot="controlButton_kE_9",Lt="viewer_MOiN",It="representationControls_JFkt",Tt="controlGroup_advN",Rt="inlineControlGroup_p0fZ",Dt="controlLabel_p9ac",Ht="controlSelect_wf9l",qt="checkboxLabel_O6nm",Vt="checkbox_vb0q",At="numberInput_NZEF",Pt="slicePositionControls_XcJh",Bt="collapsibleControl_f2QI",Ut="controlToggle_IHht",Xt="controlContent_BMT8",Yt="colorRangeGrid_zP5d",Zt="computingIndicator_nVPU",Gt="mainContent_hmUM",Wt="viewerContainer_HOsW",Kt="orbitalSidebar_Sjw1",Jt="open_VSem",Qt="orbitalToggleButton_zhVa",es="orbitalSidebarHeader_sOPI",ts="orbitalCloseButton_PBas",ss="moControls_QuQW",as="collapsibleSection_wCEA",ns="lightSectionHeader_RRMY",rs="chevron_qy2f",ls="chevronExpanded_o9bu",is="sectionContent_L8gO",os="orbitalList_q8AK",cs="placeholder_XAIu",ds="loading_XCE6",us="error_fQgs",ms="orbitalItem_coIp",hs="orbitalOccupied_2McF",ps="orbitalVirtual_y4gy",xs="orbitalSelected_kMgf",vs="orbitalContent_ff1A",js="orbitalEnergy_svnX",fs="orbitalEnergyEV_OrpY",gs="orbitalLabel_q_Pv",bs="orbitalIndicators_GNGS",Ns="occupationBadge_DFgd",ys="orbitalColorIndicator_WBpC",_s="orbitalColorPicker_rcrR",Ss=({orbital:e,isHOMO:t=!1,isLUMO:s=!1,isSelected:a=!1,colorIndicator:n,onColorChange:r,onClick:l,className:i=""})=>{const o=e.energy/27.2114;return(0,Ee.jsxs)("div",{className:`${ms} ${e.isOccupied?hs:ps} ${a?xs:""} ${i}`,onClick:l,title:`MO ${e.index}: ${e.energy.toFixed(3)} eV (occupation: ${e.occupation})`,style:{cursor:l?"pointer":"default"},children:[(0,Ee.jsxs)("div",{className:vs,children:[(0,Ee.jsxs)("div",{className:js,children:[o.toFixed(6)," Eh"]}),(0,Ee.jsxs)("div",{className:fs,children:[e.energy.toFixed(3)," eV"]}),(t||s)&&(0,Ee.jsx)("div",{className:gs,children:t?"HOMO":"LUMO"})]}),(0,Ee.jsxs)("div",{className:bs,children:[e.occupation>0&&(0,Ee.jsx)("div",{className:Ns,children:2===e.occupation?"\u2191\u2193":1===e.occupation?"\u2191":""}),n&&(a?(0,Ee.jsx)("input",{type:"color",value:n,onChange:e=>{e.stopPropagation(),r?.(e.target.value)},onClick:e=>e.stopPropagation(),className:_s,title:`Change color for MO ${e.index}`}):(0,Ee.jsx)("div",{className:ys,style:{backgroundColor:n},title:`Last used color: ${n}`}))]})]})},Cs=({xyzData:e,moleculeName:t="Molecule",wavefunctionResults:s,cubeResults:n,cubeGridInfo:r,onRequestCubeComputation:l})=>{const i=(0,a.useRef)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(null),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),[x,v]=(0,a.useState)("ball+stick"),[j,f]=(0,a.useState)(!0),[g,b]=(0,a.useState)("element"),[N,y]=(0,a.useState)(new Set),[_,S]=(0,a.useState)(.01),[C,$]=(0,a.useState)(!1),[F,w]=(0,a.useState)(1),[M,k]=(0,a.useState)(!1),[E,z]=(0,a.useState)((()=>{try{const e=localStorage.getItem("orbitalColors");if(e){const t=JSON.parse(e);return new Map(Object.entries(t).map((([e,t])=>[parseInt(e),t])))}}catch(h){console.warn("Failed to load orbital colors from localStorage:",h)}return new Map})),[O,L]=(0,a.useState)(40),I=(0,a.useRef)(null),T=(0,a.useRef)(null),[R,D]=(0,a.useState)(!0),[H,q]=(0,a.useState)(!1),V=(0,a.useRef)(null),[A,P]=(0,a.useState)(null),[B,U]=(0,a.useState)("surface"),[X,Y]=(0,a.useState)(!1),[Z,G]=(0,a.useState)("z"),[W,K]=(0,a.useState)(0),[J,Q]=(0,a.useState)("rwb"),[ee,te]=(0,a.useState)([0,.05]),[se,ae]=(0,a.useState)(!1),ne=()=>"dark"===document.documentElement.getAttribute("data-theme")?"#1b1b1d":"#ffffff";(0,a.useEffect)((()=>{if(!i.current)return;o.current=new Mt.BI(i.current,{backgroundColor:ne(),quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10,fogNear:100,fogFar:100});const e=()=>{o.current&&o.current.handleResize()};window.addEventListener("resize",e);const t=new MutationObserver((()=>{o.current&&o.current.setParameters({backgroundColor:ne()})}));return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{window.removeEventListener("resize",e),t.disconnect(),o.current&&o.current.dispose()}}),[]);const re=()=>{if(!c.current)return;c.current.removeAllRepresentations();const e={colorScheme:g,sele:j?"all":"not hydrogen"};switch(x){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0;break;case"surface":e.opacity=.8,e.surfaceType="vws"}c.current.addRepresentation(x,e),o.current?.autoView()};(0,a.useEffect)((()=>{re()}),[x,j,g]);const le=async e=>{if(o.current)try{o.current.removeAllComponents();const s=((e,t)=>{const s=e.trim().split("\n"),a=parseInt(s[0]),n=s[1]||t,r=[];for(let m=2;m<2+a;m++){const e=s[m].trim().split(/\s+/);r.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const l={"H-H":.74,"H-C":1.09,"H-N":1.01,"H-O":.96,"H-S":1.34,"C-C":1.54,"C-N":1.47,"C-O":1.43,"C-S":1.82,"N-N":1.45,"N-O":1.4,"N-S":1.68,"O-O":1.48,"O-S":1.66,"S-S":2.05},i=(e,t)=>{const s=e.x-t.x,a=e.y-t.y,n=e.z-t.z;return Math.sqrt(s*s+a*a+n*n)},o=[];for(let m=0;m<r.length;m++)for(let e=m+1;e<r.length;e++){const t=i(r[m],r[e]),s=l[`${c=r[m].element}-${d=r[e].element}`]||l[`${d}-${c}`]||2;if(t<=1.3*s){let a=1;t<.85*s&&(a=2),t<.75*s&&(a=3),o.push({atom1:m+1,atom2:e+1,order:a})}}var c,d;let u=`${n}\n`;return u+="  Generated from XYZ with bond guessing\n",u+="\n",u+=`${a.toString().padStart(3," ")}${o.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`,r.forEach((e=>{const t=e.x.toFixed(4).padStart(10," "),s=e.y.toFixed(4).padStart(10," "),a=e.z.toFixed(4).padStart(10," ");u+=`${t}${s}${a} ${e.element.padEnd(3," ")} 0  0  0  0  0  0  0  0  0  0  0  0\n`})),o.forEach((e=>{u+=`${e.atom1.toString().padStart(3," ")}${e.atom2.toString().padStart(3," ")}${e.order.toString().padStart(3," ")}  0  0  0  0\n`})),u+="M  END\n$$$$\n",u})(e,t),a=new Blob([s],{type:"text/plain"}),n=await o.current.loadFile(a,{ext:"sdf",name:t});c.current=n,re()}catch(s){throw console.error("Error loading geometry:",s),s}};(0,a.useEffect)((()=>{if(!e||!o.current)return;(async()=>{m(!0),p("");try{await le(e),m(!1)}catch(t){console.error("Error loading molecule:",t),p("Failed to load molecule structure"),m(!1)}})()}),[e,t]);const ie=a.useMemo((()=>{if(!s?.orbitalEnergies||!s?.orbitalOccupations)return[];const e=[];for(let t=0;t<s.orbitalEnergies.length;t++){const a=s.orbitalEnergies[t],n=s.orbitalOccupations[t]||0;e.push({index:t,energy:27.2114*a,occupation:n,isOccupied:n>0})}return e}),[s]),oe=ie;(0,a.useEffect)((()=>{if(ie.length>0&&l&&N.size>0){const e=[];for(const t of N){const s=`molecular_orbital_${t}_${O}`,a=n?.get(s);a||e.push(t)}e.length>0&&(I.current&&clearTimeout(I.current),I.current=setTimeout((()=>{ce(e)}),300))}return()=>{I.current&&clearTimeout(I.current),T.current&&clearTimeout(T.current)}}),[N,ie.length,n,O]);const ce=async e=>{if(l&&o.current){k(!0),p("");try{const t=ie.length-1;for(const s of e){if(s<0||s>t)throw new Error(`Invalid orbital index ${s}. Valid range: 0-${t}`);l("molecular_orbital",s,O)}}catch(h){console.error("Error requesting MO computation:",h),p("Failed to request molecular orbital computation: "+h.message),k(!1)}}};(0,a.useEffect)((()=>{if(console.log("MO visualization effect triggered:",{selectedOrbitals:N.size,cubeResults:n.size,orbitalRenderStyle:B,sliceDirection:Z,slicePosition:W}),T.current&&(clearTimeout(T.current),T.current=null),!o.current)return;if(0===N.size)return void de();if(!n)return;Array.from(N).every((e=>{const t=`molecular_orbital_${e}_${O}`;return n.get(t)}))&&(de(),M&&k(!1))}),[n,N,_,C,F,B,Z,W,J,ee]);const de=async()=>{var e,t;if(o.current)try{d.current&&(Array.isArray(d.current)?d.current.forEach((e=>{e&&o.current&&o.current.removeComponent(e)})):o.current&&o.current.removeComponent(d.current),d.current=null);const s=[],a=["#4A90E2","#FF8C42","#7B68EE","#32CD32","#FF6B6B","#9B59B6"];if(0===N.size)return d.current=[],void o.current.autoView();for(const[r,l]of Array.from(N).entries()){const i=`molecular_orbital_${l}_${O}`,c=n?.get(i);if(c){const n=new Blob([c],{type:"text/plain"}),i=await o.current.loadFile(n,{ext:"cube",name:`MO_${l}`});if(i){let n=E.get(l);if(n||(n=a[r%a.length],z((e=>{const t=new Map(e);return t.set(l,n),t}))),"surface"===B)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:_,color:n,opacity:F,opaqueBack:!1}),C&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-_,color:"red",opacity:F,opaqueBack:!1});else if("wireframe"===B)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:_,color:n,opacity:F,wireframe:!0,linewidth:2}),C&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-_,color:"red",opacity:F,wireframe:!0,linewidth:2});else if("dot"===B)i.addRepresentation("dot",{visible:!0,color:n,opacity:F,dotType:"square",dotSpacing:2,threshold:.001});else if("slice"===B){const s=(e=Z,t=W,console.log(`Slice position: direction=${e}, position=${t}`),t);console.log(`Adding slice representation: direction=${Z}, normalizedPos=${W}, coordinatePos=${s}`),i.addRepresentation("slice",{visible:!0,opacity:F,dimension:Z,positionType:"coordinate",position:s,thresholdMin:ee[0],thresholdMax:ee[1],thresholdType:"value",colorScheme:J,colorDomain:ee})}s.push(i)}}}d.current=s,o.current.autoView()}catch(h){console.error("Error visualizing molecular orbitals:",h),p("Failed to visualize molecular orbitals: "+h.message)}};return(0,a.useEffect)((()=>{(async()=>{if(!o.current)return;if(V.current&&(o.current.removeComponent(V.current),V.current=null),!H)return;let e=null;if(r){const t=r.origin,s=r.steps,a=r.nx,n=r.ny,l=r.nz,i=r.basis;if(t&&s&&a&&n&&l&&i){const s=[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],r=[t[0],t[1],t[2]],o=[t[0]+(a-1)*s[0][0]+(n-1)*s[1][0]+(l-1)*s[2][0],t[1]+(a-1)*s[0][1]+(n-1)*s[1][1]+(l-1)*s[2][1],t[2]+(a-1)*s[0][2]+(n-1)*s[1][2]+(l-1)*s[2][2]],c=.529177;e={min:[r[0]*c,r[1]*c,r[2]*c],max:[o[0]*c,o[1]*c,o[2]*c]},console.log("Grid bounds (converted to Angstrom):",e)}}if(e)try{const[t,s,a]=e.min,[n,r,l]=e.max,i=[[t,s,a],[n,s,a],[n,r,a],[t,r,a],[t,s,l],[n,s,l],[n,r,l],[t,r,l]],c=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];let d=`Grid Bounds\n  Generated\n  \n${i.length.toString().padStart(3," ")}${c.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`;i.forEach((([e,t,s])=>{d+=`${e.toFixed(4).padStart(10," ")}${t.toFixed(4).padStart(10," ")}${s.toFixed(4).padStart(10," ")} C   0  0  0  0  0  0  0  0  0  0  0  0\n`})),c.forEach((([e,t])=>{d+=`${(e+1).toString().padStart(3," ")}${(t+1).toString().padStart(3," ")}  1  0  0  0  0\n`})),d+="M  END\n$$$$\n";const u=new Blob([d],{type:"text/plain"}),m=await o.current.loadFile(u,{ext:"mol",name:"Grid_Bounds"});m&&(m.addRepresentation("line",{colorScheme:"uniform",colorValue:"#ff6b6b",linewidth:2,opacity:.7}),V.current=m)}catch(h){console.error("Error creating grid bounds visualization:",h),p("Failed to create grid bounds visualization: "+h.message)}else console.log("No cube grid info available - cannot show accurate grid bounds")})()}),[H,r]),(0,a.useEffect)((()=>{try{const e=Object.fromEntries(E);localStorage.setItem("orbitalColors",JSON.stringify(e))}catch(h){console.warn("Failed to save orbital colors to localStorage:",h)}}),[E]),e?(0,Ee.jsxs)("div",{className:kt,children:[(0,Ee.jsxs)("div",{className:Et,children:[(0,Ee.jsx)("h4",{children:"3D Structure & Molecular Orbitals"}),(0,Ee.jsxs)("div",{className:zt,children:[(0,Ee.jsx)("button",{className:Ot,onClick:()=>{o.current&&o.current.autoView()},title:"Reset view",children:"\u2302"}),(0,Ee.jsx)("button",{className:Ot,onClick:()=>{o.current&&o.current.toggleFullscreen(i.current)},title:"Toggle fullscreen",children:"\u26f6"})]})]}),(0,Ee.jsxs)("div",{className:It,children:[(0,Ee.jsxs)("div",{className:Rt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Style"}),(0,Ee.jsxs)("select",{value:x,onChange:e=>v(e.target.value),className:Ht,children:[(0,Ee.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,Ee.jsx)("option",{value:"line",children:"Line"}),(0,Ee.jsx)("option",{value:"spacefill",children:"Space Fill"}),(0,Ee.jsx)("option",{value:"licorice",children:"Licorice"}),(0,Ee.jsx)("option",{value:"surface",children:"Surface"})]})]}),(0,Ee.jsxs)("div",{className:Rt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Color"}),(0,Ee.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:Ht,children:[(0,Ee.jsx)("option",{value:"element",children:"By Element"}),(0,Ee.jsx)("option",{value:"uniform",children:"Uniform"}),(0,Ee.jsx)("option",{value:"chainname",children:"By Chain"}),(0,Ee.jsx)("option",{value:"random",children:"Random"})]})]})]}),(0,Ee.jsxs)("div",{className:Gt,children:[(0,Ee.jsxs)("div",{className:Wt,children:[h&&(0,Ee.jsx)("div",{className:us,children:(0,Ee.jsx)("p",{children:h})}),u&&(0,Ee.jsx)("div",{className:ds,children:(0,Ee.jsx)("p",{children:"Loading molecule..."})}),(0,Ee.jsx)("div",{ref:i,className:Lt,style:{opacity:u?.5:1}}),s&&ie.length>0&&(0,Ee.jsx)("button",{className:Qt,onClick:()=>Y(!X),children:X?"Hide":"Orbitals"})]}),s&&ie.length>0&&(0,Ee.jsxs)("div",{className:`${Kt} ${X?Jt:""}`,children:[(0,Ee.jsxs)("div",{className:es,children:[(0,Ee.jsx)("h5",{children:"Molecular Orbitals"}),(0,Ee.jsx)("button",{className:ts,onClick:()=>Y(!1),title:"Close orbital panel",children:"\xd7"})]}),(0,Ee.jsxs)("div",{className:as,children:[(0,Ee.jsxs)("button",{className:ns,onClick:()=>D(!R),children:[(0,Ee.jsx)("span",{children:"Settings"}),(0,Ee.jsx)("span",{className:`${rs} ${R?ls:""}`,children:"\u25bc"})]}),R&&(0,Ee.jsx)("div",{className:is,children:(0,Ee.jsxs)("div",{className:ss,children:[(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Style"}),(0,Ee.jsxs)("select",{value:B,onChange:e=>U(e.target.value),className:Ht,children:[(0,Ee.jsx)("option",{value:"surface",children:"Surface"}),(0,Ee.jsx)("option",{value:"wireframe",children:"Wireframe"}),(0,Ee.jsx)("option",{value:"dot",children:"Dot Volume"}),(0,Ee.jsx)("option",{value:"slice",children:"Slice Volume"})]})]}),("surface"===B||"wireframe"===B)&&(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Isovalue"}),(0,Ee.jsx)("input",{type:"number",min:"0.001",max:"0.2",step:"0.001",value:_,onChange:e=>S(parseFloat(e.target.value)||.01),className:At})]}),"slice"===B&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Slice Direction"}),(0,Ee.jsxs)("select",{value:Z,onChange:e=>G(e.target.value),className:Ht,children:[(0,Ee.jsx)("option",{value:"x",children:"X-axis"}),(0,Ee.jsx)("option",{value:"y",children:"Y-axis"}),(0,Ee.jsx)("option",{value:"z",children:"Z-axis"})]})]}),(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Slice Position"}),(0,Ee.jsxs)("div",{className:Pt,children:[(0,Ee.jsx)("button",{onClick:()=>K(W-.5),className:Ot,title:"Move slice by -0.5",children:"-"}),(0,Ee.jsx)("input",{type:"number",step:"0.1",value:W,onChange:e=>K(parseFloat(e.target.value)||0),className:At,title:"Slice position in Angstroms"}),(0,Ee.jsx)("button",{onClick:()=>K(W+.5),className:Ot,title:"Move slice by +0.5",children:"+"})]})]}),(0,Ee.jsxs)("div",{className:Bt,children:[(0,Ee.jsxs)("button",{className:Ut,onClick:()=>ae(!se),children:[(0,Ee.jsx)("span",{className:Dt,children:"Color Range"}),(0,Ee.jsx)("span",{className:`${rs} ${se?ls:""}`,children:"\u25bc"})]}),se&&(0,Ee.jsx)("div",{className:Xt,children:(0,Ee.jsxs)("div",{className:Yt,children:[(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Minimum"}),(0,Ee.jsx)("input",{type:"number",step:"0.01",value:ee[0],onChange:e=>te([parseFloat(e.target.value)||0,ee[1]]),className:At,title:"Minimum value for color scale"})]}),(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Maximum"}),(0,Ee.jsx)("input",{type:"number",step:"0.01",value:ee[1],onChange:e=>te([ee[0],parseFloat(e.target.value)||.05]),className:At,title:"Maximum value for color scale"})]})]})})]})]}),(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Opacity"}),(0,Ee.jsx)("input",{type:"number",min:"0",max:"1",step:"0.05",value:F,onChange:e=>w(parseFloat(e.target.value)||1),className:At,title:"Orbital surface opacity (0 = transparent, 1 = opaque)"})]}),(0,Ee.jsxs)("div",{className:Tt,children:[(0,Ee.jsx)("label",{className:Dt,children:"Grid Steps"}),(0,Ee.jsx)("input",{type:"number",min:"20",max:"60",step:"5",value:O,onChange:e=>L(parseInt(e.target.value)||40),className:At,title:"Number of grid points per dimension (higher = more detail, slower)"}),r&&(0,Ee.jsxs)("label",{className:qt,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:H,onChange:e=>q(e.target.checked),className:Vt}),"Bounds"]})]}),M&&(0,Ee.jsx)("div",{className:Tt,children:(0,Ee.jsx)("span",{className:Zt,children:"Computing MO..."})})]})})]}),(0,Ee.jsx)("div",{className:os,children:oe.map(((e,t)=>{const s=ie.findIndex(((e,t)=>e.isOccupied&&(!ie[t+1]||!ie[t+1].isOccupied))),a=s>=0?s+1:-1,n=e.index===s,r=e.index===a,l=N.has(e.index),i=E.get(e.index);return(0,Ee.jsx)(Ss,{orbital:e,isHOMO:n,isLUMO:r,isSelected:l,colorIndicator:i,onColorChange:t=>((e,t)=>{z((s=>{const a=new Map(s);return a.set(e,t),a})),T.current&&clearTimeout(T.current),N.has(e)&&(T.current=setTimeout((()=>{de(),T.current=null}),50))})(e.index,t),onClick:()=>{return t=e.index,void y((e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s}));var t}},e.index)}))})]})]})]}):(0,Ee.jsx)("div",{className:kt,children:(0,Ee.jsxs)("div",{className:cs,children:[(0,Ee.jsx)("h4",{children:"Molecule Viewer"}),(0,Ee.jsx)("p",{children:"Load a molecule to see its 3D structure"})]})})};var $s=s(6370);class Fs{static DEFAULT_FRAMES=20;static DEFAULT_AMPLITUDE=.3;static precomputeAllTrajectories(e,t,s,a){const n=new Map;return t.forEach(((t,r)=>{const l=s[r],i=l&&l.length>0?this.generateTrajectory(e,l,t,r,a):this.createPlaceholderTrajectory(e,t,r);n.set(r,i)})),n}static generateTrajectory(e,t,s,a,n){const r=n?.frames??this.DEFAULT_FRAMES,l=n?.amplitude??this.DEFAULT_AMPLITUDE,{numAtoms:i,atoms:o}=this.parseGeometry(e);if(!o.length)return"";const c=[];for(let d=0;d<r;d++){const e=2*Math.PI*d/r,n=l*Math.sin(e),i=this.createFrame(o,t,n,s,a);c.push(i)}return c.join("\n")}static createPlaceholderTrajectory(e,t,s){const a=e.trim().split("\n"),n=parseInt(a[0]),r=[];for(let l=0;l<5;l++){const e=[n.toString()];e.push(`Mode ${s+1}: ${Math.abs(t).toFixed(2)} cm\u207b\xb9 (normal mode data unavailable)`);for(let t=2;t<a.length;t++)e.push(a[t]);r.push(e.join("\n"))}return r.join("\n")}static parseGeometry(e){const t=e.trim().split("\n"),s=parseInt(t[0]);if(t.length<s+2)return{numAtoms:0,atoms:[]};const a=[];for(let n=2;n<2+s;n++){const e=t[n].trim().split(/\s+/);a.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}return{numAtoms:s,atoms:a}}static createFrame(e,t,s,a,n){const r=[e.length.toString()];r.push(`Mode ${n+1}: ${Math.abs(a).toFixed(2)} cm\u207b\xb9 ${a<0?"(imaginary)":""}`);for(let l=0;l<e.length;l++){const a=e[l],n=t[3*l]||0,i=t[3*l+1]||0,o=t[3*l+2]||0,c=a.x+s*n,d=a.y+s*i,u=a.z+s*o;r.push(`${a.element}  ${c.toFixed(6)}  ${d.toFixed(6)}  ${u.toFixed(6)}`)}return r.join("\n")}}const ws=()=>{const[e,t]=(0,a.useState)(null),[n,xe]=(0,a.useState)(!1),[ve,je]=(0,a.useState)(""),[fe,ge]=(0,a.useState)(null),[be,Ne]=(0,a.useState)(!1),[ye,_e]=(0,a.useState)(null),[Se,Ce]=(0,a.useState)([]),[$e,Fe]=(0,a.useState)("structure"),[we,Me]=(0,a.useState)(""),[ke,ze]=(0,a.useState)(""),[Le,Ie]=(0,a.useState)(new Map),[Te,Re]=(0,a.useState)(null),[De,qe]=(0,a.useState)(!0),[Ve,Ae]=(0,a.useState)(!0),[Pe,Be]=(0,a.useState)(!0),[Ue,Xe]=(0,a.useState)("hf"),[Ye,Ze]=(0,a.useState)("3-21g"),[Ge,We]=(0,a.useState)(100),[Ke,Je]=(0,a.useState)(1e-8),[Qe,et]=(0,a.useState)(2),[tt,st]=(0,a.useState)(!1),[at,nt]=(0,a.useState)(!1),[rt,lt]=(0,a.useState)(0),[it,ot]=(0,a.useState)("optimization"),[ct,ut]=(0,a.useState)(null),[ht,pt]=(0,a.useState)(!0),[xt,vt]=(0,a.useState)(!0),[jt,ft]=(0,a.useState)(new Map);(0,a.useEffect)((()=>(gt(),()=>{e&&e.terminate()})),[]);const gt=async()=>{try{const e=new Worker(new URL(s.p+s.u(842),s.b),{type:void 0});e.onmessage=bt,e.onerror=e=>{console.error("Worker error:",e),Me("Worker error: "+e.message),xe(!1)},t(e),e.postMessage({type:"init",data:{}})}catch(we){console.error("Failed to initialize worker:",we),Me("Failed to initialize Web Worker: "+we.message)}},bt=e=>{const{type:t,...s}=e.data;switch(t){case"initialized":s.success?(xe(!0),yt("Worker initialized successfully","info")):(xe(!1),Me("Worker initialization failed: "+s.error));break;case"log":yt(s.message,Nt(s.level));break;case"progress":yt(s.message,"info"),"complete"===s.stage&&Ne(!1);break;case"result":_t(s);break;case"optimization_progress":yt(s.message,"info");break;case"cubeResult":St(s);break;case"error":console.error("Worker error:",s.error),Me("Calculation error: "+s.error),Ne(!1)}},Nt=e=>{switch(e){case 0:case 1:return"debug";case 2:default:return"info";case 3:return"warn";case 4:case 5:return"error"}},yt=(e,t)=>{Ce((s=>[...s,{message:e,level:t,timestamp:new Date}]))},_t=e=>{Ne(!1),e.success?(_e(e.results),Fe("results"),yt("Calculation completed successfully!","info"),e.results.frequencies?.frequencies&&e.results.optimization?.finalXYZ?(yt(`Found frequency data: ${e.results.frequencies.frequencies.length} frequencies, normalModes: ${e.results.frequencies.normalModes?"available":"missing"}`,"info"),Ct(e.results)):yt("No frequency data or optimized geometry available for trajectory pre-computation","info")):Me("Calculation failed: "+e.error)},St=e=>{if(e.success){const t="molecular_orbital"===e.cubeType?`${e.cubeType}_${e.orbitalIndex}_${e.gridSteps||40}`:e.cubeType;Ie((s=>new Map(s.set(t,e.cubeData)))),e.gridInfo&&Re(e.gridInfo),yt(`Cube computation completed: ${e.cubeType}${void 0!==e.orbitalIndex?` (orbital ${e.orbitalIndex})`:""} [${e.gridSteps||40} steps]`,"info")}else Me(`Cube computation failed: ${e.error}`),yt(`Cube computation failed: ${e.error}`,"error")},Ct=e=>{if(!e.frequencies?.frequencies||!e.optimization?.finalXYZ)return;yt("Pre-computing normal mode trajectories...","info");const t=Fs.precomputeAllTrajectories(e.optimization.finalXYZ,e.frequencies.frequencies,e.frequencies.normalModes||[]);ft(t),yt(`Pre-computed ${t.size} normal mode trajectories`,"info")},$t=()=>ye?.frequencies?.frequencies?ye.frequencies.frequencies.map(((e,t)=>({freq:e,index:t}))).filter((({freq:e})=>!ht||Math.abs(e)>=50)):[];return(0,Ee.jsxs)("div",{className:r,children:[(0,Ee.jsxs)("div",{className:l,children:[(0,Ee.jsxs)("div",{className:i,children:[(0,Ee.jsx)("div",{className:`${f} ${n?b:g}`,children:n?"\u2713 Ready":"\u23f3 Loading..."}),(0,Ee.jsxs)("div",{className:_,children:[(0,Ee.jsxs)("div",{className:m,children:[(0,Ee.jsxs)("button",{className:h,onClick:()=>Ae(!Ve),children:[(0,Ee.jsx)("span",{className:p,children:"Molecule Input"}),(0,Ee.jsx)("span",{className:`${x} ${Ve?j:""}`,children:"\u25bc"})]}),Ve&&(0,Ee.jsxs)("div",{className:v,children:[(0,Ee.jsx)(Oe,{onFileLoad:e=>{je(e),Ie(new Map),_e(null),Me(""),Fe("structure"),ze("");try{const t=e.trim().split("\n"),s=parseInt(t[0]),a=t[1]||"Loaded Molecule",n=new Map;for(let e=2;e<2+s;e++){const s=t[e].trim().split(/\s+/)[0];n.set(s,(n.get(s)||0)+1)}const r=Array.from(n.entries()).map((([e,t])=>t>1?`${e}${t}`:e)).join("");ge({name:a,formula:r,numAtoms:s}),yt(`Molecule loaded: ${r} (${s} atoms) - cleared orbital cache`,"info")}catch(we){console.error("Error parsing XYZ:",we)}},onValidationChange:(e,t)=>{qe(e),ze(!e&&t?t:"")}}),fe&&(0,Ee.jsx)("div",{className:N,children:(0,Ee.jsxs)("div",{children:[(0,Ee.jsx)("strong",{children:fe.formula})," (",fe.numAtoms," atoms)"]})})]})]}),ve&&(0,Ee.jsxs)("div",{className:m,children:[(0,Ee.jsxs)("button",{className:h,onClick:()=>Be(!Pe),children:[(0,Ee.jsx)("span",{className:p,children:"Calculation Settings"}),(0,Ee.jsx)("span",{className:`${x} ${Pe?j:""}`,children:"\u25bc"})]}),Pe&&(0,Ee.jsx)("div",{className:v,children:(0,Ee.jsx)(He,{method:Ue,setMethod:Xe,basisSet:Ye,setBasisSet:Ze,maxIterations:Ge,setMaxIterations:We,energyTolerance:Ke,setEnergyTolerance:Je,logLevel:Qe,setLogLevel:et,optimize:tt,setOptimize:e=>{st(e),e||nt(!1)},computeFrequencies:at,setComputeFrequencies:nt,charge:rt,setCharge:lt})})]})]}),ve&&(0,Ee.jsxs)("div",{className:S,children:[(0,Ee.jsx)("button",{className:`${y} ${C}`,onClick:()=>{if(!ve)return void Me("Please load a molecule first.");if(!De)return;if(!e||!n)return void Me("Web Worker not ready.");_e(null),Ce([]),Fe("output"),Ne(!0),ft(new Map),e.postMessage({type:"setLogLevel",data:{level:Qe}});const t={xyzData:ve,method:Ue,basisSet:Ye,maxIterations:Ge,energyTolerance:Ke,optimize:tt,computeFrequencies:at,charge:rt};yt("Starting calculation...","info"),e.postMessage({type:"calculate",data:t})},disabled:be||!n||!De,children:be?"Calculating...":"Run Calculation"}),be&&(0,Ee.jsx)("button",{className:`${y} ${$}`,onClick:()=>{e&&be&&(e.terminate(),yt("Calculation cancelled. Restarting worker...","warn"),gt(),Ne(!1))},children:"Cancel"})]})]}),(0,Ee.jsxs)("div",{className:o,children:[ve&&(0,Ee.jsxs)("div",{className:c,children:[(0,Ee.jsx)("button",{className:`${d} ${"output"===$e?F:""}`,onClick:()=>Fe("output"),children:"Output"}),(0,Ee.jsx)("button",{className:`${d} ${"results"===$e?F:""}`,onClick:()=>Fe("results"),children:"Results"}),(0,Ee.jsx)("button",{className:`${d} ${"structure"===$e?F:""}`,onClick:()=>Fe("structure"),children:"Structure"}),(0,Ee.jsx)("button",{className:`${d} ${"properties"===$e?F:""}`,onClick:()=>Fe("properties"),children:"Properties"}),ye?.optimization&&(0,Ee.jsx)("button",{className:`${d} ${"optimization"===$e?F:""}`,onClick:()=>Fe("optimization"),children:"Optimization"})]}),(0,Ee.jsxs)("div",{className:u,children:["output"===$e&&(0,Ee.jsx)(mt,{logs:Se}),"results"===$e&&(0,Ee.jsx)(dt,{results:ye}),"structure"===$e&&(0,Ee.jsx)("div",{className:M,children:ve?(0,Ee.jsx)(Cs,{xyzData:ye?.optimization?.finalXYZ?ye.optimization.finalXYZ:ve,moleculeName:`${fe?.name||"Molecule"}${ye?.optimization?" (Optimized)":""}`,wavefunctionResults:ye,cubeResults:Le,cubeGridInfo:Te,onRequestCubeComputation:(t,s,a)=>{e&&n?ye&&ye.wavefunctionData?(yt(`Requesting ${t} cube computation...`,"info"),e.postMessage({type:"computeCube",data:{cubeType:t,orbitalIndex:s,gridSteps:a||40}})):Me("No wavefunction data available for cube computation."):Me("Web Worker not ready for cube computation.")}}):(0,Ee.jsxs)("div",{className:k,children:[(0,Ee.jsx)("h3",{children:"No Structure Loaded"}),(0,Ee.jsx)("p",{children:"Load a molecule to see its 3D structure visualization."})]})}),"properties"===$e&&ye&&(0,Ee.jsxs)("div",{className:w,children:[ye.orbitalEnergies&&ye.orbitalEnergies.length>0&&(0,Ee.jsxs)("div",{className:O,children:[(0,Ee.jsx)("h4",{children:"Orbital Energies"}),(0,Ee.jsx)("div",{className:L,children:ye.orbitalEnergies.slice(0,20).map(((e,t)=>{const s=ye.orbitalOccupations?.[t]??0,a={index:t,energy:27.2114*e,occupation:s,isOccupied:s>0};return(0,Ee.jsx)(Ss,{orbital:a},t)}))}),ye.orbitalEnergies.length>20&&(0,Ee.jsxs)("div",{className:I,children:["... and ",ye.orbitalEnergies.length-20," more orbitals"]})]}),ye.matrices&&Object.keys(ye.matrices).length>0?(0,Ee.jsx)("div",{className:E,children:Object.entries(ye.matrices).map((([e,t])=>t?(0,Ee.jsx)(wt,{matrix:t,title:`${e.charAt(0).toUpperCase()}${e.slice(1)} Matrix`,precision:6,maxDisplaySize:6},e):null))}):(0,Ee.jsx)("div",{className:z,children:(0,Ee.jsx)("p",{children:"No matrix data available. Matrices are generated during SCF calculations and may depend on the calculation method and settings."})})]}),"optimization"===$e&&ye?.optimization&&(0,Ee.jsxs)("div",{className:D,children:[(0,Ee.jsx)("div",{className:q,children:(0,Ee.jsxs)("div",{className:H,children:[(0,Ee.jsx)("h4",{children:"Optimization Summary"}),(0,Ee.jsxs)("div",{className:V,children:[(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Converged:"}),(0,Ee.jsx)("span",{className:`${B} ${ye.optimization.trajectory.converged?U:X}`,children:ye.optimization.trajectory.converged?"Yes":"No"})]}),(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Steps:"}),(0,Ee.jsx)("span",{className:B,children:ye.optimization.steps})]}),(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Final Energy:"}),(0,Ee.jsxs)("span",{className:B,children:[ye.energy.toFixed(8)," Ha"]})]}),(0,Ee.jsxs)("div",{className:A,children:[(0,Ee.jsx)("span",{className:P,children:"Final Energy:"}),(0,Ee.jsxs)("span",{className:B,children:[ye.energyInEV.toFixed(4)," eV"]})]})]})]})}),(0,Ee.jsxs)("div",{className:Z,children:[(0,Ee.jsx)("div",{className:G,children:(0,Ee.jsx)("div",{className:Y,children:(0,Ee.jsx)($s.A,{trajectoryData:"normal_mode"===it&&null!==ct?(e=>{const t=jt.get(e);if(t)return t;if(!ye?.optimization?.finalXYZ||!ye?.frequencies?.frequencies)return"";const s=ye.frequencies.normalModes?.[e],a=ye.frequencies.frequencies[e];return s&&0!==s.length?Fs.generateTrajectory(ye.optimization.finalXYZ,s,a,e):Fs.createPlaceholderTrajectory(ye.optimization.finalXYZ,a,e)})(ct):"optimization"===it&&ye?.optimization?.trajectory?(e=>{if(!e||!e.geometries||!e.energies)return"";const t=[];return e.geometries.forEach(((s,a)=>{const n=e.energies[a],r=s.trim().split("\n");if(r.length>=2){const e=r[0],s=`Step ${a} Energy=${n.toFixed(9)}`,l=r.slice(2).join("\n");t.push(`${e}\n${s}\n${l}`)}})),t.join("\n")})(ye.optimization.trajectory):"",moleculeName:(()=>{if("normal_mode"===it&&null!==ct&&ye?.frequencies?.frequencies){const e=ye.frequencies.frequencies[ct];return`Mode ${ct+1}: ${Math.abs(e).toFixed(2)} cm\u207b\xb9`}return"optimization"===it?`${fe?.formula||"Molecule"} Optimization`:"Trajectory"})(),autoPlay:"normal_mode"===it,initialSpeed:"normal_mode"===it?60:20})})}),(0,Ee.jsxs)("div",{className:W,children:[(0,Ee.jsx)("div",{className:K,children:(0,Ee.jsx)("h4",{children:"Trajectory Controls"})}),(0,Ee.jsx)("div",{className:J,children:(0,Ee.jsx)("button",{onClick:()=>{ot("optimization"),ut(null)},className:`${Q} ${"optimization"===it?ee:""}`,children:"Optimization Path"})}),ye.frequencies&&ye.frequencies.frequencies.length>0&&(0,Ee.jsxs)("div",{className:te,children:[(0,Ee.jsxs)("div",{className:se,children:[(0,Ee.jsx)("h5",{children:"Normal Modes"}),(0,Ee.jsx)("div",{className:ae,children:(0,Ee.jsxs)("label",{className:ne,children:[(0,Ee.jsx)("input",{type:"checkbox",checked:ht,onChange:e=>{pt(e.target.checked),e.target.checked&&null!==ct&&ye.frequencies.frequencies[ct]&&Math.abs(ye.frequencies.frequencies[ct])<50&&(ut(null),ot("optimization"))},className:re}),"Hide low modes (< 50 cm\u207b\xb9)"]})})]}),(0,Ee.jsx)("div",{className:le,children:$t().map((({freq:e,index:t})=>{const s="normal_mode"===it&&ct===t;return(0,Ee.jsxs)("div",{className:`${ie} ${s?oe:""}`,onClick:()=>{ot("normal_mode"),ut(t)},style:{cursor:"pointer"},title:`Click to visualize mode ${t+1}`,children:[(0,Ee.jsxs)("div",{className:de,children:[(0,Ee.jsxs)("div",{className:ue,children:["Mode ",t+1]}),(0,Ee.jsxs)("div",{className:me,children:[e<0?`${Math.abs(e).toFixed(1)}i`:e.toFixed(1)," cm\u207b\xb9"]}),e<0&&(0,Ee.jsx)("div",{className:he,children:"imag"})]}),s&&(0,Ee.jsx)("div",{className:ce,children:"\u25b6 Playing"})]},t)}))}),(0,Ee.jsxs)("div",{className:pe,children:["Showing ",$t().length," of ",ye.frequencies.frequencies.length," modes"]})]})]})]})]})]})]})]}),we&&!ke&&(0,Ee.jsx)("div",{className:T,children:(0,Ee.jsxs)("div",{className:R,children:[(0,Ee.jsx)("h3",{children:"Error"}),(0,Ee.jsx)("p",{children:we}),(0,Ee.jsx)("button",{onClick:()=>Me(""),children:"Close"})]})})]})};function Ms(){return(0,Ee.jsx)(n.A,{title:"Wavefunction Calculator",description:"Quantum Chemistry Calculations in Your Browser",children:(0,Ee.jsx)("main",{style:{minHeight:"calc(100vh - 60px)"},children:(0,Ee.jsx)(ws,{})})})}},6370:(e,t,s)=>{s.d(t,{A:()=>D});var a=s(6540),n=s(7851);const r="container_kZ5w",l="header_HEr1",i="controls_ixvO",o="controlButton_GDgO",c="viewer_WviD",d="loadingOverlay_lwCV",u="errorOverlay_rmFC",m="loadingSpinner_PLZ5",h="errorMessage_qkbu",p="frameInfoOverlay_vX3K",x="frameNumber_EMUy",v="frameComment_F9wg",j="frameEnergy_RPyN",f="frameVolume_c0K5",g="displayControlsOverlay_fIES",b="overlayControls_EEtd",N="overlayControlGroup_E9WC",y="overlayLabel_tcBl",_="overlaySelect_UZvO",S="overlayCheckbox_jtWY",C="overlaySlider_ifAA",$="overlayValue_f7JJ",F="overlayNumberInput_nqMv",w="trajectoryControls_t0nZ",M="compactControls_H6OY",k="frameControls_R8UR",E="playerControls_ukm9",z="playerButton_Mfw8",O="playPauseButton_PlTX",L="frameSlider_B4ss";var I=s(4848);class T{shapeComponent=null;frameUnitcells=[];constructor(e,t){this.component=e,this.stage=t}setFrameUnitcells(e){this.frameUnitcells=e.map((e=>{if(!e.includes("Lattice="))return null;const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const s=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==s.length)return null;return{a:[s[0],s[1],s[2]],b:[s[3],s[4],s[5]],c:[s[6],s[7],s[8]]}}))}updateFrame(e){if(e<0||e>=this.frameUnitcells.length)return;const t=this.frameUnitcells[e];t&&(this.remove(),this.createUnitCellShape(t))}createUnitCellShape(e){const{a:t,b:s,c:a}=e,r=this.component.structure.center,l=[[0,0,0],[1,0,0],[0,1,0],[0,0,1],[1,1,0],[1,0,1],[0,1,1],[1,1,1]].map((([e,n,l])=>[r.x+e*t[0]+n*s[0]+l*a[0],r.y+e*t[1]+n*s[1]+l*a[1],r.z+e*t[2]+n*s[2]+l*a[2]])),i=new n.yp("unitcell");[[0,1],[0,2],[0,3],[1,4],[1,5],[2,4],[2,6],[3,5],[3,6],[4,7],[5,7],[6,7]].forEach((([e,t])=>{i.addWideline(l[e],l[t],[1,.5,0])})),this.shapeComponent=this.stage.addComponentFromObject(i),this.shapeComponent.addRepresentation("buffer",{linewidth:5,opacity:.8})}remove(){this.shapeComponent&&(this.stage.removeComponent(this.shapeComponent),this.shapeComponent=null)}setVisible(e){this.shapeComponent&&this.shapeComponent.setVisibility(e)}}class R{static convertXYZTrajToPDB(e,t="MOL"){const s=this.parseXYZTrajectory(e);return this.convertFramesToPDB(s,t)}static calculateVolume(e,t,s,a,n,r){const l=a*Math.PI/180,i=n*Math.PI/180,o=r*Math.PI/180,c=Math.cos(l),d=Math.cos(i),u=Math.cos(o);return e*t*s*Math.sqrt(1+2*c*d*u-c*c-d*d-u*u)}static parseLatticeInfo(e){const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const s=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==s.length)return null;const a=s[0],n=s[1],r=s[2],l=s[3],i=s[4],o=s[5],c=s[6],d=s[7],u=s[8],m=Math.sqrt(a*a+n*n+r*r),h=Math.sqrt(l*l+i*i+o*o),p=Math.sqrt(c*c+d*d+u*u),x=180*Math.acos((l*c+i*d+o*u)/(h*p))/Math.PI,v=180*Math.acos((a*c+n*d+r*u)/(m*p))/Math.PI,j=180*Math.acos((a*l+n*i+r*o)/(m*h))/Math.PI;return{a:m,b:h,c:p,alpha:x,beta:v,gamma:j,volume:this.calculateVolume(m,h,p,x,v,j)}}static convertFramesToPDB(e,t="MOL"){let s="";return e.forEach(((e,a)=>{s+=`MODEL     ${(a+1).toString().padStart(4," ")}\n`;const n=e.trim().split("\n"),r=parseInt(n[0]),l=n[1]||"",i=this.parseLatticeInfo(l);if(i){const e=i.a.toFixed(3).padStart(9," "),t=i.b.toFixed(3).padStart(9," "),a=i.c.toFixed(3).padStart(9," "),n=i.alpha.toFixed(2).padStart(7," "),r=i.beta.toFixed(2).padStart(7," "),l=i.gamma.toFixed(2).padStart(7," ");s+=`CRYST1${e}${t}${a}${n}${r}${l} P 1           1\n`}for(let o=0;o<r;o++){const e=n[o+2].trim().split(/\s+/),a=e[0],r=parseFloat(e[1]),l=parseFloat(e[2]),i=parseFloat(e[3]),c=(o+1).toString().padStart(5," "),d=a.padEnd(4," "),u=t.substring(0,3).padEnd(3," "),m="A",h="1".padStart(4," "),p=r.toFixed(3).padStart(8," "),x=l.toFixed(3).padStart(8," "),v=i.toFixed(3).padStart(8," ");s+=`ATOM  ${c} ${d} ${u} ${m}${h}    ${p}${x}${v}  1.00  0.00           ${a.padEnd(2," ")}\n`}s+="ENDMDL\n"})),s+="END\n",s}static parseXYZTrajectory(e){const t=[],s=e.trim().split("\n");let a=0;for(;a<s.length;){if(!s[a]||""===s[a].trim()){a++;continue}const e=parseInt(s[a]);if(isNaN(e)||e<=0){a++;continue}if(a+e+1>=s.length)break;const n=s.slice(a,a+e+2);t.push(n.join("\n")),a+=e+2}return t}}const D=({trajectoryData:e,xyzFrames:t,moleculeName:s="Trajectory",autoPlay:D=!1,initialSpeed:H=100})=>{const q=(0,a.useRef)(null),V=(0,a.useRef)(null),A=(0,a.useRef)(null),P=(0,a.useRef)(null),B=(0,a.useRef)(null),[U,X]=(0,a.useState)(!1),[Y,Z]=(0,a.useState)(""),[G,W]=(0,a.useState)(0),[K,J]=(0,a.useState)(0),[Q,ee]=(0,a.useState)(!1),[te,se]=(0,a.useState)(30),[ae,ne]=(0,a.useState)("ball+stick"),[re,le]=(0,a.useState)(!0),[ie,oe]=(0,a.useState)("element"),[ce,de]=(0,a.useState)([]),[ue,me]=(0,a.useState)([]),[he,pe]=(0,a.useState)(null),[xe,ve]=(0,a.useState)(!1),[je,fe]=(0,a.useState)(!1),[ge,be]=(0,a.useState)(!1),[Ne,ye]=(0,a.useState)(1),[_e,Se]=(0,a.useState)(1),[Ce,$e]=(0,a.useState)(1),[Fe,we]=(0,a.useState)([]),[Me,ke]=(0,a.useState)(null),Ee=()=>"dark"===document.documentElement.getAttribute("data-theme")?"#1b1b1d":"#ffffff";(0,a.useEffect)((()=>{if(!q.current)return;V.current=new n.BI(q.current,{backgroundColor:Ee(),quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10});const e=()=>{V.current&&V.current.handleResize()};window.addEventListener("resize",e);const t=new MutationObserver((()=>{V.current&&V.current.setParameters({backgroundColor:Ee()})}));return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{window.removeEventListener("resize",e),t.disconnect(),V.current&&V.current.dispose()}}),[]);const ze=e=>{const t=[/Energy\s*=\s*(-?\d+\.?\d*)/i,/E\s*=\s*(-?\d+\.?\d*)/i,/energy:\s*(-?\d+\.?\d*)/i];for(const s of t){const t=e.match(s);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null},Oe=e=>e.includes("cm\u207b\xb9")||e.includes("cm-1")||e.toLowerCase().includes("mode")||e.includes("Frame=")?null:e.toUpperCase().includes("ORCA")?(e=>{if(e.toUpperCase().includes("ORCA")){const t=e.match(/E\s+(-?\d+\.?\d*)/i);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null})(e):e.includes("Energy=")||e.includes("E=")||e.includes("energy:")||e.includes("Lattice=")?ze(e):null,Le=e=>{const t=e.match(/Lattice="([^"]+)"/);if(!t)return null;const s=t[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==s.length)return null;const a=s[0],n=s[1],r=s[2],l=s[3],i=s[4],o=s[5],c=s[6],d=s[7],u=s[8],m=Math.sqrt(a*a+n*n+r*r),h=Math.sqrt(l*l+i*i+o*o),p=Math.sqrt(c*c+d*d+u*u),x=180*Math.acos((l*c+i*d+o*u)/(h*p))/Math.PI,v=180*Math.acos((a*c+n*d+r*u)/(m*p))/Math.PI,j=180*Math.acos((a*l+n*i+r*o)/(m*h))/Math.PI,f=x*Math.PI/180,g=v*Math.PI/180,b=j*Math.PI/180,N=Math.cos(f),y=Math.cos(g),_=Math.cos(b);return m*h*p*Math.sqrt(1+2*N*y*_-N*N-y*y-_*_)},Ie=e=>{const t=e.trim().split("\n"),s=[],a=[],n=[],r=[];let l=!1,i=0;for(;i<t.length;){const e=parseInt(t[i]);if(isNaN(e)){i++;continue}const o=t.slice(i,i+e+2);s.push(o.join("\n"));const c=t[i+1]||"";n.push(c);const d=Oe(c);a.push(d);const u=Le(c);r.push(u),c.includes("Lattice=")&&(l=!0),i+=e+2}de(a),me(n),we(r),fe(l);const o=a.filter((e=>null!==e));return o.length>0?pe(Math.min(...o)):pe(null),{frames:s,comments:n,hasLattice:l}},Te=async(e,t=[],a=!1)=>{if(V.current){X(!0),Z("");try{V.current.removeAllComponents(),P.current=null,B.current=null;const n=R.convertFramesToPDB(e,s),r=new Blob([n],{type:"text/plain"}),l=await V.current.loadFile(r,{ext:"pdb",name:s,asTrajectory:!0});A.current=l,J(e.length),Re();const i=l.addTrajectory();if(P.current=i,i.trajectory&&i.trajectory.player){const e=i.trajectory.player;B.current=e;const t=Math.round(1e3/te);e.parameters&&(e.parameters.timeout=t,e.parameters.mode="loop",e.parameters.step=1,e.parameters.direction="forward"),e.signals&&(e.signals.startedRunning&&e.signals.startedRunning.add((()=>{ee(!0)})),e.signals.haltedRunning&&e.signals.haltedRunning.add((()=>{ee(!1)})))}if(i.trajectory&&i.trajectory.signals&&i.trajectory.signals.frameChanged&&i.trajectory.signals.frameChanged.add((e=>{W(e)})),V.current.autoView(),console.log("Trajectory loaded. latticeDetected:",a,"comments.length:",t.length),a&&t.length>0){console.log("Creating CustomUnitCellRepresentation...");const e=new T(l,V.current);e.setFrameUnitcells(t),ke(e),fe(!0),console.log("CustomUnitCellRepresentation created:",e)}else console.log("Not creating unit cell: latticeDetected =",a,"comments =",t.length),fe(!1);D&&B.current&&setTimeout((()=>B.current.play()),500),X(!1)}catch(n){console.error("Error loading trajectory:",n),Z(`Failed to load trajectory: ${n.message}`),X(!1)}}},Re=()=>{if(!A.current)return;A.current.removeAllRepresentations();const e={colorScheme:ie,sele:re?"all":"not hydrogen"};switch(ae){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0}A.current.addRepresentation(ae,e),V.current?.autoView()},De=e=>1===Ne&&1===_e&&1===Ce?e:e.map((e=>{const t=e.trim().split("\n"),s=parseInt(t[0]),a=t[1]||"",n=a.match(/Lattice="([^"]+)"/);if(!n)return e;const r=n[1].split(/\s+/).map((e=>parseFloat(e)));if(9!==r.length)return e;const l=[r[0],r[1],r[2]],i=[r[3],r[4],r[5]],o=[r[6],r[7],r[8]],c=[];for(let h=0;h<s;h++){const e=t[h+2].trim().split(/\s+/);c.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const d=[];for(let h=0;h<Ne;h++)for(let e=0;e<_e;e++)for(let t=0;t<Ce;t++){const s=[h*l[0]+e*i[0]+t*o[0],h*l[1]+e*i[1]+t*o[1],h*l[2]+e*i[2]+t*o[2]];c.forEach((e=>{d.push({element:e.element,x:e.x+s[0],y:e.y+s[1],z:e.z+s[2]})}))}const u=[d.length.toString()],m=a.replace(/Lattice="([^"]+)"/,((e,t)=>`Lattice="${[l[0]*Ne,l[1]*Ne,l[2]*Ne,i[0]*_e,i[1]*_e,i[2]*_e,o[0]*Ce,o[1]*Ce,o[2]*Ce].join(" ")}"`));return u.push(m),d.forEach((e=>{u.push(`${e.element}  ${e.x.toFixed(6)}  ${e.y.toFixed(6)}  ${e.z.toFixed(6)}`)})),u.join("\n")})),He=()=>{Me&&je&&(ge?(Me.updateFrame(G),Me.setVisible(!0)):Me.setVisible(!1))};(0,a.useEffect)((()=>{const s=()=>{if(B.current)if("function"==typeof B.current.pause)try{B.current.pause()}catch(e){}else B.current.intervalId&&clearInterval(B.current.intervalId);ee(!1)};if(e){const t=Ie(e);if(t.frames.length>0){s();const e=De(t.frames);setTimeout((()=>Te(e,t.comments,t.hasLattice)),50)}}else if(t&&t.length>0){s();const e=t.join("\n\n"),a=Ie(e),n=De(a.frames);setTimeout((()=>Te(n,a.comments,a.hasLattice)),50)}return s}),[e,t,Ne,_e,Ce]),(0,a.useEffect)((()=>{Re()}),[ae,re,ie]),(0,a.useEffect)((()=>{ge?He():Me&&Me.remove()}),[ge,Ne,_e,Ce,je,Me]),(0,a.useEffect)((()=>{ge&&je&&He()}),[G,ge,je,Me]);const qe=()=>{if(B.current&&"function"==typeof B.current.play)B.current.play();else if(P.current&&P.current.trajectory&&K>1){ee(!0);let e=G;const t=setInterval((()=>{try{P.current&&P.current.trajectory?(e=(e+1)%K,P.current.trajectory.setFrame(e),W(e)):(clearInterval(t),ee(!1))}catch(s){console.warn("Trajectory disposed during playback, stopping:",s.message),clearInterval(t),ee(!1)}}),Math.round(1e3/te));B.current={intervalId:t}}},Ve=()=>{B.current&&("function"==typeof B.current.pause?B.current.pause():B.current.intervalId&&(clearInterval(B.current.intervalId),B.current=null)),ee(!1)},Ae=e=>{try{P.current&&P.current.trajectory&&P.current.trajectory.setFrame(e)}catch(t){console.warn("Cannot set frame on disposed trajectory:",t.message)}};return(0,a.useEffect)((()=>{const e=e=>{if(!(K<=1||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement))switch(e.code){case"Space":e.preventDefault(),Q?Ve():qe();break;case"ArrowLeft":e.preventDefault(),Ae(Math.max(0,G-1));break;case"ArrowRight":e.preventDefault(),Ae(Math.min(K-1,G+1));break;case"Home":e.preventDefault(),Ae(0);break;case"End":e.preventDefault(),Ae(K-1)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[K,G,Q]),(0,I.jsxs)("div",{className:r,children:[(0,I.jsxs)("div",{className:l,children:[(0,I.jsx)("h4",{children:s}),(0,I.jsxs)("div",{className:i,children:[(0,I.jsx)("button",{onClick:()=>ve(!xe),className:o,title:"Toggle display options",children:"Options"}),(0,I.jsx)("button",{onClick:()=>{V.current&&V.current.autoView(1e3)},className:o,children:"Reset View"}),(0,I.jsx)("button",{onClick:()=>{V.current&&V.current.toggleFullscreen(q.current)},className:o,children:"Fullscreen"})]})]}),(0,I.jsxs)("div",{className:c,ref:q,children:[U&&(0,I.jsx)("div",{className:d,children:(0,I.jsx)("div",{className:m,children:"Loading trajectory..."})}),Y&&(0,I.jsx)("div",{className:u,children:(0,I.jsx)("div",{className:h,children:Y})}),K>0&&(0,I.jsxs)("div",{className:p,children:[(0,I.jsxs)("div",{className:x,children:["Frame ",G+1,"/",K]}),ue[G]&&(0,I.jsx)("div",{className:v,children:ue[G]}),null!==ce[G]&&void 0!==ce[G]&&null!==he&&(0,I.jsx)("div",{className:j,children:(()=>{const e=ce[G]-he;return`${e>=0?"+":""}${(2625.5*e).toFixed(2)} kJ/mol`})()}),null!==Fe[G]&&void 0!==Fe[G]&&(0,I.jsxs)("div",{className:f,children:["Volume: ",Fe[G].toFixed(2)," \xc5\xb3"]})]}),xe&&(0,I.jsx)("div",{className:g,children:(0,I.jsxs)("div",{className:b,children:[(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("label",{className:y,children:"Style:"}),(0,I.jsxs)("select",{value:ae,onChange:e=>ne(e.target.value),className:_,children:[(0,I.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,I.jsx)("option",{value:"line",children:"Line"}),(0,I.jsx)("option",{value:"spacefill",children:"Spacefill"}),(0,I.jsx)("option",{value:"licorice",children:"Licorice"}),(0,I.jsx)("option",{value:"cartoon",children:"Cartoon"})]})]}),(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("label",{className:y,children:"Color:"}),(0,I.jsxs)("select",{value:ie,onChange:e=>oe(e.target.value),className:_,children:[(0,I.jsx)("option",{value:"element",children:"Element"}),(0,I.jsx)("option",{value:"chainname",children:"Chain"}),(0,I.jsx)("option",{value:"residueindex",children:"Residue"}),(0,I.jsx)("option",{value:"bfactor",children:"B-factor"})]})]}),(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("input",{type:"checkbox",checked:re,onChange:e=>le(e.target.checked),id:"showH-overlay",className:S}),(0,I.jsx)("label",{htmlFor:"showH-overlay",className:y,children:"Show Hydrogens"})]}),(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("label",{className:y,children:"FPS:"}),(0,I.jsx)("input",{type:"range",min:"10",max:"60",step:"5",value:te,onChange:e=>(e=>{if(se(e),B.current&&B.current.parameters){const t=Math.round(1e3/e);B.current.parameters.timeout=t,Q&&"function"==typeof B.current.pause&&"function"==typeof B.current.play&&(B.current.pause(),B.current.play())}})(parseInt(e.target.value)),className:C}),(0,I.jsx)("span",{className:$,children:te})]}),je&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("input",{type:"checkbox",checked:ge,onChange:e=>be(e.target.checked),id:"showUnitCell-overlay",className:S}),(0,I.jsx)("label",{htmlFor:"showUnitCell-overlay",className:y,children:"Show Unit Cell"})]}),ge&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("label",{className:y,children:"Supercell X:"}),(0,I.jsx)("input",{type:"number",min:"1",max:"5",value:Ne,onChange:e=>ye(parseInt(e.target.value)||1),className:F})]}),(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("label",{className:y,children:"Supercell Y:"}),(0,I.jsx)("input",{type:"number",min:"1",max:"5",value:_e,onChange:e=>Se(parseInt(e.target.value)||1),className:F})]}),(0,I.jsxs)("div",{className:N,children:[(0,I.jsx)("label",{className:y,children:"Supercell Z:"}),(0,I.jsx)("input",{type:"number",min:"1",max:"5",value:Ce,onChange:e=>$e(parseInt(e.target.value)||1),className:F})]})]})]})]})})]}),K>1&&(0,I.jsx)("div",{className:w,children:(0,I.jsxs)("div",{className:M,children:[(0,I.jsxs)("div",{className:E,children:[(0,I.jsx)("button",{onClick:()=>Ae(Math.max(0,G-1)),className:z,disabled:0===G,title:"Previous frame",children:"\u23ee"}),(0,I.jsx)("button",{onClick:Q?Ve:qe,className:`${z} ${O}`,title:Q?"Pause":"Play",children:Q?"\u23f8":"\u23f5"}),(0,I.jsx)("button",{onClick:()=>Ae(Math.min(K-1,G+1)),className:z,disabled:G===K-1,title:"Next frame",children:"\u23ed"})]}),(0,I.jsx)("div",{className:k,children:(0,I.jsx)("input",{type:"range",min:"0",max:K-1,value:G,onChange:e=>Ae(parseInt(e.target.value)),className:L})})]})})]})}}}]);