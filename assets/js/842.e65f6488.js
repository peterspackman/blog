(()=>{var e={},s={};function t(a){var o=s[a];if(void 0!==o)return o.exports;var r=s[a]={exports:{}};return e[a](r,r.exports,t),r.exports}t.m=e,t.d=(e,s)=>{for(var a in s)t.o(s,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})},t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce(((s,a)=>(t.f[a](e,s),s)),[])),t.u=e=>"assets/js/"+e+"."+{3223:"6c49d0ae",9819:"ebb9d4c0"}[e]+".js",t.miniCssF=e=>{},t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.p="/",t.gca=function(e){return e={}[e]||e,t.p+t.u(e)},(()=>{t.b=self.location+"/../../../";var e={842:1};t.f.i=(s,a)=>{e[s]||importScripts(t.p+t.u(s))};var s=self.webpackChunkblog=self.webpackChunkblog||[],a=s.push.bind(s);s.push=s=>{var o=s[0],r=s[1],l=s[2];for(var c in r)t.o(r,c)&&(t.m[c]=r[c]);for(l&&l(t);o.length;)e[o.pop()]=1;a(s)}})();let a=null,o=null;self.addEventListener("message",(async function(e){const{type:s,data:r}=e.data;try{switch(s){case"init":await async function(){try{postMessage({type:"log",level:2,message:"Initializing OCC in worker..."});try{a=await t.e(9819).then(t.bind(t,9819)),postMessage({type:"log",level:2,message:"Loaded OCC package"})}catch(e){return void postMessage({type:"initialized",success:!1,error:`OCC package import failed: ${e.message}. The WASM module contains Node.js-specific imports that don't work in browsers.`})}o=await a.loadOCC(),o.registerLogCallback&&o.registerLogCallback(((e,s)=>{postMessage({type:"log",level:e,message:s})})),postMessage({type:"initialized",success:!0})}catch(s){postMessage({type:"initialized",success:!1,error:s.message})}}();break;case"calculate":await async function(s){try{const t=performance.now();postMessage({type:"progress",stage:"start",message:"Starting calculation..."}),postMessage({type:"log",level:2,message:"Creating molecule from XYZ data..."});const o=await a.moleculeFromXYZ(s.xyzData);postMessage({type:"log",level:2,message:`Molecule created: ${o.size()} atoms`}),postMessage({type:"progress",stage:"setup",message:`Setting up ${s.method.toUpperCase()} calculation with ${s.basisSet} basis...`});const r=await a.createQMCalculation(o,s.basisSet),l=(new a.SCFSettings).setMaxIterations(s.maxIterations).setEnergyTolerance(s.energyTolerance);let c;if(postMessage({type:"progress",stage:"calculation",message:"Running SCF iterations..."}),"hf"===s.method)postMessage({type:"log",level:2,message:"Running Hartree-Fock calculation..."}),c=await r.runHF(l);else if(s.method.startsWith("dft-")){const e=s.method.substring(4);postMessage({type:"log",level:2,message:`Running DFT calculation with ${e} functional...`}),c=await r.runDFT(e,{scfSettings:l})}const i=performance.now()-t;postMessage({type:"progress",stage:"complete",message:"Calculation completed successfully!"});const n={energy:c,energyInEV:27.2114*c,elapsedMs:i,converged:!0};try{const e=await r.calculateProperties(["orbitals","homo","lumo","gap"]);n.properties={homo:e.homo,lumo:e.lumo,gap:e.gap}}catch(e){postMessage({type:"log",level:3,message:`Could not calculate properties: ${e.message}`})}try{const e=r.wavefunction;n.wavefunctionData={fchk:e.exportToString("fchk"),numBasisFunctions:r.basis.nbf(),numAtoms:o.size()}}catch(e){postMessage({type:"log",level:3,message:`Could not export wavefunction: ${e.message}`})}postMessage({type:"progress",stage:"matrices",message:"Computing matrices..."}),n.matrices={};try{const s=new(a.getModule().HartreeFock)(r.basis),t=r.wavefunction,l=e=>{const s=e.rows(),t=e.cols(),a=[];for(let o=0;o<s;o++){const s=[];for(let a=0;a<t;a++)s.push(e.get(o,a));a.push(s)}return{rows:s,cols:t,data:a}};postMessage({type:"log",level:2,message:"Computing overlap matrix..."});try{const e=s.overlapMatrix();n.matrices.overlap=l(e)}catch(e){postMessage({type:"log",level:3,message:`Could not compute overlap matrix: ${e.message}`})}postMessage({type:"log",level:2,message:"Computing kinetic energy matrix..."});try{const e=s.kineticMatrix();n.matrices.kinetic=l(e)}catch(e){postMessage({type:"log",level:3,message:`Could not compute kinetic matrix: ${e.message}`})}postMessage({type:"log",level:2,message:"Computing nuclear attraction matrix..."});try{const e=s.nuclearAttractionMatrix();n.matrices.nuclear=l(e)}catch(e){postMessage({type:"log",level:3,message:`Could not compute nuclear attraction matrix: ${e.message}`})}postMessage({type:"log",level:2,message:"Computing Fock matrix..."});try{const e=s.fockMatrix(t.molecularOrbitals);n.matrices.fock=l(e)}catch(e){postMessage({type:"log",level:3,message:`Could not compute Fock matrix: ${e.message}`})}postMessage({type:"log",level:2,message:"Extracting density matrix..."});try{const e=t.molecularOrbitals.densityMatrix;n.matrices.density=l(e)}catch(e){postMessage({type:"log",level:3,message:`Could not extract density matrix: ${e.message}`})}postMessage({type:"log",level:2,message:"Extracting MO coefficients..."});try{const e=t.coefficients();n.matrices.coefficients=l(e)}catch(e){postMessage({type:"log",level:3,message:`Could not extract MO coefficients: ${e.message}`})}try{const e=t.orbitalEnergies(),s=[];for(let t=0;t<e.size();t++)s.push(e.get(t));n.orbitalEnergies=s}catch(e){postMessage({type:"log",level:3,message:`Could not extract orbital energies: ${e.message}`})}postMessage({type:"log",level:2,message:"Note: Orbital occupations are currently estimated and will be available properly in the API soon"});try{const e=o.numElectrons(),s=n.orbitalEnergies?n.orbitalEnergies.length:0;if(s>0){const t=[];let a=e;for(let e=0;e<s;e++)a>=2?(t.push(2),a-=2):1===a?(t.push(1),a=0):t.push(0);n.orbitalOccupations=t}}catch(e){}}catch(e){postMessage({type:"log",level:3,message:`Matrix computation failed: ${e.message}`})}postMessage({type:"result",success:!0,results:n})}catch(t){postMessage({type:"result",success:!1,error:t.message})}}(r);break;case"setLogLevel":l=r.level,o&&o.setLogLevel&&(o.setLogLevel(l),postMessage({type:"log",level:2,message:`Log level set to ${l}`}));break;default:postMessage({type:"error",error:`Unknown message type: ${s}`})}}catch(c){postMessage({type:"error",error:c.message||"Unknown error occurred",stack:c.stack})}var l}))})();