"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1288],{5066:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Ss});var a=s(6540),r=s(1656);const n="container_Qh_B",l="layout_SyMw",i="sidebar_Cwvp",o="content_ak_G",c="tabs_tRXw",d="tab_F12w",u="tabContent_hF_7",m="collapsibleSection_Nmyk",h="sectionHeader_qShV",p="sectionTitle_aNil",x="chevron_b8vT",v="sectionContent_NPTV",j="chevronExpanded_ry9E",g="status_l6dK",f="statusLoading_AJab",N="statusReady_FVt8",b="moleculeInfo_KKVy",y="button_XSDO",_="stickyButtons_GEQA",S="buttonPrimary_eux_",C="buttonDanger_gLI_",$="tabActive_fzT3",w="propertiesTab_ipsn",k="structureTab_HvbL",F="noStructure_y5fR",M="matricesSection_omrz",E="noMatrices_bajq",z="orbitalsCard_tkcK",O="orbitalGrid_Wtwa",L="moreOrbitals_oRmJ",R="errorModal_HssV",T="errorContent_nEMj",H="optimizationTab_sFuH",I="optimizationSummary_Qbys",D="optimizationHeader_o9LX",V="summaryGrid_miSr",B="summaryItem_TeDs",q="summaryLabel_ItYF",A="summaryValue_eJ3Z",P="converged_TVV4",X="notConverged_zYdK",G="trajectoryViewerContainer_y8Ak",Y="optimizationLayout_h32e",Z="trajectoryViewerSection_ZNX4",U="trajectoryControlsPanel_mPQs",W="trajectoryControlsHeader_NJya",K="trajectoryModeSection_Fa3j",Q="modeButton_mefH",J="active_TuRi",ee="frequenciesControlSection_yYHA",te="frequenciesSectionHeader_PauO",se="frequencySettings_wwcQ",ae="checkboxLabel_yHfy",re="checkbox_PB7n",ne="modesList_XfUU",le="modeItem_NeQD",ie="modeInfo_QcHf",oe="modeNumber_aQX4",ce="modeValue_Thd_",de="imaginaryBadge_edwd",ue="modeVisualizeButton_MSaD",me="frequencySummary_MO4Z",he="section_X2kF",pe="exampleSection_iMDs",xe="exampleLabel__wK2",ve="exampleSelect_VuLc",je="inputContainer_aHUj",ge="headerRow_MA_E",fe="label_1fak",Ne="controls_Azqc",be="browseButton_eNgL",ye="combinedInput_AOvI",_e="dragging_F5j2",Se="valid_peYL",Ce="invalid_Yt4V",$e="clearButton_KExK",we="xyzTextarea_Jaou",ke="errorMessage_OUge";var Fe=s(4848);const Me={formaldehyde:{name:"Formaldehyde (CH\u2082O)",xyz:"4\nFormaldehyde\nH  1.0686 -0.1411  1.0408\nC  0.5979  0.0151  0.0688\nH  1.2687  0.2002 -0.7717\nO -0.5960 -0.0151 -0.0686"},water:{name:"Water (H\u2082O)",xyz:"3\nWater molecule\nO  0.000000  0.000000  0.000000\nH  0.757000  0.586000  0.000000\nH -0.757000  0.586000  0.000000"},urea:{name:"Urea (CH\u2084N\u2082O)",xyz:"8\nUrea molecule\nC  0.000000  0.000000  0.000000\nO  0.000000  1.220000  0.000000\nN  1.150000 -0.610000  0.000000\nN -1.150000 -0.610000  0.000000\nH  1.150000 -1.610000  0.000000\nH  2.050000 -0.110000  0.000000\nH -1.150000 -1.610000  0.000000\nH -2.050000 -0.110000  0.000000"},formamide:{name:"Formamide (CH\u2083NO)",xyz:"6\nFormamide molecule\nC  0.000000  0.000000  0.000000\nO  1.220000  0.000000  0.000000\nN -0.610000  1.150000  0.000000\nH -0.610000 -0.950000  0.000000\nH -1.610000  1.150000  0.000000\nH -0.110000  2.050000  0.000000"},methane:{name:"Methane (CH\u2084)",xyz:"5\nMethane molecule\nC  0.000000  0.000000  0.000000\nH  0.629000  0.629000  0.629000\nH -0.629000 -0.629000  0.629000\nH -0.629000  0.629000 -0.629000\nH  0.629000 -0.629000 -0.629000"},ammonia:{name:"Ammonia (NH\u2083)",xyz:"4\nAmmonia molecule\nN  0.000000  0.000000  0.000000\nH  0.000000  0.950000  0.330000\nH  0.820000 -0.480000  0.330000\nH -0.820000 -0.480000  0.330000"},ethylene:{name:"Ethylene (C\u2082H\u2084)",xyz:"6\nEthylene molecule\nC  0.000000  0.000000  0.668000\nC  0.000000  0.000000 -0.668000\nH  0.000000  0.923000  1.232000\nH  0.000000 -0.923000  1.232000\nH  0.000000  0.923000 -1.232000\nH  0.000000 -0.923000 -1.232000"}},Ee=({onFileLoad:e,onValidationChange:t})=>{const[s,r]=(0,a.useState)(""),[n,l]=(0,a.useState)(""),[i,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)("formaldehyde"),[u,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)(""),x=(0,a.useRef)(null),v=(0,a.useRef)(null),j=e=>{try{const t=e.trim().split("\n").filter((e=>e.trim()));if(t.length<3)return{isValid:!1,error:"XYZ file must have at least 3 lines"};const s=parseInt(t[0]);if(isNaN(s)||s<=0)return{isValid:!1,error:"First line must be a positive integer (number of atoms)"};const a=t.slice(2);if(a.length<s)return{isValid:!1,error:`Expected ${s} atom lines, but found ${a.length}`};const r=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr"];for(let e=0;e<s;e++){const t=a[e].trim().split(/\s+/);if(t.length<4)return{isValid:!1,error:`Line ${e+3}: Expected element symbol and 3 coordinates`};const s=t[0];if(!r.includes(s))return{isValid:!1,error:`Line ${e+3}: Unknown element '${s}'`};for(let a=1;a<=3;a++){const s=parseFloat(t[a]);if(isNaN(s))return{isValid:!1,error:`Line ${e+3}: Invalid coordinate '${t[a]}'`}}}return{isValid:!0}}catch(t){return{isValid:!1,error:"Failed to parse XYZ format: "+t.message}}};(0,a.useEffect)((()=>{const s=Me.formaldehyde;l(s.xyz),r(""),d("formaldehyde"),m(!0),p(""),e(s.xyz),t&&t(!0)}),[]),(0,a.useEffect)((()=>()=>{v.current&&clearTimeout(v.current)}),[]);const g=async s=>{const a=s.name.split(".").pop()?.toLowerCase();if("xyz"===a){r(s.name);try{const a=await s.text();l(a);const r=j(a);m(r.isValid),p(r.error||""),r.isValid&&e(a),t&&t(r.isValid,r.error)}catch(n){console.error("Error reading file:",n),alert("Failed to read file: "+n.message)}}else alert("Please upload an XYZ file.")};return(0,Fe.jsxs)("div",{className:he,children:[(0,Fe.jsxs)("div",{className:pe,children:[(0,Fe.jsx)("label",{className:xe,children:"Example Molecules"}),(0,Fe.jsxs)("select",{value:c,onChange:s=>{const a=s.target.value;if(a&&Me[a]){const s=Me[a];l(s.xyz),r(""),d(a),m(!0),p(""),e(s.xyz),t&&t(!0),x.current&&(x.current.value="")}},className:ve,children:[(0,Fe.jsx)("option",{value:"",children:"Select an example..."}),Object.entries(Me).map((([e,t])=>(0,Fe.jsx)("option",{value:e,children:t.name},e)))]})]}),(0,Fe.jsxs)("div",{className:je,children:[(0,Fe.jsxs)("div",{className:ge,children:[(0,Fe.jsx)("span",{className:fe,children:"XYZ Coordinates"}),(0,Fe.jsxs)("div",{className:Ne,children:[(0,Fe.jsx)("button",{onClick:e=>{e.stopPropagation(),x.current?.click()},className:be,children:"Browse"}),(s||n)&&(0,Fe.jsx)("button",{onClick:()=>{r(""),l(""),d(""),m(!0),p(""),t&&t(!0),x.current&&(x.current.value="")},className:$e,children:"Clear"})]})]}),(0,Fe.jsxs)("div",{className:`${ye} ${i?_e:""} ${u?n.trim()?Se:"":Ce}`,onDrop:e=>{e.preventDefault(),o(!1);const t=e.dataTransfer.files[0];t&&g(t)},onDragOver:e=>{e.preventDefault(),o(!0)},onDragLeave:()=>{o(!1)},children:[(0,Fe.jsx)("textarea",{value:n,onChange:s=>{const a=s.target.value;l(a),r(""),d(""),v.current&&clearTimeout(v.current),v.current=setTimeout((()=>{if(a.trim()){const s=j(a);m(s.isValid),p(s.error||""),s.isValid&&e(a),t&&t(s.isValid,s.error)}else m(!0),p(""),t&&t(!0)}),300)},placeholder:s?`Loaded: ${s}`:"Select an example molecule above or drag & drop XYZ file here",rows:8,className:we}),(0,Fe.jsx)("input",{ref:x,type:"file",accept:".xyz",onChange:e=>{const t=e.target.files?.[0];t&&g(t)},style:{display:"none"}})]}),!u&&h&&(0,Fe.jsx)("div",{className:ke,children:h})]})]})},ze="section_H6hy",Oe="field_rd2A",Le="checkboxLabel_PBvi",Re="disabled_hTIz",Te="fieldDescription_BWzj",He=({method:e,setMethod:t,basisSet:s,setBasisSet:a,maxIterations:r,setMaxIterations:n,energyTolerance:l,setEnergyTolerance:i,logLevel:o,setLogLevel:c,optimize:d,setOptimize:u,computeFrequencies:m,setComputeFrequencies:h})=>(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsxs)("div",{className:ze,children:[(0,Fe.jsx)("h3",{children:"Calculation Method"}),(0,Fe.jsxs)("div",{className:Oe,children:[(0,Fe.jsx)("label",{children:"Theory Level"}),(0,Fe.jsxs)("select",{value:e,onChange:e=>t(e.target.value),children:[(0,Fe.jsx)("option",{value:"hf",children:"Hartree-Fock (HF)"}),(0,Fe.jsx)("option",{value:"dft-b3lyp",children:"DFT (B3LYP)"}),(0,Fe.jsx)("option",{value:"dft-pbe",children:"DFT (PBE)"}),(0,Fe.jsx)("option",{value:"dft-pbe0",children:"DFT (PBE0)"}),(0,Fe.jsx)("option",{value:"dft-blyp",children:"DFT (BLYP)"}),(0,Fe.jsx)("option",{value:"dft-wb97x",children:"DFT (\u03c9B97X)"})]})]}),(0,Fe.jsxs)("div",{className:Oe,children:[(0,Fe.jsx)("label",{children:"Basis Set"}),(0,Fe.jsxs)("select",{value:s,onChange:e=>a(e.target.value),children:[(0,Fe.jsx)("option",{value:"sto-3g",children:"STO-3G"}),(0,Fe.jsx)("option",{value:"3-21g",children:"3-21G"}),(0,Fe.jsx)("option",{value:"6-31g",children:"6-31G"}),(0,Fe.jsx)("option",{value:"6-31g(d,p)",children:"6-31G(d,p)"}),(0,Fe.jsx)("option",{value:"6-311g(d,p)",children:"6-311G(d,p)"}),(0,Fe.jsx)("option",{value:"def2-svp",children:"def2-SVP"}),(0,Fe.jsx)("option",{value:"def2-tzvp",children:"def2-TZVP"}),(0,Fe.jsx)("option",{value:"cc-pvdz",children:"cc-pVDZ"}),(0,Fe.jsx)("option",{value:"cc-pvtz",children:"cc-pVTZ"}),(0,Fe.jsx)("option",{value:"cc-pvqz",children:"cc-pVQZ"}),(0,Fe.jsx)("option",{value:"pcseg-0",children:"pc-0"}),(0,Fe.jsx)("option",{value:"pcseg-1",children:"pc-1"}),(0,Fe.jsx)("option",{value:"pcseg-2",children:"pc-2"}),(0,Fe.jsx)("option",{value:"pcseg-3",children:"pc-3"}),(0,Fe.jsx)("option",{value:"aug-pcseg-1",children:"aug-pc-1"}),(0,Fe.jsx)("option",{value:"aug-pcseg-2",children:"aug-pc-2"})]})]})]}),(0,Fe.jsxs)("div",{className:ze,children:[(0,Fe.jsx)("h3",{children:"Calculation Options"}),(0,Fe.jsxs)("div",{className:Oe,children:[(0,Fe.jsxs)("label",{className:Le,children:[(0,Fe.jsx)("input",{type:"checkbox",checked:d,onChange:e=>u(e.target.checked)}),(0,Fe.jsx)("span",{children:"Geometry Optimization"})]}),(0,Fe.jsx)("small",{className:Te,children:"Optimize molecular geometry to find minimum energy structure"})]}),(0,Fe.jsxs)("div",{className:Oe,children:[(0,Fe.jsxs)("label",{className:`${Le} ${d?"":Re}`,children:[(0,Fe.jsx)("input",{type:"checkbox",checked:m,onChange:e=>h(e.target.checked),disabled:!d}),(0,Fe.jsx)("span",{children:"Vibrational Frequencies"})]}),(0,Fe.jsx)("small",{className:Te,children:"Calculate vibrational frequencies after optimization (requires optimization)"})]})]}),(0,Fe.jsxs)("div",{className:ze,children:[(0,Fe.jsx)("h3",{children:"SCF Settings"}),(0,Fe.jsxs)("div",{className:Oe,children:[(0,Fe.jsx)("label",{children:"Max Iterations"}),(0,Fe.jsx)("input",{type:"number",min:"10",max:"500",value:r,onChange:e=>n(parseInt(e.target.value))})]}),(0,Fe.jsxs)("div",{className:Oe,children:[(0,Fe.jsx)("label",{children:"Energy Tolerance"}),(0,Fe.jsxs)("select",{value:l.toString(),onChange:e=>i(parseFloat(e.target.value)),children:[(0,Fe.jsx)("option",{value:"1e-6",children:"1e-6"}),(0,Fe.jsx)("option",{value:"1e-7",children:"1e-7"}),(0,Fe.jsx)("option",{value:"1e-8",children:"1e-8"}),(0,Fe.jsx)("option",{value:"1e-9",children:"1e-9"}),(0,Fe.jsx)("option",{value:"1e-10",children:"1e-10"})]})]}),(0,Fe.jsxs)("div",{className:Oe,children:[(0,Fe.jsx)("label",{children:"Log Level"}),(0,Fe.jsxs)("select",{value:o,onChange:e=>c(parseInt(e.target.value)),children:[(0,Fe.jsx)("option",{value:"0",children:"Trace"}),(0,Fe.jsx)("option",{value:"1",children:"Debug"}),(0,Fe.jsx)("option",{value:"2",children:"Info"}),(0,Fe.jsx)("option",{value:"3",children:"Warning"}),(0,Fe.jsx)("option",{value:"4",children:"Error"}),(0,Fe.jsx)("option",{value:"5",children:"Critical"})]})]})]})]}),Ie="container_R89I",De="summaryGrid_ag2i",Ve="energyCard_YXOX",Be="statusCard_RoU8",qe="propertiesCard_AHmH",Ae="primaryEnergy_Xokq",Pe="secondaryEnergy_Gl5x",Xe="propertyItem_grVF",Ge="exportSection_Tufw",Ye="exportButtons_Op6D",Ze="exportButton_Xvg9",Ue="energyValues_pzt_",We="statusInfo_hd1b",Ke="convergenceStatus_AYcc",Qe="converged_xwWE",Je="notConverged_Y8IO",et="timing_HvIZ",tt="propertyList_aAAD",st="propertyLabel_Acxr",at="propertyValue_OR5o",rt="exportButtonDisabled_HPmD",nt="noResults_jWfa",lt=({results:e})=>{if(!e)return(0,Fe.jsxs)("div",{className:nt,children:[(0,Fe.jsx)("h3",{children:"No Results Yet"}),(0,Fe.jsx)("p",{children:"Run a calculation to see results here."})]});const t=t=>{if(!e.wavefunctionData)return;let s,a,r;switch(t){case"fchk":if(!e.wavefunctionData.fchk)return void alert("FCHK data not available.");s=e.wavefunctionData.fchk,a="wavefunction.fchk",r="text/plain";break;case"json":s=JSON.stringify({energy:e.energy,energyInEV:e.energyInEV,properties:e.properties,numBasisFunctions:e.wavefunctionData.numBasisFunctions,numAtoms:e.wavefunctionData.numAtoms,calculationTime:e.elapsedMs},null,2),a="wavefunction.json",r="application/json"}const n=new Blob([s],{type:r}),l=URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.download=a,i.click(),URL.revokeObjectURL(l)};return(0,Fe.jsxs)("div",{className:Ie,children:[(0,Fe.jsxs)("div",{className:De,children:[(0,Fe.jsxs)("div",{className:Ve,children:[(0,Fe.jsx)("h4",{children:"Total Energy"}),(0,Fe.jsxs)("div",{className:Ue,children:[(0,Fe.jsxs)("div",{className:Ae,children:[e.energy.toFixed(8)," Eh"]}),(0,Fe.jsxs)("div",{className:Pe,children:[e.energyInEV.toFixed(6)," eV"]})]})]}),(0,Fe.jsxs)("div",{className:Be,children:[(0,Fe.jsx)("h4",{children:"Status"}),(0,Fe.jsxs)("div",{className:We,children:[(0,Fe.jsx)("div",{className:`${Ke} ${e.converged?Qe:Je}`,children:e.converged?"\u2713 Converged":"\u2717 Not Converged"}),(0,Fe.jsx)("div",{className:et,children:(s=e.elapsedMs,`${Math.floor(s/1e3)}s ${Math.round(s%1e3)}ms`)})]})]}),e.properties&&(0,Fe.jsxs)("div",{className:qe,children:[(0,Fe.jsx)("h4",{children:"Key Properties"}),(0,Fe.jsxs)("div",{className:tt,children:[void 0!==e.properties.homo&&(0,Fe.jsxs)("div",{className:Xe,children:[(0,Fe.jsx)("span",{className:st,children:"HOMO:"}),(0,Fe.jsxs)("span",{className:at,children:[e.properties.homo.toFixed(6)," Eh"]})]}),void 0!==e.properties.lumo&&(0,Fe.jsxs)("div",{className:Xe,children:[(0,Fe.jsx)("span",{className:st,children:"LUMO:"}),(0,Fe.jsxs)("span",{className:at,children:[e.properties.lumo.toFixed(6)," Eh"]})]}),void 0!==e.properties.gap&&(0,Fe.jsxs)("div",{className:Xe,children:[(0,Fe.jsx)("span",{className:st,children:"Gap:"}),(0,Fe.jsxs)("span",{className:at,children:[e.properties.gap.toFixed(6)," Eh"]})]})]})]})]}),e.wavefunctionData&&(0,Fe.jsxs)("div",{className:Ge,children:[(0,Fe.jsx)("h4",{children:"Export Wavefunction"}),(0,Fe.jsxs)("div",{className:Ye,children:[(0,Fe.jsx)("button",{className:Ze,onClick:()=>t("json"),children:"\u2193 JSON"}),(0,Fe.jsxs)("button",{className:e.wavefunctionData.fchk?Ze:`${Ze} ${rt}`,onClick:()=>e.wavefunctionData.fchk?t("fchk"):alert("FCHK data not available. Check the calculation logs for details."),disabled:!e.wavefunctionData.fchk,title:e.wavefunctionData.fchk?"Download FCHK file":"FCHK generation failed - see logs",children:["\u2193 FCHK ",!e.wavefunctionData.fchk&&"(unavailable)"]})]})]})]});var s},it={container:"container_BYXD",header:"header_RGzB",controls:"controls_Rvup",button:"button_YEOU",buttonActive:"buttonActive_nb5D",logOutput:"logOutput_RpAa",noLogs:"noLogs_oYTM",logEntry:"logEntry_Oa3L",timestamp:"timestamp__Tyr",message:"message_A8Nt","log-debug":"log-debug_cHxc","log-info":"log-info_Lwm5","log-warn":"log-warn_SwuY","log-error":"log-error_TdP2"},ot=({logs:e})=>{const[t,s]=(0,a.useState)(!0),r=(0,a.useRef)(null);(0,a.useEffect)((()=>{t&&r.current&&(r.current.scrollTop=r.current.scrollHeight)}),[e,t]);return(0,Fe.jsxs)("div",{className:it.container,children:[(0,Fe.jsxs)("div",{className:it.header,children:[(0,Fe.jsx)("h3",{children:"Calculation Output"}),(0,Fe.jsx)("div",{className:it.controls,children:(0,Fe.jsx)("button",{className:`${it.button} ${t?it.buttonActive:""}`,onClick:()=>s(!t),children:t?"Auto-scroll ON":"Auto-scroll OFF"})})]}),(0,Fe.jsx)("div",{ref:r,className:it.logOutput,children:0===e.length?(0,Fe.jsx)("div",{className:it.noLogs,children:"No output yet. Run a calculation to see logs."}):e.map(((e,t)=>{return(0,Fe.jsxs)("div",{className:`${it.logEntry} ${it[`log-${e.level}`]}`,children:[(0,Fe.jsxs)("span",{className:it.timestamp,children:["[",(s=e.timestamp,s.toLocaleTimeString()),"]"]}),(0,Fe.jsx)("span",{className:it.message,children:e.message})]},t);var s}))})]})},ct="matrixContainer__RiK",dt="header_t7QL",ut="controls_sj24",mt="dimensions_G9Ce",ht="toggleButton_ziSy",pt="downloadButton_yZ_5",xt="matrixWrapper_lIP_",vt="matrix_UPd_",jt="matrixElement_jLaA",gt="infoContent_XCc5",ft="fullMatrix_FIje",Nt="zeroElement_VjgC",bt="truncationNotice_Npk0",yt="matrixInfo_AD0u",_t="infoToggle_sbWR",St=({matrix:e,title:t,precision:s=6,maxDisplaySize:r=8})=>{const[n,l]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);if(!e||!e.data)return(0,Fe.jsxs)("div",{className:ct,children:[(0,Fe.jsx)("h4",{children:t}),(0,Fe.jsx)("p",{children:"Matrix data not available"})]});const{rows:c,cols:d,data:u}=e,m=c>r||d>r,h=i?c:Math.min(c,r),p=i?d:Math.min(d,r),x=e=>Math.abs(e)<1e-10?"\xb7":e.toFixed(s);return(0,Fe.jsxs)("div",{className:ct,children:[(0,Fe.jsxs)("div",{className:dt,children:[(0,Fe.jsx)("h4",{children:t}),(0,Fe.jsxs)("div",{className:ut,children:[(0,Fe.jsxs)("span",{className:mt,children:[c," \xd7 ",d]}),m&&(0,Fe.jsx)("button",{className:ht,onClick:()=>o(!i),children:i?"Show Preview":"Show Full"}),(0,Fe.jsx)("button",{className:pt,onClick:()=>{const e=u.map((e=>e.map((e=>x(e))).join(","))).join("\n"),s=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`${t.toLowerCase().replace(/\s+/g,"_")}_matrix.csv`,r.click(),URL.revokeObjectURL(a)},title:"Download as CSV",children:"\u2193 CSV"})]})]}),(0,Fe.jsxs)("div",{className:xt,children:[(0,Fe.jsx)("div",{className:`${vt} ${i?ft:""}`,style:{gridTemplateColumns:`repeat(${p}, 1fr)`},children:Array.from({length:h},((e,t)=>Array.from({length:p},((e,s)=>{const a=u[t]?.[s]||0,r=x(a),n=Math.abs(a)<1e-10;return(0,Fe.jsx)("div",{className:`${jt} ${n?Nt:""}`,title:`[${t+1},${s+1}] = ${a}`,children:r},`${t}-${s}`)}))))}),m&&!i&&(0,Fe.jsxs)("div",{className:bt,children:["Showing ",h," \xd7 ",p," of ",c," \xd7 ",d," matrix"]})]}),(0,Fe.jsxs)("div",{className:yt,children:[(0,Fe.jsxs)("button",{className:_t,onClick:()=>l(!n),children:[n?"\u25bc":"\u25b6"," Matrix Information"]}),n&&(0,Fe.jsxs)("div",{className:gt,children:[(0,Fe.jsxs)("div",{children:[(0,Fe.jsx)("strong",{children:"Dimensions:"})," ",c," rows \xd7 ",d," columns"]}),(0,Fe.jsxs)("div",{children:[(0,Fe.jsx)("strong",{children:"Total elements:"})," ",c*d]}),u.length>0&&u[0]&&(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsxs)("div",{children:[(0,Fe.jsx)("strong",{children:"Max value:"})," ",Math.max(...u.flat()).toFixed(s)]}),(0,Fe.jsxs)("div",{children:[(0,Fe.jsx)("strong",{children:"Min value:"})," ",Math.min(...u.flat()).toFixed(s)]}),(0,Fe.jsxs)("div",{children:[(0,Fe.jsx)("strong",{children:"Trace (diagonal sum):"})," ",u.reduce(((e,t,s)=>e+(t[s]||0)),0).toFixed(s)]})]})]})]})]})};var Ct=s(7851);const $t="container_BTtL",wt="header_Zg_R",kt="controls_krEJ",Ft="controlButton_kE_9",Mt="viewer_MOiN",Et="representationControls_JFkt",zt="controlGroup_advN",Ot="inlineControlGroup_p0fZ",Lt="controlLabel_p9ac",Rt="controlSelect_wf9l",Tt="checkboxLabel_O6nm",Ht="checkbox_vb0q",It="numberInput_NZEF",Dt="slicePositionControls_XcJh",Vt="collapsibleControl_f2QI",Bt="controlToggle_IHht",qt="controlContent_BMT8",At="colorRangeGrid_zP5d",Pt="computingIndicator_nVPU",Xt="mainContent_hmUM",Gt="viewerContainer_HOsW",Yt="orbitalSidebar_Sjw1",Zt="open_VSem",Ut="orbitalToggleButton_zhVa",Wt="orbitalSidebarHeader_sOPI",Kt="orbitalCloseButton_PBas",Qt="moControls_QuQW",Jt="collapsibleSection_wCEA",es="lightSectionHeader_RRMY",ts="chevron_qy2f",ss="chevronExpanded_o9bu",as="sectionContent_L8gO",rs="orbitalList_q8AK",ns="placeholder_XAIu",ls="loading_XCE6",is="error_fQgs",os="orbitalItem_coIp",cs="orbitalOccupied_2McF",ds="orbitalVirtual_y4gy",us="orbitalSelected_kMgf",ms="orbitalContent_ff1A",hs="orbitalEnergy_svnX",ps="orbitalEnergyEV_OrpY",xs="orbitalLabel_q_Pv",vs="orbitalIndicators_GNGS",js="occupationBadge_DFgd",gs="orbitalColorIndicator_WBpC",fs="orbitalColorPicker_rcrR",Ns=({orbital:e,isHOMO:t=!1,isLUMO:s=!1,isSelected:a=!1,colorIndicator:r,onColorChange:n,onClick:l,className:i=""})=>{const o=e.energy/27.2114;return(0,Fe.jsxs)("div",{className:`${os} ${e.isOccupied?cs:ds} ${a?us:""} ${i}`,onClick:l,title:`MO ${e.index}: ${e.energy.toFixed(3)} eV (occupation: ${e.occupation})`,style:{cursor:l?"pointer":"default"},children:[(0,Fe.jsxs)("div",{className:ms,children:[(0,Fe.jsxs)("div",{className:hs,children:[o.toFixed(6)," Eh"]}),(0,Fe.jsxs)("div",{className:ps,children:[e.energy.toFixed(3)," eV"]}),(t||s)&&(0,Fe.jsx)("div",{className:xs,children:t?"HOMO":"LUMO"})]}),(0,Fe.jsxs)("div",{className:vs,children:[e.occupation>0&&(0,Fe.jsx)("div",{className:js,children:2===e.occupation?"\u2191\u2193":1===e.occupation?"\u2191":""}),r&&(a?(0,Fe.jsx)("input",{type:"color",value:r,onChange:e=>{e.stopPropagation(),n?.(e.target.value)},onClick:e=>e.stopPropagation(),className:fs,title:`Change color for MO ${e.index}`}):(0,Fe.jsx)("div",{className:gs,style:{backgroundColor:r},title:`Last used color: ${r}`}))]})]})},bs=({xyzData:e,moleculeName:t="Molecule",wavefunctionResults:s,cubeResults:r,cubeGridInfo:n,onRequestCubeComputation:l})=>{const i=(0,a.useRef)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(null),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),[x,v]=(0,a.useState)("ball+stick"),[j,g]=(0,a.useState)(!0),[f,N]=(0,a.useState)("element"),[b,y]=(0,a.useState)(new Set),[_,S]=(0,a.useState)(.01),[C,$]=(0,a.useState)(!1),[w,k]=(0,a.useState)(1),[F,M]=(0,a.useState)(!1),[E,z]=(0,a.useState)((()=>{try{const e=localStorage.getItem("orbitalColors");if(e){const t=JSON.parse(e);return new Map(Object.entries(t).map((([e,t])=>[parseInt(e),t])))}}catch(h){console.warn("Failed to load orbital colors from localStorage:",h)}return new Map})),[O,L]=(0,a.useState)(40),R=(0,a.useRef)(null),T=(0,a.useRef)(null),[H,I]=(0,a.useState)(!0),[D,V]=(0,a.useState)(!1),B=(0,a.useRef)(null),[q,A]=(0,a.useState)(null),[P,X]=(0,a.useState)("surface"),[G,Y]=(0,a.useState)(!1),[Z,U]=(0,a.useState)("z"),[W,K]=(0,a.useState)(0),[Q,J]=(0,a.useState)("rwb"),[ee,te]=(0,a.useState)([0,.05]),[se,ae]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!i.current)return;o.current=new Ct.BI(i.current,{backgroundColor:"white",quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10,fogNear:100,fogFar:100});const e=()=>{o.current&&o.current.handleResize()};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),o.current&&o.current.dispose()}}),[]);const re=()=>{if(!c.current)return;c.current.removeAllRepresentations();const e={colorScheme:f,sele:j?"all":"not hydrogen"};switch(x){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0;break;case"surface":e.opacity=.8,e.surfaceType="vws"}c.current.addRepresentation(x,e),o.current?.autoView()};(0,a.useEffect)((()=>{re()}),[x,j,f]);const ne=async e=>{if(o.current)try{o.current.removeAllComponents();const s=((e,t)=>{const s=e.trim().split("\n"),a=parseInt(s[0]),r=s[1]||t,n=[];for(let m=2;m<2+a;m++){const e=s[m].trim().split(/\s+/);n.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const l={"H-H":.74,"H-C":1.09,"H-N":1.01,"H-O":.96,"H-S":1.34,"C-C":1.54,"C-N":1.47,"C-O":1.43,"C-S":1.82,"N-N":1.45,"N-O":1.4,"N-S":1.68,"O-O":1.48,"O-S":1.66,"S-S":2.05},i=(e,t)=>{const s=e.x-t.x,a=e.y-t.y,r=e.z-t.z;return Math.sqrt(s*s+a*a+r*r)},o=[];for(let m=0;m<n.length;m++)for(let e=m+1;e<n.length;e++){const t=i(n[m],n[e]),s=l[`${c=n[m].element}-${d=n[e].element}`]||l[`${d}-${c}`]||2;if(t<=1.3*s){let a=1;t<.85*s&&(a=2),t<.75*s&&(a=3),o.push({atom1:m+1,atom2:e+1,order:a})}}var c,d;let u=`${r}\n`;return u+="  Generated from XYZ with bond guessing\n",u+="\n",u+=`${a.toString().padStart(3," ")}${o.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`,n.forEach((e=>{const t=e.x.toFixed(4).padStart(10," "),s=e.y.toFixed(4).padStart(10," "),a=e.z.toFixed(4).padStart(10," ");u+=`${t}${s}${a} ${e.element.padEnd(3," ")} 0  0  0  0  0  0  0  0  0  0  0  0\n`})),o.forEach((e=>{u+=`${e.atom1.toString().padStart(3," ")}${e.atom2.toString().padStart(3," ")}${e.order.toString().padStart(3," ")}  0  0  0  0\n`})),u+="M  END\n$$$$\n",u})(e,t),a=new Blob([s],{type:"text/plain"}),r=await o.current.loadFile(a,{ext:"sdf",name:t});c.current=r,re()}catch(s){throw console.error("Error loading geometry:",s),s}};(0,a.useEffect)((()=>{if(!e||!o.current)return;(async()=>{m(!0),p("");try{await ne(e),m(!1)}catch(t){console.error("Error loading molecule:",t),p("Failed to load molecule structure"),m(!1)}})()}),[e,t]);const le=a.useMemo((()=>{if(!s?.orbitalEnergies||!s?.orbitalOccupations)return[];const e=[];for(let t=0;t<s.orbitalEnergies.length;t++){const a=s.orbitalEnergies[t],r=s.orbitalOccupations[t]||0;e.push({index:t,energy:27.2114*a,occupation:r,isOccupied:r>0})}return e}),[s]),ie=le;(0,a.useEffect)((()=>{if(le.length>0&&l&&b.size>0){const e=[];for(const t of b){const s=`molecular_orbital_${t}_${O}`,a=r?.get(s);a||e.push(t)}e.length>0&&(R.current&&clearTimeout(R.current),R.current=setTimeout((()=>{oe(e)}),300))}return()=>{R.current&&clearTimeout(R.current),T.current&&clearTimeout(T.current)}}),[b,le.length,r,O]);const oe=async e=>{if(l&&o.current){M(!0),p("");try{const t=le.length-1;for(const s of e){if(s<0||s>t)throw new Error(`Invalid orbital index ${s}. Valid range: 0-${t}`);l("molecular_orbital",s,O)}}catch(h){console.error("Error requesting MO computation:",h),p("Failed to request molecular orbital computation: "+h.message),M(!1)}}};(0,a.useEffect)((()=>{if(console.log("MO visualization effect triggered:",{selectedOrbitals:b.size,cubeResults:r.size,orbitalRenderStyle:P,sliceDirection:Z,slicePosition:W}),T.current&&(clearTimeout(T.current),T.current=null),!o.current)return;if(0===b.size)return void ce();if(!r)return;Array.from(b).every((e=>{const t=`molecular_orbital_${e}_${O}`;return r.get(t)}))&&(ce(),F&&M(!1))}),[r,b,_,C,w,P,Z,W,Q,ee]);const ce=async()=>{var e,t;if(o.current)try{d.current&&(Array.isArray(d.current)?d.current.forEach((e=>{e&&o.current&&o.current.removeComponent(e)})):o.current&&o.current.removeComponent(d.current),d.current=null);const s=[],a=["#4A90E2","#FF8C42","#7B68EE","#32CD32","#FF6B6B","#9B59B6"];if(0===b.size)return d.current=[],void o.current.autoView();for(const[n,l]of Array.from(b).entries()){const i=`molecular_orbital_${l}_${O}`,c=r?.get(i);if(c){const r=new Blob([c],{type:"text/plain"}),i=await o.current.loadFile(r,{ext:"cube",name:`MO_${l}`});if(i){let r=E.get(l);if(r||(r=a[n%a.length],z((e=>{const t=new Map(e);return t.set(l,r),t}))),"surface"===P)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:_,color:r,opacity:w,opaqueBack:!1}),C&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-_,color:"red",opacity:w,opaqueBack:!1});else if("wireframe"===P)i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:_,color:r,opacity:w,wireframe:!0,linewidth:2}),C&&i.addRepresentation("surface",{visible:!0,isolevelType:"value",isolevel:-_,color:"red",opacity:w,wireframe:!0,linewidth:2});else if("dot"===P)i.addRepresentation("dot",{visible:!0,color:r,opacity:w,dotType:"square",dotSpacing:2,threshold:.001});else if("slice"===P){const s=(e=Z,t=W,console.log(`Slice position: direction=${e}, position=${t}`),t);console.log(`Adding slice representation: direction=${Z}, normalizedPos=${W}, coordinatePos=${s}`),i.addRepresentation("slice",{visible:!0,opacity:w,dimension:Z,positionType:"coordinate",position:s,thresholdMin:ee[0],thresholdMax:ee[1],thresholdType:"value",colorScheme:Q,colorDomain:ee})}s.push(i)}}}d.current=s,o.current.autoView()}catch(h){console.error("Error visualizing molecular orbitals:",h),p("Failed to visualize molecular orbitals: "+h.message)}};return(0,a.useEffect)((()=>{(async()=>{if(!o.current)return;if(B.current&&(o.current.removeComponent(B.current),B.current=null),!D)return;let e=null;if(n){const t=n.origin,s=n.steps,a=n.nx,r=n.ny,l=n.nz,i=n.basis;if(t&&s&&a&&r&&l&&i){const s=[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],n=[t[0],t[1],t[2]],o=[t[0]+(a-1)*s[0][0]+(r-1)*s[1][0]+(l-1)*s[2][0],t[1]+(a-1)*s[0][1]+(r-1)*s[1][1]+(l-1)*s[2][1],t[2]+(a-1)*s[0][2]+(r-1)*s[1][2]+(l-1)*s[2][2]],c=.529177;e={min:[n[0]*c,n[1]*c,n[2]*c],max:[o[0]*c,o[1]*c,o[2]*c]},console.log("Grid bounds (converted to Angstrom):",e)}}if(e)try{const[t,s,a]=e.min,[r,n,l]=e.max,i=[[t,s,a],[r,s,a],[r,n,a],[t,n,a],[t,s,l],[r,s,l],[r,n,l],[t,n,l]],c=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];let d=`Grid Bounds\n  Generated\n  \n${i.length.toString().padStart(3," ")}${c.length.toString().padStart(3," ")}  0  0  0  0  0  0  0  0999 V2000\n`;i.forEach((([e,t,s])=>{d+=`${e.toFixed(4).padStart(10," ")}${t.toFixed(4).padStart(10," ")}${s.toFixed(4).padStart(10," ")} C   0  0  0  0  0  0  0  0  0  0  0  0\n`})),c.forEach((([e,t])=>{d+=`${(e+1).toString().padStart(3," ")}${(t+1).toString().padStart(3," ")}  1  0  0  0  0\n`})),d+="M  END\n$$$$\n";const u=new Blob([d],{type:"text/plain"}),m=await o.current.loadFile(u,{ext:"mol",name:"Grid_Bounds"});m&&(m.addRepresentation("line",{colorScheme:"uniform",colorValue:"#ff6b6b",linewidth:2,opacity:.7}),B.current=m)}catch(h){console.error("Error creating grid bounds visualization:",h),p("Failed to create grid bounds visualization: "+h.message)}else console.log("No cube grid info available - cannot show accurate grid bounds")})()}),[D,n]),(0,a.useEffect)((()=>{try{const e=Object.fromEntries(E);localStorage.setItem("orbitalColors",JSON.stringify(e))}catch(h){console.warn("Failed to save orbital colors to localStorage:",h)}}),[E]),e?(0,Fe.jsxs)("div",{className:$t,children:[(0,Fe.jsxs)("div",{className:wt,children:[(0,Fe.jsx)("h4",{children:"3D Structure & Molecular Orbitals"}),(0,Fe.jsxs)("div",{className:kt,children:[(0,Fe.jsx)("button",{className:Ft,onClick:()=>{o.current&&o.current.autoView()},title:"Reset view",children:"\u2302"}),(0,Fe.jsx)("button",{className:Ft,onClick:()=>{o.current&&o.current.toggleFullscreen(i.current)},title:"Toggle fullscreen",children:"\u26f6"})]})]}),(0,Fe.jsxs)("div",{className:Et,children:[(0,Fe.jsxs)("div",{className:Ot,children:[(0,Fe.jsx)("label",{className:Lt,children:"Style"}),(0,Fe.jsxs)("select",{value:x,onChange:e=>v(e.target.value),className:Rt,children:[(0,Fe.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,Fe.jsx)("option",{value:"line",children:"Line"}),(0,Fe.jsx)("option",{value:"spacefill",children:"Space Fill"}),(0,Fe.jsx)("option",{value:"licorice",children:"Licorice"}),(0,Fe.jsx)("option",{value:"surface",children:"Surface"})]})]}),(0,Fe.jsxs)("div",{className:Ot,children:[(0,Fe.jsx)("label",{className:Lt,children:"Color"}),(0,Fe.jsxs)("select",{value:f,onChange:e=>N(e.target.value),className:Rt,children:[(0,Fe.jsx)("option",{value:"element",children:"By Element"}),(0,Fe.jsx)("option",{value:"uniform",children:"Uniform"}),(0,Fe.jsx)("option",{value:"chainname",children:"By Chain"}),(0,Fe.jsx)("option",{value:"random",children:"Random"})]})]})]}),(0,Fe.jsxs)("div",{className:Xt,children:[(0,Fe.jsxs)("div",{className:Gt,children:[h&&(0,Fe.jsx)("div",{className:is,children:(0,Fe.jsx)("p",{children:h})}),u&&(0,Fe.jsx)("div",{className:ls,children:(0,Fe.jsx)("p",{children:"Loading molecule..."})}),(0,Fe.jsx)("div",{ref:i,className:Mt,style:{opacity:u?.5:1}}),s&&le.length>0&&(0,Fe.jsx)("button",{className:Ut,onClick:()=>Y(!G),children:G?"Hide":"Orbitals"})]}),s&&le.length>0&&(0,Fe.jsxs)("div",{className:`${Yt} ${G?Zt:""}`,children:[(0,Fe.jsxs)("div",{className:Wt,children:[(0,Fe.jsx)("h5",{children:"Molecular Orbitals"}),(0,Fe.jsx)("button",{className:Kt,onClick:()=>Y(!1),title:"Close orbital panel",children:"\xd7"})]}),(0,Fe.jsxs)("div",{className:Jt,children:[(0,Fe.jsxs)("button",{className:es,onClick:()=>I(!H),children:[(0,Fe.jsx)("span",{children:"Settings"}),(0,Fe.jsx)("span",{className:`${ts} ${H?ss:""}`,children:"\u25bc"})]}),H&&(0,Fe.jsx)("div",{className:as,children:(0,Fe.jsxs)("div",{className:Qt,children:[(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Style"}),(0,Fe.jsxs)("select",{value:P,onChange:e=>X(e.target.value),className:Rt,children:[(0,Fe.jsx)("option",{value:"surface",children:"Surface"}),(0,Fe.jsx)("option",{value:"wireframe",children:"Wireframe"}),(0,Fe.jsx)("option",{value:"dot",children:"Dot Volume"}),(0,Fe.jsx)("option",{value:"slice",children:"Slice Volume"})]})]}),("surface"===P||"wireframe"===P)&&(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Isovalue"}),(0,Fe.jsx)("input",{type:"number",min:"0.001",max:"0.2",step:"0.001",value:_,onChange:e=>S(parseFloat(e.target.value)||.01),className:It})]}),"slice"===P&&(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Slice Direction"}),(0,Fe.jsxs)("select",{value:Z,onChange:e=>U(e.target.value),className:Rt,children:[(0,Fe.jsx)("option",{value:"x",children:"X-axis"}),(0,Fe.jsx)("option",{value:"y",children:"Y-axis"}),(0,Fe.jsx)("option",{value:"z",children:"Z-axis"})]})]}),(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Slice Position"}),(0,Fe.jsxs)("div",{className:Dt,children:[(0,Fe.jsx)("button",{onClick:()=>K(W-.5),className:Ft,title:"Move slice by -0.5",children:"-"}),(0,Fe.jsx)("input",{type:"number",step:"0.1",value:W,onChange:e=>K(parseFloat(e.target.value)||0),className:It,title:"Slice position in Angstroms"}),(0,Fe.jsx)("button",{onClick:()=>K(W+.5),className:Ft,title:"Move slice by +0.5",children:"+"})]})]}),(0,Fe.jsxs)("div",{className:Vt,children:[(0,Fe.jsxs)("button",{className:Bt,onClick:()=>ae(!se),children:[(0,Fe.jsx)("span",{className:Lt,children:"Color Range"}),(0,Fe.jsx)("span",{className:`${ts} ${se?ss:""}`,children:"\u25bc"})]}),se&&(0,Fe.jsx)("div",{className:qt,children:(0,Fe.jsxs)("div",{className:At,children:[(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Minimum"}),(0,Fe.jsx)("input",{type:"number",step:"0.01",value:ee[0],onChange:e=>te([parseFloat(e.target.value)||0,ee[1]]),className:It,title:"Minimum value for color scale"})]}),(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Maximum"}),(0,Fe.jsx)("input",{type:"number",step:"0.01",value:ee[1],onChange:e=>te([ee[0],parseFloat(e.target.value)||.05]),className:It,title:"Maximum value for color scale"})]})]})})]})]}),(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Opacity"}),(0,Fe.jsx)("input",{type:"number",min:"0",max:"1",step:"0.05",value:w,onChange:e=>k(parseFloat(e.target.value)||1),className:It,title:"Orbital surface opacity (0 = transparent, 1 = opaque)"})]}),(0,Fe.jsxs)("div",{className:zt,children:[(0,Fe.jsx)("label",{className:Lt,children:"Grid Steps"}),(0,Fe.jsx)("input",{type:"number",min:"20",max:"60",step:"5",value:O,onChange:e=>L(parseInt(e.target.value)||40),className:It,title:"Number of grid points per dimension (higher = more detail, slower)"}),n&&(0,Fe.jsxs)("label",{className:Tt,children:[(0,Fe.jsx)("input",{type:"checkbox",checked:D,onChange:e=>V(e.target.checked),className:Ht}),"Bounds"]})]}),F&&(0,Fe.jsx)("div",{className:zt,children:(0,Fe.jsx)("span",{className:Pt,children:"Computing MO..."})})]})})]}),(0,Fe.jsx)("div",{className:rs,children:ie.map(((e,t)=>{const s=le.findIndex(((e,t)=>e.isOccupied&&(!le[t+1]||!le[t+1].isOccupied))),a=s>=0?s+1:-1,r=e.index===s,n=e.index===a,l=b.has(e.index),i=E.get(e.index);return(0,Fe.jsx)(Ns,{orbital:e,isHOMO:r,isLUMO:n,isSelected:l,colorIndicator:i,onColorChange:t=>((e,t)=>{z((s=>{const a=new Map(s);return a.set(e,t),a})),T.current&&clearTimeout(T.current),b.has(e)&&(T.current=setTimeout((()=>{ce(),T.current=null}),50))})(e.index,t),onClick:()=>{return t=e.index,void y((e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s}));var t}},e.index)}))})]})]})]}):(0,Fe.jsx)("div",{className:$t,children:(0,Fe.jsxs)("div",{className:ns,children:[(0,Fe.jsx)("h4",{children:"Molecule Viewer"}),(0,Fe.jsx)("p",{children:"Load a molecule to see its 3D structure"})]})})};var ys=s(6370);const _s=()=>{const[e,t]=(0,a.useState)(null),[r,he]=(0,a.useState)(!1),[pe,xe]=(0,a.useState)(""),[ve,je]=(0,a.useState)(null),[ge,fe]=(0,a.useState)(!1),[Ne,be]=(0,a.useState)(null),[ye,_e]=(0,a.useState)([]),[Se,Ce]=(0,a.useState)("structure"),[$e,we]=(0,a.useState)(""),[ke,Me]=(0,a.useState)(""),[ze,Oe]=(0,a.useState)(new Map),[Le,Re]=(0,a.useState)(null),[Te,Ie]=(0,a.useState)(!0),[De,Ve]=(0,a.useState)(!0),[Be,qe]=(0,a.useState)(!0),[Ae,Pe]=(0,a.useState)("hf"),[Xe,Ge]=(0,a.useState)("3-21g"),[Ye,Ze]=(0,a.useState)(100),[Ue,We]=(0,a.useState)(1e-8),[Ke,Qe]=(0,a.useState)(2),[Je,et]=(0,a.useState)(!1),[tt,st]=(0,a.useState)(!1),[at,rt]=(0,a.useState)("optimization"),[nt,it]=(0,a.useState)(null),[ct,dt]=(0,a.useState)(!0);(0,a.useEffect)((()=>(ut(),()=>{e&&e.terminate()})),[]);const ut=async()=>{try{const e=new Worker(new URL(s.p+s.u(842),s.b),{type:void 0});e.onmessage=mt,e.onerror=e=>{console.error("Worker error:",e),we("Worker error: "+e.message),he(!1)},t(e),e.postMessage({type:"init",data:{}})}catch($e){console.error("Failed to initialize worker:",$e),we("Failed to initialize Web Worker: "+$e.message)}},mt=e=>{const{type:t,...s}=e.data;switch(t){case"initialized":s.success?(he(!0),pt("Worker initialized successfully","info")):(he(!1),we("Worker initialization failed: "+s.error));break;case"log":pt(s.message,ht(s.level));break;case"progress":pt(s.message,"info"),"complete"===s.stage&&fe(!1);break;case"result":xt(s);break;case"optimization_progress":pt(s.message,"info");break;case"cubeResult":vt(s);break;case"error":console.error("Worker error:",s.error),we("Calculation error: "+s.error),fe(!1)}},ht=e=>{switch(e){case 0:case 1:return"debug";case 2:default:return"info";case 3:return"warn";case 4:case 5:return"error"}},pt=(e,t)=>{_e((s=>[...s,{message:e,level:t,timestamp:new Date}]))},xt=e=>{fe(!1),e.success?(be(e.results),Ce("results"),pt("Calculation completed successfully!","info")):we("Calculation failed: "+e.error)},vt=e=>{if(e.success){const t="molecular_orbital"===e.cubeType?`${e.cubeType}_${e.orbitalIndex}_${e.gridSteps||40}`:e.cubeType;Oe((s=>new Map(s.set(t,e.cubeData)))),e.gridInfo&&Re(e.gridInfo),pt(`Cube computation completed: ${e.cubeType}${void 0!==e.orbitalIndex?` (orbital ${e.orbitalIndex})`:""} [${e.gridSteps||40} steps]`,"info")}else we(`Cube computation failed: ${e.error}`),pt(`Cube computation failed: ${e.error}`,"error")},jt=(e,t,s)=>{const a=e.trim().split("\n"),r=parseInt(a[0]),n=[];for(let l=0;l<5;l++){const e=[r.toString()];e.push(`Mode ${s+1}: ${Math.abs(t).toFixed(2)} cm\u207b\xb9 (normal mode data unavailable)`);for(let t=2;t<a.length;t++)e.push(a[t]);n.push(e.join("\n"))}return n.join("\n")},gt=()=>Ne?.frequencies?.frequencies?Ne.frequencies.frequencies.map(((e,t)=>({freq:e,index:t}))).filter((({freq:e})=>!ct||Math.abs(e)>=50)):[];return(0,Fe.jsxs)("div",{className:n,children:[(0,Fe.jsxs)("div",{className:l,children:[(0,Fe.jsxs)("div",{className:i,children:[(0,Fe.jsx)("div",{className:`${g} ${r?N:f}`,children:r?"\u2713 Ready":"\u23f3 Loading..."}),(0,Fe.jsxs)("div",{className:m,children:[(0,Fe.jsxs)("button",{className:h,onClick:()=>Ve(!De),children:[(0,Fe.jsx)("span",{className:p,children:"Molecule Input"}),(0,Fe.jsx)("span",{className:`${x} ${De?j:""}`,children:"\u25bc"})]}),De&&(0,Fe.jsxs)("div",{className:v,children:[(0,Fe.jsx)(Ee,{onFileLoad:e=>{xe(e),Oe(new Map),be(null),we(""),Ce("structure"),Me("");try{const t=e.trim().split("\n"),s=parseInt(t[0]),a=t[1]||"Loaded Molecule",r=new Map;for(let e=2;e<2+s;e++){const s=t[e].trim().split(/\s+/)[0];r.set(s,(r.get(s)||0)+1)}const n=Array.from(r.entries()).map((([e,t])=>t>1?`${e}${t}`:e)).join("");je({name:a,formula:n,numAtoms:s}),pt(`Molecule loaded: ${n} (${s} atoms) - cleared orbital cache`,"info")}catch($e){console.error("Error parsing XYZ:",$e)}},onValidationChange:(e,t)=>{Ie(e),Me(!e&&t?t:"")}}),ve&&(0,Fe.jsx)("div",{className:b,children:(0,Fe.jsxs)("div",{children:[(0,Fe.jsx)("strong",{children:ve.formula})," (",ve.numAtoms," atoms)"]})})]})]}),pe&&(0,Fe.jsxs)("div",{className:m,children:[(0,Fe.jsxs)("button",{className:h,onClick:()=>qe(!Be),children:[(0,Fe.jsx)("span",{className:p,children:"Calculation Settings"}),(0,Fe.jsx)("span",{className:`${x} ${Be?j:""}`,children:"\u25bc"})]}),Be&&(0,Fe.jsx)("div",{className:v,children:(0,Fe.jsx)(He,{method:Ae,setMethod:Pe,basisSet:Xe,setBasisSet:Ge,maxIterations:Ye,setMaxIterations:Ze,energyTolerance:Ue,setEnergyTolerance:We,logLevel:Ke,setLogLevel:Qe,optimize:Je,setOptimize:e=>{et(e),e||st(!1)},computeFrequencies:tt,setComputeFrequencies:st})})]}),pe&&(0,Fe.jsxs)("div",{className:_,children:[(0,Fe.jsx)("button",{className:`${y} ${S}`,onClick:()=>{if(!pe)return void we("Please load a molecule first.");if(!Te)return;if(!e||!r)return void we("Web Worker not ready.");be(null),_e([]),Ce("output"),fe(!0),e.postMessage({type:"setLogLevel",data:{level:Ke}});const t={xyzData:pe,method:Ae,basisSet:Xe,maxIterations:Ye,energyTolerance:Ue,optimize:Je,computeFrequencies:tt};pt("Starting calculation...","info"),e.postMessage({type:"calculate",data:t})},disabled:ge||!r||!Te,children:ge?"Calculating...":"Run Calculation"}),ge&&(0,Fe.jsx)("button",{className:`${y} ${C}`,onClick:()=>{e&&ge&&(e.terminate(),pt("Calculation cancelled. Restarting worker...","warn"),ut(),fe(!1))},children:"Cancel"})]})]}),(0,Fe.jsxs)("div",{className:o,children:[pe&&(0,Fe.jsxs)("div",{className:c,children:[(0,Fe.jsx)("button",{className:`${d} ${"output"===Se?$:""}`,onClick:()=>Ce("output"),children:"Output"}),(0,Fe.jsx)("button",{className:`${d} ${"results"===Se?$:""}`,onClick:()=>Ce("results"),children:"Results"}),(0,Fe.jsx)("button",{className:`${d} ${"structure"===Se?$:""}`,onClick:()=>Ce("structure"),children:"Structure"}),(0,Fe.jsx)("button",{className:`${d} ${"properties"===Se?$:""}`,onClick:()=>Ce("properties"),children:"Properties"}),Ne?.optimization&&(0,Fe.jsx)("button",{className:`${d} ${"optimization"===Se?$:""}`,onClick:()=>Ce("optimization"),children:"Optimization"})]}),(0,Fe.jsxs)("div",{className:u,children:["output"===Se&&(0,Fe.jsx)(ot,{logs:ye}),"results"===Se&&(0,Fe.jsx)(lt,{results:Ne}),"structure"===Se&&(0,Fe.jsx)("div",{className:k,children:pe?(0,Fe.jsx)(bs,{xyzData:Ne?.optimization?.finalXYZ?Ne.optimization.finalXYZ:pe,moleculeName:`${ve?.name||"Molecule"}${Ne?.optimization?" (Optimized)":""}`,wavefunctionResults:Ne,cubeResults:ze,cubeGridInfo:Le,onRequestCubeComputation:(t,s,a)=>{e&&r?Ne&&Ne.wavefunctionData?(pt(`Requesting ${t} cube computation...`,"info"),e.postMessage({type:"computeCube",data:{cubeType:t,orbitalIndex:s,gridSteps:a||40}})):we("No wavefunction data available for cube computation."):we("Web Worker not ready for cube computation.")}}):(0,Fe.jsxs)("div",{className:F,children:[(0,Fe.jsx)("h3",{children:"No Structure Loaded"}),(0,Fe.jsx)("p",{children:"Load a molecule to see its 3D structure visualization."})]})}),"properties"===Se&&Ne&&(0,Fe.jsxs)("div",{className:w,children:[Ne.orbitalEnergies&&Ne.orbitalEnergies.length>0&&(0,Fe.jsxs)("div",{className:z,children:[(0,Fe.jsx)("h4",{children:"Orbital Energies"}),(0,Fe.jsx)("div",{className:O,children:Ne.orbitalEnergies.slice(0,20).map(((e,t)=>{const s=Ne.orbitalOccupations?.[t]??0,a={index:t,energy:27.2114*e,occupation:s,isOccupied:s>0};return(0,Fe.jsx)(Ns,{orbital:a},t)}))}),Ne.orbitalEnergies.length>20&&(0,Fe.jsxs)("div",{className:L,children:["... and ",Ne.orbitalEnergies.length-20," more orbitals"]})]}),Ne.matrices&&Object.keys(Ne.matrices).length>0?(0,Fe.jsx)("div",{className:M,children:Object.entries(Ne.matrices).map((([e,t])=>t?(0,Fe.jsx)(St,{matrix:t,title:`${e.charAt(0).toUpperCase()}${e.slice(1)} Matrix`,precision:6,maxDisplaySize:6},e):null))}):(0,Fe.jsx)("div",{className:E,children:(0,Fe.jsx)("p",{children:"No matrix data available. Matrices are generated during SCF calculations and may depend on the calculation method and settings."})})]}),"optimization"===Se&&Ne?.optimization&&(0,Fe.jsxs)("div",{className:H,children:[(0,Fe.jsx)("div",{className:D,children:(0,Fe.jsxs)("div",{className:I,children:[(0,Fe.jsx)("h4",{children:"Optimization Summary"}),(0,Fe.jsxs)("div",{className:V,children:[(0,Fe.jsxs)("div",{className:B,children:[(0,Fe.jsx)("span",{className:q,children:"Converged:"}),(0,Fe.jsx)("span",{className:`${A} ${Ne.optimization.trajectory.converged?P:X}`,children:Ne.optimization.trajectory.converged?"Yes":"No"})]}),(0,Fe.jsxs)("div",{className:B,children:[(0,Fe.jsx)("span",{className:q,children:"Steps:"}),(0,Fe.jsx)("span",{className:A,children:Ne.optimization.steps})]}),(0,Fe.jsxs)("div",{className:B,children:[(0,Fe.jsx)("span",{className:q,children:"Final Energy:"}),(0,Fe.jsxs)("span",{className:A,children:[Ne.energy.toFixed(8)," Ha"]})]}),(0,Fe.jsxs)("div",{className:B,children:[(0,Fe.jsx)("span",{className:q,children:"Final Energy:"}),(0,Fe.jsxs)("span",{className:A,children:[Ne.energyInEV.toFixed(4)," eV"]})]})]})]})}),(0,Fe.jsxs)("div",{className:Y,children:[(0,Fe.jsx)("div",{className:Z,children:(0,Fe.jsx)("div",{className:G,children:(0,Fe.jsx)(ys.A,{trajectoryData:"normal_mode"===at&&null!==nt?(e=>{if(!Ne?.optimization?.finalXYZ||!Ne?.frequencies?.normalModes)return console.log("Missing data for normal mode trajectory:",{hasXYZ:!!Ne?.optimization?.finalXYZ,hasNormalModes:!!Ne?.frequencies?.normalModes,normalModesLength:Ne?.frequencies?.normalModes?.length}),"";const t=Ne.optimization.finalXYZ,s=Ne.frequencies.normalModes[e],a=Ne.frequencies.frequencies[e];if(!s||0===s.length)return console.log("Normal mode data not available for mode",e,"normalMode:",s),jt(t,a,e);const r=t.trim().split("\n"),n=parseInt(r[0]);if(r[1],r.length<n+2)return"";const l=[];for(let o=2;o<2+n;o++){const e=r[o].trim().split(/\s+/);l.push({element:e[0],x:parseFloat(e[1]),y:parseFloat(e[2]),z:parseFloat(e[3])})}const i=[];for(let o=0;o<20;o++){const t=2*Math.PI*o/20,r=.3*Math.sin(t),c=[n.toString()];c.push(`Mode ${e+1}: ${Math.abs(a).toFixed(2)} cm\u207b\xb9 ${a<0?"(imaginary)":""}`);for(let e=0;e<n;e++){const t=l[e],a=s[3*e]||0,n=s[3*e+1]||0,i=s[3*e+2]||0,o=t.x+r*a,d=t.y+r*n,u=t.z+r*i;c.push(`${t.element}  ${o.toFixed(6)}  ${d.toFixed(6)}  ${u.toFixed(6)}`)}i.push(c.join("\n"))}return i.join("\n")})(nt):"optimization"===at&&Ne?.optimization?.trajectory?(e=>{if(!e||!e.geometries||!e.energies)return"";const t=[];return e.geometries.forEach(((s,a)=>{const r=e.energies[a],n=s.trim().split("\n");if(n.length>=2){const e=n[0],s=`Step ${a} Energy=${r.toFixed(9)}`,l=n.slice(2).join("\n");t.push(`${e}\n${s}\n${l}`)}})),t.join("\n")})(Ne.optimization.trajectory):"",moleculeName:(()=>{if("normal_mode"===at&&null!==nt&&Ne?.frequencies?.frequencies){const e=Ne.frequencies.frequencies[nt];return`Mode ${nt+1}: ${Math.abs(e).toFixed(2)} cm\u207b\xb9`}return"optimization"===at?`${ve?.formula||"Molecule"} Optimization`:"Trajectory"})(),autoPlay:"normal_mode"===at,initialSpeed:"normal_mode"===at?60:20})})}),(0,Fe.jsxs)("div",{className:U,children:[(0,Fe.jsx)("div",{className:W,children:(0,Fe.jsx)("h4",{children:"Trajectory Controls"})}),(0,Fe.jsx)("div",{className:K,children:(0,Fe.jsx)("button",{onClick:()=>{rt("optimization"),it(null)},className:`${Q} ${"optimization"===at?J:""}`,children:"Optimization Path"})}),Ne.frequencies&&Ne.frequencies.frequencies.length>0&&(0,Fe.jsxs)("div",{className:ee,children:[(0,Fe.jsxs)("div",{className:te,children:[(0,Fe.jsx)("h5",{children:"Normal Modes"}),(0,Fe.jsx)("div",{className:se,children:(0,Fe.jsxs)("label",{className:ae,children:[(0,Fe.jsx)("input",{type:"checkbox",checked:ct,onChange:e=>{dt(e.target.checked),e.target.checked&&null!==nt&&Ne.frequencies.frequencies[nt]&&Math.abs(Ne.frequencies.frequencies[nt])<50&&(it(null),rt("optimization"))},className:re}),"Hide low modes (< 50 cm\u207b\xb9)"]})})]}),(0,Fe.jsx)("div",{className:ne,children:gt().map((({freq:e,index:t})=>(0,Fe.jsxs)("div",{className:le,children:[(0,Fe.jsxs)("div",{className:ie,children:[(0,Fe.jsxs)("div",{className:oe,children:["Mode ",t+1]}),(0,Fe.jsxs)("div",{className:ce,children:[e<0?`${Math.abs(e).toFixed(1)}i`:e.toFixed(1)," cm\u207b\xb9"]}),e<0&&(0,Fe.jsx)("div",{className:de,children:"imag"})]}),(0,Fe.jsx)("button",{onClick:()=>{rt("normal_mode"),it(t)},className:`${ue} ${"normal_mode"===at&&nt===t?J:""}`,disabled:!Ne.frequencies.normalModes||0===Ne.frequencies.normalModes.length,children:"normal_mode"===at&&nt===t?"Playing":"Play"})]},t)))}),(0,Fe.jsxs)("div",{className:me,children:["Showing ",gt().length," of ",Ne.frequencies.frequencies.length," modes"]})]})]})]})]})]})]})]}),$e&&!ke&&(0,Fe.jsx)("div",{className:R,children:(0,Fe.jsxs)("div",{className:T,children:[(0,Fe.jsx)("h3",{children:"Error"}),(0,Fe.jsx)("p",{children:$e}),(0,Fe.jsx)("button",{onClick:()=>we(""),children:"Close"})]})})]})};function Ss(){return(0,Fe.jsx)(r.A,{title:"Wavefunction Calculator",description:"Quantum Chemistry Calculations in Your Browser",children:(0,Fe.jsx)("main",{style:{minHeight:"calc(100vh - 60px)"},children:(0,Fe.jsx)(_s,{})})})}},6370:(e,t,s)=>{s.d(t,{A:()=>q});var a=s(6540),r=s(7851);const n="container_kZ5w",l="header_HEr1",i="controls_ixvO",o="controlButton_GDgO",c="representationControls_zQqr",d="controlGroup_r1Gu",u="inlineControlGroup_xXdM",m="controlLabel_WiJU",h="controlSelect_i5Ps",p="viewer_WviD",x="loadingOverlay_lwCV",v="errorOverlay_rmFC",j="loadingSpinner_PLZ5",g="errorMessage_qkbu",f="frameInfoOverlay_vX3K",N="frameNumber_EMUy",b="frameComment_F9wg",y="frameEnergy_RPyN",_="trajectoryControls_t0nZ",S="playerControls_ukm9",C="playerButton_Mfw8",$="firstFrame_yeaq",w="prevFrame_8ROf",k="nextFrame_EuyI",F="lastFrame__ZJ0",M="playPauseButton_PlTX",E="playing_EHSL",z="paused_cbF1",O="sliderContainer_y7_P",L="frameSlider_B4ss",R="speedControl_qcka",T="speedLabel_DCOl",H="speedSlider_PBkR",I="speedValue_Xkoz",D="keyboardHints_eduS",V="hint_AlSv";var B=s(4848);const q=({trajectoryData:e,xyzFrames:t,moleculeName:s="Trajectory",autoPlay:q=!1,initialSpeed:A=100})=>{const P=(0,a.useRef)(null),X=(0,a.useRef)(null),G=(0,a.useRef)(null),Y=(0,a.useRef)(null),Z=(0,a.useRef)(null),[U,W]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(""),[J,ee]=(0,a.useState)(0),[te,se]=(0,a.useState)(0),[ae,re]=(0,a.useState)(!1),[ne,le]=(0,a.useState)(30),[ie,oe]=(0,a.useState)("ball+stick"),[ce,de]=(0,a.useState)(!0),[ue,me]=(0,a.useState)("element"),[he,pe]=(0,a.useState)([]),[xe,ve]=(0,a.useState)([]),[je,ge]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!P.current)return;X.current=new r.BI(P.current,{backgroundColor:"white",quality:"medium",clipNear:1e-6,clipFar:100,clipDist:10});const e=()=>{X.current&&X.current.handleResize()};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),X.current&&X.current.dispose()}}),[]);const fe=e=>{const t=[/Energy\s*=\s*(-?\d+\.?\d*)/i,/E\s*=\s*(-?\d+\.?\d*)/i,/E\s+(-?\d+\.?\d*)/i,/energy:\s*(-?\d+\.?\d*)/i,/(-?\d+\.\d+)\s*(?:hartree|ha|au)/i];for(const s of t){const t=e.match(s);if(t){const e=parseFloat(t[1]);if(!isNaN(e))return e}}return null},Ne=async e=>{if(X.current){W(!0),Q("");try{X.current.removeAllComponents(),Y.current=null,Z.current=null;const t=(e=>{let t="";return e.forEach(((e,s)=>{t+=`MODEL     ${(s+1).toString().padStart(4," ")}\n`;const a=e.trim().split("\n"),r=parseInt(a[0]);for(let n=0;n<r;n++){const e=a[n+2].trim().split(/\s+/),s=e[0],r=parseFloat(e[1]),l=parseFloat(e[2]),i=parseFloat(e[3]),o=(n+1).toString().padStart(5," "),c=s.padEnd(4," "),d="MOL",u="A",m="1".padStart(4," "),h=r.toFixed(3).padStart(8," "),p=l.toFixed(3).padStart(8," "),x=i.toFixed(3).padStart(8," "),v="1.00".padStart(6," "),j="0.00".padStart(6," "),g=s.padStart(2," ");t+=`ATOM  ${o} ${c} ${d} ${u}${m}    ${h}${p}${x}${v}${j}          ${g}\n`}t+="ENDMDL\n"})),t+="END\n",t})(e),a=new Blob([t],{type:"text/plain"}),r=await X.current.loadFile(a,{ext:"pdb",name:s,asTrajectory:!0});G.current=r,se(e.length),be();const n=r.addTrajectory();if(Y.current=n,n.trajectory&&n.trajectory.player){const e=n.trajectory.player;Z.current=e;const t=Math.round(1e3/ne);e.parameters&&(e.parameters.timeout=t,e.parameters.mode="loop",e.parameters.step=1,e.parameters.direction="forward"),e.signals&&(e.signals.startedRunning&&e.signals.startedRunning.add((()=>{re(!0)})),e.signals.haltedRunning&&e.signals.haltedRunning.add((()=>{re(!1)})))}n.trajectory&&n.trajectory.signals&&n.trajectory.signals.frameChanged&&n.trajectory.signals.frameChanged.add((e=>{ee(e)})),X.current.autoView(),q&&Z.current&&setTimeout((()=>Z.current.play()),500),W(!1)}catch(t){console.error("Error loading trajectory:",t),Q(`Failed to load trajectory: ${t.message}`),W(!1)}}},be=()=>{if(!G.current)return;G.current.removeAllRepresentations();const e={colorScheme:ue,sele:ce?"all":"not hydrogen"};switch(ie){case"ball+stick":e.radiusScale=.8,e.bondScale=.3;break;case"line":e.linewidth=2;break;case"spacefill":e.radiusScale=1;break;case"licorice":e.bondScale=.5,e.multipleBond=!0}G.current.addRepresentation(ie,e),X.current?.autoView()};(0,a.useEffect)((()=>{const s=()=>{if(Z.current)if("function"==typeof Z.current.pause)try{Z.current.pause()}catch(e){}else Z.current.intervalId&&clearInterval(Z.current.intervalId);re(!1)};if(e){const t=(e=>{const t=e.trim().split("\n"),s=[],a=[],r=[];let n=0;for(;n<t.length;){const e=parseInt(t[n]);if(isNaN(e)){n++;continue}const l=t.slice(n,n+e+2);s.push(l.join("\n"));const i=t[n+1]||"";r.push(i);const o=fe(i);a.push(o),n+=e+2}pe(a),ve(r);const l=a.filter((e=>null!==e));return l.length>0?ge(Math.min(...l)):ge(null),s})(e);t.length>0&&(s(),setTimeout((()=>Ne(t)),50))}else t&&t.length>0&&(s(),setTimeout((()=>Ne(t)),50));return s}),[e,t]),(0,a.useEffect)((()=>{be()}),[ie,ce,ue]);const ye=()=>{if(Z.current&&"function"==typeof Z.current.play)Z.current.play();else if(Y.current&&Y.current.trajectory&&te>1){re(!0);let e=J;const t=setInterval((()=>{try{Y.current&&Y.current.trajectory?(e=(e+1)%te,Y.current.trajectory.setFrame(e),ee(e)):(clearInterval(t),re(!1))}catch(s){console.warn("Trajectory disposed during playback, stopping:",s.message),clearInterval(t),re(!1)}}),Math.round(1e3/ne));Z.current={intervalId:t}}},_e=()=>{Z.current&&("function"==typeof Z.current.pause?Z.current.pause():Z.current.intervalId&&(clearInterval(Z.current.intervalId),Z.current=null)),re(!1)},Se=e=>{try{Y.current&&Y.current.trajectory&&Y.current.trajectory.setFrame(e)}catch(t){console.warn("Cannot set frame on disposed trajectory:",t.message)}};return(0,a.useEffect)((()=>{const e=e=>{if(!(te<=1||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement))switch(e.code){case"Space":e.preventDefault(),ae?_e():ye();break;case"ArrowLeft":e.preventDefault(),Se(Math.max(0,J-1));break;case"ArrowRight":e.preventDefault(),Se(Math.min(te-1,J+1));break;case"Home":e.preventDefault(),Se(0);break;case"End":e.preventDefault(),Se(te-1)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[te,J,ae]),(0,B.jsxs)("div",{className:n,children:[(0,B.jsxs)("div",{className:l,children:[(0,B.jsx)("h4",{children:s}),(0,B.jsxs)("div",{className:i,children:[(0,B.jsx)("button",{onClick:()=>{X.current&&X.current.autoView(1e3)},className:o,children:"Reset View"}),(0,B.jsx)("button",{onClick:()=>{X.current&&X.current.toggleFullscreen(P.current)},className:o,children:"Fullscreen"})]})]}),(0,B.jsx)("div",{className:c,children:(0,B.jsxs)("div",{className:d,children:[(0,B.jsxs)("div",{className:u,children:[(0,B.jsx)("label",{className:m,children:"Style:"}),(0,B.jsxs)("select",{value:ie,onChange:e=>oe(e.target.value),className:h,children:[(0,B.jsx)("option",{value:"ball+stick",children:"Ball & Stick"}),(0,B.jsx)("option",{value:"line",children:"Line"}),(0,B.jsx)("option",{value:"spacefill",children:"Spacefill"}),(0,B.jsx)("option",{value:"licorice",children:"Licorice"}),(0,B.jsx)("option",{value:"cartoon",children:"Cartoon"})]})]}),(0,B.jsxs)("div",{className:u,children:[(0,B.jsx)("label",{className:m,children:"Color:"}),(0,B.jsxs)("select",{value:ue,onChange:e=>me(e.target.value),className:h,children:[(0,B.jsx)("option",{value:"element",children:"Element"}),(0,B.jsx)("option",{value:"chainname",children:"Chain"}),(0,B.jsx)("option",{value:"residueindex",children:"Residue"}),(0,B.jsx)("option",{value:"bfactor",children:"B-factor"})]})]}),(0,B.jsxs)("div",{className:u,children:[(0,B.jsx)("input",{type:"checkbox",checked:ce,onChange:e=>de(e.target.checked),id:"showH"}),(0,B.jsx)("label",{htmlFor:"showH",className:m,children:"Show Hydrogens"})]})]})}),(0,B.jsxs)("div",{className:p,ref:P,children:[U&&(0,B.jsx)("div",{className:x,children:(0,B.jsx)("div",{className:j,children:"Loading trajectory..."})}),K&&(0,B.jsx)("div",{className:v,children:(0,B.jsx)("div",{className:g,children:K})}),te>0&&(0,B.jsxs)("div",{className:f,children:[(0,B.jsxs)("div",{className:N,children:["Frame ",J+1,"/",te]}),xe[J]&&(0,B.jsx)("div",{className:b,children:xe[J]}),null!==he[J]&&void 0!==he[J]&&null!==je&&(0,B.jsx)("div",{className:y,children:(()=>{const e=he[J]-je;return`${e>=0?"+":""}${(2625.5*e).toFixed(2)} kJ/mol`})()})]})]}),te>1&&(0,B.jsxs)("div",{className:_,children:[(0,B.jsxs)("div",{className:S,children:[(0,B.jsx)("button",{onClick:()=>Se(0),className:`${C} ${$}`,disabled:0===J,title:"First frame"}),(0,B.jsx)("button",{onClick:()=>Se(Math.max(0,J-1)),className:`${C} ${w}`,disabled:0===J,title:"Previous frame"}),(0,B.jsx)("button",{onClick:ae?_e:ye,className:`${C} ${M} ${ae?E:z}`,title:ae?"Pause":"Play"}),(0,B.jsx)("button",{onClick:()=>Se(Math.min(te-1,J+1)),className:`${C} ${k}`,disabled:J===te-1,title:"Next frame"}),(0,B.jsx)("button",{onClick:()=>Se(te-1),className:`${C} ${F}`,disabled:J===te-1,title:"Last frame"})]}),(0,B.jsx)("div",{className:O,children:(0,B.jsx)("input",{type:"range",min:"0",max:te-1,value:J,onChange:e=>Se(parseInt(e.target.value)),className:L})}),(0,B.jsxs)("div",{className:R,children:[(0,B.jsx)("label",{className:T,children:"FPS:"}),(0,B.jsx)("input",{type:"range",min:"10",max:"60",step:"5",value:ne,onChange:e=>(e=>{if(le(e),Z.current&&Z.current.parameters){const t=Math.round(1e3/e);Z.current.parameters.timeout=t,ae&&"function"==typeof Z.current.pause&&"function"==typeof Z.current.play&&(Z.current.pause(),Z.current.play())}})(parseInt(e.target.value)),className:H}),(0,B.jsx)("span",{className:I,children:ne})]}),(0,B.jsxs)("div",{className:D,children:[(0,B.jsx)("span",{className:V,children:"Spacebar: Play/Pause"}),(0,B.jsx)("span",{className:V,children:"\u2190 \u2192: Frame by frame"})]})]})]})}}}]);